<!DOCTYPE html>
<html>
<head>
    <title>Test de Repartidores - TRATO</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #0056b3; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        #results { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; white-space: pre-line; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test de Consistencia - Repartidores</h1>
        
        <div class="test-card">
            <h3>📋 Instrucciones:</h3>
            <ol>
                <li>Abre la aplicación TRATO en otra pestaña</li>
                <li>Inicia sesión como vendedor</li>
                <li>Observa si aparecen alertas de "Sin repartidores disponibles"</li>
                <li>Verifica el botón verde en la esquina superior derecha</li>
                <li>Usa los botones de abajo para hacer pruebas</li>
            </ol>
        </div>

        <div class="test-card">
            <h3>🔧 Pruebas Automáticas:</h3>
            <button class="button" onclick="openAppAndTest()">🚀 Abrir App y Testear</button>
            <button class="button" onclick="testConsistency()">🔍 Verificar Consistencia</button>
            <button class="button" onclick="monitorChanges()">📊 Monitorear 30s</button>
            <button class="button" onclick="clearResults()">🧹 Limpiar</button>
        </div>

        <div class="test-card">
            <h3>📊 Resultados:</h3>
            <div id="results">Ejecuta una prueba para ver resultados...</div>
        </div>

        <div class="test-card">
            <h3>💡 Códigos para la Consola del Navegador:</h3>
            <p>Copia y pega estos códigos en la consola de la app TRATO:</p>
            <textarea readonly style="width: 100%; height: 100px; font-family: monospace;">
// Verificar estado actual
testDriversConsistency();

// Monitorear cambios por 30 segundos  
monitorDriversChanges(30000);

// Forzar verificación del sistema
forceSystemCheck();
            </textarea>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            results.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = 'Limpiado...\n';
        }

        function openAppAndTest() {
            log('🚀 Abriendo aplicación TRATO...', 'info');
            window.open('http://localhost:5173/', 'trato-app');
            
            setTimeout(() => {
                log('💡 Ahora ve a la pestaña de TRATO y:');
                log('1. Abre las herramientas de desarrollador (F12)');
                log('2. Ve a la pestaña Console');
                log('3. Ejecuta: testDriversConsistency()');
                log('4. Observa si hay inconsistencias', 'warning');
            }, 2000);
        }

        async function testConsistency() {
            log('🔍 Verificando consistencia...', 'info');
            
            try {
                // Simular las mismas consultas que hace la app
                const response = await fetch('/api/test-drivers-consistency');
                if (response.ok) {
                    const result = await response.json();
                    log(`✅ Prueba completada: ${JSON.stringify(result)}`, 'success');
                } else {
                    log('⚠️ No se puede acceder a la API desde aquí', 'warning');
                    log('💡 Usa la consola del navegador en la app TRATO', 'info');
                }
            } catch (error) {
                log('💡 Para hacer la prueba completa:', 'info');
                log('1. Ve a http://localhost:5173/');
                log('2. Abre la consola (F12 > Console)');
                log('3. Ejecuta: testDriversConsistency()');
                log('4. Observa los resultados en la consola', 'warning');
            }
        }

        function monitorChanges() {
            log('📊 Iniciando monitoreo...', 'info');
            log('💡 Para monitoreo en tiempo real:');
            log('1. Ve a la consola de TRATO');
            log('2. Ejecuta: monitorDriversChanges(30000)');
            log('3. Observa cambios durante 30 segundos', 'warning');
            
            // Simular monitoreo local
            let count = 0;
            const interval = setInterval(() => {
                count++;
                log(`📊 Verificación ${count}/10 - Revisa la consola de TRATO`, 'info');
                
                if (count >= 10) {
                    clearInterval(interval);
                    log('⏹️ Monitoreo completado', 'success');
                }
            }, 3000);
        }

        // Auto-log inicial
        log('🧪 Herramienta de testing cargada', 'success');
        log('💡 Usa los botones de arriba para hacer pruebas', 'info');
    </script>
</body>
</html>
