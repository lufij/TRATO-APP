import{g as R,k as Y,r as f,a6 as xe,j as t,a7 as Q,l as j,H as C,G as ye,A as J,F as X,m as Te,J as Ne,o as M,u as P,N as O,s as k,t as N,C as _e,c as Ce,B as D,v as Ee,X as Z,f as V,p as L,e as ee,d as Ae}from"./index-BUZ7un_H.js";import{T as ke}from"./triangle-alert-989fNwCd.js";import{S as Re}from"./shopping-cart-Ou0eNDe7.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],ut=R("dollar-sign",je);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Ie=R("package",Se);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],ft=R("trending-up",De);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Fe=R("volume-2",Pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Oe=R("wifi-off",Me);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],qe=R("wifi",$e);var B="rovingFocusGroup.onEntryFocus",Ge={bubbles:!1,cancelable:!0},$="RovingFocusGroup",[U,te,Ve]=xe($),[Be,ne]=Y($,[Ve]),[Le,Ue]=Be($),re=f.forwardRef((e,o)=>t.jsx(U.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(U.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(ze,{...e,ref:o})})}));re.displayName=$;var ze=f.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:i,orientation:l,loop:u=!1,dir:g,currentTabStopId:c,defaultCurrentTabStopId:b,onCurrentTabStopIdChange:h,onEntryFocus:a,preventScrollOnEntryFocus:s=!1,...d}=e,m=f.useRef(null),w=ye(o,m),r=J(g),[n=null,v]=X({prop:c,defaultProp:b,onChange:h}),[p,x]=f.useState(!1),y=Te(a),_=te(i),S=f.useRef(!1),[q,A]=f.useState(0);return f.useEffect(()=>{const T=m.current;if(T)return T.addEventListener(B,y),()=>T.removeEventListener(B,y)},[y]),t.jsx(Le,{scope:i,orientation:l,dir:r,loop:u,currentTabStopId:n,onItemFocus:f.useCallback(T=>v(T),[v]),onItemShiftTab:f.useCallback(()=>x(!0),[]),onFocusableItemAdd:f.useCallback(()=>A(T=>T+1),[]),onFocusableItemRemove:f.useCallback(()=>A(T=>T-1),[]),children:t.jsx(j.div,{tabIndex:p||q===0?-1:0,"data-orientation":l,...d,ref:w,style:{outline:"none",...e.style},onMouseDown:C(e.onMouseDown,()=>{S.current=!0}),onFocus:C(e.onFocus,T=>{const I=!S.current;if(T.target===T.currentTarget&&I&&!p){const W=new CustomEvent(B,Ge);if(T.currentTarget.dispatchEvent(W),!W.defaultPrevented){const G=_().filter(E=>E.focusable),be=G.find(E=>E.active),we=G.find(E=>E.id===n),he=[be,we,...G].filter(Boolean).map(E=>E.ref.current);ae(he,s)}}S.current=!1}),onBlur:C(e.onBlur,()=>x(!1))})})}),oe="RovingFocusGroupItem",se=f.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:i,focusable:l=!0,active:u=!1,tabStopId:g,...c}=e,b=Q(),h=g||b,a=Ue(oe,i),s=a.currentTabStopId===h,d=te(i),{onFocusableItemAdd:m,onFocusableItemRemove:w}=a;return f.useEffect(()=>{if(l)return m(),()=>w()},[l,m,w]),t.jsx(U.ItemSlot,{scope:i,id:h,focusable:l,active:u,children:t.jsx(j.span,{tabIndex:s?0:-1,"data-orientation":a.orientation,...c,ref:o,onMouseDown:C(e.onMouseDown,r=>{l?a.onItemFocus(h):r.preventDefault()}),onFocus:C(e.onFocus,()=>a.onItemFocus(h)),onKeyDown:C(e.onKeyDown,r=>{if(r.key==="Tab"&&r.shiftKey){a.onItemShiftTab();return}if(r.target!==r.currentTarget)return;const n=We(r,a.orientation,a.dir);if(n!==void 0){if(r.metaKey||r.ctrlKey||r.altKey||r.shiftKey)return;r.preventDefault();let p=d().filter(x=>x.focusable).map(x=>x.ref.current);if(n==="last")p.reverse();else if(n==="prev"||n==="next"){n==="prev"&&p.reverse();const x=p.indexOf(r.currentTarget);p=a.loop?Ye(p,x+1):p.slice(x+1)}setTimeout(()=>ae(p))}})})})});se.displayName=oe;var Ke={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function He(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function We(e,o,i){const l=He(e.key,i);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return Ke[l]}function ae(e,o=!1){const i=document.activeElement;for(const l of e)if(l===i||(l.focus({preventScroll:o}),document.activeElement!==i))return}function Ye(e,o){return e.map((i,l)=>e[(o+l)%e.length])}var Qe=re,Je=se,z="Tabs",[Xe,mt]=Y(z,[ne]),ie=ne(),[Ze,K]=Xe(z),ce=f.forwardRef((e,o)=>{const{__scopeTabs:i,value:l,onValueChange:u,defaultValue:g,orientation:c="horizontal",dir:b,activationMode:h="automatic",...a}=e,s=J(b),[d,m]=X({prop:l,onChange:u,defaultProp:g});return t.jsx(Ze,{scope:i,baseId:Q(),value:d,onValueChange:m,orientation:c,dir:s,activationMode:h,children:t.jsx(j.div,{dir:s,"data-orientation":c,...a,ref:o})})});ce.displayName=z;var de="TabsList",le=f.forwardRef((e,o)=>{const{__scopeTabs:i,loop:l=!0,...u}=e,g=K(de,i),c=ie(i);return t.jsx(Qe,{asChild:!0,...c,orientation:g.orientation,dir:g.dir,loop:l,children:t.jsx(j.div,{role:"tablist","aria-orientation":g.orientation,...u,ref:o})})});le.displayName=de;var ue="TabsTrigger",fe=f.forwardRef((e,o)=>{const{__scopeTabs:i,value:l,disabled:u=!1,...g}=e,c=K(ue,i),b=ie(i),h=pe(c.baseId,l),a=ve(c.baseId,l),s=l===c.value;return t.jsx(Je,{asChild:!0,...b,focusable:!u,active:s,children:t.jsx(j.button,{type:"button",role:"tab","aria-selected":s,"aria-controls":a,"data-state":s?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:h,...g,ref:o,onMouseDown:C(e.onMouseDown,d=>{!u&&d.button===0&&d.ctrlKey===!1?c.onValueChange(l):d.preventDefault()}),onKeyDown:C(e.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&c.onValueChange(l)}),onFocus:C(e.onFocus,()=>{const d=c.activationMode!=="manual";!s&&!u&&d&&c.onValueChange(l)})})})});fe.displayName=ue;var me="TabsContent",ge=f.forwardRef((e,o)=>{const{__scopeTabs:i,value:l,forceMount:u,children:g,...c}=e,b=K(me,i),h=pe(b.baseId,l),a=ve(b.baseId,l),s=l===b.value,d=f.useRef(s);return f.useEffect(()=>{const m=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(m)},[]),t.jsx(Ne,{present:u||s,children:({present:m})=>t.jsx(j.div,{"data-state":s?"active":"inactive","data-orientation":b.orientation,role:"tabpanel","aria-labelledby":h,hidden:!m,id:a,tabIndex:0,...c,ref:o,style:{...e.style,animationDuration:d.current?"0s":void 0},children:m&&g})})});ge.displayName=me;function pe(e,o){return`${e}-trigger-${o}`}function ve(e,o){return`${e}-content-${o}`}var et=ce,tt=le,nt=fe,rt=ge;function gt({className:e,...o}){return t.jsx(et,{"data-slot":"tabs",className:M("flex flex-col gap-2",e),...o})}function pt({className:e,...o}){return t.jsx(tt,{"data-slot":"tabs-list",className:M("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",e),...o})}function vt({className:e,...o}){return t.jsx(nt,{"data-slot":"tabs-trigger",className:M("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...o})}function bt({className:e,...o}){return t.jsx(rt,{"data-slot":"tabs-content",className:M("flex-1 outline-none",e),...o})}var F=(e=>(e.NEW_ORDER="new-order",e.ORDER_ASSIGNED="order-assigned",e.ORDER_READY="order-ready",e.ORDER_DELIVERED="order-delivered",e.NEW_PRODUCT="new-product",e.GENERAL="general",e))(F||{});const ot={enabled:!0,volume:.7,sounds:{"new-order":{frequency:800,duration:300,pattern:"triple"},"order-assigned":{frequency:600,duration:200,pattern:"double"},"order-ready":{frequency:1e3,duration:250,pattern:"double"},"order-delivered":{frequency:500,duration:400,pattern:"single"},"new-product":{frequency:700,duration:200,pattern:"single"},general:{frequency:650,duration:200,pattern:"single"}}};function H(){const{user:e}=P(),{showOrderNotification:o,showDeliveryNotification:i,requestPermission:l}=O(),u=f.useRef(null),g=f.useRef(ot);f.useEffect(()=>{if(!u.current)try{u.current=new(window.AudioContext||window.webkitAudioContext)}catch(r){console.warn("Web Audio API not supported:",r)}return l().then(r=>{r?console.log("✅ Permisos de notificación concedidos"):console.warn("⚠️ Permisos de notificación denegados")}),()=>{if(u.current&&u.current.state!=="closed")try{u.current.close().catch(r=>{console.warn("Error closing AudioContext:",r)})}catch(r){console.warn("Error closing AudioContext:",r)}}},[l]);const c=f.useCallback(r=>{if(!g.current.enabled||!u.current)return;const n=g.current.sounds[r],v=u.current;if(v.state==="closed"){console.warn("AudioContext is closed, cannot play sound");return}v.state==="suspended"&&v.resume().catch(x=>{console.warn("Error resuming AudioContext:",x)});const p=(x=0)=>{setTimeout(()=>{try{if(v.state==="closed")return;const y=v.createOscillator(),_=v.createGain();y.connect(_),_.connect(v.destination),y.frequency.value=n.frequency,y.type="sine",_.gain.setValueAtTime(0,v.currentTime),_.gain.linearRampToValueAtTime(g.current.volume,v.currentTime+.01),_.gain.exponentialRampToValueAtTime(.01,v.currentTime+n.duration/1e3),y.start(v.currentTime),y.stop(v.currentTime+n.duration/1e3)}catch(y){console.warn("Error playing sound tone:",y)}},x)};switch(n.pattern){case"single":p();break;case"double":p(),p(n.duration+100);break;case"triple":p(),p(n.duration+100),p((n.duration+100)*2);break}},[]),b=f.useCallback(()=>{if(!e||e.role!=="vendedor")return;const r=k.channel("vendor-sound-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${e.id}`},n=>{console.log("🔊 Vendor: New order notification with sound"),c("new-order"),window.notifyNewOrder&&window.notifyNewOrder({id:n.new.id,customer_name:n.new.customer_name||"Cliente",total:n.new.total_amount||n.new.total||0,delivery_type:n.new.delivery_type||"pickup"}),o({customer_name:n.new.customer_name||"Cliente",total:n.new.total_amount||n.new.total||0,delivery_type:n.new.delivery_type||"pickup",order_id:n.new.id}),N.success("¡Nueva orden recibida!",{description:`Pedido por Q${n.new.total_amount||n.new.total||0}`,duration:5e3})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`seller_id=eq.${e.id}`},n=>{var x,y;const v=(x=n.old)==null?void 0:x.status,p=(y=n.new)==null?void 0:y.status;v==="ready"&&p==="assigned"&&(console.log("🔊 Vendor: Driver assigned notification with sound"),c("order-assigned"),window.notifyDriverAssigned&&window.notifyDriverAssigned({id:n.new.id,customer_name:n.new.customer_name}),i("Un repartidor aceptó la entrega"),N.info("Repartidor asignado",{description:"Un repartidor aceptó la entrega",duration:4e3})),p==="delivered"&&(console.log("🔊 Vendor: Order delivered notification with sound"),c("order-delivered"),i("El pedido fue entregado exitosamente"),N.success("Pedido entregado",{description:"El pedido fue entregado exitosamente",duration:4e3}))}).subscribe();return()=>r.unsubscribe()},[e,c]),h=f.useCallback(()=>{if(!e||e.role!=="repartidor")return;const r=k.channel("driver-sound-notifications").on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:"status=eq.ready"},n=>{console.log("🔊 Driver: New delivery available with sound"),c("order-ready"),window.notifyDeliveryAvailable&&window.notifyDeliveryAvailable({id:n.new.id,customer_name:n.new.customer_name||"Cliente",delivery_address:n.new.delivery_address||"Dirección no especificada",total:n.new.total_amount||n.new.total||0}),i("Nueva entrega disponible",`Pedido de Q${n.new.total_amount||n.new.total||0} listo para recoger`),N.info("¡Nueva entrega disponible!",{description:`Pedido de Q${n.new.total_amount||n.new.total||0} listo para recoger`,duration:6e3})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`driver_id=eq.${e.id}`},n=>{var p;((p=n.new)==null?void 0:p.status)==="assigned"&&(console.log("🔊 Driver: Order assigned to you with sound"),c("order-assigned"),i("Entrega asignada","Tienes una nueva entrega asignada"),N.success("Entrega asignada",{description:"Tienes una nueva entrega asignada",duration:4e3}))}).subscribe();return()=>r.unsubscribe()},[e,c,i]),a=f.useCallback(()=>{if(!e||e.role!=="comprador")return;const r=k.channel("buyer-sound-notifications").on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`buyer_id=eq.${e.id}`},n=>{var x,y;const v=(x=n.old)==null?void 0:x.status,p=(y=n.new)==null?void 0:y.status;v==="pending"&&p==="accepted"&&(console.log("🔊 Buyer: Order accepted with sound"),c("general"),o({customer_name:"Tu pedido",total:n.new.total_amount||n.new.total||0,delivery_type:n.new.delivery_type||"pickup",order_id:n.new.id}),N.success("Pedido aceptado",{description:"El vendedor aceptó tu pedido",duration:4e3})),p==="ready"&&(console.log("🔊 Buyer: Order ready with sound"),c("order-ready"),o({customer_name:"Tu pedido",total:n.new.total_amount||n.new.total||0,delivery_type:n.new.delivery_type||"pickup",order_id:n.new.id}),N.info("Pedido listo",{description:"Tu pedido está listo para recoger o será entregado pronto",duration:5e3})),p==="assigned"&&(console.log("🔊 Buyer: Driver assigned with sound"),c("order-assigned"),i("Repartidor asignado","Un repartidor está en camino a recoger tu pedido"),N.info("Repartidor asignado",{description:"Un repartidor está en camino a recoger tu pedido",duration:4e3})),p==="delivered"&&(console.log("🔊 Buyer: Order delivered with sound"),c("order-delivered"),window.notifyOrderDelivered&&window.notifyOrderDelivered({id:n.new.id}),o({customer_name:"Tu pedido",total:n.new.total_amount||n.new.total||0,delivery_type:n.new.delivery_type||"pickup",order_id:n.new.id}),N.success("¡Pedido entregado!",{description:"Tu pedido ha sido entregado exitosamente",duration:5e3}))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"daily_products"},n=>{console.log("🔊 Buyer: New product available with sound"),c("new-product"),o({customer_name:"Nuevo producto",total:0,delivery_type:"pickup",order_id:"new-product"}),N.info("¡Nuevo producto disponible!",{description:"Se agregó un nuevo producto al catálogo",duration:4e3})}).subscribe();return()=>r.unsubscribe()},[e,c,o,i]);f.useEffect(()=>{if(!e)return;let r;switch(e.role){case"vendedor":r=b();break;case"repartidor":r=h();break;case"comprador":r=a();break}return r},[e,b,h,a]);const s=f.useCallback(r=>{g.current={...g.current,...r}},[]),d=f.useCallback(r=>{g.current.enabled=r},[]),m=f.useCallback(r=>{g.current.volume=Math.max(0,Math.min(1,r))},[]),w=f.useCallback(r=>{c(r)},[c]);return{playSound:c,updateConfig:s,toggleSounds:d,setVolume:m,testSound:w,config:g.current,isEnabled:g.current.enabled}}function st({onDismiss:e}){const{user:o}=P(),{permission:i,requestPermission:l}=O(),{isEnabled:u,toggleSounds:g,testSound:c}=H(),[b,h]=f.useState(!1),[a,s]=f.useState("checking"),[d,m]=f.useState(!1),[w,r]=f.useState(!1),n=!b&&(i!=="granted"||!u||a==="disconnected");f.useEffect(()=>{o&&(async()=>{s("checking");try{const T=k.channel("banner-test").on("broadcast",{event:"test"},()=>{s("connected")}).subscribe(I=>{I==="SUBSCRIBED"?s("connected"):(I==="CHANNEL_ERROR"||I==="TIMED_OUT")&&s("disconnected")});setTimeout(()=>{k.removeChannel(T)},3e3)}catch{s("disconnected")}})()},[o]);const v=async()=>{r(!0);try{if(i!=="granted"&&!await l()){alert("⚠️ Las notificaciones son necesarias para recibir pedidos. Por favor, permite las notificaciones en la configuración del navegador."),r(!1);return}u||g(!0),setTimeout(()=>{c("general")},500),setTimeout(()=>{h(!0),e==null||e()},1e3)}catch(A){console.error("Error activating notifications:",A),alert("Error al activar notificaciones. Inténtalo de nuevo.")}finally{r(!1)}},p=()=>{h(!0),e==null||e()};if(!n||!o)return null;const x=()=>i==="granted"&&u&&a==="connected"?"bg-green-50 border-green-200":i==="denied"?"bg-red-50 border-red-200":"bg-orange-50 border-orange-200",y=()=>i==="granted"&&u&&a==="connected"?t.jsx(ee,{className:"w-5 h-5 text-green-600"}):i==="denied"?t.jsx(ke,{className:"w-5 h-5 text-red-600"}):t.jsx(L,{className:"w-5 h-5 text-orange-600"}),_=()=>{switch(o.role){case"vendedor":return{title:"🔔 Activa las notificaciones para no perder ventas",description:"Recibirás alertas sonoras cada vez que llegue un nuevo pedido"};case"repartidor":return{title:"🚚 Activa las notificaciones para nuevas entregas",description:"Te avisaremos cuando haya pedidos listos para entregar"};case"comprador":return{title:"📱 Activa las notificaciones para seguir tus pedidos",description:"Te mantendremos informado del estado de tus órdenes"};default:return{title:"🔔 Activa las notificaciones",description:"Mantente informado de actualizaciones importantes"}}},{title:S,description:q}=_();return t.jsx(_e,{className:`mx-4 my-2 shadow-lg ${x()}`,children:t.jsx(Ce,{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 mt-0.5",children:y()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"font-semibold text-gray-900 text-sm md:text-base",children:S}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"h-6 w-6 p-0",children:t.jsx(Ee,{className:"w-4 h-4"})}),t.jsx(D,{variant:"ghost",size:"sm",onClick:p,className:"h-6 w-6 p-0",children:t.jsx(Z,{className:"w-4 h-4"})})]})]}),t.jsx("p",{className:"text-sm text-gray-700 mb-3",children:q}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.jsxs(V,{variant:i==="granted"?"default":"destructive",className:"text-xs",children:[t.jsx(L,{className:"w-3 h-3 mr-1"}),i==="granted"?"Permisos ✓":"Sin permisos"]}),t.jsxs(V,{variant:u?"default":"secondary",className:"text-xs",children:[t.jsx(Fe,{className:"w-3 h-3 mr-1"}),u?"Sonido ✓":"Sin sonido"]}),t.jsxs(V,{variant:a==="connected"?"default":"destructive",className:"text-xs",children:[a==="connected"?t.jsx(qe,{className:"w-3 h-3 mr-1"}):t.jsx(Oe,{className:"w-3 h-3 mr-1"}),a==="connected"?"Tiempo real ✓":a==="checking"?"Verificando...":"Sin conexión"]})]}),d&&t.jsxs("div",{className:"bg-white bg-opacity-50 rounded-lg p-3 mb-3 text-xs space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Notificaciones del navegador:"}),t.jsx("span",{className:i==="granted"?"text-green-600":"text-red-600",children:i==="granted"?"✅ Activadas":i==="denied"?"❌ Bloqueadas":"⏳ Pendientes"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Sonidos:"}),t.jsx("span",{className:u?"text-green-600":"text-gray-600",children:u?"✅ Activados":"⏹️ Desactivados"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Conexión en tiempo real:"}),t.jsx("span",{className:a==="connected"?"text-green-600":"text-red-600",children:a==="connected"?"✅ Conectado":a==="checking"?"🔄 Verificando":"❌ Desconectado"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[i!=="granted"||!u?t.jsx(D,{onClick:v,disabled:w,className:"bg-orange-600 hover:bg-orange-700 text-white text-sm px-4 py-2",children:w?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Activando..."]}):"Activar Notificaciones"}):t.jsx(D,{onClick:p,variant:"outline",className:"text-sm px-4 py-2",children:"Todo configurado ✓"}),a==="disconnected"&&t.jsx(D,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),className:"text-xs",children:"Reconectar"})]}),typeof window<"u"&&!window.location.protocol.startsWith("https")&&t.jsx("div",{className:"mt-3 p-2 bg-red-100 border border-red-200 rounded text-xs text-red-700",children:"⚠️ Las notificaciones requieren HTTPS. En desarrollo usa: https://localhost:5173"})]})]})})})}function at({onNewOrder:e}){const{user:o}=P(),[i,l]=f.useState([]),u=f.useCallback(a=>{try{const s=new(window.AudioContext||window.webkitAudioContext);if(a==="new_order")[220,330,440].forEach((d,m)=>{setTimeout(()=>{const w=s.createOscillator(),r=s.createGain();w.connect(r),r.connect(s.destination),w.frequency.setValueAtTime(d,s.currentTime),w.type="sine",r.gain.setValueAtTime(.3,s.currentTime),r.gain.exponentialRampToValueAtTime(.01,s.currentTime+.3),w.start(s.currentTime),w.stop(s.currentTime+.3)},m*200)});else{const d=s.createOscillator(),m=s.createGain();d.connect(m),m.connect(s.destination),d.frequency.setValueAtTime(300,s.currentTime),d.type="sine",m.gain.setValueAtTime(.2,s.currentTime),m.gain.exponentialRampToValueAtTime(.01,s.currentTime+.2),d.start(s.currentTime),d.stop(s.currentTime+.2)}}catch(s){console.log("Audio not supported:",s)}},[]),g=f.useCallback(a=>{const s=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,d={...a,id:s,timestamp:new Date().toISOString(),autoRemove:a.autoRemove!==!1};l(m=>[d,...m.slice(0,4)]),u(a.type),d.autoRemove&&setTimeout(()=>{c(s)},12e4),a.type==="new_order"&&e&&e()},[u,e]),c=f.useCallback(a=>{l(s=>s.filter(d=>d.id!==a))},[]);f.useEffect(()=>{if(!(o!=null&&o.id))return;const a=k.channel("seller-order-toasts").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${o.id}`},s=>{var m;const d=s.new;g({type:"new_order",title:"🛒 Nueva Orden",message:`Pedido de Q${((m=d.total)==null?void 0:m.toFixed(2))||"0.00"} recibido`,autoRemove:!0})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`seller_id=eq.${o.id}`},s=>{const d=s.new,m=s.old;if(d.status!==m.status){let w="",r="order_update";switch(d.status){case"confirmed":w="Orden confirmada exitosamente",r="success";break;case"ready":w="Orden lista para entrega",r="success";break;case"delivered":w="Orden entregada exitosamente",r="success";break;case"cancelled":w="Orden cancelada",r="warning";break;default:return}g({type:r,title:"📋 Actualización de Orden",message:w,autoRemove:!0})}}).subscribe();return()=>{a.unsubscribe()}},[o==null?void 0:o.id,g]);const b=a=>{switch(a){case"new_order":return t.jsx(Re,{className:"w-5 h-5 text-blue-600"});case"order_update":return t.jsx(Ie,{className:"w-5 h-5 text-green-600"});case"success":return t.jsx(ee,{className:"w-5 h-5 text-green-600"});case"warning":return t.jsx(Ae,{className:"w-5 h-5 text-yellow-600"});default:return t.jsx(L,{className:"w-5 h-5 text-gray-600"})}},h=a=>{switch(a){case"new_order":return"bg-blue-50 border-blue-200 shadow-lg ring-2 ring-blue-500/20";case"success":return"bg-green-50 border-green-200 shadow-lg ring-2 ring-green-500/20";case"warning":return"bg-yellow-50 border-yellow-200 shadow-lg ring-2 ring-yellow-500/20";default:return"bg-white border-gray-200 shadow-lg"}};return i.length===0?null:t.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full pointer-events-none",children:i.map((a,s)=>t.jsx("div",{className:`
            ${h(a.type)}
            rounded-lg border p-4 pointer-events-auto
            transform transition-all duration-300 ease-in-out
            animate-in slide-in-from-right-2 fade-in-0
            ${s>0?"opacity-90 scale-95":""}
          `,style:{animationDelay:`${s*100}ms`,transform:`translateY(${s*4}px) scale(${1-s*.05})`},children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 mt-0.5",children:b(a.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:a.title}),t.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:a.message}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(a.timestamp).toLocaleTimeString("es-GT",{hour:"2-digit",minute:"2-digit"})})]}),t.jsx("button",{onClick:()=>c(a.id),className:"flex-shrink-0 p-1 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Cerrar notificación",children:t.jsx(Z,{className:"w-4 h-4 text-gray-400"})})]})},a.id))})}function wt({showBanner:e=!0,enableAutoActivation:o=!0,className:i=""}){const{user:l}=P(),{permission:u,requestPermission:g}=O(),{isEnabled:c,toggleSounds:b}=H(),[h,a]=f.useState(!1),[s,d]=f.useState(!1);if(f.useEffect(()=>{if(!l||s||!o)return;if((l.role==="vendedor"||l.role==="repartidor")&&(u!=="granted"||!c)){const n=setTimeout(async()=>{try{u==="default"&&await g(),c||b(!0)}catch(v){console.log("Auto-activation failed:",v)}finally{d(!0)}},2e3);return()=>clearTimeout(n)}else d(!0)},[l,u,c,o,s]),!l)return null;const m=e&&!h&&(u!=="granted"||!c||!s);return t.jsxs("div",{className:`notification-system ${i}`,children:[m&&t.jsx(st,{onDismiss:()=>a(!0)}),t.jsx(at,{})]})}function ht(){const{user:e}=P(),{permission:o,requestPermission:i,showNotification:l}=O(),{isEnabled:u,toggleSounds:g,testSound:c}=H(),b=o==="granted"&&u;return{isReady:b,needsSetup:!b&&e,permission:o,soundEnabled:u,setupNotifications:async()=>{try{if(!await i())throw new Error("Push notifications denied");return u||g(!0),(e==null?void 0:e.role)==="vendedor"?await c(F.NEW_ORDER):(e==null?void 0:e.role)==="repartidor"&&await c(F.ORDER_ASSIGNED),!0}catch(d){return console.error("Notification setup failed:",d),!1}},notify:async(d,m)=>{const{body:w,sound:r=F.GENERAL,push:n=!0,data:v}=m||{};try{u&&r&&await c(r),n&&o==="granted"&&await l(d,{body:w,icon:"/icon-192x192.png",data:v,tag:`notification-${Date.now()}`,requireInteraction:(e==null?void 0:e.role)==="vendedor"})}catch(p){console.error("Notification failed:",p)}},testSound:d=>c(d)}}export{ut as D,Je as I,at as M,wt as N,Ie as P,Qe as R,gt as T,pt as a,vt as b,ft as c,bt as d,ne as e,ht as u};
