import{u as N,r as c,s as f,j as s}from"./index-BjTbJZtF.js";import{SellerDashboard as b}from"./SellerDashboard-BNbiKX9X.js";import{u as v,F as A}from"./FloatingNotifications-BbVGGp21.js";import"./alert-C-E6eydX.js";import"./NotificationSystem-nychs1Z9.js";import"./triangle-alert-KLVDszTy.js";import"./shopping-cart-Cfbed8vh.js";import"./input-D4_EB-GG.js";import"./textarea-Cxpk2vcf.js";import"./label-CXPGU4I2.js";import"./select-BI5i3ZH_.js";import"./arrow-left-BD-jQcHL.js";import"./upload-Bf9b4OII.js";import"./save-GgqkRAMS.js";import"./clock-BXIPhKIz.js";import"./TimeoutAlerts-Dg98ZweZ.js";import"./truck-BrXFQt59.js";import"./users-DSw0QBNn.js";import"./alert-dialog-CuOTaWb5.js";import"./eye-off-BKVvAeLR.js";import"./trash-2-2dLpYzuK.js";import"./CriticalNotifications-B_gqW_Tm.js";import"./store-CbsGE8e6.js";import"./info-DDNKWBeX.js";import"./map-pin-BCmKHKCp.js";import"./mail-D6vMv_zj.js";import"./globe-BUgccg7L.js";import"./circle-x-RtDyAMvd.js";import"./external-link-5YHPmGDF.js";import"./user-CeFocL-y.js";import"./log-out-DnUIte8z.js";import"./shopping-bag-DEKdHDBx.js";import"./star-gp1wwVjw.js";function oe(){const{user:n}=N(),{notifications:g,addNotification:a,removeNotification:T}=v(),l=c.useCallback(async()=>{try{const e=new(window.AudioContext||window.webkitAudioContext);e.state==="suspended"&&await e.resume();const o=e.createOscillator(),t=e.createOscillator(),i=e.createGain();o.connect(i),t.connect(i),i.connect(e.destination),o.frequency.setValueAtTime(800,e.currentTime),o.frequency.exponentialRampToValueAtTime(600,e.currentTime+.3),o.type="sine",t.frequency.setValueAtTime(1200,e.currentTime),t.frequency.exponentialRampToValueAtTime(900,e.currentTime+.3),t.type="triangle",i.gain.setValueAtTime(0,e.currentTime),i.gain.linearRampToValueAtTime(.4,e.currentTime+.1),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+1.2),o.start(e.currentTime),o.stop(e.currentTime+1.2),t.start(e.currentTime+.1),t.stop(e.currentTime+1),console.log("ðŸ”Š Sonido de pedido reproducido")}catch(e){console.log("âš ï¸ Error con sonido:",e)}},[]);return c.useEffect(()=>{const o=setTimeout(async()=>{try{Notification.permission==="default"&&(console.log("ðŸ”” Solicitando permisos de notificaciÃ³n automÃ¡ticamente..."),await Notification.requestPermission()==="granted"?(localStorage.setItem("trato_permissions","granted"),console.log("âœ… Permisos concedidos automÃ¡ticamente")):console.log("âš ï¸ Permisos denegados por el usuario"))}catch(t){console.log("âš ï¸ Error solicitando permisos:",t)}},2e3);return()=>clearTimeout(o)},[]),c.useEffect(()=>{if(!(n!=null&&n.id))return;console.log("ðŸ”” Activando notificaciones para vendedor:",n.email);const e=f.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${n.id}`},o=>{console.log("ðŸŽ¯ Nuevo pedido recibido:",o.new);const t=o.new,i=parseFloat(t.total||"0").toFixed(2);if(a({title:"ðŸ›’ Nuevo Pedido",message:`Orden por Q${i}${t.notes?` - ${t.notes}`:""}`,orderData:t,duration:8e3}),l(),Notification.permission==="granted"){const r=new Notification("ðŸ›’ Nuevo Pedido TRATO",{body:`Orden por Q${i}${t.notes?` - ${t.notes.substring(0,50)}`:""}`,icon:"/favicon.ico",tag:`trato-order-${t.id}`,requireInteraction:!0});setTimeout(()=>{r.close()},1e4),r.onclick=()=>{window.focus(),r.close()}}navigator.vibrate&&navigator.vibrate([200,100,200,100,400])}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`seller_id=eq.${n.id}`},o=>{var r,m,d,u;const t=(r=o.old)==null?void 0:r.status,i=(m=o.new)==null?void 0:m.status;if(t!==i&&(i==="cancelled"||i==="delivered")){const p=((u=(d=o.new)==null?void 0:d.id)==null?void 0:u.toString().slice(-4))||"N/A",w=i==="cancelled"?`Orden #${p} cancelada`:`Orden #${p} marcada como entregada`;a({title:i==="cancelled"?"âŒ Orden Cancelada":"âœ… Orden Entregada",message:w,orderData:o.new,duration:5e3})}}).subscribe(o=>{console.log("ðŸ“¡ Estado de notificaciones:",o),o==="SUBSCRIBED"?console.log("âœ… Escuchando nuevos pedidos"):(o==="CHANNEL_ERROR"||o==="TIMED_OUT")&&console.error("âŒ Error en notificaciones:",o)});return()=>{console.log("ðŸ”„ Desconectando notificaciones"),f.removeChannel(e)}},[n==null?void 0:n.id,a,l]),s.jsxs(s.Fragment,{children:[s.jsx(A,{notifications:g,onRemove:T}),s.jsx(b,{})]})}export{oe as EnhancedSellerDashboard};
