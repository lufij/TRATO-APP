import{g as ue,r as c,j as e,o as De,X as Ne,u as fe,B as E,C as B,a as re,b as ee,c as W,L as ie,f as se,d as _e,s as N,i as ps,e as te,v as hs,q as Us,t as q,R as ye,F as fs,p as rs,G as Vs}from"./index-urxcoLs_.js";import{A as de,a as me}from"./alert-xsM8RmRy.js";import{P as ge,T as ss,a as as,b as be,d as ce,M as Gs,c as Bs,D as Hs}from"./MobileToastNotifications-C-QnXEI8.js";import{R as Ws,P as Qs,C as bs,i as Js,T as js,O as vs,D as Ns,A as ys,a as ws,b as _s,c as Ss,d as ks,e as Cs,f as Es,g as Ps,h as Ts}from"./alert-dialog-BK9HpypI.js";import{I as H}from"./input-qHtuaJE-.js";import{T as ts}from"./textarea-CZEV-FU5.js";import{L as V}from"./label-74OaXu9Z.js";import{S as Zs,a as Ys,b as Ks,c as Xs,d as ea}from"./select-CwG0Q3Ss.js";import{A as Is}from"./arrow-left-B-DnNMCV.js";import{U as As}from"./upload-BSREP_Id.js";import{S as Ue}from"./save-FUAxyLqp.js";import{C as ae}from"./clock-CmqsdHSK.js";import{T as Ds,I as ze,F as sa,g as aa,f as ra,S as ta,B as ia,R as na,u as oa,H as la,O as ca,P as Ke}from"./OnlineDriversIndicator-B9EAGIRI.js";import{E as da}from"./eye-BN7c8EG1.js";import{E as ma}from"./eye-off-DRdzzKrr.js";import{T as $s}from"./trash-2-BLc-u0RI.js";import{C as Xe,a as je,P as Fe,M as ua,N as qe}from"./phone-BLgC7u0q.js";import{S as ve}from"./store-CjME3cjw.js";import{I as os}from"./info-Dc2uxSMi.js";import{M as oe}from"./map-pin-giNlXS6N.js";import{T as Ae}from"./truck-SBhFVdHN.js";import{M as xa}from"./mail-C4f_jUQJ.js";import{G as ls}from"./globe-Dbbw55er.js";import{T as Se}from"./triangle-alert-D0GK7goV.js";import{C as we}from"./circle-x-B81EBSrE.js";import{E as ga}from"./external-link-BlBmKYWG.js";import{U as is}from"./user-B0UErowU.js";import{L as pa}from"./log-out-BmhDXmiG.js";import{S as ha}from"./shopping-bag-Cuev8Twq.js";import{S as fa}from"./star-dRXZJAUd.js";import"./shopping-cart-BcLNYpLf.js";import"./users-BAiOA3Ek.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],ja=ue("bell-ring",ba);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Na=ue("chart-column",va);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],wa=ue("clipboard-list",ya);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Sa=ue("copy",_a);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],Ca=ue("facebook",ka);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Os=ue("hash",Ea);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ms=ue("image",Pa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],Ia=ue("instagram",Ta);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],Da=ue("message-square",Aa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ns=ue("pen",$a),Oa=Ws,Ma=Qs,Ls=c.forwardRef(({className:s,...o},i)=>e.jsx(vs,{ref:i,className:De("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...o}));Ls.displayName=vs.displayName;const Rs=c.forwardRef(({className:s,children:o,description:i,...x},h)=>e.jsxs(Ma,{children:[e.jsx(Ls,{}),e.jsxs(bs,{ref:h,className:De("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),"aria-describedby":i?"dialog-description":void 0,...x,children:[o,i&&e.jsx("div",{id:"dialog-description",className:"sr-only",children:i}),e.jsxs(Js,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Rs.displayName=bs.displayName;const qs=({className:s,...o})=>e.jsx("div",{className:De("flex flex-col space-y-1.5 text-center sm:text-left",s),...o});qs.displayName="DialogHeader";const zs=c.forwardRef(({className:s,...o},i)=>e.jsx(js,{ref:i,className:De("text-lg font-semibold leading-none tracking-tight",s),...o}));zs.displayName=js.displayName;const La=c.forwardRef(({className:s,...o},i)=>e.jsx(Ns,{ref:i,className:De("text-sm text-muted-foreground",s),...o}));La.displayName=Ns.displayName;const Ra=["Alimentos","Bebidas","Ropa","Electr√≥nicos","Hogar","Belleza","Deportes","Libros","Juguetes","Mascotas","Salud","Herramientas","Jard√≠n","M√∫sica","Arte","Otros"];function cs({product:s,onSuccess:o,onCancel:i}){const{user:x}=fe(),[h,_]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.category)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||"",is_public:(s==null?void 0:s.is_public)!==!1}),[D,f]=c.useState(null),[m,P]=c.useState((s==null?void 0:s.image_url)||""),[T,k]=c.useState(!1),[t,u]=c.useState(!1),[C,I]=c.useState(""),b=c.useRef(null),A=r=>{var l;const d=(l=r.target.files)==null?void 0:l[0];if(d){if(!d.type.startsWith("image/")){I("Por favor selecciona una imagen v√°lida");return}if(d.size>5*1024*1024){I("La imagen debe ser menor a 5MB");return}f(d),I("");const g=new FileReader;g.onload=n=>{var p;P((p=n.target)==null?void 0:p.result)},g.readAsDataURL(d)}},U=async r=>{var d;u(!0);try{const{data:{session:l}}=await N.auth.getSession();if(!((d=l==null?void 0:l.user)!=null&&d.id))throw new Error("No autorizado - sesi√≥n inv√°lida");const g=r.name.split(".").pop(),p=`products/${`${l.user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${g}`}`;for(let S=0;S<3;S++)try{const{error:O}=await N.storage.from("products").upload(p,r,{cacheControl:"3600",upsert:!0});if(O){if(O.message.includes("JWT")||O.message.includes("token")){await N.auth.refreshSession();continue}throw O}const{data:z}=N.storage.from("products").getPublicUrl(p);if(!z.publicUrl)throw new Error("No se pudo obtener la URL p√∫blica");return z.publicUrl}catch(O){if(S===2)throw O;await new Promise(z=>setTimeout(z,1e3));continue}throw new Error("No se pudo subir la imagen despu√©s de 3 intentos")}catch(l){throw console.error("Error uploading image:",l),new Error("Error al subir la imagen: "+l.message)}finally{u(!1)}},Z=async r=>{try{const d=r.split("/"),l=d[d.length-3],g=d[d.length-2],n=d[d.length-1],p=`${g}/${n}`;l==="products"&&await N.storage.from("products").remove([p])}catch(d){console.error("Error deleting old image:",d)}},G=async r=>{if(r.preventDefault(),I(""),!h.name.trim()){I("El nombre del producto es requerido");return}if(!h.price||parseFloat(h.price.toString())<=0){I("El precio debe ser mayor a 0");return}if(!h.category){I("Selecciona una categor√≠a");return}if(!h.stock_quantity||parseInt(h.stock_quantity.toString())<0){I("La cantidad debe ser mayor a 0");return}if(!s&&!D&&!m){I("Selecciona una imagen para el producto");return}k(!0);try{let d=(s==null?void 0:s.image_url)||"";D&&(d=await U(D),s!=null&&s.image_url&&await Z(s.image_url));const l={name:h.name.trim(),description:h.description.trim(),price:parseFloat(h.price.toString())||0,category:h.category,stock_quantity:parseInt(h.stock_quantity.toString())||1,is_public:h.is_public,image_url:d,seller_id:x==null?void 0:x.id};if(s){const{error:g}=await N.from("products").update(l).eq("id",s.id);if(g)throw g}else{const{error:g}=await N.from("products").insert([l]);if(g)throw g}o()}catch(d){console.error("Error saving product:",d),I(d.message||"Error al guardar el producto")}finally{k(!1)}},Y=()=>{f(null),P(""),b.current&&(b.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:i,children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto":"Agregar Producto"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica la informaci√≥n de tu producto":"Crea un nuevo producto para tu tienda"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(B,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Informaci√≥n del Producto"]})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:"Imagen del Producto *"}),m?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(E,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:Y,children:e.jsx(Ne,{className:"w-4 h-4"})}),t&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-500 transition-colors",onClick:()=>{var r;return(r=b.current)==null?void 0:r.click()},children:[e.jsx(Ms,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, WEBP hasta 5MB"})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:A,className:"hidden"}),!m&&e.jsxs(E,{type:"button",variant:"outline",onClick:()=>{var r;return(r=b.current)==null?void 0:r.click()},className:"w-full",children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:h.name,onChange:r=>_({...h,name:r.target.value}),placeholder:"Ej: Manzanas Rojas Org√°nicas",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(ts,{id:"description",value:h.description,onChange:r=>_({...h,description:r.target.value}),placeholder:"Describe las caracter√≠sticas y beneficios de tu producto...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"price",children:"Precio (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:h.price,onChange:r=>_({...h,price:r.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:h.stock_quantity,onChange:r=>_({...h,stock_quantity:r.target.value}),placeholder:"1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Categor√≠a *"}),e.jsxs(Zs,{onValueChange:r=>_({...h,category:r}),children:[e.jsx(Ys,{children:e.jsx(Ks,{placeholder:h.category||"Selecciona una categor√≠a"})}),e.jsx(Xs,{children:Ra.map(r=>e.jsx(ea,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{children:"Visibilidad"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(E,{type:"button",variant:h.is_public?"default":"outline",onClick:()=>_({...h,is_public:!0}),className:"flex-1",children:["P√∫blico",h.is_public&&e.jsx(se,{variant:"secondary",className:"ml-2",children:"Activo"})]}),e.jsxs(E,{type:"button",variant:h.is_public?"outline":"default",onClick:()=>_({...h,is_public:!1}),className:"flex-1",children:["Privado",!h.is_public&&e.jsx(se,{variant:"secondary",className:"ml-2",children:"Activo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Los productos p√∫blicos aparecen en el cat√°logo general. Los privados solo los ves t√∫."})]}),C&&e.jsxs(de,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(me,{children:C})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:i,className:"flex-1",disabled:T||t,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:T||t,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:T?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Producto"]})})]})]})})]})})]})}function ds({dailyProduct:s,onSuccess:o,onCancel:i}){const{user:x}=fe(),[h,_]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:s!=null&&s.price?String(s.price):"",stock_quantity:s!=null&&s.stock_quantity?String(s.stock_quantity):""}),[D,f]=c.useState(null),[m,P]=c.useState((s==null?void 0:s.image_url)||""),[T,k]=c.useState(!1),[t,u]=c.useState(!1),[C,I]=c.useState(""),b=c.useRef(null),A=()=>{const l=new Date;return new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59,59,999).toISOString()},U=()=>{const l=new Date,g=new Date;g.setHours(23,59,59,999);const n=g.getTime()-l.getTime(),p=Math.floor(n/(1e3*60*60)),S=Math.floor(n%(1e3*60*60)/(1e3*60));return`${p}h ${S}m`},Z=l=>{var n;const g=(n=l.target.files)==null?void 0:n[0];if(g){if(!g.type.startsWith("image/")){I("Por favor selecciona una imagen v√°lida");return}if(g.size>5*1024*1024){I("La imagen debe ser menor a 5MB");return}f(g),I("");const p=new FileReader;p.onload=S=>{var O;P((O=S.target)==null?void 0:O.result)},p.readAsDataURL(g)}},G=async l=>{u(!0);try{const g=new Date().toISOString().split("T")[0],n=l.name.split(".").pop(),S=`daily-products/${`${x==null?void 0:x.id}/${g}/${Date.now()}.${n}`}`,{error:O}=await N.storage.from("products").upload(S,l,{cacheControl:"3600",upsert:!1});if(O)throw O;const{data:z}=N.storage.from("products").getPublicUrl(S);return z.publicUrl}catch(g){throw console.error("Error uploading image:",g),new Error("Error al subir la imagen: "+g.message)}finally{u(!1)}},Y=async l=>{try{const g=l.split("/"),n=g.findIndex(p=>p==="products");if(n!==-1){const S=g.slice(n+1).join("/");await N.storage.from("products").remove([S])}}catch(g){console.error("Error deleting old image:",g)}},r=async l=>{if(l.preventDefault(),I(""),!h.name.trim()){I("El nombre del producto es requerido");return}if(parseFloat(h.price)<=0){I("El precio debe ser mayor a 0");return}if(parseInt(h.stock_quantity)<0){I("La cantidad no puede ser negativa");return}if(!s&&!D&&!m){I("Selecciona una imagen para el producto");return}if(new Date().getHours()>=23){I("Es muy tarde para crear productos del d√≠a. Int√©ntalo ma√±ana temprano.");return}k(!0);try{let p=(s==null?void 0:s.image_url)||"";D&&(p=await G(D),s!=null&&s.image_url&&await Y(s.image_url));const S={name:h.name.trim(),description:h.description.trim(),price:parseFloat(h.price)||0,stock_quantity:parseInt(h.stock_quantity)||0,image_url:p,seller_id:x==null?void 0:x.id,expires_at:A()};if(s){const{error:O}=await N.from("daily_products").update(S).eq("id",s.id);if(O)throw O}else{const{error:O}=await N.from("daily_products").insert([S]);if(O)throw O}o()}catch(p){console.error("Error saving daily product:",p),I(p.message||"Error al guardar el producto del d√≠a")}finally{k(!1)}},d=()=>{f(null),P(""),b.current&&(b.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:i,children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto del D√≠a":"Tu Venta del D√≠a"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica tu oferta especial":"Crea una oferta especial que dura hasta medianoche"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ds,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800",children:["Tiempo restante: ",U()]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Este producto se eliminar√° autom√°ticamente a las 23:59:59 de hoy. Las im√°genes tambi√©n se eliminar√°n del servidor."})]}),e.jsxs(B,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Informaci√≥n del Producto del D√≠a"]})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:r,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:"Imagen del Producto *"}),m?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(E,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:d,children:e.jsx(Ne,{className:"w-4 h-4"})}),t&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})}),e.jsxs(se,{variant:"destructive",className:"absolute bottom-2 left-2",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Expira a medianoche"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-orange-300 rounded-lg p-8 text-center cursor-pointer hover:border-orange-500 transition-colors bg-orange-50",onClick:()=>{var l;return(l=b.current)==null?void 0:l.click()},children:[e.jsx(Ms,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-orange-600",children:"PNG, JPG, WEBP hasta 5MB"}),e.jsx(se,{variant:"outline",className:"mt-2 border-orange-300 text-orange-700",children:"Se elimina autom√°ticamente"})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:Z,className:"hidden"}),!m&&e.jsxs(E,{type:"button",variant:"outline",onClick:()=>{var l;return(l=b.current)==null?void 0:l.click()},className:"w-full border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:h.name,onChange:l=>_({...h,name:l.target.value}),placeholder:"Ej: Combo Especial del D√≠a",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(ts,{id:"description",value:h.description,onChange:l=>_({...h,description:l.target.value}),placeholder:"Describe tu oferta especial del d√≠a...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"price",children:"Precio Especial (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:h.price,onChange:l=>_({...h,price:l.target.value}),placeholder:"0.00",required:!0}),e.jsx("p",{className:"text-xs text-orange-600",children:"Precio especial v√°lido solo hoy"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:h.stock_quantity,onChange:l=>_({...h,stock_quantity:l.target.value}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-orange-600",children:"¬°Solo por hoy!"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Caracter√≠sticas de Productos del D√≠a"]}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Se elimina autom√°ticamente a las 23:59:59"}),e.jsx("li",{children:'‚Ä¢ Aparece marcado como "Oferta del D√≠a" en el cat√°logo'}),e.jsx("li",{children:"‚Ä¢ Las im√°genes se almacenan en carpeta temporal"}),e.jsx("li",{children:"‚Ä¢ Ideal para ofertas especiales y productos perecederos"})]})]}),C&&e.jsxs(de,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(me,{children:C})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:i,className:"flex-1",disabled:T||t,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:T||t,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:T?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Venta del D√≠a"]})})]})]})})]})]})]})}function qa({product:s,onEdit:o,onDelete:i}){const[x,h]=c.useState(!1),{openImageModal:_}=ps(),D=m=>`Q${m.toFixed(2)}`,f=m=>new Date(m).toLocaleDateString("es-GT",{day:"numeric",month:"short",year:"numeric"});return e.jsxs(B,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border border-gray-200",style:{backgroundColor:"white"},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-gray-100",children:x?e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sin imagen"})]})}):e.jsx(ze,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>h(!0),expandable:!0,onExpand:_})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(se,{variant:s.is_public?"default":"secondary",className:"text-xs font-medium",style:{backgroundColor:s.is_public?"#22c55e":"#6b7280",color:"white",border:"none"},children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-3 h-3 mr-1"}),"P√∫blico"]}):e.jsxs(e.Fragment,{children:[e.jsx(ma,{className:"w-3 h-3 mr-1"}),"Privado"]})})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(se,{variant:"destructive",className:"text-xs font-medium",style:{backgroundColor:"#ef4444",color:"white",border:"none"},children:"Sin stock"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(se,{variant:"outline",className:"text-xs font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",color:"#374151",border:"1px solid #d1d5db"},children:s.category})})]}),e.jsx(W,{className:"p-3 md:p-4",style:{backgroundColor:"white"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1 text-sm md:text-base",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"font-bold text-sm md:text-lg text-green-600",children:D(s.price)})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Os,{className:"w-3 h-3 md:w-4 md:h-4 text-gray-500 flex-shrink-0"}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Creado el ",f(s.created_at)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>o(s),className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#d1d5db",color:"#374151"},children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(ys,{children:[e.jsx(ws,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#fecaca",color:"#dc2626",backgroundColor:"white"},children:[e.jsx($s,{className:"w-3 h-3 mr-1"}),"Eliminar"]})}),e.jsxs(_s,{children:[e.jsxs(Ss,{children:[e.jsx(ks,{children:"¬øEliminar producto?"}),e.jsxs(Cs,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda.']})]}),e.jsxs(Es,{children:[e.jsx(Ps,{children:"Cancelar"}),e.jsx(Ts,{onClick:()=>i(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]})}function za({dailyProduct:s,onEdit:o,onDelete:i}){const[x,h]=c.useState(!1),[_,D]=c.useState(""),[f,m]=c.useState(!1),{openImageModal:P}=ps();c.useEffect(()=>{const t=()=>{const C=aa(s.expires_at);D(C.formattedTime),m(C.isExpired)};t();const u=setInterval(t,1e3);return()=>clearInterval(u)},[s.expires_at]);const T=t=>`Q${t.toFixed(2)}`,k=t=>ra(t);return e.jsxs(B,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:x?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-12 h-12 text-orange-400"})}):e.jsx(ze,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>h(!0),expandable:!0,onExpand:P})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(se,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs",children:[e.jsx(sa,{className:"w-3 h-3 mr-1"}),"Oferta del D√≠a"]})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(se,{variant:"destructive",className:"text-xs",children:"Agotado"})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(se,{variant:f?"destructive":"secondary",className:`text-xs ${f?"bg-red-500 text-white":"bg-white/90 backdrop-blur-sm text-orange-700"}`,children:[e.jsx(Ds,{className:"w-3 h-3 mr-1"}),_]})})]}),e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:T(s.price)})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Os,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-orange-700",children:["Creado a las ",k(s.created_at)]}),e.jsxs("span",{className:"text-orange-700 font-medium",children:["Expira: ",k(s.expires_at)]})]})}),!f&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:["‚è∞ Se elimina autom√°ticamente en ",_]})}),f&&e.jsx("div",{className:"text-center bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"‚ùå Este producto ha expirado y ser√° eliminado pronto"})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>o(s),className:"flex-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:f,children:[e.jsx(ns,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(ys,{children:[e.jsx(ws,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx($s,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(_s,{children:[e.jsxs(Ss,{children:[e.jsx(ks,{children:"¬øEliminar producto del d√≠a?"}),e.jsxs(Cs,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda y su imagen del servidor.',!f&&e.jsxs("span",{className:"block mt-2 text-orange-600 font-medium",children:["Nota: Este producto se eliminar√° autom√°ticamente en ",_," de todas formas."]})]})]}),e.jsxs(Es,{children:[e.jsx(Ps,{children:"Cancelar"}),e.jsx(Ts,{onClick:()=>i(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar Ahora"})]})]})]})]})]})})]})}const Re={north:15.2,south:15,east:-89.3,west:-89.5};function Fa(){var s,o;try{return(o=(s=import.meta)==null?void 0:s.env)==null?void 0:o.VITE_GOOGLE_MAPS_API_KEY}catch{return}}function Ua(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")?"Safari":s.includes("edge")?"Edge":"tu navegador"}function Va(){const[s,o]=c.useState(!1),[i,x]=c.useState(null),[h,_]=c.useState(null),D=c.useCallback(()=>{x(null)},[]),f=c.useCallback((t,u)=>t>=Re.south&&t<=Re.north&&u>=Re.west&&u<=Re.east,[]),m=c.useCallback(async()=>{try{if("permissions"in navigator&&"query"in navigator.permissions){const t=await navigator.permissions.query({name:"geolocation"});return _(t.state),t.state}return _("prompt"),"prompt"}catch(t){return console.warn("Could not check geolocation permissions:",t),_("prompt"),"prompt"}},[]),P=c.useCallback(async()=>{try{const t=await new Promise(u=>{navigator.geolocation.getCurrentPosition(()=>u(!0),C=>{console.log("Permission request result:",C.code,C.message),u(C.code!==C.PERMISSION_DENIED)},{timeout:1e3,maximumAge:0})});return t&&await m(),t}catch(t){return console.error("Error requesting permissions:",t),!1}},[m]),T=c.useCallback(async(t,u)=>{try{x(null);const C=Fa();if(C&&typeof fetch<"u")try{const I=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${t},${u}&key=${C}&language=es&region=GT`);if(I.ok){const b=await I.json();if(b.status==="OK"&&b.results&&b.results.length>0){const A=b.results[0],U=A.address_components||[];let Z="",G="",Y="",r="";return U.forEach(d=>{const l=d.types||[];l.includes("locality")||l.includes("administrative_area_level_2")?Z=d.long_name||"":l.includes("administrative_area_level_1")?G=d.long_name||"":l.includes("country")?Y=d.long_name||"":l.includes("postal_code")&&(r=d.long_name||"")}),{latitude:t,longitude:u,address:A.formatted_address||`Ubicaci√≥n GPS: ${t.toFixed(6)}, ${u.toFixed(6)}`,formatted_address:A.formatted_address||`Coordenadas: ${t.toFixed(6)}, ${u.toFixed(6)}`,city:Z||"Gual√°n",state:G||"Zacapa",country:Y||"Guatemala",postal_code:r,place_id:A.place_id}}}}catch(I){console.warn("Google Maps API request failed, using fallback:",I)}return{latitude:t,longitude:u,address:`Gual√°n, Zacapa, Guatemala (${t.toFixed(6)}, ${u.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS verificada en Gual√°n: ${t.toFixed(6)}, ${u.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}catch(C){return console.error("Error in reverse geocoding:",C),{latitude:t,longitude:u,address:`Gual√°n, Zacapa, Guatemala (${t.toFixed(6)}, ${u.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS: ${t.toFixed(6)}, ${u.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}},[]),k=c.useCallback(async()=>new Promise((t,u)=>{if(o(!0),x(null),!(navigator!=null&&navigator.geolocation)){const b=`‚ùå Geolocalizaci√≥n no disponible

Tu navegador no soporta geolocalizaci√≥n GPS. 

‚úÖ Soluciones:
‚Ä¢ Usa un navegador moderno (Chrome, Firefox, Safari, Edge)
‚Ä¢ Verifica que est√©s usando HTTPS (no HTTP)
‚Ä¢ Intenta desde un dispositivo m√≥vil
‚Ä¢ Actualiza tu navegador a la versi√≥n m√°s reciente`;console.error("Geolocation not supported"),x(b),o(!1),u(new Error(b));return}const C={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5},I=Ua();navigator.geolocation.getCurrentPosition(async b=>{try{const{latitude:A,longitude:U}=b.coords,Z=b.coords.accuracy;if(console.log(`üìç GPS Location obtained: ${A.toFixed(6)}, ${U.toFixed(6)} (accuracy: ${Z}m)`),!f(A,U)){const Y=`üó∫Ô∏è Ubicaci√≥n fuera del √°rea de servicio

üìç Coordenadas detectadas: ${A.toFixed(4)}, ${U.toFixed(4)}
üè¢ √Årea de servicio: Gual√°n, Zacapa

‚ö†Ô∏è Posibles causas:
‚Ä¢ Tu negocio no est√° en Gual√°n, Zacapa
‚Ä¢ El GPS no es preciso (intenta ir al aire libre)
‚Ä¢ Est√°s usando VPN que cambia tu ubicaci√≥n

‚úÖ Si tu negocio S√ç est√° en Gual√°n:
‚Ä¢ Ve al exterior para mejor se√±al GPS
‚Ä¢ Desactiva VPN si usas una
‚Ä¢ Espera unos segundos y vuelve a intentar
‚Ä¢ La ubicaci√≥n se guardar√° aunque est√© fuera del √°rea estimada`;console.warn(`Location validation failed: lat=${A}, lng=${U}, accuracy=${Z}m`),x(Y),o(!1),u(new Error(Y));return}const G=await T(A,U);console.log("‚úÖ Location successfully processed:",G),o(!1),t(G)}catch(A){console.error("Error processing location:",A);const U=A instanceof Error?A.message:"Error al procesar la ubicaci√≥n detectada";x(U),o(!1),u(A)}},b=>{console.error("Geolocation error details:",{code:b.code,message:b.message,PERMISSION_DENIED:b.PERMISSION_DENIED,POSITION_UNAVAILABLE:b.POSITION_UNAVAILABLE,TIMEOUT:b.TIMEOUT});let A="Error al detectar la ubicaci√≥n";switch(b.code){case b.PERMISSION_DENIED:A=`üö´ Permiso de ubicaci√≥n denegado

üì± SOLUCI√ìN R√ÅPIDA para ${I}:

üîí **M√©todo 1 - √çcono de ubicaci√≥n:**
1. Busca el √≠cono üîí o üåê en la barra de direcciones
2. Haz clic en √©l
3. Cambia "Ubicaci√≥n" de "Bloqueado" a "Permitir"
4. Recarga la p√°gina

‚öôÔ∏è **M√©todo 2 - Configuraci√≥n del navegador:**
‚Ä¢ Chrome: Configuraci√≥n ‚Üí Privacidad ‚Üí Configuraci√≥n del sitio ‚Üí Ubicaci√≥n
‚Ä¢ Firefox: Preferencias ‚Üí Privacidad ‚Üí Permisos ‚Üí Ubicaci√≥n  
‚Ä¢ Safari: Preferencias ‚Üí Sitios web ‚Üí Ubicaci√≥n
‚Ä¢ Edge: Configuraci√≥n ‚Üí Permisos del sitio ‚Üí Ubicaci√≥n

üìç **¬øPor qu√© necesitamos tu ubicaci√≥n?**
Los repartidores necesitan las coordenadas GPS exactas de tu negocio para hacer entregas correctas.

üîÑ Despu√©s de cambiar los permisos, recarga esta p√°gina y vuelve a intentar.`;break;case b.POSITION_UNAVAILABLE:A=`üì° Se√±al GPS no disponible

üõ∞Ô∏è **Posibles causas:**
‚Ä¢ Est√°s en un lugar cerrado (edificio, s√≥tano)
‚Ä¢ Se√±al GPS d√©bil en tu √°rea
‚Ä¢ Interferencia de otros dispositivos
‚Ä¢ GPS desactivado en el dispositivo

‚úÖ **Soluciones:**
‚Ä¢ Ve cerca de una ventana o al aire libre
‚Ä¢ Verifica que el GPS est√© activado en tu dispositivo
‚Ä¢ Espera 1-2 minutos para que mejore la se√±al
‚Ä¢ Intenta desde otro lugar o dispositivo
‚Ä¢ Aseg√∫rate de tener conexi√≥n a internet estable

üì± En m√≥viles: Configuraci√≥n ‚Üí Ubicaci√≥n ‚Üí Activar GPS de alta precisi√≥n`;break;case b.TIMEOUT:A=`‚è∞ Tiempo de espera agotado (15 segundos)

üîÑ **La detecci√≥n GPS tard√≥ demasiado:**

üì∂ **Soluciones r√°pidas:**
‚Ä¢ Ve a un lugar con mejor se√±al (ventana o exterior)
‚Ä¢ Verifica tu conexi√≥n a internet
‚Ä¢ Reinicia el GPS en tu dispositivo si es m√≥vil
‚Ä¢ Cierra otras apps que usen ubicaci√≥n

üöÄ **Int√©ntalo de nuevo:**
La detecci√≥n puede ser m√°s r√°pida en el segundo intento.

üí° **Tip:** En dispositivos m√≥viles, el GPS suele ser m√°s r√°pido y preciso que en computadoras.`;break;default:A=`‚ùå Error GPS desconocido

üîß **Informaci√≥n t√©cnica:**
‚Ä¢ C√≥digo de error: ${b.code}
‚Ä¢ Mensaje: ${b.message}

üõ†Ô∏è **Soluciones generales:**
‚Ä¢ Recarga la p√°gina e intenta de nuevo
‚Ä¢ Verifica los permisos de ubicaci√≥n
‚Ä¢ Intenta desde otro navegador o dispositivo
‚Ä¢ Aseg√∫rate de usar HTTPS (no HTTP)

üìß Si el problema persiste, contacta soporte t√©cnico con esta informaci√≥n.`}console.error("Geolocation error processed:",A),x(A),o(!1),u(new Error(A))},C)}),[f,T]);return c.useEffect(()=>{m()},[m]),{getCurrentLocation:k,reverseGeocode:T,validateLocation:f,checkPermissions:m,requestPermissions:P,loading:s,error:i,permissionState:h,clearError:D}}const Ga={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWRkenlsb3RxZGNrdWJsZmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTU4NjEsImV4cCI6MjA3MTM3MTg2MX0.ktxZ0H7mI9NVdxu48sPd90kqPerSP-vkysQlIM1JpG8",VITE_SUPABASE_URL:"https://deaddzylotqdckublfed.supabase.co"},Ie=[{key:"monday",label:"Lunes",short:"Lun"},{key:"tuesday",label:"Martes",short:"Mar"},{key:"wednesday",label:"Mi√©rcoles",short:"Mi√©"},{key:"thursday",label:"Jueves",short:"Jue"},{key:"friday",label:"Viernes",short:"Vie"},{key:"saturday",label:"S√°bado",short:"S√°b"},{key:"sunday",label:"Domingo",short:"Dom"}],Ba={monday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},saturday:{isOpen:!0,openTime:"09:00",closeTime:"17:00"},sunday:{isOpen:!1,openTime:"09:00",closeTime:"15:00"}};function Ha(){try{return!!(import.meta&&Ga&&!1)}catch{return!1}}const ms=s=>{if(!s)return"";const[o,i]=s.split(":"),x=parseInt(o,10);return x===0?`12:${i} AM`:x<12?`${x}:${i} AM`:x===12?`12:${i} PM`:`${x-12}:${i} PM`};function Wa(s){const[o,i]=c.useState(()=>{if(s)try{return JSON.parse(s)}catch{console.log("Using default weekly hours")}return Ba});return{weeklyHours:o,setWeeklyHours:i,updateWeeklyHours:(m,P,T)=>{i(k=>({...k,[m]:{...k[m],[P]:T}}))},applyHoursToAllDays:(m,P,T=!0)=>{i(k=>{const t={...k};return Ie.forEach(u=>{t[u.key]={isOpen:T,openTime:m,closeTime:P}}),t})},applyHoursToWeekdays:(m,P,T=!0)=>{const k=["monday","tuesday","wednesday","thursday","friday"];i(t=>{const u={...t};return k.forEach(C=>{u[C]={isOpen:T,openTime:m,closeTime:P}}),u})},generateWeeklyHoursText:()=>{const m=Ie.filter(P=>o[P.key].isOpen);return m.length===0?"Cerrado toda la semana":m.map(P=>{const T=o[P.key],k=ms(T.openTime),t=ms(T.closeTime);return`${P.short}: ${k} - ${t}`}).join(`
`)},getHoursAsJSON:()=>JSON.stringify(o)}}function Qa({weeklyHours:s,updateWeeklyHours:o,generateWeeklyHoursText:i}){const[x,h]=c.useState(!1),[_,D]=c.useState({openTime:"09:00",closeTime:"18:00"}),f=()=>{h(!1)},m=()=>{h(!1)},P=()=>{Ie.forEach(t=>{o(t.key,"isOpen",!0),o(t.key,"openTime",_.openTime),o(t.key,"closeTime",_.closeTime)})},T=()=>{["monday","tuesday","wednesday","thursday","friday"].forEach(u=>{o(u,"isOpen",!0),o(u,"openTime",_.openTime),o(u,"closeTime",_.closeTime)})},k=()=>{Ie.forEach(t=>{o(t.key,"isOpen",!1)})};return e.jsxs(B,{className:"seller-profile w-full",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-purple-500 flex-shrink-0"}),e.jsx("span",{className:"text-base font-semibold",children:"Horarios de Atenci√≥n"})]}),!x&&e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>h(!0),className:"flex items-center gap-2 text-sm w-full justify-center",children:[e.jsx(ns,{className:"w-4 h-4"}),"Editar Horarios"]})]})}),e.jsx(W,{className:"space-y-4 px-2 sm:px-6",children:x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-base",children:"Configurar Horarios"}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(ae,{className:"w-5 h-5 text-purple-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"font-medium text-purple-900 text-sm mb-1",children:"Aplicar horarios a todos los d√≠as"}),e.jsx("p",{className:"text-xs text-purple-700 mb-3",children:"Configura una vez y aplica a toda la semana"})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 xs:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-xs font-medium text-purple-900",children:"Hora de Apertura"}),e.jsx(H,{type:"time",value:_.openTime,onChange:t=>D(u=>({...u,openTime:t.target.value})),className:"w-full h-10 text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-xs font-medium text-purple-900",children:"Hora de Cierre"}),e.jsx(H,{type:"time",value:_.closeTime,onChange:t=>D(u=>({...u,closeTime:t.target.value})),className:"w-full h-10 text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs(E,{onClick:P,variant:"outline",className:"w-full flex items-center gap-2 border-purple-300 hover:bg-purple-100 text-purple-700 h-9",children:[e.jsx(Sa,{className:"w-4 h-4"}),"Aplicar a todos los d√≠as"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(E,{onClick:T,variant:"outline",size:"sm",className:"flex items-center gap-1.5 border-blue-300 hover:bg-blue-50 text-blue-700 text-xs h-8",children:[e.jsx(Xe,{className:"w-3 h-3"}),"Lun-Vie"]}),e.jsxs(E,{onClick:k,variant:"outline",size:"sm",className:"flex items-center gap-1.5 border-red-300 hover:bg-red-50 text-red-700 text-xs h-8",children:[e.jsx(Ne,{className:"w-3 h-3"}),"Cerrar todos"]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:m,className:"flex items-center gap-2 flex-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Cancelar"]}),e.jsxs(E,{size:"sm",onClick:f,className:"flex items-center gap-2 flex-1",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Guardar"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h5",{className:"font-medium text-gray-700 text-sm",children:"Configurar cada d√≠a:"}),Ie.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-2 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"font-medium text-gray-900 text-sm",children:t.label}),e.jsx("button",{onClick:()=>o(t.key,"isOpen",!s[t.key].isOpen),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${s[t.key].isOpen?"bg-green-100 text-green-700 hover:bg-green-200":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:s[t.key].isOpen?"Abierto":"Cerrado"})]}),s[t.key].isOpen&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600 w-12",children:"Abre:"}),e.jsx(H,{type:"time",value:s[t.key].openTime,onChange:u=>o(t.key,"openTime",u.target.value),className:"flex-1 max-w-[110px] h-7 text-xs"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600 w-12",children:"Cierra:"}),e.jsx(H,{type:"time",value:s[t.key].closeTime,onChange:u=>o(t.key,"closeTime",u.target.value),className:"flex-1 max-w-[110px] h-7 text-xs"})]})]})]},t.key))]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 text-sm flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Vista previa de horarios:"]}),e.jsx("div",{className:"text-sm text-blue-800 leading-relaxed whitespace-pre-line font-mono bg-white rounded p-3 border",children:i()})]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-center text-sm sm:text-base",children:"Vista previa de horarios:"}),e.jsx("div",{className:"text-xs sm:text-sm text-blue-800 leading-relaxed break-words whitespace-pre-line",children:i()})]})})]})}function Ja(s,o){if(s&&o){const i=`https://www.google.com/maps/@${s},${o},18z`;window.open(i,"_blank")}}function Za(s){return s.business_name.trim()?null:"El nombre del negocio es requerido"}const es=({active:s,onClick:o,children:i,icon:x})=>e.jsxs("button",{onClick:o,className:`flex flex-col sm:flex-row items-center gap-2 px-4 py-3 sm:px-6 sm:py-4 text-sm font-bold rounded-lg transition-all duration-200 transform hover:scale-105 ${s?"bg-blue-600 text-white shadow-lg":"bg-white text-gray-700 hover:bg-blue-50 border border-gray-200 hover:border-blue-300"}`,children:[e.jsx(x,{className:"w-6 h-6 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-xs sm:text-sm font-bold",children:i})]});function us(){const{user:s}=fe(),{getCurrentLocation:o,loading:i,error:x,permissionState:h,clearError:_}=Va(),[D,f]=c.useState(null),[m,P]=c.useState(!0),[T,k]=c.useState(!1),[t,u]=c.useState(""),[C,I]=c.useState(""),[b,A]=c.useState(!1),[U,Z]=c.useState(!1),[G,Y]=c.useState(!1),[r,d]=c.useState(!1),[l,g]=c.useState(""),[n,p]=c.useState(!1),[S,O]=c.useState(!1),[z,K]=c.useState(!1),[Q,le]=c.useState("info"),xe=c.useRef(null),pe=c.useRef(null),{weeklyHours:Ve,setWeeklyHours:Ge,updateWeeklyHours:Be,generateWeeklyHoursText:He,getHoursAsJSON:$e}=Wa(D==null?void 0:D.business_hours),[j,X]=c.useState({business_name:"",business_description:"",business_logo:"",cover_image_url:"",business_category:"",phone:"",email:"",address:"",latitude:0,longitude:0,delivery_time:30,delivery_radius:5,minimum_order:50,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:{facebook:"",instagram:"",whatsapp:"",website:""}});c.useEffect(()=>{s?ke():(f(null),K(!1),P(!1)),p(Ha())},[s]),c.useEffect(()=>{if(!s||!m)return;const w=setTimeout(()=>{P(!1),K(!0)},8e3);return()=>clearTimeout(w)},[s,m]),c.useEffect(()=>{x&&(O(!0),u(""))},[x]);const ke=async()=>{var w;try{P(!0);const{data:a,error:v}=await N.from("sellers").select("*").eq("id",s==null?void 0:s.id).single();if(v){const y=v.code,M=((w=v.message)==null?void 0:w.toString().toLowerCase())||"";if(y==="PGRST116"||y==="PGRST403"||y==="42501"||y==="PGRST114"||M.includes("permission")||M.includes("rls")||M.includes("forbidden")||M.includes("not authorized"))K(!0);else throw v}if(a){if(f(a),X({business_name:a.business_name||"",business_description:a.business_description||"",business_logo:a.business_logo||"",cover_image_url:a.cover_image_url||"",business_category:a.business_category||"",phone:a.phone||"",email:a.email||"",address:a.address||"",latitude:a.latitude||0,longitude:a.longitude||0,delivery_time:a.delivery_time||30,delivery_radius:a.delivery_radius||5,minimum_order:a.minimum_order||50,is_active:a.is_active!==!1,is_open_now:a.is_open_now||!1,is_accepting_orders:a.is_accepting_orders!==!1,location_verified:a.location_verified||!1,social_media:a.social_media||{facebook:"",instagram:"",whatsapp:"",website:""}}),a.business_hours)try{Ge(JSON.parse(a.business_hours))}catch{console.log("Using default weekly hours")}const y=a.latitude&&a.longitude&&Math.abs(a.latitude)>.001&&Math.abs(a.longitude)>.001;d(y),y&&g(`${a.latitude.toFixed(6)}, ${a.longitude.toFixed(6)}`)}}catch(a){console.error("Error loading profile:",a),u("Error al cargar el perfil del negocio")}finally{P(!1)}},We=async()=>{var w,a,v,y,M;if(s)try{k(!0),u("");const L={business_name:((w=j.business_name)==null?void 0:w.trim())||"Mi Negocio",business_description:((a=j.business_description)==null?void 0:a.trim())||"",business_logo:"",cover_image_url:"",business_category:j.business_category||"",phone:((v=j.phone)==null?void 0:v.trim())||"",email:((y=j.email)==null?void 0:y.trim())||"",address:((M=j.address)==null?void 0:M.trim())||"",latitude:j.latitude||0,longitude:j.longitude||0,business_hours:$e(),delivery_time:j.delivery_time||30,delivery_radius:j.delivery_radius||5,minimum_order:j.minimum_order||0,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:j.social_media,is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:$}=await N.from("sellers").upsert({id:s.id,...L});if($)throw $;I("‚úÖ Perfil de vendedor creado. Completa la informaci√≥n y guarda los cambios."),K(!1),A(!0),await ke(),setTimeout(()=>I(""),4e3)}catch(L){console.error("Error creating minimal seller profile:",L),u("No se pudo crear el perfil de vendedor. Intenta de nuevo.")}finally{k(!1)}},Qe=async()=>{var w,a,v,y,M,L;try{k(!0),u("");const $=Za(j);if($){u($);return}console.log("üíæ Guardando perfil con datos:",{business_name:j.business_name,address:j.address,latitude:j.latitude,longitude:j.longitude,business_logo:((w=j.business_logo)==null?void 0:w.substring(0,50))+"...",cover_image_url:((a=j.cover_image_url)==null?void 0:a.substring(0,50))+"..."});const R={business_name:j.business_name.trim(),business_description:((v=j.business_description)==null?void 0:v.trim())||null,business_category:j.business_category||null,phone:((y=j.phone)==null?void 0:y.trim())||null,email:((M=j.email)==null?void 0:M.trim())||null,address:((L=j.address)==null?void 0:L.trim())||null,latitude:j.latitude||null,longitude:j.longitude||null,business_hours:$e(),delivery_time:j.delivery_time||30,delivery_radius:j.delivery_radius||5,minimum_order:j.minimum_order||0,is_active:j.is_active,is_open_now:j.is_open_now,location_verified:j.location_verified||!1,social_media:j.social_media||{},business_logo:j.business_logo||null,cover_image_url:j.cover_image_url||null,updated_at:new Date().toISOString()},{error:F}=await N.from("sellers").upsert({id:s==null?void 0:s.id,...R});if(F)throw console.error("üí• Error al guardar:",F),F;console.log("‚úÖ Perfil guardado exitosamente"),I("‚úÖ Perfil guardado exitosamente"),A(!1),await ke(),setTimeout(()=>I(""),4e3)}catch($){console.error("üí• Error saving profile:",$),u(`Error al guardar el perfil: ${$.message||"Error desconocido"}`)}finally{k(!1)}},Oe=(w,a,v,y=.8)=>new Promise(M=>{const L=document.createElement("canvas"),$=L.getContext("2d"),R=new Image;R.onload=()=>{let{width:F,height:J}=R;F>J?F>a&&(J=J*a/F,F=a):J>v&&(F=F*v/J,J=v),L.width=F,L.height=J,$.drawImage(R,0,0,F,J),L.toBlob(Te=>{Te&&M(Te)},"image/jpeg",y)},R.src=URL.createObjectURL(w)}),Me=async w=>{var v;const a=(v=w.target.files)==null?void 0:v[0];if(!(!a||!s))try{if(Z(!0),u(""),console.log("ÔøΩ SUBIENDO LOGO:",a.name),!a.type.startsWith("image/")){u("Solo im√°genes permitidas");return}const y=await Oe(a,400,400,.9),M=`${s.id}/logo-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-logos...");const{error:L}=await N.storage.from("business-logos").upload(M,y,{upsert:!0});if(L){console.error("‚ùå Error upload:",L),u(`Error subiendo: ${L.message}`);return}const{data:$}=N.storage.from("business-logos").getPublicUrl(M);console.log("üîó URL generada:",$.publicUrl);const{error:R}=await N.from("sellers").upsert({id:s.id,business_logo:$.publicUrl,business_name:j.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(R){console.error("‚ùå Error BD:",R),u(`Error guardando: ${R.message}`);return}console.log("‚úÖ LOGO GUARDADO EXITOSAMENTE"),X(F=>({...F,business_logo:$.publicUrl})),I("‚úÖ Logo guardado correctamente"),setTimeout(()=>I(""),3e3)}catch(y){console.error("üí• ERROR COMPLETO:",y),u(`Error: ${y.message}`)}finally{Z(!1)}},Ce=async w=>{var v;const a=(v=w.target.files)==null?void 0:v[0];if(!(!a||!s))try{if(Z(!0),u(""),console.log("ÔøΩ SUBIENDO PORTADA:",a.name),!a.type.startsWith("image/")){u("Solo im√°genes permitidas");return}const y=await Oe(a,1200,400,.9),M=`${s.id}/cover-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-covers...");const{error:L}=await N.storage.from("business-covers").upload(M,y,{upsert:!0});if(L){console.error("‚ùå Error upload:",L),u(`Error subiendo: ${L.message}`);return}const{data:$}=N.storage.from("business-covers").getPublicUrl(M);console.log("üîó URL generada:",$.publicUrl);const{error:R}=await N.from("sellers").upsert({id:s.id,cover_image_url:$.publicUrl,business_name:j.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(R){console.error("‚ùå Error BD:",R),u(`Error guardando: ${R.message}`);return}console.log("‚úÖ PORTADA GUARDADA EXITOSAMENTE"),X(F=>({...F,cover_image_url:$.publicUrl})),I("‚úÖ Portada guardada correctamente"),setTimeout(()=>I(""),3e3)}catch(y){console.error("üí• ERROR COMPLETO:",y),u(`Error: ${y.message}`)}finally{Z(!1)}},Ee=async()=>{try{u(""),O(!1),_();const w=await o();X(a=>({...a,latitude:w.latitude,longitude:w.longitude})),d(!0),g(`${w.latitude.toFixed(6)}, ${w.longitude.toFixed(6)}`),I(`üéØ ¬°Ubicaci√≥n GPS verificada exitosamente!
      
Ô∏è Ciudad: ${w.city}, ${w.state}
üìä Coordenadas: ${w.latitude.toFixed(6)}, ${w.longitude.toFixed(6)}
      
‚úÖ Los repartidores podr√°n encontrar tu negocio f√°cilmente.
üìù Ahora escribe la direcci√≥n de tu negocio en el campo correspondiente.

üîî No olvides guardar el perfil para mantener estos cambios.`)}catch(w){console.error("Error detecting location:",w),O(!0)}},Je=()=>{O(!1),_(),Ee()},Le=()=>{O(!1),_()},Pe=async()=>{const w=!j.is_open_now;try{const{error:a}=await N.from("sellers").update({is_open_now:w,updated_at:new Date().toISOString()}).eq("id",s==null?void 0:s.id);if(a)throw a;X(v=>({...v,is_open_now:w})),I(w?"üü¢ ¬°Negocio ABIERTO! Ahora apareces en el listado de compradores":"üî¥ Negocio CERRADO. No aparecer√°s en el listado hasta que abras"),setTimeout(()=>I(""),4e3)}catch(a){console.error("Error updating business status:",a),u("Error al actualizar el estado del negocio")}};return m?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"w-10 h-10 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Cargando tu perfil de negocio..."})]})}):!m&&z?e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:e.jsxs(B,{className:"text-center shadow-lg border-none",children:[e.jsxs(re,{children:[e.jsx(ee,{children:"¬°Bienvenido, Vendedor!"}),e.jsx("p",{className:"text-gray-600",children:"Parece que a√∫n no has configurado tu perfil. ¬°Es el primer paso para empezar a vender!"})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Crearemos un perfil b√°sico para ti. Podr√°s editar y completar toda la informaci√≥n m√°s adelante."}),e.jsxs(E,{onClick:We,disabled:T,size:"lg",className:"w-full sm:w-auto",children:[T?e.jsx(ie,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ve,{className:"w-5 h-5 mr-2"}),"Crear Mi Perfil Ahora"]})]})]})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil de Negocio"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestiona la informaci√≥n que ven tus clientes."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"outline",onClick:()=>A(!b),children:b?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(ta,{className:"w-4 h-4 mr-2"})," Editar"]})}),b&&e.jsxs(E,{onClick:Qe,disabled:T,children:[T?e.jsx(ie,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})]})]})}),t&&e.jsxs(de,{variant:"destructive",className:"mb-6 flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(me,{className:"whitespace-pre-line",children:t})]}),C&&e.jsxs(de,{className:"mb-6 border-green-200 bg-green-50 text-green-800 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(me,{className:"text-green-800 whitespace-pre-line",children:C})]}),!n&&e.jsxs(de,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(hs,{className:"h-4 w-4 text-blue-600"}),e.jsxs(me,{className:"text-blue-800",children:[e.jsx("strong",{children:"Sistema GPS:"})," Funcionando con detecci√≥n b√°sica. Para direcciones m√°s detalladas, puedes configurar Google Maps API (opcional).",e.jsx("br",{}),e.jsx("small",{children:"Ver: /GOOGLE_MAPS_SETUP_OPCIONAL.md"})]})]}),e.jsxs(B,{className:"w-full overflow-hidden shadow-lg border-none bg-white",children:[e.jsxs("div",{className:"relative h-32 sm:h-48 md:h-56 bg-gradient-to-r from-blue-500 to-purple-600",children:[j.cover_image_url?e.jsx(ze,{src:j.cover_image_url,alt:"Portada del negocio",className:"w-full h-full object-cover",width:800,height:200}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(je,{className:"w-12 h-12 mx-auto mb-2 opacity-70"}),e.jsx("p",{className:"text-sm opacity-90",children:"Imagen de portada"}),b&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Cualquier imagen se optimizar√° autom√°ticamente"})]})}),b&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var w;return(w=pe.current)==null?void 0:w.click()},children:[e.jsxs(E,{variant:"secondary",disabled:U,children:[U?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):e.jsx(je,{className:"w-4 h-4 mr-2"}),j.cover_image_url?"Cambiar Portada":"Agregar Portada"]}),e.jsx("input",{ref:pe,type:"file",accept:"image/*",className:"hidden",onChange:Ce})]})]}),e.jsx("div",{className:"relative px-4 sm:px-6 pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-12 sm:-mt-16 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"relative h-24 w-24 sm:h-32 sm:w-32 rounded-full border-4 border-white bg-gradient-to-br from-green-400 to-blue-500 shadow-lg flex items-center justify-center",children:[j.business_logo?e.jsx(ze,{src:j.business_logo,alt:"Logo del negocio",className:"w-full h-full object-cover rounded-full"}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-1"}),b&&e.jsx("p",{className:"text-xs opacity-80",children:"Logo - Auto-optimizado"})]}),b&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var w;return(w=xe.current)==null?void 0:w.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white/90 rounded-full flex items-center justify-center",children:U?e.jsx(ie,{className:"w-5 h-5 animate-spin text-slate-800"}):e.jsx(je,{className:"w-5 h-5 text-slate-800"})}),e.jsx("input",{ref:xe,type:"file",accept:"image/*",className:"hidden",onChange:Me})]})]}),e.jsx("div",{className:"flex-1 text-center sm:text-left sm:ml-6 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:j.business_name}),(D==null?void 0:D.is_verified)&&e.jsx(ia,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-500"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:j.business_category})]}),e.jsx("div",{className:"flex justify-center sm:justify-end mt-3 sm:mt-0",children:e.jsxs("div",{onClick:Pe,className:`flex items-center gap-3 px-4 py-2 rounded-full text-sm font-bold cursor-pointer transform transition-all duration-200 hover:scale-105 shadow-lg ${j.is_open_now?"bg-green-500 text-white hover:bg-green-600":"bg-red-500 text-white hover:bg-red-600"}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full animate-pulse ${j.is_open_now?"bg-green-200":"bg-red-200"}`}),e.jsx("span",{className:"font-bold",children:j.is_open_now?"ABIERTO":"CERRADO"}),e.jsx(Us,{checked:j.is_open_now,onCheckedChange:Pe,className:"h-5 w-9"})]})})]})})]})}),e.jsx("div",{className:"px-4 sm:px-6 mt-6 bg-gray-50 py-4 rounded-t-lg",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:flex sm:flex-wrap sm:items-center sm:justify-center sm:gap-4",children:[e.jsxs(es,{active:Q==="info",onClick:()=>le("info"),icon:os,children:[e.jsx("span",{className:"hidden sm:inline",children:"Informaci√≥n"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]}),e.jsxs(es,{active:Q==="location",onClick:()=>le("location"),icon:oe,children:[e.jsx("span",{className:"hidden sm:inline",children:"Ubicaci√≥n"}),e.jsx("span",{className:"sm:hidden",children:"Lugar"})]}),e.jsxs(es,{active:Q==="delivery",onClick:()=>le("delivery"),icon:Ae,children:[e.jsx("span",{className:"hidden sm:inline",children:"Delivery"}),e.jsx("span",{className:"sm:hidden",children:"Env√≠o"})]})]})}),e.jsxs(W,{className:"p-6",children:[Q==="info"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2 mb-4",children:[e.jsx(ve,{className:"w-5 h-5 text-green-500"})," Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"business_name",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ve,{className:"w-4 h-4 text-green-500"}),"Nombre del Negocio"]}),e.jsx(H,{id:"business_name",value:j.business_name,onChange:w=>X(a=>({...a,business_name:w.target.value})),disabled:!b,placeholder:"Mi Negocio",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs(V,{htmlFor:"business_description",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(os,{className:"w-4 h-4 text-purple-500"}),"Descripci√≥n (opcional)"]}),e.jsx(ts,{id:"business_description",value:j.business_description,onChange:w=>X(a=>({...a,business_description:w.target.value})),disabled:!b,rows:3,placeholder:"Cu√©ntales a tus clientes sobre tu negocio...",className:"border-gray-200 focus:border-purple-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2 mb-4",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-500"})," Contacto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Fe,{className:"w-4 h-4 text-green-500"}),"Tel√©fono"]}),e.jsx(H,{id:"phone",value:j.phone,onChange:w=>X(a=>({...a,phone:w.target.value})),disabled:!b,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(xa,{className:"w-4 h-4 text-blue-500"}),"Email (opcional)"]}),e.jsx(H,{id:"email",type:"email",value:j.email,onChange:w=>X(a=>({...a,email:w.target.value})),disabled:!b,placeholder:"contacto@negocio.com",className:"border-gray-200 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2 mb-4",children:[e.jsx(ls,{className:"w-5 h-5 text-purple-500"})," Redes Sociales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"whatsapp",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ua,{className:"w-4 h-4 text-green-500"})," WhatsApp"]}),e.jsx(H,{id:"whatsapp",value:j.social_media.whatsapp,onChange:w=>X(a=>({...a,social_media:{...a.social_media,whatsapp:w.target.value}})),disabled:!b,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"facebook",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ca,{className:"w-4 h-4 text-blue-600"})," Facebook"]}),e.jsx(H,{id:"facebook",value:j.social_media.facebook,onChange:w=>X(a=>({...a,social_media:{...a.social_media,facebook:w.target.value}})),disabled:!b,placeholder:"@mi_negocio",className:"border-gray-200 focus:border-blue-500"})]})]}),b&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"+ M√°s redes sociales (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"instagram",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ia,{className:"w-4 h-4 text-pink-500"})," Instagram"]}),e.jsx(H,{id:"instagram",value:j.social_media.instagram,onChange:w=>X(a=>({...a,social_media:{...a.social_media,instagram:w.target.value}})),placeholder:"@mi_negocio",className:"border-gray-200 focus:border-pink-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"website",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ls,{className:"w-4 h-4 text-gray-500"})," Sitio Web"]}),e.jsx(H,{id:"website",value:j.social_media.website,onChange:w=>X(a=>({...a,social_media:{...a.social_media,website:w.target.value}})),placeholder:"www.mi-negocio.com",className:"border-gray-200 focus:border-gray-500"})]})]})]})]})]}),Q==="location"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Ubicaci√≥n del Negocio"}),r&&e.jsx(te,{className:"w-5 h-5 text-green-500"})]}),S&&x&&e.jsxs(de,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs(me,{className:"flex flex-col gap-3",children:[e.jsx("span",{children:x}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{size:"sm",variant:"outline",onClick:Je,className:"bg-white hover:bg-gray-50",children:[e.jsx(na,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),e.jsxs(E,{size:"sm",variant:"ghost",onClick:Le,className:"text-red-800 hover:bg-red-50",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),"Cerrar"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"address",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(oe,{className:"w-4 h-4 text-red-500"}),"Direcci√≥n"]}),e.jsx(H,{id:"address",value:j.address,onChange:w=>X(a=>({...a,address:w.target.value})),disabled:!b,placeholder:"Direcci√≥n de tu negocio",className:"border-gray-200 focus:border-red-500"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"GPS Autom√°tico"})]}),r&&e.jsx(te,{className:"w-5 h-5 text-green-500"})]}),r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-green-700 bg-green-100 p-3 rounded-md",children:["‚úÖ ",e.jsx("strong",{children:"Ubicaci√≥n verificada"}),e.jsx("br",{}),"üìç ",l]}),b&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:Ee,disabled:i,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[i?e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(E,{onClick:()=>Ja(j.latitude,j.longitude),variant:"outline",size:"sm",disabled:!j.latitude||!j.longitude,children:[e.jsx(ga,{className:"w-4 h-4 mr-2"}),"Ver Mapa"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Detecta tu ubicaci√≥n para que los repartidores te encuentren f√°cilmente"}),b&&e.jsxs(E,{onClick:Ee,disabled:i,className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:[i?e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(qe,{className:"w-4 h-4 mr-2"}),i?"Detectando...":"Detectar Mi Ubicaci√≥n"]}),h==="denied"&&e.jsxs(de,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(Se,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(me,{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"GPS bloqueado."})," Haz clic en üîí en la barra del navegador para permitir ubicaci√≥n."]})]})]})]})]})]}),e.jsx("div",{children:e.jsx(Qa,{weeklyHours:Ve,updateWeeklyHours:Be,generateWeeklyHoursText:He})})]}),Q==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-orange-500"})," Configuraci√≥n de Delivery"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-500"}),e.jsx(V,{htmlFor:"delivery_time",className:"text-sm font-medium",children:"Tiempo de Preparaci√≥n"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_time",type:"number",value:j.delivery_time,onChange:w=>X(a=>({...a,delivery_time:parseInt(w.target.value)||0})),disabled:!b,min:"5",max:"120",className:"border-gray-200 focus:border-orange-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-500"}),e.jsx(V,{htmlFor:"delivery_radius",className:"text-sm font-medium",children:"Radio de Entrega"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_radius",type:"number",value:j.delivery_radius,onChange:w=>X(a=>({...a,delivery_radius:parseInt(w.target.value)||0})),disabled:!b,min:"1",max:"20",className:"border-gray-200 focus:border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"km"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-500"}),e.jsx(V,{htmlFor:"minimum_order",className:"text-sm font-medium",children:"Pedido M√≠nimo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Q"}),e.jsx(H,{id:"minimum_order",type:"number",value:j.minimum_order,onChange:w=>X(a=>({...a,minimum_order:parseInt(w.target.value)||0})),disabled:!b,min:"0",className:"border-gray-200 focus:border-green-500"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-lg",children:"üí° Estos valores ayudan a los clientes a saber qu√© esperar de tu servicio"})]})]})]})]})})}async function Ya(s){try{const{data:{user:o}}=await N.auth.getUser();if(!o)throw new Error("Usuario no autenticado");console.log(`üöÄ Intentando aceptar orden ${s}...`);const{data:i,error:x}=await N.rpc("seller_accept_order",{p_order_id:s,p_seller_id:o.id});return x?(console.error("‚ùå Error:",x),{success:!1,error:x.message}):(console.log("‚úÖ Resultado:",i),{success:!0,data:i})}catch(o){return console.error("üí• Error:",o),{success:!1,error:o instanceof Error?o.message:"Error desconocido"}}}const Ka={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-purple-100 text-purple-800",assigned:"bg-indigo-100 text-indigo-800",picked_up:"bg-green-100 text-green-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},xs={pending:"Pendiente",accepted:"Aceptado",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",assigned:"Asignado",picked_up:"Recogido",in_transit:"En camino",delivered:"Entregado",completed:"Completado",cancelled:"Cancelado",rejected:"Rechazado"};function gs(){const{user:s}=fe(),[o,i]=c.useState([]),[x,h]=c.useState(!0),[_,D]=c.useState(!1),[f,m]=c.useState(new Set),[P,T]=c.useState("pending");c.useEffect(()=>{s!=null&&s.id&&(t(),k())},[s==null?void 0:s.id]);const k=()=>{if(!(s!=null&&s.id))return;const r=N.channel("seller-orders-management").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},()=>{t()}).subscribe();return()=>{r.unsubscribe()}},t=async()=>{i([]);try{const{data:r,error:d}=await N.from("orders").select(`
          *,
          order_items (
            id,
            product_name,
            quantity,
            unit_price,
            product_image,
            notes
          ),
          users!orders_buyer_id_fkey (
            name,
            phone
          ),
          drivers:users!orders_driver_id_fkey (
            name
          )
        `).eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(d)throw d;console.log("üìä √ìrdenes cargadas:",(r==null?void 0:r.length)||0),console.log("üìã Datos de √≥rdenes:",r);const l=(r==null?void 0:r.map(g=>{var n,p,S;return console.log(`üîç Orden ${g.order_number}:`,{id:g.id,status:g.status,delivery_type:g.delivery_type,buyer_id:g.buyer_id}),{...g,buyer_id:g.buyer_id,buyer_name:((n=g.users)==null?void 0:n.name)||"Cliente",buyer_phone:(p=g.users)==null?void 0:p.phone,driver_name:(S=g.drivers)==null?void 0:S.name,items:g.order_items||[]}}))||[];i(l)}catch(r){console.error("Error loading orders:",r),q.error("Error al cargar las √≥rdenes")}finally{h(!1),D(!1)}},u=()=>{D(!0),t()},C=async r=>{console.log(`üß™ Probando aceptar orden directa: ${r}`);const d=await Ya(r);console.log("üìä Resultado:",d),d.success?(q.success("Orden aceptada exitosamente!"),t()):q.error(`Error: ${d.error}`)},I=async r=>{if(!f.has(r)){m(d=>new Set([...d,r]));try{console.log(`üéØ Marcando orden como lista: ${r}`);let d,l;try{console.log("üîÑ Intento 1: seller_mark_ready_improved");const g=await N.rpc("seller_mark_ready_improved",{p_order_id:r,p_seller_id:s==null?void 0:s.id});d=g.data,l=g.error,!l&&d&&console.log("‚úÖ √âxito con funci√≥n mejorada")}catch{console.log("‚ö†Ô∏è Funci√≥n mejorada fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_ready_safe");const n=await N.rpc("seller_mark_ready_safe",{p_order_id:r,p_seller_id:s==null?void 0:s.id});d=n.data,l=n.error,!l&&d&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_ready_basic");const p=await N.rpc("seller_mark_ready_basic",{p_order_id:r,p_seller_id:s==null?void 0:s.id});d=p.data,l=p.error,!l&&d&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(p){throw console.error("üí• Todos los m√©todos fallaron:",p),new Error("No se pudo marcar la orden como lista")}}}if(l){console.error("‚ùå Error RPC:",l),q.error(`Error: ${l.message}`);return}if(console.log("‚úÖ Resultado final:",d),d&&d.length>0){const g=d[0];g.success?(q.success(g.message),t()):q.error(g.message)}else q.success("Orden marcada como lista"),t()}catch(d){console.error("üí• Error en handleMarcarListo:",d),q.error("Error al marcar orden como lista")}finally{m(d=>{const l=new Set(d);return l.delete(r),l})}}},b=async r=>{if(!f.has(r)){m(d=>new Set([...d,r]));try{console.log(`üì¶ Completando orden pickup/dine-in: ${r}`);let d,l;try{console.log("üîÑ Intento 1: seller_mark_completed_pickup");const g=await N.rpc("seller_mark_completed_pickup",{p_order_id:r,p_seller_id:s==null?void 0:s.id});d=g.data,l=g.error,!l&&d&&console.log("‚úÖ √âxito con funci√≥n completa")}catch{console.log("‚ö†Ô∏è Funci√≥n completa fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_completed_pickup_safe");const n=await N.rpc("seller_mark_completed_pickup_safe",{p_order_id:r,p_seller_id:s==null?void 0:s.id});d=n.data,l=n.error,!l&&d&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_completed_pickup_basic");const p=await N.rpc("seller_mark_completed_pickup_basic",{p_order_id:r,p_seller_id:s==null?void 0:s.id});d=p.data,l=p.error,!l&&d&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(p){throw console.error("üí• Todos los m√©todos fallaron:",p),new Error("No se pudo completar la orden pickup/dine-in")}}}if(l){console.error("‚ùå Error RPC:",l),q.error(`Error: ${l.message}`);return}if(console.log("‚úÖ Resultado final:",d),d&&d.length>0){const g=d[0];g.success?(q.success(g.message),t()):q.error(g.message)}else q.success("Orden completada exitosamente"),t()}catch(d){console.error("üí• Error en handleCompletarPickup:",d),q.error("Error al completar la orden")}finally{m(d=>{const l=new Set(d);return l.delete(r),l})}}},A=async(r,d)=>{var n,p;if(f.has(r))return;const g={confirmed:"accepted",preparing:"ready",ready:"ready",delivered:"delivered",cancelled:"cancelled"}[d];m(S=>new Set([...S,r]));try{let S;if(g==="accepted"&&(S=await N.rpc("seller_accept_order",{p_order_id:r,p_seller_id:s==null?void 0:s.id})),S&&(S.error||S.data&&S.data[0]&&!S.data[0].success)){const z=((n=S.error)==null?void 0:n.message)||((p=S.data[0])==null?void 0:p.message)||"Error al actualizar el estado";console.error("RPC error:",z),q.error(z),m(K=>{const Q=new Set(K);return Q.delete(r),Q});return}const O=o.find(z=>z.id===r);if(O&&g==="accepted"){await N.from("notifications").insert({user_id:O.buyer_id,order_id:O.id,message:`Tu orden #${O.order_number} ha sido aceptada.`,type:"order_accepted"}),console.log("üîÑ Orden aceptada, actualizando stock...");const{data:z,error:K}=await N.from("order_items").select("product_id, daily_product_id, quantity, product_name, product_type").eq("order_id",r);if(K)console.error("‚ùå Error obteniendo items de la orden:",K),q.error("Orden aceptada pero error al actualizar stock");else if(z&&z.length>0){console.log("üì¶ Items encontrados:",z.length),z.forEach((le,xe)=>{console.log(`   ${xe+1}. ${le.product_name} - Cantidad: ${le.quantity} - Tipo: ${le.product_type}`)}),console.log("üöÄ Llamando updateProductStock...");const Q=await oa(z,r);console.log("üìä Resultado del stock manager:",Q),Q.success?(console.log("‚úÖ Stock actualizado exitosamente:",Q.updatedProducts),q.success("Orden aceptada y stock actualizado")):(console.error("‚ùå Error actualizando stock:",Q.message),q.error(`Orden aceptada pero ${Q.message}`))}else console.log("‚ö†Ô∏è No se encontraron items en la orden"),q.success("Orden aceptada (sin items para actualizar stock)")}q.success(`Orden actualizada a ${xs[g]||g}.`),t(),m(z=>{const K=new Set(z);return K.delete(r),K})}catch(S){console.error("Error updating order status:",S),q.error("Error al actualizar el estado de la orden")}finally{m(S=>{const O=new Set(S);return O.delete(r),O})}},U=async(r,d)=>{if(!f.has(r)){m(l=>new Set([...l,r]));try{const{error:l}=await N.from("orders").update({status:"rejected",rejection_reason:d,updated_at:new Date().toISOString()}).eq("id",r);if(l)throw l;const g=o.find(n=>n.id===r);g&&await N.from("notifications").insert({user_id:g.buyer_id,order_id:g.id,message:`Tu orden #${g.order_number} fue rechazada.`,type:"order_rejected"}),q.success("Orden rechazada"),t()}catch(l){console.error("Error rejecting order:",l),q.error("Error al rechazar la orden")}finally{m(l=>{const g=new Set(l);return g.delete(r),g})}}},Z=r=>{try{return new Date(r).toLocaleString("es-GT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha inv√°lida"}},G=r=>r==="active"?o.filter(d=>["accepted","ready","assigned","picked_up","in_transit"].includes(d.status)):r==="completed"?o.filter(d=>["delivered","completed"].includes(d.status)):r==="cancelled"?o.filter(d=>["cancelled","rejected"].includes(d.status)):o.filter(d=>d.status===r),Y=r=>{const d=f.has(r.id);return console.log(`üé® Renderizando orden ${r.order_number}:`,{id:r.id,status:r.status,delivery_type:r.delivery_type,buyer_id:r.buyer_id,isProcessing:d,orderObject:r}),console.log(`‚ùì Status actual: "${r.status}" (tipo: ${typeof r.status})`),console.log(`‚ùì Delivery type actual: "${r.delivery_type}" (tipo: ${typeof r.delivery_type})`),console.log(`‚ùì ¬øStatus === 'pending'? ${r.status==="pending"}`),console.log(`‚ùì ¬øDelivery type === 'delivery'? ${r.delivery_type==="delivery"}`),console.log(`‚ùì ¬øStatus incluye pending? ${String(r.status).includes("pending")}`),console.log(`‚ùì ¬øDelivery incluye delivery? ${String(r.delivery_type).includes("delivery")}`),e.jsxs(B,{className:"border-l-4 border-l-orange-500",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"text-lg",children:["Orden #",r.order_number]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Z(r.created_at)})]}),e.jsx(se,{className:Ka[r.status],children:xs[r.status]})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:r.buyer_name}),r.buyer_phone&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-4 h-4 text-gray-500 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:r.buyer_phone})]})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 ${String(r.delivery_type||"").trim().toLowerCase()==="delivery"?"bg-blue-50 border-blue-300":String(r.delivery_type||"").trim().toLowerCase()==="pickup"?"bg-green-50 border-green-300":"bg-blue-50 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[String(r.delivery_type||"").trim().toLowerCase()==="delivery"||!r.delivery_type?e.jsx(Ae,{className:"w-8 h-8 text-blue-600"}):String(r.delivery_type||"").trim().toLowerCase()==="pickup"?e.jsx(ge,{className:"w-8 h-8 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-xl font-bold ${String(r.delivery_type||"").trim().toLowerCase()==="delivery"||!r.delivery_type?"text-blue-800":String(r.delivery_type||"").trim().toLowerCase()==="pickup"?"text-green-800":"text-orange-800"}`,children:String(r.delivery_type||"").trim().toLowerCase()==="delivery"||!r.delivery_type?"SERVICIO A DOMICILIO":String(r.delivery_type||"").trim().toLowerCase()==="pickup"?"RECOGER EN TIENDA":"COMER EN EL LUGAR"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["M√©todo de entrega: ",r.delivery_type||"No especificado"]})]})]})}),r.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[e.jsx(oe,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:r.delivery_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Productos:"}),r.items.map((l,g)=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsxs("span",{children:[l.quantity,"x ",l.product_name]}),e.jsxs("span",{className:"font-medium",children:["Q",(l.quantity*l.unit_price).toFixed(2)]})]},g))]}),r.notes&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Da,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Notas:"}),e.jsx("p",{className:"text-sm text-blue-700",children:r.notes})]})]})}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["Q",r.total.toFixed(2)]})]}),r.delivery_fee>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Incluye Q",r.delivery_fee.toFixed(2)," de entrega"]})]}),r.driver_name&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Repartidor: ",r.driver_name]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[String(r.status).trim().toLowerCase()==="pending"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:()=>C(r.id),disabled:f.has(r.id),className:"flex-1 bg-green-600 hover:bg-green-700",children:[f.has(r.id)?e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Aceptar Orden"]}),e.jsxs(E,{onClick:()=>U(r.id,"No disponible"),disabled:f.has(r.id),variant:"destructive",size:"lg",className:"px-6 bg-red-600 hover:bg-red-700 text-white border-red-600",style:{backgroundColor:"#dc2626",borderColor:"#dc2626"},children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})}),r.status==="accepted"&&e.jsxs(E,{onClick:()=>I(r.id),disabled:f.has(r.id),className:"w-full bg-purple-600 hover:bg-purple-700",children:[f.has(r.id)?e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Marcar Orden Lista"]}),r.status==="ready"&&e.jsxs("div",{className:"space-y-3",children:[(r.delivery_type==="delivery"||!r.delivery_type)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Orden lista para recoger"}),e.jsx("p",{className:"text-sm text-blue-600",children:"El repartidor recoger√° y entregar√° esta orden"})]})]})}),(r.delivery_type==="pickup"||r.delivery_type==="dine-in")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${r.delivery_type==="pickup"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[r.delivery_type==="pickup"?e.jsx(ge,{className:"w-6 h-6 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${r.delivery_type==="pickup"?"text-green-800":"text-orange-800"}`,children:r.delivery_type==="pickup"?"Cliente debe recoger en tienda":"Cliente consume en el lugar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Marcar como entregado cuando el cliente complete la orden"})]})]})}),e.jsxs(E,{onClick:()=>b(r.id),disabled:f.has(r.id),className:"w-full bg-green-600 hover:bg-green-700",children:[f.has(r.id)?e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),r.delivery_type==="pickup"?"Marcar como Recogido":"Marcar como Servido"]})]})]}),r.status==="delivered"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:()=>A(r.id,"confirmed"),disabled:d,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[d?e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Re-procesar"]}),e.jsxs(E,{onClick:()=>U(r.id,"Orden rechazada"),disabled:d,variant:"destructive",size:"lg",className:"px-6",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})]})]})]},r.id)};return x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{className:"border-orange-200 shadow-lg",children:e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-500"}),"Gesti√≥n de √ìrdenes"]}),e.jsxs(E,{variant:"outline",onClick:u,disabled:_,size:"sm",children:[_?e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})})}),e.jsxs(ss,{value:P,onValueChange:T,children:[e.jsxs(as,{className:"grid w-full grid-cols-4",children:[e.jsxs(be,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Pendientes",G("pending").length>0&&e.jsx(se,{variant:"destructive",className:"ml-1 px-1.5 py-0.5 text-xs",children:G("pending").length})]}),e.jsxs(be,{value:"active",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Activas",G("active").length>0&&e.jsx(se,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:G("active").length})]}),e.jsxs(be,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Completadas"]}),e.jsxs(be,{value:"cancelled",className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Canceladas"]})]}),e.jsx(ce,{value:"pending",className:"space-y-4",children:G("pending").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes pendientes"})]})}):G("pending").map(Y)}),e.jsx(ce,{value:"active",className:"space-y-4",children:G("active").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes activas"})]})}):G("active").map(Y)}),e.jsx(ce,{value:"completed",className:"space-y-4",children:G("completed").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes completadas"})]})}):G("completed").map(Y)}),e.jsx(ce,{value:"cancelled",className:"space-y-4",children:G("cancelled").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes canceladas"})]})}):G("cancelled").map(Y)})]})]})}function Xa({userRole:s,onVerificationComplete:o}){const{user:i}=fe(),[x,h]=c.useState({latitude:null,longitude:null,address:""}),[_,D]=c.useState({latitude:null,longitude:null,address:""}),[f,m]=c.useState({phone:"",profileImage:"",coverImage:"",vehicleType:"",licenseNumber:""}),[P,T]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1}),[k,t]=c.useState(!1),[u,C]=c.useState(!1);c.useEffect(()=>{i&&I()},[i]);const I=async()=>{if(i)try{const{data:n,error:p}=await N.from("users").select("*").eq("id",i.id).single();if(p)throw p;if(n&&(h({latitude:n.latitude,longitude:n.longitude,address:n.address||""}),m({phone:n.phone||"",profileImage:n.profile_image_url||"",coverImage:n.cover_image_url||"",vehicleType:n.vehicle_type||"",licenseNumber:n.license_number||""}),T(S=>({...S,locationVerified:n.location_verified||!1,profileCompleted:n.profile_completed||!1}))),s==="vendedor"){const{data:S,error:O}=await N.from("sellers").select("*").eq("user_id",i.id).single();S&&(D({latitude:S.business_latitude,longitude:S.business_longitude,address:S.business_address||""}),m(z=>({...z,coverImage:S.cover_image_url||""})),T(z=>({...z,businessLocationVerified:S.business_location_verified||!1,canPublish:S.can_publish_products||!1})))}}catch(n){console.error("Error loading user data:",n),q.error("Error al cargar datos del usuario")}},b=async()=>{if(!navigator.geolocation){q.error("Tu navegador no soporta geolocalizaci√≥n");return}C(!0),navigator.geolocation.getCurrentPosition(async n=>{const{latitude:p,longitude:S}=n.coords;try{const O=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${S},${p}.json?access_token=`);if(O.ok){const z=await O.json();z.features&&z.features.length>0&&h(K=>({...K,latitude:p,longitude:S}))}else h(z=>({...z,latitude:p,longitude:S}));q.success("Ubicaci√≥n obtenida correctamente")}catch(O){console.error("Error getting address:",O),h(z=>({...z,latitude:p,longitude:S})),q.success("Ubicaci√≥n obtenida (sin direcci√≥n)")}finally{C(!1)}},n=>{console.error("Geolocation error:",n),C(!1),q.error("No se pudo obtener tu ubicaci√≥n. Verifica los permisos del navegador.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},A=async()=>{if(!i||!x.latitude||!x.longitude){q.error("Primero obt√©n tu ubicaci√≥n");return}t(!0);try{const{error:n}=await N.rpc("update_user_location",{user_id:i.id,lat:x.latitude,lng:x.longitude,user_address:x.address});if(n)throw n;T(p=>({...p,locationVerified:!0})),q.success("Ubicaci√≥n personal verificada"),await G()}catch(n){console.error("Error saving location:",n),q.error("Error al guardar ubicaci√≥n")}finally{t(!1)}},U=async()=>{if(!i||!_.latitude||!_.longitude){q.error("Primero obt√©n la ubicaci√≥n del negocio");return}t(!0);try{const{error:n}=await N.rpc("update_business_location",{seller_user_id:i.id,lat:_.latitude,lng:_.longitude,business_addr:_.address});if(n)throw n;T(p=>({...p,businessLocationVerified:!0})),q.success("Ubicaci√≥n del negocio verificada"),await G()}catch(n){console.error("Error saving business location:",n),q.error("Error al guardar ubicaci√≥n del negocio")}finally{t(!1)}},Z=async()=>{if(i){t(!0);try{const n={phone:f.phone,profile_image_url:f.profileImage,updated_at:new Date().toISOString()};s==="repartidor"&&(n.vehicle_type=f.vehicleType,n.license_number=f.licenseNumber);const{error:p}=await N.from("users").update(n).eq("id",i.id);if(p)throw p;if(s==="vendedor"&&f.coverImage){const{error:S}=await N.from("sellers").update({cover_image_url:f.coverImage}).eq("user_id",i.id);if(S)throw S}q.success("Perfil actualizado"),await G()}catch(n){console.error("Error updating profile:",n),q.error("Error al actualizar perfil")}finally{t(!1)}}},G=async()=>{if(i)try{let n=!1;if(s==="vendedor"){const{data:p,error:S}=await N.rpc("check_seller_can_publish",{seller_user_id:i.id});S||(n=p)}else if(s==="comprador"){const{data:p,error:S}=await N.rpc("check_buyer_can_purchase",{buyer_user_id:i.id});S||(n=p)}else if(s==="repartidor"){const{data:p,error:S}=await N.rpc("check_driver_can_work",{driver_user_id:i.id});S||(n=p)}T(p=>({...p,canPublish:s==="vendedor"?n:p.canPublish,canPurchase:s==="comprador"?n:p.canPurchase,canWork:s==="repartidor"?n:p.canWork})),n&&o&&o()}catch(n){console.error("Error checking verification status:",n)}},Y=()=>{const n=[{name:"Tel√©fono",completed:!!f.phone,icon:Fe},{name:"Ubicaci√≥n verificada",completed:P.locationVerified,icon:oe}];return s==="vendedor"?[...n,{name:"Foto de perfil",completed:!!f.profileImage,icon:je},{name:"Foto de portada",completed:!!f.coverImage,icon:je},{name:"Ubicaci√≥n del negocio",completed:P.businessLocationVerified,icon:oe}]:s==="repartidor"?[...n,{name:"Tipo de veh√≠culo",completed:!!f.vehicleType&&f.vehicleType!=="No especificado",icon:qe},{name:"N√∫mero de licencia",completed:!!f.licenseNumber&&f.licenseNumber!=="No especificado",icon:je}]:n},r=()=>s==="vendedor"&&P.canPublish?{message:"¬°Puedes publicar productos!",type:"success"}:s==="comprador"&&P.canPurchase?{message:"¬°Puedes realizar compras!",type:"success"}:s==="repartidor"&&P.canWork?{message:"¬°Puedes tomar √≥rdenes!",type:"success"}:{message:"Completa todos los requisitos",type:"warning"},d=Y(),l=d.filter(n=>n.completed).length,g=r();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[g.type==="success"?e.jsx(te,{className:"w-5 h-5 text-green-500"}):e.jsx(Se,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{children:"Estado de Verificaci√≥n"})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${g.type==="success"?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:[e.jsx("p",{className:`font-medium ${g.type==="success"?"text-green-800":"text-orange-800"}`,children:g.message}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[l," de ",d.length," requisitos completados"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:d.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border",children:[e.jsx(n.icon,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:n.name}),n.completed?e.jsx(te,{className:"w-4 h-4 text-green-500 ml-auto"}):e.jsx(we,{className:"w-4 h-4 text-red-500 ml-auto"})]},n.name))})]})})]}),e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{children:"Ubicaci√≥n Personal"}),P.locationVerified&&e.jsx(se,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n"}),e.jsx(H,{value:x.address,onChange:n=>h(p=>({...p,address:n.target.value})),placeholder:"Tu direcci√≥n",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(E,{onClick:b,disabled:u,className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50",variant:"outline",style:{borderColor:"#2563eb",color:"#2563eb",backgroundColor:"white",fontWeight:"600"},children:u?"Obteniendo...":"Obtener Ubicaci√≥n Actual"})})]}),x.latitude&&x.longitude&&e.jsx("div",{className:"p-3 bg-gray-50 rounded border",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas: ",x.latitude,", ",x.longitude]})}),e.jsx(E,{onClick:A,disabled:k||!x.latitude||!x.longitude,className:"w-full",children:k?"Guardando...":"Verificar Ubicaci√≥n Personal"})]})]}),s==="vendedor"&&e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Ubicaci√≥n del Negocio"}),P.businessLocationVerified&&e.jsx(se,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n del Negocio"}),e.jsx(H,{value:_.address,onChange:n=>D(p=>({...p,address:n.target.value})),placeholder:"Direcci√≥n de tu negocio",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(E,{onClick:()=>{b(),x.latitude&&x.longitude&&D(n=>({...n,latitude:x.latitude,longitude:x.longitude}))},disabled:u,className:"w-full",variant:"outline",children:"Usar Ubicaci√≥n Actual"})})]}),e.jsx(E,{onClick:U,disabled:k||!_.latitude||!_.longitude,className:"w-full",children:k?"Guardando...":"Verificar Ubicaci√≥n del Negocio"})]})]}),e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{children:"Informaci√≥n del Perfil"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tel√©fono"}),e.jsx(H,{value:f.phone,onChange:n=>m(p=>({...p,phone:n.target.value})),placeholder:"+502 1234-5678",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Perfil"}),e.jsx(H,{value:f.profileImage,onChange:n=>m(p=>({...p,profileImage:n.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="vendedor"&&e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Portada"}),e.jsx(H,{value:f.coverImage,onChange:n=>m(p=>({...p,coverImage:n.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="repartidor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tipo de Veh√≠culo"}),e.jsx(H,{value:f.vehicleType,onChange:n=>m(p=>({...p,vehicleType:n.target.value})),placeholder:"Motocicleta, Autom√≥vil, Bicicleta...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"N√∫mero de Licencia"}),e.jsx(H,{value:f.licenseNumber,onChange:n=>m(p=>({...p,licenseNumber:n.target.value})),placeholder:"M-123456",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]})]})]}),e.jsx(E,{onClick:Z,disabled:k,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold",style:{backgroundColor:"#2563eb",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"600"},children:k?"Actualizando...":"Actualizar Perfil"})]})]})]})}function Fs(s){const{user:o}=fe(),[i,x]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1,requirements:{phone:!1,profileImage:!1,coverImage:!1,location:!1,businessLocation:!1,vehicleType:!1,licenseNumber:!1,adminApproval:!1}}),[h,_]=c.useState(!0);c.useEffect(()=>{o&&D()},[o,s]);const D=async()=>{if(o)try{_(!0);const{data:t,error:u}=await N.from("users").select("*").eq("id",o.id).single();if(u)throw u;let C=null;if(s==="vendedor"){const{data:A,error:U}=await N.from("sellers").select("*").eq("user_id",o.id).single();U||(C=A)}const I={phone:!!(t.phone&&t.phone.trim()!==""),profileImage:!!(t.profile_image_url&&t.profile_image_url.trim()!==""),coverImage:s==="vendedor"?!!(C!=null&&C.cover_image_url&&C.cover_image_url.trim()!==""):!0,location:!!(t.location_verified&&t.latitude&&t.longitude&&t.address),businessLocation:s==="vendedor"?!!(C!=null&&C.business_location_verified&&C.business_latitude&&C.business_longitude&&C.business_address):!0,vehicleType:s==="repartidor"?!!(t.vehicle_type&&t.vehicle_type!=="No especificado"):!0,licenseNumber:s==="repartidor"?!!(t.license_number&&t.license_number!=="No especificado"):!0,adminApproval:s==="repartidor"?!!(t.is_verified&&t.is_active):!0};let b=!1;if(s==="vendedor"){const{data:A,error:U}=await N.rpc("check_seller_can_publish",{seller_user_id:o.id});U||(b=A)}else if(s==="comprador"){const{data:A,error:U}=await N.rpc("check_buyer_can_purchase",{buyer_user_id:o.id});U||(b=A)}else if(s==="repartidor"){const{data:A,error:U}=await N.rpc("check_driver_can_work",{driver_user_id:o.id});U||(b=A)}x({locationVerified:t.location_verified||!1,businessLocationVerified:(C==null?void 0:C.business_location_verified)||!1,profileCompleted:t.profile_completed||!1,canPublish:s==="vendedor"?b:!1,canPurchase:s==="comprador"?b:!1,canWork:s==="repartidor"?b:!1,requirements:I})}catch(t){console.error("Error checking verification status:",t)}finally{_(!1)}};return{status:i,loading:h,refreshStatus:()=>{D()},getCompletionPercentage:()=>{const t=Object.values(i.requirements).length,u=Object.values(i.requirements).filter(Boolean).length;return Math.round(u/t*100)},getMissingRequirements:()=>{const t=[];return i.requirements.phone||t.push("Tel√©fono"),i.requirements.profileImage||t.push("Foto de perfil"),i.requirements.location||t.push("Ubicaci√≥n verificada"),s==="vendedor"&&(i.requirements.coverImage||t.push("Foto de portada"),i.requirements.businessLocation||t.push("Ubicaci√≥n del negocio")),s==="repartidor"&&(i.requirements.vehicleType||t.push("Tipo de veh√≠culo"),i.requirements.licenseNumber||t.push("N√∫mero de licencia"),i.requirements.adminApproval||t.push("Aprobaci√≥n del administrador")),t},canPerformMainAction:()=>{switch(s){case"vendedor":return i.canPublish;case"comprador":return i.canPurchase;case"repartidor":return i.canWork;default:return!1}},getMainActionText:()=>{switch(s){case"vendedor":return i.canPublish?"Puedes publicar productos":"No puedes publicar productos a√∫n";case"comprador":return i.canPurchase?"Puedes realizar compras":"No puedes comprar a√∫n";case"repartidor":return i.canWork?"Puedes tomar √≥rdenes":"No puedes trabajar a√∫n";default:return""}}}}function er({userRole:s,onOpenVerification:o,showIfComplete:i=!1}){const{loading:x,canPerformMainAction:h,getMissingRequirements:_,getCompletionPercentage:D}=Fs(s);if(x)return null;const f=h(),m=_(),P=D();if(s==="vendedor"||f&&!i)return null;const T=()=>{switch(s){case"vendedor":return is;case"comprador":return oe;case"repartidor":return Ae;default:return Se}},k=()=>{if(f)switch(s){case"vendedor":return"¬°Perfil completo! Puedes publicar productos";case"comprador":return"¬°Perfil completo! Puedes realizar compras";case"repartidor":return"¬°Perfil completo! Puedes tomar √≥rdenes";default:return"¬°Perfil completo!"}switch(s){case"vendedor":return"Completa tu perfil para publicar productos";case"comprador":return"Completa tu perfil para realizar compras";case"repartidor":return"Completa tu perfil para trabajar como repartidor";default:return"Completa tu perfil"}},t=()=>f?"Tu perfil est√° completamente verificado y puedes usar todas las funciones de TRATO.":m.length===0?"Casi listo, solo faltan algunos detalles por verificar.":m.length===1?`Te falta 1 requisito: ${m[0]}.`:`Te faltan ${m.length} requisitos: ${m.slice(0,2).join(", ")}${m.length>2?" y m√°s...":""}.`,u=T();return e.jsx(de,{className:`verification-alert mb-6 ${f?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 w-full",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(u,{className:`w-6 h-6 flex-shrink-0 mt-1 ${f?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-lg leading-tight ${f?"text-green-800":"text-orange-800"}`,children:k()}),e.jsx(me,{className:`alert-description mt-1 text-sm ${f?"text-green-700":"text-orange-700"}`,children:t()}),!f&&e.jsxs("div",{className:"verification-progress mt-3 space-y-2",children:[e.jsxs("div",{className:"verification-progress-label flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-orange-800",children:"Progreso del perfil"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[P,"%"]})]}),e.jsx("div",{className:"verification-progress-bar w-full bg-orange-200 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${P}%`}})})]})]})]}),e.jsx("div",{className:"flex justify-center md:justify-end mt-4 md:mt-0 md:ml-4",children:e.jsx(E,{onClick:o,className:`verification-button px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 ${f?"bg-green-500 hover:bg-green-600 hover:shadow-green-200":"bg-orange-500 hover:bg-orange-600 hover:shadow-orange-200"}`,style:{minWidth:"160px",borderRadius:"8px",fontSize:"14px",fontWeight:"600"},children:f?"Ver Estado":"Completar Perfil"})})]})})}function sr({onDismiss:s}){const{user:o}=fe(),{permission:i,requestPermission:x,supported:h}=fs(),[_,D]=c.useState(!1),[f,m]=c.useState(!1);c.useEffect(()=>{const u=h&&i!=="granted"&&i!=="denied"&&((o==null?void 0:o.role)==="vendedor"||(o==null?void 0:o.role)==="repartidor");m(u)},[h,i,o==null?void 0:o.role]);const P=async()=>{D(!0);try{await x()&&(m(!1),s==null||s())}catch(u){console.error("Error al solicitar permisos:",u)}finally{D(!1)}},T=()=>{m(!1),s==null||s()};if(!f)return null;const t=(()=>{switch(o==null?void 0:o.role){case"vendedor":return{title:"Notificaciones de Nuevas √ìrdenes",description:"Recibe alertas inmediatas cuando lleguen nuevos pedidos, incluso con la pantalla apagada.",benefits:["üì± Notificaciones incluso con pantalla apagada","üîî Alertas sonoras para nuevos pedidos","‚ö° Respuesta m√°s r√°pida a clientes"]};case"repartidor":return{title:"Notificaciones de Entregas",description:"Mantente informado sobre nuevas entregas disponibles y asignaciones.",benefits:["üöõ Alertas de nuevas entregas","üìç Notificaciones de asignaciones","üí∞ No pierdas oportunidades de entrega"]};default:return{title:"Notificaciones Push",description:"Recibe notificaciones importantes de la aplicaci√≥n.",benefits:["üîî Alertas importantes","üì± Notificaciones push","‚ö° Informaci√≥n en tiempo real"]}}})();return e.jsxs(B,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-lg",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(ja,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx(ee,{className:"text-lg text-orange-900",children:t.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:t.description})]})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:T,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:e.jsx(Ne,{className:"w-4 h-4"})})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:t.benefits.map((u,C)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-800",children:[e.jsx(te,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),u]},C))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:i==="granted"?"default":i==="denied"?"destructive":"secondary",className:"flex items-center gap-1",children:i==="granted"?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-3 h-3"}),"Activadas"]}):i==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-3 h-3"}),"Denegadas"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-3 h-3"}),"Pendientes"]})}),!h&&e.jsx(se,{variant:"outline",className:"text-gray-600",children:"No soportadas en este navegador"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(E,{onClick:P,disabled:_||!h||i==="granted",className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",children:_?e.jsxs(e.Fragment,{children:[e.jsx(hs,{className:"w-4 h-4 mr-2 animate-spin"}),"Solicitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Activar Notificaciones"]})}),e.jsx(E,{variant:"outline",onClick:T,className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:"Ahora no"})]}),i==="denied"&&e.jsxs(de,{className:"border-red-200 bg-red-50",children:[e.jsx(Se,{className:"w-4 h-4 text-red-600"}),e.jsx(me,{className:"text-red-800 text-sm",children:"Las notificaciones fueron denegadas. Para activarlas, ve a configuraci√≥n del navegador ‚Üí Notificaciones ‚Üí Permitir para este sitio."})]})]})]})}function ar({onPermissionChange:s,userRole:o="buyer",className:i=""}){const[x,h]=c.useState("default"),[_,D]=c.useState(!1);c.useEffect(()=>{"Notification"in window&&h(Notification.permission)},[]);const f=async()=>{if(!("Notification"in window)){alert("Tu navegador no soporta notificaciones");return}if(x!=="granted"){D(!0);try{const m=await Notification.requestPermission();h(m),m==="granted"?(s==null||s(!0),new Notification("¬°TRATO Notificaciones Activas!",{body:"Las notificaciones est√°n funcionando correctamente",icon:"/favicon.ico"})):s==null||s(!1)}catch(m){console.error("Error requesting notification permission:",m)}finally{D(!1)}}};return x==="granted"?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-green-700 ${i}`,children:[e.jsx(te,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Notificaciones activas"})]}):e.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Configurar Notificaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:x==="denied"?"Notificaciones bloqueadas":"Activa las notificaciones para recibir alertas"})]})]}),x!=="denied"&&e.jsx("button",{onClick:f,disabled:_,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:_?"Activando...":"Activar"})]}),x==="denied"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("p",{className:"text-sm text-red-700",children:'Las notificaciones est√°n bloqueadas. Para activarlas, haz clic en el √≠cono del candado en la barra de direcciones y selecciona "Permitir".'})})]})}function rr(){const{permission:s,supported:o,pushSubscription:i,serviceWorkerReady:x,subscribeToPush:h,sendTestNotification:_}=fs(),[D,f]=c.useState(!1),[m,P]=c.useState("idle"),[T,k]=c.useState(""),[t,u]=c.useState(!1),C=async()=>{f(!0),P("idle"),k("");try{await h(),P("success"),k("¬°Notificaciones activadas correctamente! Ahora recibir√°s todas las notificaciones importantes incluso si la app est√° cerrada."),setTimeout(()=>{u(!0)},3e3),setTimeout(()=>{_()},1500)}catch(A){P("error"),k(A instanceof Error?A.message:"Error activando notificaciones Push"),console.error("Error activando Push:",A)}finally{f(!1)}},b=o?x?s==="denied"?{bg:"bg-red-100",text:"text-red-800",icon:"üö´"}:i?{bg:"bg-green-100",text:"text-green-800",icon:"‚úÖ"}:{bg:"bg-blue-100",text:"text-blue-800",icon:"üîî"}:{bg:"bg-yellow-100",text:"text-yellow-800",icon:"‚è≥"}:{bg:"bg-gray-100",text:"text-gray-600",icon:"‚ö†Ô∏è"};return i&&!T||t||i?null:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"text-2xl",children:"üîî"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notificaciones Push"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Recibe notificaciones incluso con la app cerrada"})]})]}),e.jsx("div",{className:`${b.bg} ${b.text} rounded-lg p-4 mb-6`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:b.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[!o&&"No soportado en este navegador",o&&!x&&"Cargando sistema...",o&&x&&s==="denied"&&"Permisos denegados",o&&x&&s==="default"&&"Permisos pendientes",i&&"Notificaciones Push activas"]}),e.jsxs("div",{className:"text-sm opacity-90",children:[!o&&"Usa Chrome, Firefox o Edge para recibir notificaciones Push",o&&!x&&"Inicializando Service Worker...",o&&x&&s==="denied"&&"Permite las notificaciones en la configuraci√≥n del navegador",o&&x&&s==="default"&&'Haz clic en "Activar" para recibir notificaciones',i&&"Recibir√°s notificaciones incluso con la pantalla apagada o la app cerrada"]})]})]})}),T&&e.jsx("div",{className:`rounded-lg p-4 mb-4 ${m==="success"?"bg-green-50 text-green-800":m==="error"?"bg-red-50 text-red-800":"bg-blue-50 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:m==="success"?"‚úÖ":m==="error"?"‚ùå":"‚ÑπÔ∏è"}),e.jsx("span",{className:"text-sm",children:T})]})}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:o&&x&&e.jsxs("button",{onClick:C,disabled:D||s==="denied",className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[D?"‚è≥":"üöÄ",D?"Activando...":"Activar Notificaciones Push"]})}),e.jsxs("div",{className:"mt-6 text-sm text-gray-600",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Beneficios de las Notificaciones Push:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Recibe notificaciones importantes incluso con la app cerrada"}),e.jsx("li",{children:"No te pierdas informaci√≥n cr√≠tica del negocio"}),e.jsx("li",{children:"Funciona en segundo plano y con otras aplicaciones abiertas"}),e.jsx("li",{children:"Sistema de alertas optimizado para vendedores"})]})]})]})}function Mr(){const{user:s,signOut:o}=fe(),{canPerformMainAction:i,refreshStatus:x}=Fs("vendedor"),{notifications:h,unreadCount:_,showNotifications:D,setShowNotifications:f}=Vs(),[m,P]=c.useState("dashboard"),[T,k]=c.useState("list"),[t,u]=c.useState([]),[C,I]=c.useState([]),[b,A]=c.useState(!0),[U,Z]=c.useState(""),[G,Y]=c.useState(0),[r,d]=c.useState(""),[l,g]=c.useState([]),[n,p]=c.useState(null),[S,O]=c.useState(null),[z,K]=c.useState(!1),[Q,le]=c.useState({totalProducts:0,dailyProducts:0,totalViews:0,totalSales:0,revenue:0,revenueChange:0,avgRating:0});c.useEffect(()=>{s&&(xe(),pe(),Ge(),Ce(),Oe(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(a=>{console.log(`üîî Permisos de notificaci√≥n: ${a}`),a==="granted"?console.log("‚úÖ Notificaciones habilitadas para nuevos pedidos"):console.warn("‚ö†Ô∏è Notificaciones bloqueadas - solo sonido y alertas visuales")}))},[s]),c.useEffect(()=>{const a=setInterval(()=>{(m==="dashboard"||m==="products")&&pe()},6e4);return()=>clearInterval(a)},[m]);const xe=async()=>{try{const{data:a,error:v}=await N.from("products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(v)throw v;u(a||[])}catch(a){console.error("Error loading products:",a),Z("Error al cargar productos")}},pe=async()=>{try{const{data:a,error:v}=await N.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(v)throw v;I(a||[])}catch(a){console.error("Error loading daily products:",a),Z("Error al cargar productos del d√≠a")}finally{A(!1)}},Ve=async a=>{try{const v=new Date,y=new Date(v.getFullYear(),v.getMonth(),1),M=new Date(v.getFullYear(),v.getMonth()-1,1),L=new Date(v.getFullYear(),v.getMonth(),0,23,59,59),{data:$,error:R}=await N.from("orders").select("total, status").eq("seller_id",a).eq("status","delivered").gte("created_at",y.toISOString()),F=($==null?void 0:$.reduce((Ze,Ye)=>Ze+(Ye.total||0),0))||0,{data:J,error:Te}=await N.from("orders").select("total, status").eq("seller_id",a).eq("status","delivered").gte("created_at",M.toISOString()).lte("created_at",L.toISOString()),ne=(J==null?void 0:J.reduce((Ze,Ye)=>Ze+(Ye.total||0),0))||0;let he=0;return ne>0?he=(F-ne)/ne*100:F>0&&(he=100),console.log(`üìä Ingresos mes actual: Q${F}, mes pasado: Q${ne}, cambio: ${he.toFixed(1)}%`),{currentRevenue:F,percentageChange:he}}catch(v){return console.error("Error calculating monthly revenue:",v),{currentRevenue:0,percentageChange:0}}},Ge=async()=>{try{const a=t.length,v=C.length;let y=0,M=0,L=0,$=0;try{const{data:R,error:F}=await N.from("orders").select("id").limit(1);if(F)console.log("Orders table not available yet, using default stats");else{const{data:J,error:Te}=await N.from("orders").select("id, total, status, created_at").eq("seller_id",s==null?void 0:s.id);if(!Te&&J){if(y=J.length,s!=null&&s.id){const{currentRevenue:ne,percentageChange:he}=await Ve(s.id);M=ne,L=he}console.log(`üìà Estad√≠sticas actualizadas: ${y} √≥rdenes, ingresos del mes: Q${M}, cambio: ${L.toFixed(1)}%`)}try{const{data:ne,error:he}=await N.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s==null?void 0:s.id).single();!he&&ne?($=ne.average_rating||0,console.log(`üåü Seller rating: ${$} from ${ne.total_reviews} reviews`)):console.log("No ratings found for seller, showing 0.0")}catch{console.log("Rating system not available, using 0.0")}}}catch{console.log("Orders system not configured yet, using default stats")}le({totalProducts:a,dailyProducts:v,totalViews:Math.floor(Math.random()*1e3)+500,totalSales:y,revenue:M,revenueChange:L,avgRating:$})}catch(a){console.error("Error loading stats:",a),le({totalProducts:t.length,dailyProducts:C.length,totalViews:0,totalSales:0,revenue:0,revenueChange:0,avgRating:0})}},Be=()=>{xe(),Ce(),k("list")},He=()=>{pe(),Ce(),k("list")},$e=a=>{p(a),k("edit-product")},j=a=>{O(a),k("edit-daily")},X=()=>{xe(),p(null),k("list")},ke=()=>{pe(),O(null),k("list")},We=async a=>{try{const{error:v}=await N.from("products").delete().eq("id",a);if(v)throw v;xe()}catch(v){console.error("Error deleting product:",v),Z("Error al eliminar producto")}},Qe=async a=>{try{const{error:v}=await N.from("daily_products").delete().eq("id",a);if(v)throw v;pe()}catch(v){console.error("Error deleting daily product:",v),Z("Error al eliminar producto del d√≠a")}},Oe=c.useCallback(async()=>{if(s!=null&&s.id)try{const a=N.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},v=>{console.log("üîî Nueva orden recibida:",v),Y($=>$+1);const y=v.new,M=new CustomEvent("criticalNotification",{detail:{type:"new_order",message:`üéØ NUEVA ORDEN: Q${y.total||"0.00"} - ${y.notes||"Sin notas"}`,urgency:"high",sound:!0,persist:!0,metadata:{order_id:y.id,total:y.total,buyer_name:y.buyer_name,created_at:y.created_at}}});window.dispatchEvent(M),Notification.permission==="granted"&&new Notification("¬°Nueva orden en TRATO!",{body:`Tienes un nuevo pedido por Q${y.total||"0.00"}`,icon:"/favicon.ico",tag:"new-order",requireInteraction:!0}),(async()=>{try{await N.from("critical_alerts").insert({alert_type:"new_order",order_id:y.id,user_id:s==null?void 0:s.id,message:`Nueva orden recibida: Q${y.total||"0.00"}`,urgency_level:"high",metadata:{total:y.total,buyer_name:y.buyer_name,notification_sent:!0}})}catch($){console.error("Error logging critical alert:",$)}})(),d(new Date().toISOString())}).subscribe();if(Notification.permission==="default"){const v=await Notification.requestPermission();console.log("Notification permission:",v)}return()=>{a.unsubscribe()}}catch(a){console.error("Error setting up order notifications:",a)}},[s==null?void 0:s.id]),Me=c.useCallback(async()=>{if(s!=null&&s.id)try{const{data:a,error:v}=await N.from("orders").select("id").limit(1);if(!v){const y=new Date().toISOString(),M=`seller_last_notification_${s.id}`,L=localStorage.getItem(M);if(L){const{data:$,error:R}=await N.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).gt("created_at",L).order("created_at",{ascending:!1});!R&&$&&$.length>0&&(Y(F=>F+$.length),localStorage.setItem(M,y),console.log(`üì¶ Found ${$.length} new orders since ${L}`))}else{const{data:$,error:R}=await N.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).eq("status","pending").order("created_at",{ascending:!1});!R&&$&&$.length>0&&(Y($.length),console.log(`üì¶ Found ${$.length} pending orders (first check)`)),localStorage.setItem(M,y)}}}catch(a){console.log("üì¶ Orders table not available for notifications:",a)}},[s==null?void 0:s.id]);c.useEffect(()=>{if(!(s!=null&&s.id))return;Me();const a=setInterval(()=>{Me()},3e4);return()=>clearInterval(a)},[s==null?void 0:s.id]);const Ce=async()=>{try{const a=[];if(t.length>0){const y=t[0];a.push({id:`product-${y.id}`,type:"product",message:`Producto agregado: "${y.name}"`,timestamp:y.created_at,color:"green"})}if(C.length>0){const y=C[0];a.push({id:`daily-${y.id}`,type:"daily_product",message:`Venta del d√≠a creada: "${y.name}"`,timestamp:y.created_at,color:"orange"})}try{const{data:y,error:M}=await N.from("orders").select("id").limit(1);if(!M){const{data:L,error:$}=await N.from("orders").select("id, status, created_at, total").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1}).limit(3);!$&&L&&L.length>0&&L.forEach(R=>{let F="",J="blue";switch(R.status){case"pending":F=`Nueva orden recibida (Q${R.total})`,J="yellow";break;case"confirmed":F=`Orden confirmada (Q${R.total})`,J="blue";break;case"preparing":F=`Orden en preparaci√≥n (Q${R.total})`,J="orange";break;case"ready":F=`Orden lista (Q${R.total})`,J="purple";break;case"delivered":F=`Orden entregada (Q${R.total})`,J="green";break;case"cancelled":F=`Orden cancelada (Q${R.total})`,J="red";break;default:F=`Orden ${R.status} (Q${R.total})`,J="blue"}a.push({id:`order-${R.id}`,type:"order",message:F,timestamp:R.created_at,color:J})})}}catch{console.log("Orders table not available for activity")}const v=a.sort((y,M)=>new Date(M.timestamp).getTime()-new Date(y.timestamp).getTime()).slice(0,5);g(v)}catch(a){console.error("Error loading recent activity:",a)}},Ee=a=>{const v=new Date().getTime(),y=new Date(a).getTime(),M=v-y,L=Math.floor(M/(1e3*60)),$=Math.floor(M/(1e3*60*60)),R=Math.floor(M/(1e3*60*60*24));return L<60?L<=1?"Hace un momento":`Hace ${L} minutos`:$<24?$===1?"Hace 1 hora":`Hace ${$} horas`:R===1?"Ayer":`Hace ${R} d√≠as`},Je=()=>{const a=new Date,v=new Date;v.setHours(23,59,59,999);const y=v.getTime()-a.getTime(),M=Math.floor(y/(1e3*60*60)),L=Math.floor(y%(1e3*60*60)/(1e3*60));return`${M}h ${L}m`},Le=[{id:"dashboard",label:"Inicio",icon:la,description:"Resumen y estad√≠sticas"},{id:"products",label:"Productos",icon:ha,description:"Gestiona tu men√∫"},{id:"orders",label:"Pedidos",icon:wa,description:"√ìrdenes y analytics",hasNotification:G>0,notificationCount:G},{id:"profile",label:"Perfil",icon:is,description:"Configuraci√≥n del negocio"}],Pe=()=>e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(B,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dashboard-welcome",style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",color:"white",padding:"24px",borderRadius:"16px",marginBottom:"16px"},children:e.jsx(re,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-2 md:p-3 rounded-xl",children:e.jsx(ve,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ee,{className:"text-lg md:text-2xl text-white leading-tight",style:{color:"white",fontSize:"20px"},children:"¬°Bienvenido, Interlano Fernando Interiano! üëã"}),e.jsx("p",{className:"text-sm md:text-base text-white mt-1",style:{color:"white",fontSize:"16px"},children:"Gestiona tu negocio y conecta con m√°s clientes en Gual√°n"})]})]})})}),e.jsxs("div",{className:"dashboard-stats",style:{display:"grid",gridTemplateColumns:window.innerWidth<=768?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:"12px",marginBottom:"16px"},children:[e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Productos"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Q.totalProducts})]}),e.jsx(ge,{className:"w-6 h-6 md:w-8 md:h-8 text-blue-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas del D√≠a"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Q.dailyProducts})]}),e.jsx(ae,{className:"w-6 h-6 md:w-8 md:h-8 text-orange-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Q.totalSales})]}),e.jsx(Bs,{className:"w-6 h-6 md:w-8 md:h-8 text-green-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Calificaci√≥n"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Q.avgRating.toFixed(1)})]}),e.jsx(fa,{className:"w-6 h-6 md:w-8 md:h-8 text-yellow-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(B,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"w-5 h-5 text-green-500"}),"Ingresos del Mes"]})}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["Q",Q.revenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:Q.revenueChange>0?`+${Q.revenueChange.toFixed(1)}% comparado al mes pasado`:Q.revenueChange<0?`${Q.revenueChange.toFixed(1)}% comparado al mes pasado`:"Sin cambios comparado al mes pasado"})]})]}),e.jsxs(B,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"w-5 h-5 text-blue-500"}),"Vistas del Perfil"]})}),e.jsxs(W,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:Q.totalViews.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vistas esta semana"})]})]})]}),e.jsxs(B,{children:[e.jsx(re,{children:e.jsx(ee,{children:"Acciones R√°pidas"})}),e.jsx(W,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(E,{onClick:()=>{if(!i()){K(!0);return}P("products"),k("add-product")},className:"h-20 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ke,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Nuevo Producto"})]})}),e.jsx(E,{onClick:()=>{if(!i()){K(!0);return}P("products"),k("add-daily")},variant:"outline",className:"h-20 border-orange-500 text-orange-600 hover:bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Venta del D√≠a"})]})}),e.jsx(E,{onClick:()=>P("profile"),variant:"outline",className:"h-20 border-blue-500 text-blue-600 hover:bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ve,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Editar Perfil"})]})})]})})]}),e.jsxs(B,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Actividad Reciente"]})}),e.jsx(W,{children:e.jsx("div",{className:"space-y-3",children:l.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay actividad reciente"})]}):l.map(a=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-${a.color}-50 rounded-lg`,children:[e.jsx("div",{className:`w-2 h-2 bg-${a.color}-500 rounded-full`}),e.jsx("p",{className:"text-sm flex-1",children:a.message}),e.jsx("span",{className:"text-xs text-gray-500",children:Ee(a.timestamp)})]},a.id))})})]})]}),w=()=>T==="add-product"?e.jsx(cs,{onSuccess:Be,onCancel:()=>k("list")}):T==="add-daily"?e.jsx(ds,{onSuccess:He,onCancel:()=>k("list")}):T==="edit-product"&&n?e.jsx(cs,{product:n,onSuccess:X,onCancel:()=>{p(null),k("list")}}):T==="edit-daily"&&S?e.jsx(ds,{dailyProduct:S,onSuccess:ke,onCancel:()=>{O(null),k("list")}}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 leading-tight",children:"Gesti√≥n de Productos"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Administra tu men√∫ y ofertas especiales"})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[e.jsxs(E,{onClick:()=>k("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),e.jsxs(E,{onClick:()=>k("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Venta del D√≠a"]})]})]}),e.jsxs(ss,{defaultValue:"products",className:"space-y-6",children:[e.jsxs(as,{className:"grid w-full grid-cols-2 h-auto p-1 bg-gray-100 rounded-lg",children:[e.jsxs(be,{value:"products",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ge,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos Normales"}),e.jsx("span",{className:"sm:hidden",children:"Normales"}),e.jsxs("span",{className:"ml-1",children:["(",t.length,")"]})]}),e.jsxs(be,{value:"daily",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos del D√≠a"}),e.jsx("span",{className:"sm:hidden",children:"Del D√≠a"}),e.jsxs("span",{className:"ml-1",children:["(",C.length,")"]})]})]}),e.jsx(ce,{value:"products",className:"space-y-4",children:b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{className:"w-8 h-8 animate-spin text-gray-400"})}):t.length===0?e.jsx(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(W,{className:"p-8 md:p-12 text-center",children:[e.jsx(ge,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos a√∫n"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Comienza agregando tu primer producto para empezar a vender"}),e.jsxs(E,{onClick:()=>k("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Agregar Primer Producto"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:t.map(a=>e.jsx(qa,{product:a,onEdit:$e,onDelete:We},a.id))})}),e.jsxs(ce,{value:"daily",className:"space-y-4",children:[C.length>0&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-orange-800 text-sm sm:text-base",children:"Tiempo restante:"})]}),e.jsx("span",{className:"font-bold text-orange-800 text-sm sm:text-base",children:Je()})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Los productos del d√≠a se eliminan autom√°ticamente a las 23:59:59"})]}),b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{className:"w-8 h-8 animate-spin text-gray-400"})}):C.length===0?e.jsx(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(W,{className:"p-8 md:p-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos del d√≠a"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Crea ofertas especiales que duran solo hasta medianoche"}),e.jsxs(E,{onClick:()=>k("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Crear Venta del D√≠a"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:C.map(a=>e.jsx(za,{dailyProduct:a,onEdit:j,onDelete:Qe},a.id))})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx(ar,{onPermissionChange:a=>{console.log("üîî Permisos de notificaci√≥n cambiados:",a)}})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(ve,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"TRATO Vendedor"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Panel de control empresarial"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{variant:"outline",onClick:()=>f(!D),className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px] relative",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Notificaciones"}),_>0&&e.jsx(se,{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs px-1 min-w-[16px] h-4 flex items-center justify-center",children:_>9?"9+":_})]}),e.jsxs(E,{variant:"outline",onClick:o,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(pa,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar Sesi√≥n"}),e.jsx("span",{className:"sm:hidden",children:"Salir"})]})]})]})})}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[U&&e.jsxs(de,{variant:"destructive",className:"mb-4 md:mb-6",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(me,{className:"text-sm md:text-base",children:U})]}),e.jsx(er,{userRole:"vendedor",onOpenVerification:()=>K(!0)}),e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(sr,{})}),(s==null?void 0:s.role)==="vendedor"&&e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(rr,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-4 gap-1",children:Le.map(a=>{const v=a.icon,y=m===a.id;return e.jsxs("button",{onClick:()=>{P(a.id),a.id==="orders"&&Y(0)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:y?"#fef3c7":"transparent",color:y?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"w-5 h-5"}),a.hasNotification&&a.notificationCount&&a.notificationCount>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#ef4444",color:"white",fontSize:"10px",borderRadius:"50%",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 2s infinite"},children:a.notificationCount>9?"9+":a.notificationCount})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:a.label})]},a.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(ss,{value:m,onValueChange:a=>P(a),className:"space-y-6",children:[e.jsx(as,{className:"grid w-full grid-cols-4 lg:w-2/3 mx-auto bg-white border border-gray-200",children:Le.map(a=>{const v=a.icon;return e.jsxs(be,{value:a.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",onClick:()=>{a.id==="orders"&&Y(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"w-5 h-5"}),a.hasNotification&&a.notificationCount&&a.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:a.notificationCount>9?"9+":a.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:a.label})]},a.id)})}),e.jsx(ce,{value:"dashboard",className:"space-y-6",children:Pe()}),e.jsx(ce,{value:"products",className:"space-y-6",children:w()}),e.jsx(ce,{value:"orders",className:"space-y-6",children:e.jsx(gs,{})}),e.jsx(ce,{value:"profile",className:"space-y-6",children:e.jsx(us,{})})]})}),e.jsxs("div",{className:"block md:hidden mt-4",children:[m==="dashboard"&&Pe(),m==="products"&&w(),m==="orders"&&e.jsx(gs,{}),m==="profile"&&e.jsx(us,{})]})]}),e.jsx(Oa,{open:z,onOpenChange:K,children:e.jsxs(Rs,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(qs,{children:e.jsxs(zs,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Verificaci√≥n de Perfil y Ubicaci√≥n"})]})}),e.jsx(Xa,{userRole:"vendedor",onVerificationComplete:()=>{K(!1),x()}})]})}),e.jsx(Gs,{onNewOrder:()=>{m==="orders"&&window.location.reload()}}),e.jsx(ca,{})]})}export{Mr as SellerDashboard};
