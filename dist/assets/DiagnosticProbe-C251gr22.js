import{u as h,j as s,r as c,s as l}from"./index-9d4LIYkQ.js";function p(){const{authLogs:o}=h();return s.jsxs("div",{className:"mt-4 bg-white border rounded p-3",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Auth Logs"}),s.jsx("div",{className:"font-mono text-sm max-h-48 overflow-auto",children:o&&o.length>0?o.map((d,i)=>s.jsx("div",{className:"mb-1",children:d},i)):s.jsx("div",{className:"text-gray-500",children:"No auth logs yet."})})]})}function b(){const[o,d]=c.useState([]),[i,m]=c.useState(!1),[u,g]=c.useState(null),t=a=>d(n=>[...n,`${new Date().toISOString()} - ${a}`]);return c.useEffect(()=>{(async()=>{var a,n;t("Starting diagnostic probe");try{const e=await l.auth.getSession();t(`getSession: ${(a=e==null?void 0:e.data)!=null&&a.session?"session present":"no session"}`)}catch(e){t(`getSession error: ${(e==null?void 0:e.message)||String(e)}`)}try{const e=await l.auth.getUser();t(`getUser: ${(n=e==null?void 0:e.data)!=null&&n.user?"user present":"no user"}`)}catch(e){t(`getUser error: ${(e==null?void 0:e.message)||String(e)}`)}try{const{data:e,error:r,status:x}=await l.from("users").select("id,email").limit(1);t(r?`select users error: code=${r==null?void 0:r.code} msg=${r.message}`:`select users OK: rows=${Array.isArray(e)?e.length:0}`)}catch(e){t(`select users exception: ${(e==null?void 0:e.message)||String(e)}`)}try{const{data:e,error:r}=await l.from("products").select("id,name,is_public").limit(2);t(r?`select products error: code=${r==null?void 0:r.code} msg=${r.message}`:`select products OK: rows=${(e==null?void 0:e.length)??0}`)}catch(e){t(`select products exception: ${(e==null?void 0:e.message)||String(e)}`)}t("Diagnostic probe completed")})()},[]),s.jsxs("div",{className:"min-h-screen bg-white p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Diagnostic Probe"}),s.jsx("div",{className:"bg-gray-50 border rounded p-3 font-mono text-sm",children:o.map((a,n)=>s.jsx("div",{className:"mb-1",children:a},n))}),s.jsxs("div",{className:"mt-4 flex gap-2",children:[s.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:async()=>{m(!0),g(null);try{const n=await(await fetch("/api/diagnostics",{method:"POST",headers:{"Content-Type":"application/json","x-diag-secret":prompt("Enter diagnostic secret from Vercel (VERCEL_DIAG_SECRET):")||""},body:JSON.stringify({payload:o,origin:window.location.href})})).json();g(JSON.stringify(n))}catch(a){g((a==null?void 0:a.message)||String(a))}finally{m(!1)}},disabled:i,children:i?"Enviando...":"Enviar diagn√≥stico"}),u&&s.jsx("div",{className:"text-sm text-gray-600",children:u})]}),s.jsx("div",{className:"mt-4 text-sm text-gray-600",children:"Open browser console for network details (auth/postgrest requests)."}),s.jsx(p,{})]})}export{b as default};
