import{g as pe,u as he,r as c,j as e,B as E,C as B,a as ie,b as se,c as Q,X as Ee,L as le,f as Z,d as Se,s as y,i as ls,I as Le,E as Es,q as cs,e as ne,v as ds,t as D,R as we,N as Ps,p as Je,V as Ts,O as Is,w as As,x as $s,y as Ds,z as Os}from"./index-BwL7zrtX.js";import{A as me,a as ue}from"./alert-D1yJyCmG.js";import{P as xe,D as Ze,T as He,a as Qe,b as je,d as de,M as Ls,c as Ms}from"./MobileToastNotifications-D-FKf0cs.js";import{I as J}from"./input-4CXglXxU.js";import{T as Xe}from"./textarea-8Qa_etwC.js";import{L as V}from"./label-DHTfj502.js";import{S as Rs,a as qs,b as zs,c as Fs,d as Us}from"./select-DnCThQBp.js";import{A as ms}from"./arrow-left-CHLqxnOp.js";import{U as us}from"./upload-B5AkNOvA.js";import{S as Re}from"./save-t_blVmrs.js";import{C as re}from"./clock-uxO9kJIy.js";import{T as gs,F as Vs,g as Gs,f as Bs,S as Ws,B as Hs,R as Qs,u as Js,H as Zs,O as Xs,P as Be}from"./OnlineDriversIndicator-0pAHxJHM.js";import{A as xs,a as ps,b as hs,c as fs,d as bs,e as js,f as vs,g as Ns,h as ys}from"./alert-dialog-CitEc3Xv.js";import{E as Ks}from"./eye-off-C67EsM0E.js";import{T as ws}from"./trash-2-TGOjTpN4.js";import{C as Ys,a as ve,P as Me,M as ea,N as Oe}from"./phone-BYfNz9EB.js";import{S as Ne}from"./store-B5lSYPvL.js";import{I as ss}from"./info-DUr5xUXM.js";import{M as ce}from"./map-pin-CMQTkYwm.js";import{T as Pe}from"./truck-CO_gqk1y.js";import{M as sa}from"./mail-DxDin--S.js";import{G as as}from"./globe-DXGWqcJx.js";import{T as Ce}from"./triangle-alert-BSU5RPvi.js";import{C as _e}from"./circle-x-D61qsfBL.js";import{E as aa}from"./external-link-D_g01Fw4.js";import{U as Ke}from"./user-BHxFeikJ.js";import{L as ra}from"./log-out-BkQvwip4.js";import{S as ta}from"./shopping-bag-Cd8Xv_6a.js";import{S as ia}from"./star-C_m7Jmev.js";import"./shopping-cart-y9xnQozU.js";import"./users-CQFYTE7w.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],oa=pe("bell-ring",na);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ca=pe("chart-column",la);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ma=pe("clipboard-list",da);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],ga=pe("facebook",ua);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],_s=pe("hash",xa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ss=pe("image",pa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],fa=pe("instagram",ha);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ja=pe("message-square",ba);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ye=pe("pen",va),Na=["Alimentos","Bebidas","Ropa","Electr√≥nicos","Hogar","Belleza","Deportes","Libros","Juguetes","Mascotas","Salud","Herramientas","Jard√≠n","M√∫sica","Arte","Otros"];function rs({product:s,onSuccess:u,onCancel:r}){const{user:j}=he(),[g,w]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.category)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||"",is_public:(s==null?void 0:s.is_public)!==!1}),[k,i]=c.useState(null),[f,R]=c.useState((s==null?void 0:s.image_url)||""),[T,U]=c.useState(!1),[l,N]=c.useState(!1),[P,x]=c.useState(""),t=c.useRef(null),S=a=>{var m;const d=(m=a.target.files)==null?void 0:m[0];if(d){if(!d.type.startsWith("image/")){x("Por favor selecciona una imagen v√°lida");return}if(d.size>5*1024*1024){x("La imagen debe ser menor a 5MB");return}i(d),x("");const h=new FileReader;h.onload=n=>{var b;R((b=n.target)==null?void 0:b.result)},h.readAsDataURL(d)}},O=async a=>{var d;N(!0);try{const{data:{session:m}}=await y.auth.getSession();if(!((d=m==null?void 0:m.user)!=null&&d.id))throw new Error("No autorizado - sesi√≥n inv√°lida");const h=a.name.split(".").pop(),b=`products/${`${m.user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${h}`}`;for(let C=0;C<3;C++)try{const{error:$}=await y.storage.from("products").upload(b,a,{cacheControl:"3600",upsert:!0});if($){if($.message.includes("JWT")||$.message.includes("token")){await y.auth.refreshSession();continue}throw $}const{data:q}=y.storage.from("products").getPublicUrl(b);if(!q.publicUrl)throw new Error("No se pudo obtener la URL p√∫blica");return q.publicUrl}catch($){if(C===2)throw $;await new Promise(q=>setTimeout(q,1e3));continue}throw new Error("No se pudo subir la imagen despu√©s de 3 intentos")}catch(m){throw console.error("Error uploading image:",m),new Error("Error al subir la imagen: "+m.message)}finally{N(!1)}},F=async a=>{try{const d=a.split("/"),m=d[d.length-3],h=d[d.length-2],n=d[d.length-1],b=`${h}/${n}`;m==="products"&&await y.storage.from("products").remove([b])}catch(d){console.error("Error deleting old image:",d)}},I=async a=>{if(a.preventDefault(),x(""),!g.name.trim()){x("El nombre del producto es requerido");return}if(!g.price||parseFloat(g.price.toString())<=0){x("El precio debe ser mayor a 0");return}if(!g.category){x("Selecciona una categor√≠a");return}if(!g.stock_quantity||parseInt(g.stock_quantity.toString())<0){x("La cantidad debe ser mayor a 0");return}if(!s&&!k&&!f){x("Selecciona una imagen para el producto");return}U(!0);try{let d=(s==null?void 0:s.image_url)||"";k&&(d=await O(k),s!=null&&s.image_url&&await F(s.image_url));const m={name:g.name.trim(),description:g.description.trim(),price:parseFloat(g.price.toString())||0,category:g.category,stock_quantity:parseInt(g.stock_quantity.toString())||1,is_public:g.is_public,image_url:d,seller_id:j==null?void 0:j.id};if(s){const{error:h}=await y.from("products").update(m).eq("id",s.id);if(h)throw h}else{const{error:h}=await y.from("products").insert([m]);if(h)throw h}u()}catch(d){console.error("Error saving product:",d),x(d.message||"Error al guardar el producto")}finally{U(!1)}},H=()=>{i(null),R(""),t.current&&(t.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto":"Agregar Producto"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica la informaci√≥n de tu producto":"Crea un nuevo producto para tu tienda"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Informaci√≥n del Producto"]})}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:"Imagen del Producto *"}),f?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(E,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:H,children:e.jsx(Ee,{className:"w-4 h-4"})}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-500 transition-colors",onClick:()=>{var a;return(a=t.current)==null?void 0:a.click()},children:[e.jsx(Ss,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, WEBP hasta 5MB"})]}),e.jsx("input",{ref:t,type:"file",accept:"image/*",onChange:S,className:"hidden"}),!f&&e.jsxs(E,{type:"button",variant:"outline",onClick:()=>{var a;return(a=t.current)==null?void 0:a.click()},className:"w-full",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(J,{id:"name",value:g.name,onChange:a=>w({...g,name:a.target.value}),placeholder:"Ej: Manzanas Rojas Org√°nicas",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(Xe,{id:"description",value:g.description,onChange:a=>w({...g,description:a.target.value}),placeholder:"Describe las caracter√≠sticas y beneficios de tu producto...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"price",children:"Precio (Q) *"}),e.jsx(J,{id:"price",type:"number",step:"0.01",min:"0",value:g.price,onChange:a=>w({...g,price:a.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(J,{id:"stock",type:"number",min:"0",value:g.stock_quantity,onChange:a=>w({...g,stock_quantity:a.target.value}),placeholder:"1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Categor√≠a *"}),e.jsxs(Rs,{onValueChange:a=>w({...g,category:a}),children:[e.jsx(qs,{children:e.jsx(zs,{placeholder:g.category||"Selecciona una categor√≠a"})}),e.jsx(Fs,{children:Na.map(a=>e.jsx(Us,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{children:"Visibilidad"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(E,{type:"button",variant:g.is_public?"default":"outline",onClick:()=>w({...g,is_public:!0}),className:"flex-1",children:["P√∫blico",g.is_public&&e.jsx(Z,{variant:"secondary",className:"ml-2",children:"Activo"})]}),e.jsxs(E,{type:"button",variant:g.is_public?"outline":"default",onClick:()=>w({...g,is_public:!1}),className:"flex-1",children:["Privado",!g.is_public&&e.jsx(Z,{variant:"secondary",className:"ml-2",children:"Activo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Los productos p√∫blicos aparecen en el cat√°logo general. Los privados solo los ves t√∫."})]}),P&&e.jsxs(me,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{children:P})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:T||l,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:T||l,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:T?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Producto"]})})]})]})})]})})]})}function ts({dailyProduct:s,onSuccess:u,onCancel:r}){const{user:j}=he(),[g,w]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:s!=null&&s.price?String(s.price):"",stock_quantity:s!=null&&s.stock_quantity?String(s.stock_quantity):""}),[k,i]=c.useState(null),[f,R]=c.useState((s==null?void 0:s.image_url)||""),[T,U]=c.useState(!1),[l,N]=c.useState(!1),[P,x]=c.useState(""),t=c.useRef(null),S=()=>{const m=new Date;return new Date(m.getFullYear(),m.getMonth(),m.getDate(),23,59,59,999).toISOString()},O=()=>{const m=new Date,h=new Date;h.setHours(23,59,59,999);const n=h.getTime()-m.getTime(),b=Math.floor(n/(1e3*60*60)),C=Math.floor(n%(1e3*60*60)/(1e3*60));return`${b}h ${C}m`},F=m=>{var n;const h=(n=m.target.files)==null?void 0:n[0];if(h){if(!h.type.startsWith("image/")){x("Por favor selecciona una imagen v√°lida");return}if(h.size>5*1024*1024){x("La imagen debe ser menor a 5MB");return}i(h),x("");const b=new FileReader;b.onload=C=>{var $;R(($=C.target)==null?void 0:$.result)},b.readAsDataURL(h)}},I=async m=>{N(!0);try{const h=new Date().toISOString().split("T")[0],n=m.name.split(".").pop(),C=`daily-products/${`${j==null?void 0:j.id}/${h}/${Date.now()}.${n}`}`,{error:$}=await y.storage.from("products").upload(C,m,{cacheControl:"3600",upsert:!1});if($)throw $;const{data:q}=y.storage.from("products").getPublicUrl(C);return q.publicUrl}catch(h){throw console.error("Error uploading image:",h),new Error("Error al subir la imagen: "+h.message)}finally{N(!1)}},H=async m=>{try{const h=m.split("/"),n=h.findIndex(b=>b==="products");if(n!==-1){const C=h.slice(n+1).join("/");await y.storage.from("products").remove([C])}}catch(h){console.error("Error deleting old image:",h)}},a=async m=>{if(m.preventDefault(),x(""),!g.name.trim()){x("El nombre del producto es requerido");return}if(parseFloat(g.price)<=0){x("El precio debe ser mayor a 0");return}if(parseInt(g.stock_quantity)<0){x("La cantidad no puede ser negativa");return}if(!s&&!k&&!f){x("Selecciona una imagen para el producto");return}if(new Date().getHours()>=23){x("Es muy tarde para crear productos del d√≠a. Int√©ntalo ma√±ana temprano.");return}U(!0);try{let b=(s==null?void 0:s.image_url)||"";k&&(b=await I(k),s!=null&&s.image_url&&await H(s.image_url));const C={name:g.name.trim(),description:g.description.trim(),price:parseFloat(g.price)||0,stock_quantity:parseInt(g.stock_quantity)||0,image_url:b,seller_id:j==null?void 0:j.id,expires_at:S()};if(s){const{error:$}=await y.from("daily_products").update(C).eq("id",s.id);if($)throw $}else{const{error:$}=await y.from("daily_products").insert([C]);if($)throw $}u()}catch(b){console.error("Error saving daily product:",b),x(b.message||"Error al guardar el producto del d√≠a")}finally{U(!1)}},d=()=>{i(null),R(""),t.current&&(t.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto del D√≠a":"Tu Venta del D√≠a"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica tu oferta especial":"Crea una oferta especial que dura hasta medianoche"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800",children:["Tiempo restante: ",O()]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Este producto se eliminar√° autom√°ticamente a las 23:59:59 de hoy. Las im√°genes tambi√©n se eliminar√°n del servidor."})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Informaci√≥n del Producto del D√≠a"]})}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:"Imagen del Producto *"}),f?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(E,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:d,children:e.jsx(Ee,{className:"w-4 h-4"})}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})}),e.jsxs(Z,{variant:"destructive",className:"absolute bottom-2 left-2",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Expira a medianoche"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-orange-300 rounded-lg p-8 text-center cursor-pointer hover:border-orange-500 transition-colors bg-orange-50",onClick:()=>{var m;return(m=t.current)==null?void 0:m.click()},children:[e.jsx(Ss,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-orange-600",children:"PNG, JPG, WEBP hasta 5MB"}),e.jsx(Z,{variant:"outline",className:"mt-2 border-orange-300 text-orange-700",children:"Se elimina autom√°ticamente"})]}),e.jsx("input",{ref:t,type:"file",accept:"image/*",onChange:F,className:"hidden"}),!f&&e.jsxs(E,{type:"button",variant:"outline",onClick:()=>{var m;return(m=t.current)==null?void 0:m.click()},className:"w-full border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(J,{id:"name",value:g.name,onChange:m=>w({...g,name:m.target.value}),placeholder:"Ej: Combo Especial del D√≠a",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(Xe,{id:"description",value:g.description,onChange:m=>w({...g,description:m.target.value}),placeholder:"Describe tu oferta especial del d√≠a...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"price",children:"Precio Especial (Q) *"}),e.jsx(J,{id:"price",type:"number",step:"0.01",min:"0",value:g.price,onChange:m=>w({...g,price:m.target.value}),placeholder:"0.00",required:!0}),e.jsx("p",{className:"text-xs text-orange-600",children:"Precio especial v√°lido solo hoy"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(J,{id:"stock",type:"number",min:"0",value:g.stock_quantity,onChange:m=>w({...g,stock_quantity:m.target.value}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-orange-600",children:"¬°Solo por hoy!"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Caracter√≠sticas de Productos del D√≠a"]}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Se elimina autom√°ticamente a las 23:59:59"}),e.jsx("li",{children:'‚Ä¢ Aparece marcado como "Oferta del D√≠a" en el cat√°logo'}),e.jsx("li",{children:"‚Ä¢ Las im√°genes se almacenan en carpeta temporal"}),e.jsx("li",{children:"‚Ä¢ Ideal para ofertas especiales y productos perecederos"})]})]}),P&&e.jsxs(me,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{children:P})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:T||l,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:T||l,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:T?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Venta del D√≠a"]})})]})]})})]})]})]})}function ya({product:s,onEdit:u,onDelete:r}){const[j,g]=c.useState(!1),{openImageModal:w}=ls(),k=f=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(f),i=f=>new Date(f).toLocaleDateString("es-GT",{day:"numeric",month:"short",year:"numeric"});return e.jsxs(B,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border border-gray-200",style:{backgroundColor:"white"},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-gray-100",children:j?e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xe,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sin imagen"})]})}):e.jsx(Le,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>g(!0),expandable:!0,onExpand:w})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(Z,{variant:s.is_public?"default":"secondary",className:"text-xs font-medium",style:{backgroundColor:s.is_public?"#22c55e":"#6b7280",color:"white",border:"none"},children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"w-3 h-3 mr-1"}),"P√∫blico"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"w-3 h-3 mr-1"}),"Privado"]})})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Z,{variant:"destructive",className:"text-xs font-medium",style:{backgroundColor:"#ef4444",color:"white",border:"none"},children:"Sin stock"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(Z,{variant:"outline",className:"text-xs font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",color:"#374151",border:"1px solid #d1d5db"},children:s.category})})]}),e.jsx(Q,{className:"p-3 md:p-4",style:{backgroundColor:"white"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1 text-sm md:text-base",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm md:text-lg text-green-600",children:k(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"w-3 h-3 md:w-4 md:h-4 text-gray-500 flex-shrink-0"}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Creado el ",i(s.created_at)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>u(s),className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#d1d5db",color:"#374151"},children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(xs,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#fecaca",color:"#dc2626",backgroundColor:"white"},children:[e.jsx(ws,{className:"w-3 h-3 mr-1"}),"Eliminar"]})}),e.jsxs(hs,{children:[e.jsxs(fs,{children:[e.jsx(bs,{children:"¬øEliminar producto?"}),e.jsxs(js,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda.']})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(ys,{onClick:()=>r(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]})}function wa({dailyProduct:s,onEdit:u,onDelete:r}){const[j,g]=c.useState(!1),[w,k]=c.useState(""),[i,f]=c.useState(!1),{openImageModal:R}=ls();c.useEffect(()=>{const l=()=>{const P=Gs(s.expires_at);k(P.formattedTime),f(P.isExpired)};l();const N=setInterval(l,1e3);return()=>clearInterval(N)},[s.expires_at]);const T=l=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(l),U=l=>Bs(l);return e.jsxs(B,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:j?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center",children:e.jsx(re,{className:"w-12 h-12 text-orange-400"})}):e.jsx(Le,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>g(!0),expandable:!0,onExpand:R})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(Z,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs",children:[e.jsx(Vs,{className:"w-3 h-3 mr-1"}),"Oferta del D√≠a"]})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Z,{variant:"destructive",className:"text-xs",children:"Agotado"})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(Z,{variant:i?"destructive":"secondary",className:`text-xs ${i?"bg-red-500 text-white":"bg-white/90 backdrop-blur-sm text-orange-700"}`,children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),w]})})]}),e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:T(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-orange-700",children:["Creado a las ",U(s.created_at)]}),e.jsxs("span",{className:"text-orange-700 font-medium",children:["Expira: ",U(s.expires_at)]})]})}),!i&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:["‚è∞ Se elimina autom√°ticamente en ",w]})}),i&&e.jsx("div",{className:"text-center bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"‚ùå Este producto ha expirado y ser√° eliminado pronto"})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>u(s),className:"flex-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:i,children:[e.jsx(Ye,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(xs,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ws,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(hs,{children:[e.jsxs(fs,{children:[e.jsx(bs,{children:"¬øEliminar producto del d√≠a?"}),e.jsxs(js,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda y su imagen del servidor.',!i&&e.jsxs("span",{className:"block mt-2 text-orange-600 font-medium",children:["Nota: Este producto se eliminar√° autom√°ticamente en ",w," de todas formas."]})]})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(ys,{onClick:()=>r(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar Ahora"})]})]})]})]})]})})]})}const De={north:15.2,south:15,east:-89.3,west:-89.5};function _a(){var s,u;try{return(u=(s=import.meta)==null?void 0:s.env)==null?void 0:u.VITE_GOOGLE_MAPS_API_KEY}catch{return}}function Sa(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")?"Safari":s.includes("edge")?"Edge":"tu navegador"}function Ca(){const[s,u]=c.useState(!1),[r,j]=c.useState(null),[g,w]=c.useState(null),k=c.useCallback(()=>{j(null)},[]),i=c.useCallback((l,N)=>l>=De.south&&l<=De.north&&N>=De.west&&N<=De.east,[]),f=c.useCallback(async()=>{try{if("permissions"in navigator&&"query"in navigator.permissions){const l=await navigator.permissions.query({name:"geolocation"});return w(l.state),l.state}return w("prompt"),"prompt"}catch(l){return console.warn("Could not check geolocation permissions:",l),w("prompt"),"prompt"}},[]),R=c.useCallback(async()=>{try{const l=await new Promise(N=>{navigator.geolocation.getCurrentPosition(()=>N(!0),P=>{console.log("Permission request result:",P.code,P.message),N(P.code!==P.PERMISSION_DENIED)},{timeout:1e3,maximumAge:0})});return l&&await f(),l}catch(l){return console.error("Error requesting permissions:",l),!1}},[f]),T=c.useCallback(async(l,N)=>{try{j(null);const P=_a();if(P&&typeof fetch<"u")try{const x=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${l},${N}&key=${P}&language=es&region=GT`);if(x.ok){const t=await x.json();if(t.status==="OK"&&t.results&&t.results.length>0){const S=t.results[0],O=S.address_components||[];let F="",I="",H="",a="";return O.forEach(d=>{const m=d.types||[];m.includes("locality")||m.includes("administrative_area_level_2")?F=d.long_name||"":m.includes("administrative_area_level_1")?I=d.long_name||"":m.includes("country")?H=d.long_name||"":m.includes("postal_code")&&(a=d.long_name||"")}),{latitude:l,longitude:N,address:S.formatted_address||`Ubicaci√≥n GPS: ${l.toFixed(6)}, ${N.toFixed(6)}`,formatted_address:S.formatted_address||`Coordenadas: ${l.toFixed(6)}, ${N.toFixed(6)}`,city:F||"Gual√°n",state:I||"Zacapa",country:H||"Guatemala",postal_code:a,place_id:S.place_id}}}}catch(x){console.warn("Google Maps API request failed, using fallback:",x)}return{latitude:l,longitude:N,address:`Gual√°n, Zacapa, Guatemala (${l.toFixed(6)}, ${N.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS verificada en Gual√°n: ${l.toFixed(6)}, ${N.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}catch(P){return console.error("Error in reverse geocoding:",P),{latitude:l,longitude:N,address:`Gual√°n, Zacapa, Guatemala (${l.toFixed(6)}, ${N.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS: ${l.toFixed(6)}, ${N.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}},[]),U=c.useCallback(async()=>new Promise((l,N)=>{if(u(!0),j(null),!(navigator!=null&&navigator.geolocation)){const t=`‚ùå Geolocalizaci√≥n no disponible

Tu navegador no soporta geolocalizaci√≥n GPS. 

‚úÖ Soluciones:
‚Ä¢ Usa un navegador moderno (Chrome, Firefox, Safari, Edge)
‚Ä¢ Verifica que est√©s usando HTTPS (no HTTP)
‚Ä¢ Intenta desde un dispositivo m√≥vil
‚Ä¢ Actualiza tu navegador a la versi√≥n m√°s reciente`;console.error("Geolocation not supported"),j(t),u(!1),N(new Error(t));return}const P={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5},x=Sa();navigator.geolocation.getCurrentPosition(async t=>{try{const{latitude:S,longitude:O}=t.coords,F=t.coords.accuracy;if(console.log(`üìç GPS Location obtained: ${S.toFixed(6)}, ${O.toFixed(6)} (accuracy: ${F}m)`),!i(S,O)){const H=`üó∫Ô∏è Ubicaci√≥n fuera del √°rea de servicio

üìç Coordenadas detectadas: ${S.toFixed(4)}, ${O.toFixed(4)}
üè¢ √Årea de servicio: Gual√°n, Zacapa

‚ö†Ô∏è Posibles causas:
‚Ä¢ Tu negocio no est√° en Gual√°n, Zacapa
‚Ä¢ El GPS no es preciso (intenta ir al aire libre)
‚Ä¢ Est√°s usando VPN que cambia tu ubicaci√≥n

‚úÖ Si tu negocio S√ç est√° en Gual√°n:
‚Ä¢ Ve al exterior para mejor se√±al GPS
‚Ä¢ Desactiva VPN si usas una
‚Ä¢ Espera unos segundos y vuelve a intentar
‚Ä¢ La ubicaci√≥n se guardar√° aunque est√© fuera del √°rea estimada`;console.warn(`Location validation failed: lat=${S}, lng=${O}, accuracy=${F}m`),j(H),u(!1),N(new Error(H));return}const I=await T(S,O);console.log("‚úÖ Location successfully processed:",I),u(!1),l(I)}catch(S){console.error("Error processing location:",S);const O=S instanceof Error?S.message:"Error al procesar la ubicaci√≥n detectada";j(O),u(!1),N(S)}},t=>{console.error("Geolocation error details:",{code:t.code,message:t.message,PERMISSION_DENIED:t.PERMISSION_DENIED,POSITION_UNAVAILABLE:t.POSITION_UNAVAILABLE,TIMEOUT:t.TIMEOUT});let S="Error al detectar la ubicaci√≥n";switch(t.code){case t.PERMISSION_DENIED:S=`üö´ Permiso de ubicaci√≥n denegado

üì± SOLUCI√ìN R√ÅPIDA para ${x}:

üîí **M√©todo 1 - √çcono de ubicaci√≥n:**
1. Busca el √≠cono üîí o üåê en la barra de direcciones
2. Haz clic en √©l
3. Cambia "Ubicaci√≥n" de "Bloqueado" a "Permitir"
4. Recarga la p√°gina

‚öôÔ∏è **M√©todo 2 - Configuraci√≥n del navegador:**
‚Ä¢ Chrome: Configuraci√≥n ‚Üí Privacidad ‚Üí Configuraci√≥n del sitio ‚Üí Ubicaci√≥n
‚Ä¢ Firefox: Preferencias ‚Üí Privacidad ‚Üí Permisos ‚Üí Ubicaci√≥n  
‚Ä¢ Safari: Preferencias ‚Üí Sitios web ‚Üí Ubicaci√≥n
‚Ä¢ Edge: Configuraci√≥n ‚Üí Permisos del sitio ‚Üí Ubicaci√≥n

üìç **¬øPor qu√© necesitamos tu ubicaci√≥n?**
Los repartidores necesitan las coordenadas GPS exactas de tu negocio para hacer entregas correctas.

üîÑ Despu√©s de cambiar los permisos, recarga esta p√°gina y vuelve a intentar.`;break;case t.POSITION_UNAVAILABLE:S=`üì° Se√±al GPS no disponible

üõ∞Ô∏è **Posibles causas:**
‚Ä¢ Est√°s en un lugar cerrado (edificio, s√≥tano)
‚Ä¢ Se√±al GPS d√©bil en tu √°rea
‚Ä¢ Interferencia de otros dispositivos
‚Ä¢ GPS desactivado en el dispositivo

‚úÖ **Soluciones:**
‚Ä¢ Ve cerca de una ventana o al aire libre
‚Ä¢ Verifica que el GPS est√© activado en tu dispositivo
‚Ä¢ Espera 1-2 minutos para que mejore la se√±al
‚Ä¢ Intenta desde otro lugar o dispositivo
‚Ä¢ Aseg√∫rate de tener conexi√≥n a internet estable

üì± En m√≥viles: Configuraci√≥n ‚Üí Ubicaci√≥n ‚Üí Activar GPS de alta precisi√≥n`;break;case t.TIMEOUT:S=`‚è∞ Tiempo de espera agotado (15 segundos)

üîÑ **La detecci√≥n GPS tard√≥ demasiado:**

üì∂ **Soluciones r√°pidas:**
‚Ä¢ Ve a un lugar con mejor se√±al (ventana o exterior)
‚Ä¢ Verifica tu conexi√≥n a internet
‚Ä¢ Reinicia el GPS en tu dispositivo si es m√≥vil
‚Ä¢ Cierra otras apps que usen ubicaci√≥n

üöÄ **Int√©ntalo de nuevo:**
La detecci√≥n puede ser m√°s r√°pida en el segundo intento.

üí° **Tip:** En dispositivos m√≥viles, el GPS suele ser m√°s r√°pido y preciso que en computadoras.`;break;default:S=`‚ùå Error GPS desconocido

üîß **Informaci√≥n t√©cnica:**
‚Ä¢ C√≥digo de error: ${t.code}
‚Ä¢ Mensaje: ${t.message}

üõ†Ô∏è **Soluciones generales:**
‚Ä¢ Recarga la p√°gina e intenta de nuevo
‚Ä¢ Verifica los permisos de ubicaci√≥n
‚Ä¢ Intenta desde otro navegador o dispositivo
‚Ä¢ Aseg√∫rate de usar HTTPS (no HTTP)

üìß Si el problema persiste, contacta soporte t√©cnico con esta informaci√≥n.`}console.error("Geolocation error processed:",S),j(S),u(!1),N(new Error(S))},P)}),[i,T]);return c.useEffect(()=>{f()},[f]),{getCurrentLocation:U,reverseGeocode:T,validateLocation:i,checkPermissions:f,requestPermissions:R,loading:s,error:r,permissionState:g,clearError:k}}const ka={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWRkenlsb3RxZGNrdWJsZmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTU4NjEsImV4cCI6MjA3MTM3MTg2MX0.ktxZ0H7mI9NVdxu48sPd90kqPerSP-vkysQlIM1JpG8",VITE_SUPABASE_URL:"https://deaddzylotqdckublfed.supabase.co"},Cs=[{key:"monday",label:"Lunes",short:"Lun"},{key:"tuesday",label:"Martes",short:"Mar"},{key:"wednesday",label:"Mi√©rcoles",short:"Mi√©"},{key:"thursday",label:"Jueves",short:"Jue"},{key:"friday",label:"Viernes",short:"Vie"},{key:"saturday",label:"S√°bado",short:"S√°b"},{key:"sunday",label:"Domingo",short:"Dom"}],Ea={monday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},saturday:{isOpen:!0,openTime:"09:00",closeTime:"17:00"},sunday:{isOpen:!1,openTime:"09:00",closeTime:"15:00"}};function Pa(){try{return!!(import.meta&&ka&&!1)}catch{return!1}}function Ta(s){const[u,r]=c.useState(()=>{if(s)try{return JSON.parse(s)}catch{console.log("Using default weekly hours")}return Ea});return{weeklyHours:u,setWeeklyHours:r,updateWeeklyHours:(k,i,f)=>{r(R=>({...R,[k]:{...R[k],[i]:f}}))},generateWeeklyHoursText:()=>{const k=Cs.filter(i=>u[i.key].isOpen);return k.length===0?"Cerrado toda la semana":k.map(i=>{const f=u[i.key];return`${i.short}: ${f.openTime}-${f.closeTime}`}).join(", ")},getHoursAsJSON:()=>JSON.stringify(u)}}function Ia({weeklyHours:s,updateWeeklyHours:u,generateWeeklyHoursText:r}){const[j,g]=c.useState(!1),w=()=>{g(!1)},k=()=>{g(!1)};return e.jsxs(B,{className:"seller-profile",children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"w-5 h-5 text-purple-500"}),"Horarios de Atenci√≥n"]}),!j&&e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>g(!0),className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Editar Horarios"]})]})}),e.jsx(Q,{className:"space-y-4",children:j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configurar Horarios"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:k,className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Cancelar"]}),e.jsxs(E,{size:"sm",onClick:w,className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Guardar"]})]})]}),e.jsx("div",{className:"space-y-3",children:Cs.map(i=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 min-w-[80px]",children:i.label}),e.jsx(cs,{checked:s[i.key].isOpen,onCheckedChange:f=>u(i.key,"isOpen",f)}),e.jsx("span",{className:`text-sm font-medium ${s[i.key].isOpen?"text-green-600":"text-red-600"}`,children:s[i.key].isOpen?"Abierto":"Cerrado"})]})}),s[i.key].isOpen&&e.jsxs("div",{className:"flex items-center gap-4 ml-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-sm whitespace-nowrap",children:"Apertura:"}),e.jsx(J,{type:"time",value:s[i.key].openTime,onChange:f=>u(i.key,"openTime",f.target.value),className:"w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-sm whitespace-nowrap",children:"Cierre:"}),e.jsx(J,{type:"time",value:s[i.key].closeTime,onChange:f=>u(i.key,"closeTime",f.target.value),className:"w-32"})]})]})]},i.key))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Vista previa:"}),e.jsx("p",{className:"text-sm text-blue-800",children:r()})]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-center",children:"Vista previa de horarios:"}),e.jsx("div",{className:"text-sm text-blue-800 leading-relaxed",children:r()})]})})]})}function Aa(s,u){if(s&&u){const r=`https://www.google.com/maps/@${s},${u},18z`;window.open(r,"_blank")}}function $a(s){return s.business_name.trim()?null:"El nombre del negocio es requerido"}const We=({active:s,onClick:u,children:r,icon:j})=>e.jsxs("button",{onClick:u,className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 ${s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:r})]});function is(){const{user:s}=he(),{getCurrentLocation:u,loading:r,error:j,permissionState:g,clearError:w}=Ca(),[k,i]=c.useState(null),[f,R]=c.useState(!0),[T,U]=c.useState(!1),[l,N]=c.useState(""),[P,x]=c.useState(""),[t,S]=c.useState(!1),[O,F]=c.useState(!1),[I,H]=c.useState(!1),[a,d]=c.useState(!1),[m,h]=c.useState(""),[n,b]=c.useState(!1),[C,$]=c.useState(!1),[q,Y]=c.useState(!1),[ae,ge]=c.useState("info"),ye=c.useRef(null),Te=c.useRef(null),{weeklyHours:qe,setWeeklyHours:ze,updateWeeklyHours:Fe,generateWeeklyHoursText:Ue,getHoursAsJSON:Ie}=Ta(k==null?void 0:k.business_hours),[_,ee]=c.useState({business_name:"",business_description:"",business_logo:"",cover_image_url:"",business_category:"",phone:"",email:"",address:"",latitude:0,longitude:0,delivery_time:30,delivery_radius:5,minimum_order:50,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:{facebook:"",instagram:"",whatsapp:"",website:""}});c.useEffect(()=>{s?be():(i(null),Y(!1),R(!1)),b(Pa())},[s]),c.useEffect(()=>{if(!s||!f)return;const v=setTimeout(()=>{R(!1),Y(!0)},8e3);return()=>clearTimeout(v)},[s,f]),c.useEffect(()=>{j&&($(!0),N(""))},[j]);const be=async()=>{var v;try{R(!0);const{data:o,error:A}=await y.from("sellers").select("*").eq("id",s==null?void 0:s.id).single();if(A){const M=A.code,G=((v=A.message)==null?void 0:v.toString().toLowerCase())||"";if(M==="PGRST116"||M==="PGRST403"||M==="42501"||M==="PGRST114"||G.includes("permission")||G.includes("rls")||G.includes("forbidden")||G.includes("not authorized"))Y(!0);else throw A}if(o){if(i(o),ee({business_name:o.business_name||"",business_description:o.business_description||"",business_logo:o.business_logo||"",cover_image_url:o.cover_image_url||"",business_category:o.business_category||"",phone:o.phone||"",email:o.email||"",address:o.address||"",latitude:o.latitude||0,longitude:o.longitude||0,delivery_time:o.delivery_time||30,delivery_radius:o.delivery_radius||5,minimum_order:o.minimum_order||50,is_active:o.is_active!==!1,is_open_now:o.is_open_now||!1,is_accepting_orders:o.is_accepting_orders!==!1,location_verified:o.location_verified||!1,social_media:o.social_media||{facebook:"",instagram:"",whatsapp:"",website:""}}),o.business_hours)try{ze(JSON.parse(o.business_hours))}catch{console.log("Using default weekly hours")}const M=o.latitude&&o.longitude&&Math.abs(o.latitude)>.001&&Math.abs(o.longitude)>.001;d(M),M&&h(`${o.latitude.toFixed(6)}, ${o.longitude.toFixed(6)}`)}}catch(o){console.error("Error loading profile:",o),N("Error al cargar el perfil del negocio")}finally{R(!1)}},Ve=async()=>{var v,o,A,M,G;if(s)try{U(!0),N("");const W={business_name:((v=_.business_name)==null?void 0:v.trim())||"Mi Negocio",business_description:((o=_.business_description)==null?void 0:o.trim())||"",business_logo:"",cover_image_url:"",business_category:_.business_category||"",phone:((A=_.phone)==null?void 0:A.trim())||"",email:((M=_.email)==null?void 0:M.trim())||"",address:((G=_.address)==null?void 0:G.trim())||"",latitude:_.latitude||0,longitude:_.longitude||0,business_hours:Ie(),delivery_time:_.delivery_time||30,delivery_radius:_.delivery_radius||5,minimum_order:_.minimum_order||0,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:_.social_media,is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:X}=await y.from("sellers").upsert({id:s.id,...W});if(X)throw X;x("‚úÖ Perfil de vendedor creado. Completa la informaci√≥n y guarda los cambios."),Y(!1),S(!0),await be(),setTimeout(()=>x(""),4e3)}catch(W){console.error("Error creating minimal seller profile:",W),N("No se pudo crear el perfil de vendedor. Intenta de nuevo.")}finally{U(!1)}},Ge=async()=>{var v,o,A,M,G,W;try{U(!0),N("");const X=$a(_);if(X){N(X);return}console.log("üíæ Guardando perfil con datos:",{business_name:_.business_name,address:_.address,latitude:_.latitude,longitude:_.longitude,business_logo:((v=_.business_logo)==null?void 0:v.substring(0,50))+"...",cover_image_url:((o=_.cover_image_url)==null?void 0:o.substring(0,50))+"..."});const oe={business_name:_.business_name.trim(),business_description:((A=_.business_description)==null?void 0:A.trim())||null,business_category:_.business_category||null,phone:((M=_.phone)==null?void 0:M.trim())||null,email:((G=_.email)==null?void 0:G.trim())||null,address:((W=_.address)==null?void 0:W.trim())||null,latitude:_.latitude||null,longitude:_.longitude||null,business_hours:Ie(),delivery_time:_.delivery_time||30,delivery_radius:_.delivery_radius||5,minimum_order:_.minimum_order||0,is_active:_.is_active,is_open_now:_.is_open_now,location_verified:_.location_verified||!1,social_media:_.social_media||{},business_logo:_.business_logo||null,cover_image_url:_.cover_image_url||null,updated_at:new Date().toISOString()},{error:te}=await y.from("sellers").upsert({id:s==null?void 0:s.id,...oe});if(te)throw console.error("üí• Error al guardar:",te),te;console.log("‚úÖ Perfil guardado exitosamente"),x("‚úÖ Perfil guardado exitosamente"),S(!1),await be(),setTimeout(()=>x(""),4e3)}catch(X){console.error("üí• Error saving profile:",X),N(`Error al guardar el perfil: ${X.message||"Error desconocido"}`)}finally{U(!1)}},ke=(v,o,A,M=.8)=>new Promise(G=>{const W=document.createElement("canvas"),X=W.getContext("2d"),oe=new Image;oe.onload=()=>{let{width:te,height:fe}=oe;te>fe?te>o&&(fe=fe*o/te,te=o):fe>A&&(te=te*A/fe,fe=A),W.width=te,W.height=fe,X.drawImage(oe,0,0,te,fe),W.toBlob(es=>{es&&G(es)},"image/jpeg",M)},oe.src=URL.createObjectURL(v)}),Ae=async v=>{var A;const o=(A=v.target.files)==null?void 0:A[0];if(!(!o||!s))try{if(F(!0),N(""),console.log("ÔøΩ SUBIENDO LOGO:",o.name),!o.type.startsWith("image/")){N("Solo im√°genes permitidas");return}const M=await ke(o,400,400,.9),G=`${s.id}/logo-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-logos...");const{error:W}=await y.storage.from("business-logos").upload(G,M,{upsert:!0});if(W){console.error("‚ùå Error upload:",W),N(`Error subiendo: ${W.message}`);return}const{data:X}=y.storage.from("business-logos").getPublicUrl(G);console.log("üîó URL generada:",X.publicUrl);const{error:oe}=await y.from("sellers").upsert({id:s.id,business_logo:X.publicUrl,business_name:_.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(oe){console.error("‚ùå Error BD:",oe),N(`Error guardando: ${oe.message}`);return}console.log("‚úÖ LOGO GUARDADO EXITOSAMENTE"),ee(te=>({...te,business_logo:X.publicUrl})),x("‚úÖ Logo guardado correctamente"),setTimeout(()=>x(""),3e3)}catch(M){console.error("üí• ERROR COMPLETO:",M),N(`Error: ${M.message}`)}finally{F(!1)}},$e=async v=>{var A;const o=(A=v.target.files)==null?void 0:A[0];if(!(!o||!s))try{if(F(!0),N(""),console.log("ÔøΩ SUBIENDO PORTADA:",o.name),!o.type.startsWith("image/")){N("Solo im√°genes permitidas");return}const M=await ke(o,1200,400,.9),G=`${s.id}/cover-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-covers...");const{error:W}=await y.storage.from("business-covers").upload(G,M,{upsert:!0});if(W){console.error("‚ùå Error upload:",W),N(`Error subiendo: ${W.message}`);return}const{data:X}=y.storage.from("business-covers").getPublicUrl(G);console.log("üîó URL generada:",X.publicUrl);const{error:oe}=await y.from("sellers").upsert({id:s.id,cover_image_url:X.publicUrl,business_name:_.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(oe){console.error("‚ùå Error BD:",oe),N(`Error guardando: ${oe.message}`);return}console.log("‚úÖ PORTADA GUARDADA EXITOSAMENTE"),ee(te=>({...te,cover_image_url:X.publicUrl})),x("‚úÖ Portada guardada correctamente"),setTimeout(()=>x(""),3e3)}catch(M){console.error("üí• ERROR COMPLETO:",M),N(`Error: ${M.message}`)}finally{F(!1)}},p=async()=>{try{N(""),$(!1),w();const v=await u();ee(o=>({...o,latitude:v.latitude,longitude:v.longitude})),d(!0),h(`${v.latitude.toFixed(6)}, ${v.longitude.toFixed(6)}`),x(`üéØ ¬°Ubicaci√≥n GPS verificada exitosamente!
      
Ô∏è Ciudad: ${v.city}, ${v.state}
üìä Coordenadas: ${v.latitude.toFixed(6)}, ${v.longitude.toFixed(6)}
      
‚úÖ Los repartidores podr√°n encontrar tu negocio f√°cilmente.
üìù Ahora escribe la direcci√≥n de tu negocio en el campo correspondiente.

üîî No olvides guardar el perfil para mantener estos cambios.`)}catch(v){console.error("Error detecting location:",v),$(!0)}},z=()=>{$(!1),w(),p()},L=()=>{$(!1),w()},K=async()=>{const v=!_.is_open_now;try{const{error:o}=await y.from("sellers").update({is_open_now:v,updated_at:new Date().toISOString()}).eq("id",s==null?void 0:s.id);if(o)throw o;ee(A=>({...A,is_open_now:v})),x(v?"üü¢ ¬°Negocio ABIERTO! Ahora apareces en el listado de compradores":"üî¥ Negocio CERRADO. No aparecer√°s en el listado hasta que abras"),setTimeout(()=>x(""),4e3)}catch(o){console.error("Error updating business status:",o),N("Error al actualizar el estado del negocio")}};return f?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"w-10 h-10 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Cargando tu perfil de negocio..."})]})}):!f&&q?e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:e.jsxs(B,{className:"text-center shadow-lg border-none",children:[e.jsxs(ie,{children:[e.jsx(se,{children:"¬°Bienvenido, Vendedor!"}),e.jsx("p",{className:"text-gray-600",children:"Parece que a√∫n no has configurado tu perfil. ¬°Es el primer paso para empezar a vender!"})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Crearemos un perfil b√°sico para ti. Podr√°s editar y completar toda la informaci√≥n m√°s adelante."}),e.jsxs(E,{onClick:Ve,disabled:T,size:"lg",className:"w-full sm:w-auto",children:[T?e.jsx(le,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Crear Mi Perfil Ahora"]})]})]})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil de Negocio"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestiona la informaci√≥n que ven tus clientes."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"outline",onClick:()=>S(!t),children:t?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"})," Editar"]})}),t&&e.jsxs(E,{onClick:Ge,disabled:T,children:[T?e.jsx(le,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})]})]})}),l&&e.jsxs(me,{variant:"destructive",className:"mb-6 flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{className:"whitespace-pre-line",children:l})]}),P&&e.jsxs(me,{className:"mb-6 border-green-200 bg-green-50 text-green-800 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-green-800 whitespace-pre-line",children:P})]}),!n&&e.jsxs(me,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(ds,{className:"h-4 w-4 text-blue-600"}),e.jsxs(ue,{className:"text-blue-800",children:[e.jsx("strong",{children:"Sistema GPS:"})," Funcionando con detecci√≥n b√°sica. Para direcciones m√°s detalladas, puedes configurar Google Maps API (opcional).",e.jsx("br",{}),e.jsx("small",{children:"Ver: /GOOGLE_MAPS_SETUP_OPCIONAL.md"})]})]}),e.jsxs(B,{className:"w-full overflow-hidden shadow-lg border-none",children:[e.jsxs("div",{className:"relative h-40 sm:h-56 bg-gradient-to-r from-blue-500 to-purple-600",children:[_.cover_image_url?e.jsx(Le,{src:_.cover_image_url,alt:"Portada del negocio",className:"w-full h-full object-cover",width:800,height:200}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-2 opacity-70"}),e.jsx("p",{className:"text-sm opacity-90",children:"Imagen de portada"}),t&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Cualquier imagen se optimizar√° autom√°ticamente"})]})}),t&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var v;return(v=Te.current)==null?void 0:v.click()},children:[e.jsxs(E,{variant:"secondary",disabled:O,children:[O?e.jsx(le,{className:"w-4 h-4 animate-spin"}):e.jsx(ve,{className:"w-4 h-4 mr-2"}),_.cover_image_url?"Cambiar Portada":"Agregar Portada"]}),e.jsx("input",{ref:Te,type:"file",accept:"image/*",className:"hidden",onChange:$e})]})]}),e.jsx("div",{className:"relative px-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-16 sm:-mt-12",children:[e.jsxs("div",{className:"relative h-32 w-32 rounded-full border-4 border-white bg-gradient-to-br from-green-400 to-blue-500 shadow-md flex items-center justify-center",children:[_.business_logo?e.jsx(Le,{src:_.business_logo,alt:"Logo del negocio",className:"w-full h-full object-cover rounded-full"}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-1"}),t&&e.jsx("p",{className:"text-xs opacity-80",children:"Logo - Auto-optimizado"})]}),t&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var v;return(v=ye.current)==null?void 0:v.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white/90 rounded-full flex items-center justify-center",children:O?e.jsx(le,{className:"w-5 h-5 animate-spin text-slate-800"}):e.jsx(ve,{className:"w-5 h-5 text-slate-800"})}),e.jsx("input",{ref:ye,type:"file",accept:"image/*",className:"hidden",onChange:Ae})]})]}),e.jsxs("div",{className:"mt-4 sm:ml-6 text-center sm:text-left",children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:_.business_name}),(k==null?void 0:k.is_verified)&&e.jsx(Hs,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-gray-500",children:_.business_category})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-auto",children:e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium ${_.is_open_now?"bg-green-500 text-white":"bg-gray-400 text-white"}`,children:[e.jsx("span",{children:_.is_open_now?"Abierto":"Cerrado"}),e.jsx(cs,{checked:_.is_open_now,onCheckedChange:K,className:"h-3 w-5 scale-75"})]})})]})}),e.jsx("div",{className:"px-6 mt-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 -mb-px overflow-x-auto",children:[e.jsx(We,{active:ae==="info",onClick:()=>ge("info"),icon:ss,children:"Informaci√≥n"}),e.jsx(We,{active:ae==="location",onClick:()=>ge("location"),icon:ce,children:"Ubicaci√≥n"}),e.jsx(We,{active:ae==="delivery",onClick:()=>ge("delivery"),icon:Pe,children:"Delivery"})]})}),e.jsxs(Q,{className:"p-6",children:[ae==="info"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(se,{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"w-5 h-5 text-green-500"})," Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"business_name",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ne,{className:"w-4 h-4 text-green-500"}),"Nombre del Negocio"]}),e.jsx(J,{id:"business_name",value:_.business_name,onChange:v=>ee(o=>({...o,business_name:v.target.value})),disabled:!t,placeholder:"Mi Negocio",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs(V,{htmlFor:"business_description",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ss,{className:"w-4 h-4 text-purple-500"}),"Descripci√≥n (opcional)"]}),e.jsx(Xe,{id:"business_description",value:_.business_description,onChange:v=>ee(o=>({...o,business_description:v.target.value})),disabled:!t,rows:3,placeholder:"Cu√©ntales a tus clientes sobre tu negocio...",className:"border-gray-200 focus:border-purple-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs(se,{className:"flex items-center gap-2 mb-4",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-500"})," Contacto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Me,{className:"w-4 h-4 text-green-500"}),"Tel√©fono"]}),e.jsx(J,{id:"phone",value:_.phone,onChange:v=>ee(o=>({...o,phone:v.target.value})),disabled:!t,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(sa,{className:"w-4 h-4 text-blue-500"}),"Email (opcional)"]}),e.jsx(J,{id:"email",type:"email",value:_.email,onChange:v=>ee(o=>({...o,email:v.target.value})),disabled:!t,placeholder:"contacto@negocio.com",className:"border-gray-200 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs(se,{className:"flex items-center gap-2 mb-4",children:[e.jsx(as,{className:"w-5 h-5 text-purple-500"})," Redes Sociales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"whatsapp",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ea,{className:"w-4 h-4 text-green-500"})," WhatsApp"]}),e.jsx(J,{id:"whatsapp",value:_.social_media.whatsapp,onChange:v=>ee(o=>({...o,social_media:{...o.social_media,whatsapp:v.target.value}})),disabled:!t,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"facebook",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ga,{className:"w-4 h-4 text-blue-600"})," Facebook"]}),e.jsx(J,{id:"facebook",value:_.social_media.facebook,onChange:v=>ee(o=>({...o,social_media:{...o.social_media,facebook:v.target.value}})),disabled:!t,placeholder:"@mi_negocio",className:"border-gray-200 focus:border-blue-500"})]})]}),t&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"+ M√°s redes sociales (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"instagram",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(fa,{className:"w-4 h-4 text-pink-500"})," Instagram"]}),e.jsx(J,{id:"instagram",value:_.social_media.instagram,onChange:v=>ee(o=>({...o,social_media:{...o.social_media,instagram:v.target.value}})),placeholder:"@mi_negocio",className:"border-gray-200 focus:border-pink-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"website",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(as,{className:"w-4 h-4 text-gray-500"})," Sitio Web"]}),e.jsx(J,{id:"website",value:_.social_media.website,onChange:v=>ee(o=>({...o,social_media:{...o.social_media,website:v.target.value}})),placeholder:"www.mi-negocio.com",className:"border-gray-200 focus:border-gray-500"})]})]})]})]})]}),ae==="location"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Ubicaci√≥n del Negocio"}),a&&e.jsx(ne,{className:"w-5 h-5 text-green-500"})]}),C&&j&&e.jsxs(me,{variant:"destructive",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsxs(ue,{className:"flex flex-col gap-3",children:[e.jsx("span",{children:j}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{size:"sm",variant:"outline",onClick:z,className:"bg-white hover:bg-gray-50",children:[e.jsx(Qs,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),e.jsxs(E,{size:"sm",variant:"ghost",onClick:L,className:"text-red-800 hover:bg-red-50",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Cerrar"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(V,{htmlFor:"address",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500"}),"Direcci√≥n"]}),e.jsx(J,{id:"address",value:_.address,onChange:v=>ee(o=>({...o,address:v.target.value})),disabled:!t,placeholder:"Direcci√≥n de tu negocio",className:"border-gray-200 focus:border-red-500"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"GPS Autom√°tico"})]}),a&&e.jsx(ne,{className:"w-5 h-5 text-green-500"})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-green-700 bg-green-100 p-3 rounded-md",children:["‚úÖ ",e.jsx("strong",{children:"Ubicaci√≥n verificada"}),e.jsx("br",{}),"üìç ",m]}),t&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:p,disabled:r,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[r?e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(E,{onClick:()=>Aa(_.latitude,_.longitude),variant:"outline",size:"sm",disabled:!_.latitude||!_.longitude,children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Ver Mapa"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Detecta tu ubicaci√≥n para que los repartidores te encuentren f√°cilmente"}),t&&e.jsxs(E,{onClick:p,disabled:r,className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:[r?e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4 mr-2"}),r?"Detectando...":"Detectar Mi Ubicaci√≥n"]}),g==="denied"&&e.jsxs(me,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(Ce,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(ue,{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"GPS bloqueado."})," Haz clic en üîí en la barra del navegador para permitir ubicaci√≥n."]})]})]})]})]})]}),e.jsx("div",{children:e.jsx(Ia,{weeklyHours:qe,updateWeeklyHours:Fe,generateWeeklyHoursText:Ue})})]}),ae==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-orange-500"})," Configuraci√≥n de Delivery"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"w-5 h-5 text-orange-500"}),e.jsx(V,{htmlFor:"delivery_time",className:"text-sm font-medium",children:"Tiempo de Preparaci√≥n"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{id:"delivery_time",type:"number",value:_.delivery_time,onChange:v=>ee(o=>({...o,delivery_time:parseInt(v.target.value)||0})),disabled:!t,min:"5",max:"120",className:"border-gray-200 focus:border-orange-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-500"}),e.jsx(V,{htmlFor:"delivery_radius",className:"text-sm font-medium",children:"Radio de Entrega"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{id:"delivery_radius",type:"number",value:_.delivery_radius,onChange:v=>ee(o=>({...o,delivery_radius:parseInt(v.target.value)||0})),disabled:!t,min:"1",max:"20",className:"border-gray-200 focus:border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"km"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-5 h-5 text-green-500"}),e.jsx(V,{htmlFor:"minimum_order",className:"text-sm font-medium",children:"Pedido M√≠nimo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Q"}),e.jsx(J,{id:"minimum_order",type:"number",value:_.minimum_order,onChange:v=>ee(o=>({...o,minimum_order:parseInt(v.target.value)||0})),disabled:!t,min:"0",className:"border-gray-200 focus:border-green-500"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-lg",children:"üí° Estos valores ayudan a los clientes a saber qu√© esperar de tu servicio"})]})]})]})]})})}async function Da(s){try{const{data:{user:u}}=await y.auth.getUser();if(!u)throw new Error("Usuario no autenticado");console.log(`üöÄ Intentando aceptar orden ${s}...`);const{data:r,error:j}=await y.rpc("seller_accept_order",{p_order_id:s,p_seller_id:u.id});return j?(console.error("‚ùå Error:",j),{success:!1,error:j.message}):(console.log("‚úÖ Resultado:",r),{success:!0,data:r})}catch(u){return console.error("üí• Error:",u),{success:!1,error:u instanceof Error?u.message:"Error desconocido"}}}const Oa={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-purple-100 text-purple-800",assigned:"bg-indigo-100 text-indigo-800",picked_up:"bg-green-100 text-green-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},ns={pending:"Pendiente",accepted:"Aceptado",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",assigned:"Asignado",picked_up:"Recogido",in_transit:"En camino",delivered:"Entregado",completed:"Completado",cancelled:"Cancelado",rejected:"Rechazado"};function os(){const{user:s}=he(),[u,r]=c.useState([]),[j,g]=c.useState(!0),[w,k]=c.useState(!1),[i,f]=c.useState(new Set),[R,T]=c.useState("pending");c.useEffect(()=>{s!=null&&s.id&&(l(),U())},[s==null?void 0:s.id]);const U=()=>{if(!(s!=null&&s.id))return;const a=y.channel("seller-orders-management").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},()=>{l()}).subscribe();return()=>{a.unsubscribe()}},l=async()=>{r([]);try{const{data:a,error:d}=await y.from("orders").select(`
          *,
          order_items (
            id,
            product_name,
            quantity,
            unit_price,
            product_image,
            notes
          ),
          users!orders_buyer_id_fkey (
            name,
            phone
          ),
          drivers:users!orders_driver_id_fkey (
            name
          )
        `).eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(d)throw d;console.log("üìä √ìrdenes cargadas:",(a==null?void 0:a.length)||0),console.log("üìã Datos de √≥rdenes:",a);const m=(a==null?void 0:a.map(h=>{var n,b,C;return console.log(`üîç Orden ${h.order_number}:`,{id:h.id,status:h.status,delivery_type:h.delivery_type,buyer_id:h.buyer_id}),{...h,buyer_id:h.buyer_id,buyer_name:((n=h.users)==null?void 0:n.name)||"Cliente",buyer_phone:(b=h.users)==null?void 0:b.phone,driver_name:(C=h.drivers)==null?void 0:C.name,items:h.order_items||[]}}))||[];r(m)}catch(a){console.error("Error loading orders:",a),D.error("Error al cargar las √≥rdenes")}finally{g(!1),k(!1)}},N=()=>{k(!0),l()},P=async a=>{console.log(`üß™ Probando aceptar orden directa: ${a}`);const d=await Da(a);console.log("üìä Resultado:",d),d.success?(D.success("Orden aceptada exitosamente!"),l()):D.error(`Error: ${d.error}`)},x=async a=>{if(!i.has(a)){f(d=>new Set([...d,a]));try{console.log(`üéØ Marcando orden como lista: ${a}`);let d,m;try{console.log("üîÑ Intento 1: seller_mark_ready_improved");const h=await y.rpc("seller_mark_ready_improved",{p_order_id:a,p_seller_id:s==null?void 0:s.id});d=h.data,m=h.error,!m&&d&&console.log("‚úÖ √âxito con funci√≥n mejorada")}catch{console.log("‚ö†Ô∏è Funci√≥n mejorada fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_ready_safe");const n=await y.rpc("seller_mark_ready_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});d=n.data,m=n.error,!m&&d&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_ready_basic");const b=await y.rpc("seller_mark_ready_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});d=b.data,m=b.error,!m&&d&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(b){throw console.error("üí• Todos los m√©todos fallaron:",b),new Error("No se pudo marcar la orden como lista")}}}if(m){console.error("‚ùå Error RPC:",m),D.error(`Error: ${m.message}`);return}if(console.log("‚úÖ Resultado final:",d),d&&d.length>0){const h=d[0];h.success?(D.success(h.message),l()):D.error(h.message)}else D.success("Orden marcada como lista"),l()}catch(d){console.error("üí• Error en handleMarcarListo:",d),D.error("Error al marcar orden como lista")}finally{f(d=>{const m=new Set(d);return m.delete(a),m})}}},t=async a=>{if(!i.has(a)){f(d=>new Set([...d,a]));try{console.log(`üì¶ Completando orden pickup/dine-in: ${a}`);let d,m;try{console.log("üîÑ Intento 1: seller_mark_completed_pickup");const h=await y.rpc("seller_mark_completed_pickup",{p_order_id:a,p_seller_id:s==null?void 0:s.id});d=h.data,m=h.error,!m&&d&&console.log("‚úÖ √âxito con funci√≥n completa")}catch{console.log("‚ö†Ô∏è Funci√≥n completa fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_completed_pickup_safe");const n=await y.rpc("seller_mark_completed_pickup_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});d=n.data,m=n.error,!m&&d&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_completed_pickup_basic");const b=await y.rpc("seller_mark_completed_pickup_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});d=b.data,m=b.error,!m&&d&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(b){throw console.error("üí• Todos los m√©todos fallaron:",b),new Error("No se pudo completar la orden pickup/dine-in")}}}if(m){console.error("‚ùå Error RPC:",m),D.error(`Error: ${m.message}`);return}if(console.log("‚úÖ Resultado final:",d),d&&d.length>0){const h=d[0];h.success?(D.success(h.message),l()):D.error(h.message)}else D.success("Orden completada exitosamente"),l()}catch(d){console.error("üí• Error en handleCompletarPickup:",d),D.error("Error al completar la orden")}finally{f(d=>{const m=new Set(d);return m.delete(a),m})}}},S=async(a,d)=>{var n,b;if(i.has(a))return;const h={confirmed:"accepted",preparing:"ready",ready:"ready",delivered:"delivered",cancelled:"cancelled"}[d];f(C=>new Set([...C,a]));try{let C;if(h==="accepted"&&(C=await y.rpc("seller_accept_order",{p_order_id:a,p_seller_id:s==null?void 0:s.id})),C&&(C.error||C.data&&C.data[0]&&!C.data[0].success)){const q=((n=C.error)==null?void 0:n.message)||((b=C.data[0])==null?void 0:b.message)||"Error al actualizar el estado";console.error("RPC error:",q),D.error(q),f(Y=>{const ae=new Set(Y);return ae.delete(a),ae});return}const $=u.find(q=>q.id===a);if($&&h==="accepted"){await y.from("notifications").insert({user_id:$.buyer_id,order_id:$.id,message:`Tu orden #${$.order_number} ha sido aceptada.`,type:"order_accepted"}),console.log("üîÑ Orden aceptada, actualizando stock...");const{data:q,error:Y}=await y.from("order_items").select("product_id, daily_product_id, quantity, product_name, product_type").eq("order_id",a);if(Y)console.error("‚ùå Error obteniendo items de la orden:",Y),D.error("Orden aceptada pero error al actualizar stock");else if(q&&q.length>0){console.log("üì¶ Items encontrados:",q.length),q.forEach((ge,ye)=>{console.log(`   ${ye+1}. ${ge.product_name} - Cantidad: ${ge.quantity} - Tipo: ${ge.product_type}`)}),console.log("üöÄ Llamando updateProductStock...");const ae=await Js(q,a);console.log("üìä Resultado del stock manager:",ae),ae.success?(console.log("‚úÖ Stock actualizado exitosamente:",ae.updatedProducts),D.success("Orden aceptada y stock actualizado")):(console.error("‚ùå Error actualizando stock:",ae.message),D.error(`Orden aceptada pero ${ae.message}`))}else console.log("‚ö†Ô∏è No se encontraron items en la orden"),D.success("Orden aceptada (sin items para actualizar stock)")}D.success(`Orden actualizada a ${ns[h]||h}.`),l(),f(q=>{const Y=new Set(q);return Y.delete(a),Y})}catch(C){console.error("Error updating order status:",C),D.error("Error al actualizar el estado de la orden")}finally{f(C=>{const $=new Set(C);return $.delete(a),$})}},O=async(a,d)=>{if(!i.has(a)){f(m=>new Set([...m,a]));try{const{error:m}=await y.from("orders").update({status:"rejected",rejection_reason:d,updated_at:new Date().toISOString()}).eq("id",a);if(m)throw m;const h=u.find(n=>n.id===a);h&&await y.from("notifications").insert({user_id:h.buyer_id,order_id:h.id,message:`Tu orden #${h.order_number} fue rechazada.`,type:"order_rejected"}),D.success("Orden rechazada"),l()}catch(m){console.error("Error rejecting order:",m),D.error("Error al rechazar la orden")}finally{f(m=>{const h=new Set(m);return h.delete(a),h})}}},F=a=>{try{return new Date(a).toLocaleString("es-GT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha inv√°lida"}},I=a=>a==="active"?u.filter(d=>["accepted","ready","assigned","picked_up","in_transit"].includes(d.status)):a==="completed"?u.filter(d=>["delivered","completed"].includes(d.status)):a==="cancelled"?u.filter(d=>["cancelled","rejected"].includes(d.status)):u.filter(d=>d.status===a),H=a=>{const d=i.has(a.id);return console.log(`üé® Renderizando orden ${a.order_number}:`,{id:a.id,status:a.status,delivery_type:a.delivery_type,buyer_id:a.buyer_id,isProcessing:d,orderObject:a}),console.log(`‚ùì Status actual: "${a.status}" (tipo: ${typeof a.status})`),console.log(`‚ùì Delivery type actual: "${a.delivery_type}" (tipo: ${typeof a.delivery_type})`),console.log(`‚ùì ¬øStatus === 'pending'? ${a.status==="pending"}`),console.log(`‚ùì ¬øDelivery type === 'delivery'? ${a.delivery_type==="delivery"}`),console.log(`‚ùì ¬øStatus incluye pending? ${String(a.status).includes("pending")}`),console.log(`‚ùì ¬øDelivery incluye delivery? ${String(a.delivery_type).includes("delivery")}`),e.jsxs(B,{className:"border-l-4 border-l-orange-500",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(se,{className:"text-lg",children:["Orden #",a.order_number]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:F(a.created_at)})]}),e.jsx(Z,{className:Oa[a.status],children:ns[a.status]})]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.buyer_name}),a.buyer_phone&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 text-gray-500 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.buyer_phone})]})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"?"bg-blue-50 border-blue-300":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"bg-green-50 border-green-300":"bg-blue-50 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?e.jsx(Pe,{className:"w-8 h-8 text-blue-600"}):String(a.delivery_type||"").trim().toLowerCase()==="pickup"?e.jsx(xe,{className:"w-8 h-8 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-xl font-bold ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"text-blue-800":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"text-green-800":"text-orange-800"}`,children:String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"SERVICIO A DOMICILIO":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"RECOGER EN TIENDA":"COMER EN EL LUGAR"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["M√©todo de entrega: ",a.delivery_type||"No especificado"]})]})]})}),a.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.delivery_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Productos:"}),a.items.map((m,h)=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsxs("span",{children:[m.quantity,"x ",m.product_name]}),e.jsxs("span",{className:"font-medium",children:["Q",(m.quantity*m.unit_price).toFixed(2)]})]},h))]}),a.notes&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ja,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Notas:"}),e.jsx("p",{className:"text-sm text-blue-700",children:a.notes})]})]})}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["Q",a.total.toFixed(2)]})]}),a.delivery_fee>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Incluye Q",a.delivery_fee.toFixed(2)," de entrega"]})]}),a.driver_name&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Repartidor: ",a.driver_name]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[String(a.status).trim().toLowerCase()==="pending"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:()=>P(a.id),disabled:i.has(a.id),className:"flex-1 bg-green-600 hover:bg-green-700",children:[i.has(a.id)?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Aceptar Orden"]}),e.jsxs(E,{onClick:()=>O(a.id,"No disponible"),disabled:i.has(a.id),variant:"destructive",size:"lg",className:"px-6 bg-red-600 hover:bg-red-700 text-white border-red-600",style:{backgroundColor:"#dc2626",borderColor:"#dc2626"},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})}),a.status==="accepted"&&e.jsxs(E,{onClick:()=>x(a.id),disabled:i.has(a.id),className:"w-full bg-purple-600 hover:bg-purple-700",children:[i.has(a.id)?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Marcar Orden Lista"]}),a.status==="ready"&&e.jsxs("div",{className:"space-y-3",children:[(a.delivery_type==="delivery"||!a.delivery_type)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Orden lista para recoger"}),e.jsx("p",{className:"text-sm text-blue-600",children:"El repartidor recoger√° y entregar√° esta orden"})]})]})}),(a.delivery_type==="pickup"||a.delivery_type==="dine-in")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${a.delivery_type==="pickup"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.delivery_type==="pickup"?e.jsx(xe,{className:"w-6 h-6 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.delivery_type==="pickup"?"text-green-800":"text-orange-800"}`,children:a.delivery_type==="pickup"?"Cliente debe recoger en tienda":"Cliente consume en el lugar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Marcar como entregado cuando el cliente complete la orden"})]})]})}),e.jsxs(E,{onClick:()=>t(a.id),disabled:i.has(a.id),className:"w-full bg-green-600 hover:bg-green-700",children:[i.has(a.id)?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),a.delivery_type==="pickup"?"Marcar como Recogido":"Marcar como Servido"]})]})]}),a.status==="delivered"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:()=>S(a.id,"confirmed"),disabled:d,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[d?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Re-procesar"]}),e.jsxs(E,{onClick:()=>O(a.id,"Orden rechazada"),disabled:d,variant:"destructive",size:"lg",className:"px-6",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})]})]})]},a.id)};return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{className:"border-orange-200 shadow-lg",children:e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-500"}),"Gesti√≥n de √ìrdenes"]}),e.jsxs(E,{variant:"outline",onClick:N,disabled:w,size:"sm",children:[w?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(we,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})})}),e.jsxs(He,{value:R,onValueChange:T,children:[e.jsxs(Qe,{className:"grid w-full grid-cols-4",children:[e.jsxs(je,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Pendientes",I("pending").length>0&&e.jsx(Z,{variant:"destructive",className:"ml-1 px-1.5 py-0.5 text-xs",children:I("pending").length})]}),e.jsxs(je,{value:"active",className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Activas",I("active").length>0&&e.jsx(Z,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:I("active").length})]}),e.jsxs(je,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Completadas"]}),e.jsxs(je,{value:"cancelled",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Canceladas"]})]}),e.jsx(de,{value:"pending",className:"space-y-4",children:I("pending").length===0?e.jsx(B,{children:e.jsxs(Q,{className:"text-center py-8",children:[e.jsx(Se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes pendientes"})]})}):I("pending").map(H)}),e.jsx(de,{value:"active",className:"space-y-4",children:I("active").length===0?e.jsx(B,{children:e.jsxs(Q,{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes activas"})]})}):I("active").map(H)}),e.jsx(de,{value:"completed",className:"space-y-4",children:I("completed").length===0?e.jsx(B,{children:e.jsxs(Q,{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes completadas"})]})}):I("completed").map(H)}),e.jsx(de,{value:"cancelled",className:"space-y-4",children:I("cancelled").length===0?e.jsx(B,{children:e.jsxs(Q,{className:"text-center py-8",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes canceladas"})]})}):I("cancelled").map(H)})]})]})}function La({userRole:s,onVerificationComplete:u}){const{user:r}=he(),[j,g]=c.useState({latitude:null,longitude:null,address:""}),[w,k]=c.useState({latitude:null,longitude:null,address:""}),[i,f]=c.useState({phone:"",profileImage:"",coverImage:"",vehicleType:"",licenseNumber:""}),[R,T]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1}),[U,l]=c.useState(!1),[N,P]=c.useState(!1);c.useEffect(()=>{r&&x()},[r]);const x=async()=>{if(r)try{const{data:n,error:b}=await y.from("users").select("*").eq("id",r.id).single();if(b)throw b;if(n&&(g({latitude:n.latitude,longitude:n.longitude,address:n.address||""}),f({phone:n.phone||"",profileImage:n.profile_image_url||"",coverImage:n.cover_image_url||"",vehicleType:n.vehicle_type||"",licenseNumber:n.license_number||""}),T(C=>({...C,locationVerified:n.location_verified||!1,profileCompleted:n.profile_completed||!1}))),s==="vendedor"){const{data:C,error:$}=await y.from("sellers").select("*").eq("user_id",r.id).single();C&&(k({latitude:C.business_latitude,longitude:C.business_longitude,address:C.business_address||""}),f(q=>({...q,coverImage:C.cover_image_url||""})),T(q=>({...q,businessLocationVerified:C.business_location_verified||!1,canPublish:C.can_publish_products||!1})))}}catch(n){console.error("Error loading user data:",n),D.error("Error al cargar datos del usuario")}},t=async()=>{if(!navigator.geolocation){D.error("Tu navegador no soporta geolocalizaci√≥n");return}P(!0),navigator.geolocation.getCurrentPosition(async n=>{const{latitude:b,longitude:C}=n.coords;try{const $=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${C},${b}.json?access_token=`);if($.ok){const q=await $.json();q.features&&q.features.length>0&&g(Y=>({...Y,latitude:b,longitude:C}))}else g(q=>({...q,latitude:b,longitude:C}));D.success("Ubicaci√≥n obtenida correctamente")}catch($){console.error("Error getting address:",$),g(q=>({...q,latitude:b,longitude:C})),D.success("Ubicaci√≥n obtenida (sin direcci√≥n)")}finally{P(!1)}},n=>{console.error("Geolocation error:",n),P(!1),D.error("No se pudo obtener tu ubicaci√≥n. Verifica los permisos del navegador.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},S=async()=>{if(!r||!j.latitude||!j.longitude){D.error("Primero obt√©n tu ubicaci√≥n");return}l(!0);try{const{error:n}=await y.rpc("update_user_location",{user_id:r.id,lat:j.latitude,lng:j.longitude,user_address:j.address});if(n)throw n;T(b=>({...b,locationVerified:!0})),D.success("Ubicaci√≥n personal verificada"),await I()}catch(n){console.error("Error saving location:",n),D.error("Error al guardar ubicaci√≥n")}finally{l(!1)}},O=async()=>{if(!r||!w.latitude||!w.longitude){D.error("Primero obt√©n la ubicaci√≥n del negocio");return}l(!0);try{const{error:n}=await y.rpc("update_business_location",{seller_user_id:r.id,lat:w.latitude,lng:w.longitude,business_addr:w.address});if(n)throw n;T(b=>({...b,businessLocationVerified:!0})),D.success("Ubicaci√≥n del negocio verificada"),await I()}catch(n){console.error("Error saving business location:",n),D.error("Error al guardar ubicaci√≥n del negocio")}finally{l(!1)}},F=async()=>{if(r){l(!0);try{const n={phone:i.phone,profile_image_url:i.profileImage,updated_at:new Date().toISOString()};s==="repartidor"&&(n.vehicle_type=i.vehicleType,n.license_number=i.licenseNumber);const{error:b}=await y.from("users").update(n).eq("id",r.id);if(b)throw b;if(s==="vendedor"&&i.coverImage){const{error:C}=await y.from("sellers").update({cover_image_url:i.coverImage}).eq("user_id",r.id);if(C)throw C}D.success("Perfil actualizado"),await I()}catch(n){console.error("Error updating profile:",n),D.error("Error al actualizar perfil")}finally{l(!1)}}},I=async()=>{if(r)try{let n=!1;if(s==="vendedor"){const{data:b,error:C}=await y.rpc("check_seller_can_publish",{seller_user_id:r.id});C||(n=b)}else if(s==="comprador"){const{data:b,error:C}=await y.rpc("check_buyer_can_purchase",{buyer_user_id:r.id});C||(n=b)}else if(s==="repartidor"){const{data:b,error:C}=await y.rpc("check_driver_can_work",{driver_user_id:r.id});C||(n=b)}T(b=>({...b,canPublish:s==="vendedor"?n:b.canPublish,canPurchase:s==="comprador"?n:b.canPurchase,canWork:s==="repartidor"?n:b.canWork})),n&&u&&u()}catch(n){console.error("Error checking verification status:",n)}},H=()=>{const n=[{name:"Tel√©fono",completed:!!i.phone,icon:Me},{name:"Ubicaci√≥n verificada",completed:R.locationVerified,icon:ce}];return s==="vendedor"?[...n,{name:"Foto de perfil",completed:!!i.profileImage,icon:ve},{name:"Foto de portada",completed:!!i.coverImage,icon:ve},{name:"Ubicaci√≥n del negocio",completed:R.businessLocationVerified,icon:ce}]:s==="repartidor"?[...n,{name:"Tipo de veh√≠culo",completed:!!i.vehicleType&&i.vehicleType!=="No especificado",icon:Oe},{name:"N√∫mero de licencia",completed:!!i.licenseNumber&&i.licenseNumber!=="No especificado",icon:ve}]:n},a=()=>s==="vendedor"&&R.canPublish?{message:"¬°Puedes publicar productos!",type:"success"}:s==="comprador"&&R.canPurchase?{message:"¬°Puedes realizar compras!",type:"success"}:s==="repartidor"&&R.canWork?{message:"¬°Puedes tomar √≥rdenes!",type:"success"}:{message:"Completa todos los requisitos",type:"warning"},d=H(),m=d.filter(n=>n.completed).length,h=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center space-x-2",children:[h.type==="success"?e.jsx(ne,{className:"w-5 h-5 text-green-500"}):e.jsx(Ce,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{children:"Estado de Verificaci√≥n"})]})}),e.jsx(Q,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${h.type==="success"?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:[e.jsx("p",{className:`font-medium ${h.type==="success"?"text-green-800":"text-orange-800"}`,children:h.message}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[m," de ",d.length," requisitos completados"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:d.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border",children:[e.jsx(n.icon,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:n.name}),n.completed?e.jsx(ne,{className:"w-4 h-4 text-green-500 ml-auto"}):e.jsx(_e,{className:"w-4 h-4 text-red-500 ml-auto"})]},n.name))})]})})]}),e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{children:"Ubicaci√≥n Personal"}),R.locationVerified&&e.jsx(Z,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(Q,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n"}),e.jsx(J,{value:j.address,onChange:n=>g(b=>({...b,address:n.target.value})),placeholder:"Tu direcci√≥n",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(E,{onClick:t,disabled:N,className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50",variant:"outline",style:{borderColor:"#2563eb",color:"#2563eb",backgroundColor:"white",fontWeight:"600"},children:N?"Obteniendo...":"Obtener Ubicaci√≥n Actual"})})]}),j.latitude&&j.longitude&&e.jsx("div",{className:"p-3 bg-gray-50 rounded border",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas: ",j.latitude,", ",j.longitude]})}),e.jsx(E,{onClick:S,disabled:U||!j.latitude||!j.longitude,className:"w-full",children:U?"Guardando...":"Verificar Ubicaci√≥n Personal"})]})]}),s==="vendedor"&&e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Ubicaci√≥n del Negocio"}),R.businessLocationVerified&&e.jsx(Z,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(Q,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n del Negocio"}),e.jsx(J,{value:w.address,onChange:n=>k(b=>({...b,address:n.target.value})),placeholder:"Direcci√≥n de tu negocio",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(E,{onClick:()=>{t(),j.latitude&&j.longitude&&k(n=>({...n,latitude:j.latitude,longitude:j.longitude}))},disabled:N,className:"w-full",variant:"outline",children:"Usar Ubicaci√≥n Actual"})})]}),e.jsx(E,{onClick:O,disabled:U||!w.latitude||!w.longitude,className:"w-full",children:U?"Guardando...":"Verificar Ubicaci√≥n del Negocio"})]})]}),e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{children:"Informaci√≥n del Perfil"})]})}),e.jsxs(Q,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tel√©fono"}),e.jsx(J,{value:i.phone,onChange:n=>f(b=>({...b,phone:n.target.value})),placeholder:"+502 1234-5678",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Perfil"}),e.jsx(J,{value:i.profileImage,onChange:n=>f(b=>({...b,profileImage:n.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="vendedor"&&e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Portada"}),e.jsx(J,{value:i.coverImage,onChange:n=>f(b=>({...b,coverImage:n.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="repartidor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tipo de Veh√≠culo"}),e.jsx(J,{value:i.vehicleType,onChange:n=>f(b=>({...b,vehicleType:n.target.value})),placeholder:"Motocicleta, Autom√≥vil, Bicicleta...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(V,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"N√∫mero de Licencia"}),e.jsx(J,{value:i.licenseNumber,onChange:n=>f(b=>({...b,licenseNumber:n.target.value})),placeholder:"M-123456",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]})]})]}),e.jsx(E,{onClick:F,disabled:U,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold",style:{backgroundColor:"#2563eb",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"600"},children:U?"Actualizando...":"Actualizar Perfil"})]})]})]})}function ks(s){const{user:u}=he(),[r,j]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1,requirements:{phone:!1,profileImage:!1,coverImage:!1,location:!1,businessLocation:!1,vehicleType:!1,licenseNumber:!1,adminApproval:!1}}),[g,w]=c.useState(!0);c.useEffect(()=>{u&&k()},[u,s]);const k=async()=>{if(u)try{w(!0);const{data:l,error:N}=await y.from("users").select("*").eq("id",u.id).single();if(N)throw N;let P=null;if(s==="vendedor"){const{data:S,error:O}=await y.from("sellers").select("*").eq("user_id",u.id).single();O||(P=S)}const x={phone:!!(l.phone&&l.phone.trim()!==""),profileImage:!!(l.profile_image_url&&l.profile_image_url.trim()!==""),coverImage:s==="vendedor"?!!(P!=null&&P.cover_image_url&&P.cover_image_url.trim()!==""):!0,location:!!(l.location_verified&&l.latitude&&l.longitude&&l.address),businessLocation:s==="vendedor"?!!(P!=null&&P.business_location_verified&&P.business_latitude&&P.business_longitude&&P.business_address):!0,vehicleType:s==="repartidor"?!!(l.vehicle_type&&l.vehicle_type!=="No especificado"):!0,licenseNumber:s==="repartidor"?!!(l.license_number&&l.license_number!=="No especificado"):!0,adminApproval:s==="repartidor"?!!(l.is_verified&&l.is_active):!0};let t=!1;if(s==="vendedor"){const{data:S,error:O}=await y.rpc("check_seller_can_publish",{seller_user_id:u.id});O||(t=S)}else if(s==="comprador"){const{data:S,error:O}=await y.rpc("check_buyer_can_purchase",{buyer_user_id:u.id});O||(t=S)}else if(s==="repartidor"){const{data:S,error:O}=await y.rpc("check_driver_can_work",{driver_user_id:u.id});O||(t=S)}j({locationVerified:l.location_verified||!1,businessLocationVerified:(P==null?void 0:P.business_location_verified)||!1,profileCompleted:l.profile_completed||!1,canPublish:s==="vendedor"?t:!1,canPurchase:s==="comprador"?t:!1,canWork:s==="repartidor"?t:!1,requirements:x})}catch(l){console.error("Error checking verification status:",l)}finally{w(!1)}};return{status:r,loading:g,refreshStatus:()=>{k()},getCompletionPercentage:()=>{const l=Object.values(r.requirements).length,N=Object.values(r.requirements).filter(Boolean).length;return Math.round(N/l*100)},getMissingRequirements:()=>{const l=[];return r.requirements.phone||l.push("Tel√©fono"),r.requirements.profileImage||l.push("Foto de perfil"),r.requirements.location||l.push("Ubicaci√≥n verificada"),s==="vendedor"&&(r.requirements.coverImage||l.push("Foto de portada"),r.requirements.businessLocation||l.push("Ubicaci√≥n del negocio")),s==="repartidor"&&(r.requirements.vehicleType||l.push("Tipo de veh√≠culo"),r.requirements.licenseNumber||l.push("N√∫mero de licencia"),r.requirements.adminApproval||l.push("Aprobaci√≥n del administrador")),l},canPerformMainAction:()=>{switch(s){case"vendedor":return r.canPublish;case"comprador":return r.canPurchase;case"repartidor":return r.canWork;default:return!1}},getMainActionText:()=>{switch(s){case"vendedor":return r.canPublish?"Puedes publicar productos":"No puedes publicar productos a√∫n";case"comprador":return r.canPurchase?"Puedes realizar compras":"No puedes comprar a√∫n";case"repartidor":return r.canWork?"Puedes tomar √≥rdenes":"No puedes trabajar a√∫n";default:return""}}}}function Ma({userRole:s,onOpenVerification:u,showIfComplete:r=!1}){const{loading:j,canPerformMainAction:g,getMissingRequirements:w,getCompletionPercentage:k}=ks(s);if(j)return null;const i=g(),f=w(),R=k();if(s==="vendedor"||i&&!r)return null;const T=()=>{switch(s){case"vendedor":return Ke;case"comprador":return ce;case"repartidor":return Pe;default:return Ce}},U=()=>{if(i)switch(s){case"vendedor":return"¬°Perfil completo! Puedes publicar productos";case"comprador":return"¬°Perfil completo! Puedes realizar compras";case"repartidor":return"¬°Perfil completo! Puedes tomar √≥rdenes";default:return"¬°Perfil completo!"}switch(s){case"vendedor":return"Completa tu perfil para publicar productos";case"comprador":return"Completa tu perfil para realizar compras";case"repartidor":return"Completa tu perfil para trabajar como repartidor";default:return"Completa tu perfil"}},l=()=>i?"Tu perfil est√° completamente verificado y puedes usar todas las funciones de TRATO.":f.length===0?"Casi listo, solo faltan algunos detalles por verificar.":f.length===1?`Te falta 1 requisito: ${f[0]}.`:`Te faltan ${f.length} requisitos: ${f.slice(0,2).join(", ")}${f.length>2?" y m√°s...":""}.`,N=T();return e.jsx(me,{className:`verification-alert mb-6 ${i?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 w-full",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(N,{className:`w-6 h-6 flex-shrink-0 mt-1 ${i?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-lg leading-tight ${i?"text-green-800":"text-orange-800"}`,children:U()}),e.jsx(ue,{className:`alert-description mt-1 text-sm ${i?"text-green-700":"text-orange-700"}`,children:l()}),!i&&e.jsxs("div",{className:"verification-progress mt-3 space-y-2",children:[e.jsxs("div",{className:"verification-progress-label flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-orange-800",children:"Progreso del perfil"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[R,"%"]})]}),e.jsx("div",{className:"verification-progress-bar w-full bg-orange-200 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${R}%`}})})]})]})]}),e.jsx("div",{className:"flex justify-center md:justify-end mt-4 md:mt-0 md:ml-4",children:e.jsx(E,{onClick:u,className:`verification-button px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 ${i?"bg-green-500 hover:bg-green-600 hover:shadow-green-200":"bg-orange-500 hover:bg-orange-600 hover:shadow-orange-200"}`,style:{minWidth:"160px",borderRadius:"8px",fontSize:"14px",fontWeight:"600"},children:i?"Ver Estado":"Completar Perfil"})})]})})}function Ra({onDismiss:s}){const{user:u}=he(),{permission:r,requestPermission:j,supported:g}=Ps(),[w,k]=c.useState(!1),[i,f]=c.useState(!1);c.useEffect(()=>{const N=g&&r!=="granted"&&r!=="denied"&&((u==null?void 0:u.role)==="vendedor"||(u==null?void 0:u.role)==="repartidor");f(N)},[g,r,u==null?void 0:u.role]);const R=async()=>{k(!0);try{await j()&&(f(!1),s==null||s())}catch(N){console.error("Error al solicitar permisos:",N)}finally{k(!1)}},T=()=>{f(!1),s==null||s()};if(!i)return null;const l=(()=>{switch(u==null?void 0:u.role){case"vendedor":return{title:"Notificaciones de Nuevas √ìrdenes",description:"Recibe alertas inmediatas cuando lleguen nuevos pedidos, incluso con la pantalla apagada.",benefits:["üì± Notificaciones incluso con pantalla apagada","üîî Alertas sonoras para nuevos pedidos","‚ö° Respuesta m√°s r√°pida a clientes"]};case"repartidor":return{title:"Notificaciones de Entregas",description:"Mantente informado sobre nuevas entregas disponibles y asignaciones.",benefits:["üöõ Alertas de nuevas entregas","üìç Notificaciones de asignaciones","üí∞ No pierdas oportunidades de entrega"]};default:return{title:"Notificaciones Push",description:"Recibe notificaciones importantes de la aplicaci√≥n.",benefits:["üîî Alertas importantes","üì± Notificaciones push","‚ö° Informaci√≥n en tiempo real"]}}})();return e.jsxs(B,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-lg",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(oa,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx(se,{className:"text-lg text-orange-900",children:l.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:l.description})]})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:T,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:e.jsx(Ee,{className:"w-4 h-4"})})]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:l.benefits.map((N,P)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-800",children:[e.jsx(ne,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),N]},P))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{variant:r==="granted"?"default":r==="denied"?"destructive":"secondary",className:"flex items-center gap-1",children:r==="granted"?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-3 h-3"}),"Activadas"]}):r==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-3 h-3"}),"Denegadas"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3"}),"Pendientes"]})}),!g&&e.jsx(Z,{variant:"outline",className:"text-gray-600",children:"No soportadas en este navegador"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(E,{onClick:R,disabled:w||!g||r==="granted",className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",children:w?e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-4 h-4 mr-2 animate-spin"}),"Solicitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Activar Notificaciones"]})}),e.jsx(E,{variant:"outline",onClick:T,className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:"Ahora no"})]}),r==="denied"&&e.jsxs(me,{className:"border-red-200 bg-red-50",children:[e.jsx(Ce,{className:"w-4 h-4 text-red-600"}),e.jsx(ue,{className:"text-red-800 text-sm",children:"Las notificaciones fueron denegadas. Para activarlas, ve a configuraci√≥n del navegador ‚Üí Notificaciones ‚Üí Permitir para este sitio."})]})]})]})}function qa({onPermissionChange:s,userRole:u="buyer",className:r=""}){const[j,g]=c.useState("default"),[w,k]=c.useState(!1);c.useEffect(()=>{"Notification"in window&&g(Notification.permission)},[]);const i=async()=>{if(!("Notification"in window)){alert("Tu navegador no soporta notificaciones");return}if(j!=="granted"){k(!0);try{const f=await Notification.requestPermission();g(f),f==="granted"?(s==null||s(!0),new Notification("¬°TRATO Notificaciones Activas!",{body:"Las notificaciones est√°n funcionando correctamente",icon:"/favicon.ico"})):s==null||s(!1)}catch(f){console.error("Error requesting notification permission:",f)}finally{k(!1)}}};return j==="granted"?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-green-700 ${r}`,children:[e.jsx(ne,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Notificaciones activas"})]}):e.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Configurar Notificaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:j==="denied"?"Notificaciones bloqueadas":"Activa las notificaciones para recibir alertas"})]})]}),j!=="denied"&&e.jsx("button",{onClick:i,disabled:w,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:w?"Activando...":"Activar"})]}),j==="denied"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("p",{className:"text-sm text-red-700",children:'Las notificaciones est√°n bloqueadas. Para activarlas, haz clic en el √≠cono del candado en la barra de direcciones y selecciona "Permitir".'})})]})}function za({onNewOrder:s}){const{user:u}=he(),[r,j]=c.useState({permissions:"default",soundEnabled:!1,realtimeConnected:!1,isListening:!1,orderCount:0,reconnectAttempts:0,lastError:null,lastSuccessfulConnection:null,isReconnecting:!1}),g=c.useRef(null),w=c.useRef(null),k=c.useRef(null),i=c.useRef(null),f=c.useRef(null),R=c.useCallback(async()=>{if(r.soundEnabled)try{g.current||(g.current=new(window.AudioContext||window.webkitAudioContext));const x=g.current;await x.resume();const t=(S,O,F=0)=>{setTimeout(()=>{const I=x.createOscillator(),H=x.createGain();I.connect(H),H.connect(x.destination),I.frequency.setValueAtTime(S,x.currentTime),I.type="sine",H.gain.setValueAtTime(.8,x.currentTime),H.gain.exponentialRampToValueAtTime(.01,x.currentTime+O/1e3),I.start(x.currentTime),I.stop(x.currentTime+O/1e3)},F)};t(800,400,0),t(1e3,400,300),t(1200,600,600),"vibrate"in navigator&&navigator.vibrate([300,100,300,100,500]),console.log("üîä Sonido de nueva orden reproducido")}catch(x){console.warn("Error reproduciendo sonido:",x)}},[r.soundEnabled]),T=c.useCallback(async x=>{if(r.permissions==="granted")try{if(!x||typeof x!="object"){console.warn("‚ö†Ô∏è Datos de orden inv√°lidos:",x);return}const t=x.customer_name||x.buyer_name||"Cliente An√≥nimo",S=x.total||x.total_amount||0,O=typeof S=="number"?S:parseFloat(S)||0,F=x.notes&&typeof x.notes=="string"?` - ${x.notes.substring(0,50)}`:"",I=x.id||`temp-${Date.now()}`,H=new Notification("üõí ¬°NUEVA ORDEN RECIBIDA!",{body:`${t} - Q${O.toFixed(2)}${F}`,icon:"/icon-192x192.png",tag:`order-${I}`,requireInteraction:!0,silent:!1});H.onclick=()=>{window.focus(),H.close(),s&&s(x)},setTimeout(()=>H.close(),15e3),console.log("üîî Notificaci√≥n flotante mostrada correctamente")}catch(t){console.error("‚ùå Error mostrando notificaci√≥n:",t)}},[r.permissions,s]),U=c.useCallback(async x=>{try{const t=x.new||x.data||x;if(!t)return;if(t.status&&t.status!=="pending"&&t.status!=="new"){console.log("üìù Orden no es nueva, es actualizaci√≥n:",t.status);return}j(F=>({...F,orderCount:F.orderCount+1})),await R(),await T(t);const S=t.customer_name||t.buyer_name||"Cliente",O=t.total||t.total_amount||0;D.success("üõí ¬°Nueva Orden!",{description:`${S} - Q${parseFloat(O).toFixed(2)}`,duration:8e3}),s&&s(t),console.log("‚úÖ Procesamiento de nueva orden completado")}catch(t){console.error("‚ùå Error procesando nueva orden:",t)}},[R,T,s]),l=c.useCallback(async()=>{if(!u||u.role!=="vendedor"||r.isReconnecting)return;if((r.lastSuccessfulConnection?Date.now()-r.lastSuccessfulConnection:1/0)<3e4){console.log("‚è±Ô∏è Conexi√≥n muy reciente, evitando reconexi√≥n innecesaria");return}if(r.reconnectAttempts>=3){console.error("‚ùå L√≠mite de reconexi√≥n alcanzado"),j(t=>({...t,lastError:"Conexi√≥n inestable - pausa de 5 min",isReconnecting:!1})),D.error("‚ùå Conexi√≥n inestable",{description:"Sistema pausado por 5 minutos. Revisa tu internet.",duration:15e3}),setTimeout(()=>{j(t=>({...t,reconnectAttempts:0,lastError:"Sistema reiniciado - listo para conectar"}))},3e5);return}j(t=>({...t,isReconnecting:!0,lastError:`Reconectando... (${t.reconnectAttempts+1}/3)`})),console.log(`üîÑ Reconexi√≥n inteligente ${r.reconnectAttempts+1}/3`);try{if(w.current){try{w.current.unsubscribe(),await y.removeChannel(w.current)}catch{}w.current=null}const t=Math.min(5e3*Math.pow(4,r.reconnectAttempts),8e4);console.log(`‚è±Ô∏è Esperando ${t/1e3}s antes de reconectar...`),await new Promise(F=>setTimeout(F,t));const S=`vendor-orders-${u.id}-${Date.now()}`,O=y.channel(S,{config:{presence:{key:u.id},broadcast:{self:!1},private:!0}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${u.id}`},U).subscribe(F=>{console.log("üì° Estado reconexi√≥n:",F),F==="SUBSCRIBED"?(j(I=>({...I,realtimeConnected:!0,isListening:!0,reconnectAttempts:0,lastError:null,isReconnecting:!1,lastSuccessfulConnection:Date.now()})),D.success("‚úÖ Reconectado",{description:"Sistema de notificaciones restaurado"})):(F==="CHANNEL_ERROR"||F==="CLOSED")&&(j(I=>({...I,realtimeConnected:!1,isListening:!1,reconnectAttempts:I.reconnectAttempts+1,lastError:`Error: ${F}`,isReconnecting:!1})),r.reconnectAttempts+1<3&&(f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{l()},15e3)))});w.current=O}catch(t){console.error("‚ùå Error cr√≠tico en reconexi√≥n:",t),j(S=>({...S,reconnectAttempts:S.reconnectAttempts+1,lastError:"Error cr√≠tico de conexi√≥n",isReconnecting:!1}))}},[u,r.reconnectAttempts,r.isReconnecting,r.lastSuccessfulConnection,U]),N=c.useCallback(async()=>{if(!(!u||u.role!=="vendedor"))try{if(console.log("üöÄ Inicializando sistema de notificaciones..."),r.permissions!=="granted"){const x=await Notification.requestPermission();j(t=>({...t,permissions:x}))}if(r.soundEnabled||j(x=>({...x,soundEnabled:!0})),"wakeLock"in navigator&&!k.current)try{k.current=await navigator.wakeLock.request("screen")}catch{}if(!w.current&&!r.isListening){const x=y.channel(`vendor-orders-${u.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${u.id}`},U).subscribe(t=>{console.log("üì° Estado inicial:",t),t==="SUBSCRIBED"?(j(S=>({...S,realtimeConnected:!0,isListening:!0,lastSuccessfulConnection:Date.now(),lastError:null})),D.success("üì° Sistema conectado")):(t==="CHANNEL_ERROR"||t==="CLOSED")&&(console.warn("‚ö†Ô∏è Error inicial, iniciando reconexi√≥n..."),j(S=>({...S,realtimeConnected:!1,isListening:!1})),setTimeout(()=>{l()},3e3))});w.current=x}}catch(x){console.error("Error inicializando:",x),D.error("Error de inicializaci√≥n")}},[u,r.permissions,r.soundEnabled,r.isListening,U,l]);c.useEffect(()=>()=>{w.current&&y.removeChannel(w.current),k.current&&k.current.release(),g.current&&g.current.state!=="closed"&&g.current.close(),i.current&&clearTimeout(i.current),f.current&&clearTimeout(f.current)},[]),c.useEffect(()=>{if((u==null?void 0:u.role)==="vendedor"){const x=setTimeout(N,1e3);return()=>clearTimeout(x)}},[u,N]);const P=()=>{j(x=>({...x,soundEnabled:!x.soundEnabled})),D.success(r.soundEnabled?"üîá Sonidos OFF":"üîä Sonidos ON")};return!u||u.role!=="vendedor"?null:e.jsx(B,{className:"fixed top-4 right-4 w-80 z-50 shadow-lg border-orange-200",children:e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-semibold text-sm",children:"Notificaciones"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{variant:r.isListening?"default":"destructive",className:"text-xs",children:r.isListening?"Activo":"Inactivo"}),r.isReconnecting&&e.jsx(Z,{variant:"secondary",className:"text-xs animate-pulse",children:"Conectando..."})]})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Permisos:"}),e.jsx(Z,{variant:r.permissions==="granted"?"default":"destructive",children:r.permissions==="granted"?"‚úÖ":"‚ùå"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Realtime:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{variant:r.realtimeConnected?"default":"destructive",children:r.realtimeConnected?"üü¢":"üî¥"}),r.reconnectAttempts>0&&e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[r.reconnectAttempts,"/3"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"√ìrdenes:"}),e.jsx(Z,{children:r.orderCount})]}),r.lastError&&e.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded text-xs",children:[e.jsx("span",{className:"text-amber-700 font-medium",children:"Estado:"}),e.jsx("p",{className:"text-amber-600",children:r.lastError})]})]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx(E,{size:"sm",variant:"outline",onClick:P,className:"w-full",children:r.soundEnabled?e.jsxs(e.Fragment,{children:[e.jsx(Ts,{className:"w-3 h-3 mr-1"}),"Sonidos ON"]}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"w-3 h-3 mr-1"}),"Sonidos OFF"]})})})]})})}function br(){const{user:s,signOut:u}=he(),{canPerformMainAction:r,refreshStatus:j}=ks("vendedor"),[g,w]=c.useState("dashboard"),[k,i]=c.useState("list"),[f,R]=c.useState([]),[T,U]=c.useState([]),[l,N]=c.useState(!0),[P,x]=c.useState(""),[t,S]=c.useState(0),[O,F]=c.useState(""),[I,H]=c.useState([]),[a,d]=c.useState(null),[m,h]=c.useState(null),[n,b]=c.useState(!1),[C,$]=c.useState({totalProducts:0,dailyProducts:0,totalViews:0,totalSales:0,revenue:0,avgRating:0});c.useEffect(()=>{s&&(q(),Y(),ae(),be(),_(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(p=>{console.log(`üîî Permisos de notificaci√≥n: ${p}`),p==="granted"?console.log("‚úÖ Notificaciones habilitadas para nuevos pedidos"):console.warn("‚ö†Ô∏è Notificaciones bloqueadas - solo sonido y alertas visuales")}))},[s]),c.useEffect(()=>{const p=setInterval(()=>{(g==="dashboard"||g==="products")&&Y()},6e4);return()=>clearInterval(p)},[g]);const q=async()=>{try{const{data:p,error:z}=await y.from("products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(z)throw z;R(p||[])}catch(p){console.error("Error loading products:",p),x("Error al cargar productos")}},Y=async()=>{try{const{data:p,error:z}=await y.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(z)throw z;U(p||[])}catch(p){console.error("Error loading daily products:",p),x("Error al cargar productos del d√≠a")}finally{N(!1)}},ae=async()=>{try{const p=f.length,z=T.length;let L=0,K=0,v=0;try{const{data:o,error:A}=await y.from("orders").select("id").limit(1);if(A)console.log("Orders table not available yet, using default stats");else{const{data:M,error:G}=await y.from("orders").select("id, total, status, created_at").eq("seller_id",s==null?void 0:s.id);!G&&M&&(L=M.length,K=M.filter(W=>W.status==="delivered").reduce((W,X)=>W+(X.total||0),0),console.log(`Loaded ${L} orders, revenue: Q${K}`));try{const{data:W,error:X}=await y.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s==null?void 0:s.id).single();!X&&W?(v=W.average_rating||0,console.log(`üåü Seller rating: ${v} from ${W.total_reviews} reviews`)):console.log("No ratings found for seller, showing 0.0")}catch{console.log("Rating system not available, using 0.0")}}}catch{console.log("Orders system not configured yet, using default stats")}$({totalProducts:p,dailyProducts:z,totalViews:Math.floor(Math.random()*1e3)+500,totalSales:L,revenue:K,avgRating:v})}catch(p){console.error("Error loading stats:",p),$({totalProducts:f.length,dailyProducts:T.length,totalViews:0,totalSales:0,revenue:0,avgRating:0})}},ge=()=>{q(),be(),i("list")},ye=()=>{Y(),be(),i("list")},Te=p=>{d(p),i("edit-product")},qe=p=>{h(p),i("edit-daily")},ze=()=>{q(),d(null),i("list")},Fe=()=>{Y(),h(null),i("list")},Ue=async p=>{try{const{error:z}=await y.from("products").delete().eq("id",p);if(z)throw z;q()}catch(z){console.error("Error deleting product:",z),x("Error al eliminar producto")}},Ie=async p=>{try{const{error:z}=await y.from("daily_products").delete().eq("id",p);if(z)throw z;Y()}catch(z){console.error("Error deleting daily product:",z),x("Error al eliminar producto del d√≠a")}},_=c.useCallback(async()=>{if(s!=null&&s.id)try{const p=y.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},z=>{console.log("üîî Nueva orden recibida:",z),S(o=>o+1);const L=z.new,K=new CustomEvent("criticalNotification",{detail:{type:"new_order",message:`üéØ NUEVA ORDEN: Q${L.total||"0.00"} - ${L.notes||"Sin notas"}`,urgency:"high",sound:!0,persist:!0,metadata:{order_id:L.id,total:L.total,buyer_name:L.buyer_name,created_at:L.created_at}}});window.dispatchEvent(K),Notification.permission==="granted"&&new Notification("¬°Nueva orden en TRATO!",{body:`Tienes un nuevo pedido por Q${L.total||"0.00"}`,icon:"/favicon.ico",tag:"new-order",requireInteraction:!0}),(async()=>{try{await y.from("critical_alerts").insert({alert_type:"new_order",order_id:L.id,user_id:s==null?void 0:s.id,message:`Nueva orden recibida: Q${L.total||"0.00"}`,urgency_level:"high",metadata:{total:L.total,buyer_name:L.buyer_name,notification_sent:!0}})}catch(o){console.error("Error logging critical alert:",o)}})(),F(new Date().toISOString())}).subscribe();if(Notification.permission==="default"){const z=await Notification.requestPermission();console.log("Notification permission:",z)}return()=>{p.unsubscribe()}}catch(p){console.error("Error setting up order notifications:",p)}},[s==null?void 0:s.id]),ee=c.useCallback(async()=>{if(s!=null&&s.id)try{const{data:p,error:z}=await y.from("orders").select("id").limit(1);if(!z){const L=new Date().toISOString(),K=`seller_last_notification_${s.id}`,v=localStorage.getItem(K);if(v){const{data:o,error:A}=await y.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).gt("created_at",v).order("created_at",{ascending:!1});!A&&o&&o.length>0&&(S(M=>M+o.length),localStorage.setItem(K,L),console.log(`üì¶ Found ${o.length} new orders since ${v}`))}else{const{data:o,error:A}=await y.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).eq("status","pending").order("created_at",{ascending:!1});!A&&o&&o.length>0&&(S(o.length),console.log(`üì¶ Found ${o.length} pending orders (first check)`)),localStorage.setItem(K,L)}}}catch(p){console.log("üì¶ Orders table not available for notifications:",p)}},[s==null?void 0:s.id]);c.useEffect(()=>{if(!(s!=null&&s.id))return;ee();const p=setInterval(()=>{ee()},3e4);return()=>clearInterval(p)},[s==null?void 0:s.id]);const be=async()=>{try{const p=[];if(f.length>0){const L=f[0];p.push({id:`product-${L.id}`,type:"product",message:`Producto agregado: "${L.name}"`,timestamp:L.created_at,color:"green"})}if(T.length>0){const L=T[0];p.push({id:`daily-${L.id}`,type:"daily_product",message:`Venta del d√≠a creada: "${L.name}"`,timestamp:L.created_at,color:"orange"})}try{const{data:L,error:K}=await y.from("orders").select("id").limit(1);if(!K){const{data:v,error:o}=await y.from("orders").select("id, status, created_at, total").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1}).limit(3);!o&&v&&v.length>0&&v.forEach(A=>{let M="",G="blue";switch(A.status){case"pending":M=`Nueva orden recibida (Q${A.total})`,G="yellow";break;case"confirmed":M=`Orden confirmada (Q${A.total})`,G="blue";break;case"preparing":M=`Orden en preparaci√≥n (Q${A.total})`,G="orange";break;case"ready":M=`Orden lista (Q${A.total})`,G="purple";break;case"delivered":M=`Orden entregada (Q${A.total})`,G="green";break;case"cancelled":M=`Orden cancelada (Q${A.total})`,G="red";break;default:M=`Orden ${A.status} (Q${A.total})`,G="blue"}p.push({id:`order-${A.id}`,type:"order",message:M,timestamp:A.created_at,color:G})})}}catch{console.log("Orders table not available for activity")}const z=p.sort((L,K)=>new Date(K.timestamp).getTime()-new Date(L.timestamp).getTime()).slice(0,5);H(z)}catch(p){console.error("Error loading recent activity:",p)}},Ve=p=>{const z=new Date().getTime(),L=new Date(p).getTime(),K=z-L,v=Math.floor(K/(1e3*60)),o=Math.floor(K/(1e3*60*60)),A=Math.floor(K/(1e3*60*60*24));return v<60?v<=1?"Hace un momento":`Hace ${v} minutos`:o<24?o===1?"Hace 1 hora":`Hace ${o} horas`:A===1?"Ayer":`Hace ${A} d√≠as`},Ge=()=>{const p=new Date,z=new Date;z.setHours(23,59,59,999);const L=z.getTime()-p.getTime(),K=Math.floor(L/(1e3*60*60)),v=Math.floor(L%(1e3*60*60)/(1e3*60));return`${K}h ${v}m`},ke=[{id:"dashboard",label:"Inicio",icon:Zs,description:"Resumen y estad√≠sticas"},{id:"products",label:"Productos",icon:ta,description:"Gestiona tu men√∫"},{id:"orders",label:"Pedidos",icon:ma,description:"√ìrdenes y analytics",hasNotification:t>0,notificationCount:t},{id:"profile",label:"Perfil",icon:Ke,description:"Configuraci√≥n del negocio"}],Ae=()=>e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(B,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dashboard-welcome",style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",color:"white",padding:"24px",borderRadius:"16px",marginBottom:"16px"},children:e.jsx(ie,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-2 md:p-3 rounded-xl",children:e.jsx(Ne,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(se,{className:"text-lg md:text-2xl text-white leading-tight",style:{color:"white",fontSize:"20px"},children:"¬°Bienvenido, Interlano Fernando Interiano! üëã"}),e.jsx("p",{className:"text-sm md:text-base text-white mt-1",style:{color:"white",fontSize:"16px"},children:"Gestiona tu negocio y conecta con m√°s clientes en Gual√°n"})]})]})})}),e.jsxs("div",{className:"dashboard-stats",style:{display:"grid",gridTemplateColumns:window.innerWidth<=768?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:"12px",marginBottom:"16px"},children:[e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(Q,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Productos"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:C.totalProducts})]}),e.jsx(xe,{className:"w-6 h-6 md:w-8 md:h-8 text-blue-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(Q,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas del D√≠a"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:C.dailyProducts})]}),e.jsx(re,{className:"w-6 h-6 md:w-8 md:h-8 text-orange-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(Q,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:C.totalSales})]}),e.jsx(Ms,{className:"w-6 h-6 md:w-8 md:h-8 text-green-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(Q,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Calificaci√≥n"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:C.avgRating.toFixed(1)})]}),e.jsx(ia,{className:"w-6 h-6 md:w-8 md:h-8 text-yellow-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-green-500"}),"Ingresos del Mes"]})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["Q",C.revenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"+12% comparado al mes pasado"})]})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(ca,{className:"w-5 h-5 text-blue-500"}),"Vistas del Perfil"]})}),e.jsxs(Q,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:C.totalViews.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vistas esta semana"})]})]})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsx(se,{children:"Acciones R√°pidas"})}),e.jsx(Q,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(E,{onClick:()=>{if(!r()){b(!0);return}w("products"),i("add-product")},className:"h-20 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Nuevo Producto"})]})}),e.jsx(E,{onClick:()=>{if(!r()){b(!0);return}w("products"),i("add-daily")},variant:"outline",className:"h-20 border-orange-500 text-orange-600 hover:bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Venta del D√≠a"})]})}),e.jsx(E,{onClick:()=>w("profile"),variant:"outline",className:"h-20 border-blue-500 text-blue-600 hover:bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ne,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Editar Perfil"})]})})]})})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Actividad Reciente"]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-3",children:I.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay actividad reciente"})]}):I.map(p=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-${p.color}-50 rounded-lg`,children:[e.jsx("div",{className:`w-2 h-2 bg-${p.color}-500 rounded-full`}),e.jsx("p",{className:"text-sm flex-1",children:p.message}),e.jsx("span",{className:"text-xs text-gray-500",children:Ve(p.timestamp)})]},p.id))})})]})]}),$e=()=>k==="add-product"?e.jsx(rs,{onSuccess:ge,onCancel:()=>i("list")}):k==="add-daily"?e.jsx(ts,{onSuccess:ye,onCancel:()=>i("list")}):k==="edit-product"&&a?e.jsx(rs,{product:a,onSuccess:ze,onCancel:()=>{d(null),i("list")}}):k==="edit-daily"&&m?e.jsx(ts,{dailyProduct:m,onSuccess:Fe,onCancel:()=>{h(null),i("list")}}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 leading-tight",children:"Gesti√≥n de Productos"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Administra tu men√∫ y ofertas especiales"})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[e.jsxs(E,{onClick:()=>i("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),e.jsxs(E,{onClick:()=>i("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Venta del D√≠a"]})]})]}),e.jsxs(He,{defaultValue:"products",className:"space-y-6",children:[e.jsxs(Qe,{className:"grid w-full grid-cols-2 h-auto p-1 bg-gray-100 rounded-lg",children:[e.jsxs(je,{value:"products",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(xe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos Normales"}),e.jsx("span",{className:"sm:hidden",children:"Normales"}),e.jsxs("span",{className:"ml-1",children:["(",f.length,")"]})]}),e.jsxs(je,{value:"daily",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(re,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos del D√≠a"}),e.jsx("span",{className:"sm:hidden",children:"Del D√≠a"}),e.jsxs("span",{className:"ml-1",children:["(",T.length,")"]})]})]}),e.jsx(de,{value:"products",className:"space-y-4",children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-gray-400"})}):f.length===0?e.jsx(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(Q,{className:"p-8 md:p-12 text-center",children:[e.jsx(xe,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos a√∫n"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Comienza agregando tu primer producto para empezar a vender"}),e.jsxs(E,{onClick:()=>i("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Agregar Primer Producto"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:f.map(p=>e.jsx(ya,{product:p,onEdit:Te,onDelete:Ue},p.id))})}),e.jsxs(de,{value:"daily",className:"space-y-4",children:[T.length>0&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-orange-800 text-sm sm:text-base",children:"Tiempo restante:"})]}),e.jsx("span",{className:"font-bold text-orange-800 text-sm sm:text-base",children:Ge()})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Los productos del d√≠a se eliminan autom√°ticamente a las 23:59:59"})]}),l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-gray-400"})}):T.length===0?e.jsx(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(Q,{className:"p-8 md:p-12 text-center",children:[e.jsx(re,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos del d√≠a"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Crea ofertas especiales que duran solo hasta medianoche"}),e.jsxs(E,{onClick:()=>i("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Crear Venta del D√≠a"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:T.map(p=>e.jsx(wa,{dailyProduct:p,onEdit:qe,onDelete:Ie},p.id))})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx(za,{onNewOrder:p=>{console.log("üõí Nueva orden recibida en dashboard:",p)}}),e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx(qa,{onPermissionChange:p=>{console.log("üîî Permisos de notificaci√≥n cambiados:",p)}})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"TRATO Vendedor"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Panel de control empresarial"})]})]}),e.jsxs(E,{variant:"outline",onClick:u,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(ra,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar Sesi√≥n"}),e.jsx("span",{className:"sm:hidden",children:"Salir"})]})]})})}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[P&&e.jsxs(me,{variant:"destructive",className:"mb-4 md:mb-6",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-sm md:text-base",children:P})]}),e.jsx(Ma,{userRole:"vendedor",onOpenVerification:()=>b(!0)}),e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(Ra,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-4 gap-1",children:ke.map(p=>{const z=p.icon,L=g===p.id;return e.jsxs("button",{onClick:()=>{w(p.id),p.id==="orders"&&S(0)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:L?"#fef3c7":"transparent",color:L?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"w-5 h-5"}),p.hasNotification&&p.notificationCount&&p.notificationCount>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#ef4444",color:"white",fontSize:"10px",borderRadius:"50%",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 2s infinite"},children:p.notificationCount>9?"9+":p.notificationCount})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:p.label})]},p.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(He,{value:g,onValueChange:p=>w(p),className:"space-y-6",children:[e.jsx(Qe,{className:"grid w-full grid-cols-4 lg:w-2/3 mx-auto bg-white border border-gray-200",children:ke.map(p=>{const z=p.icon;return e.jsxs(je,{value:p.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",onClick:()=>{p.id==="orders"&&S(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"w-5 h-5"}),p.hasNotification&&p.notificationCount&&p.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:p.notificationCount>9?"9+":p.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:p.label})]},p.id)})}),e.jsx(de,{value:"dashboard",className:"space-y-6",children:Ae()}),e.jsx(de,{value:"products",className:"space-y-6",children:$e()}),e.jsx(de,{value:"orders",className:"space-y-6",children:e.jsx(os,{})}),e.jsx(de,{value:"profile",className:"space-y-6",children:e.jsx(is,{})})]})}),e.jsxs("div",{className:"block md:hidden mt-4",children:[g==="dashboard"&&Ae(),g==="products"&&$e(),g==="orders"&&e.jsx(os,{}),g==="profile"&&e.jsx(is,{})]})]}),e.jsx(As,{open:n,onOpenChange:b,children:e.jsxs($s,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ds,{children:e.jsxs(Os,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Verificaci√≥n de Perfil y Ubicaci√≥n"})]})}),e.jsx(La,{userRole:"vendedor",onVerificationComplete:()=>{b(!1),j()}})]})}),e.jsx(Xs,{}),e.jsx(Ls,{onNewOrder:()=>{g==="orders"&&window.location.reload()}})]})}export{br as SellerDashboard};
