import{u as E,r as x,j as e,C as d,c as m,d as R,B as t,a as L,b as F,R as y}from"./index-BjTbJZtF.js";import{I as h}from"./input-D4_EB-GG.js";import{T as q}from"./textarea-Cxpk2vcf.js";import{L as n}from"./label-CXPGU4I2.js";import{A as z,a as A}from"./alert-C-E6eydX.js";import{S as k,a as P,b as I,c as B,d as p}from"./select-BI5i3ZH_.js";import{T as w}from"./triangle-alert-KLVDszTy.js";import{L as O}from"./log-out-DnUIte8z.js";import{T as b}from"./trash-2-2dLpYzuK.js";import{U as V}from"./user-CeFocL-y.js";import{S as M}from"./save-GgqkRAMS.js";import{T as H}from"./truck-BrXFQt59.js";import{S as U}from"./store-CbsGE8e6.js";import{S as $}from"./shopping-bag-DEKdHDBx.js";function le(){const{orphanedUser:u,createMissingProfile:C,signOut:N,loading:v}=E(),[l,S]=x.useState(null),[r,o]=x.useState({name:"",phone:"",businessName:"",businessDescription:"",vehicleType:"",licenseNumber:""}),[j,c]=x.useState(""),[a,f]=x.useState(!1),T=async s=>{if(s.preventDefault(),c(""),!l){c("Por favor selecciona tu rol");return}if(!r.name.trim()){c("El nombre es requerido");return}if(l==="vendedor"&&!r.businessName.trim()){c("El nombre del negocio es requerido para vendedores");return}if(l==="repartidor"&&(!r.vehicleType||!r.licenseNumber.trim())){c("El tipo de veh√≠culo y n√∫mero de licencia son requeridos para repartidores");return}f(!0);try{const i=await C({name:r.name,role:l,phone:r.phone,businessName:r.businessName,businessDescription:r.businessDescription,vehicleType:r.vehicleType,licenseNumber:r.licenseNumber});i.success||c(i.error||"Error al crear el perfil")}catch(i){console.error("Error during profile recovery:",i),c("Ocurri√≥ un error inesperado al recuperar el perfil")}finally{f(!1)}},g=async()=>{try{localStorage.clear(),sessionStorage.clear(),await N(),window.location.reload()}catch(s){console.error("Error during emergency sign out:",s),window.location.reload()}},D=s=>{switch(s){case"comprador":return{title:"Comprador",icon:e.jsx($,{className:"w-5 h-5"}),description:"Descubre y compra productos locales",color:"from-blue-500 to-blue-600"};case"vendedor":return{title:"Vendedor",icon:e.jsx(U,{className:"w-5 h-5"}),description:"Vende tus productos y haz crecer tu negocio",color:"from-green-500 to-green-600"};case"repartidor":return{title:"Repartidor",icon:e.jsx(H,{className:"w-5 h-5"}),description:"Genera ingresos entregando pedidos",color:"from-orange-500 to-orange-600"}}};return u?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 to-orange-50",children:[e.jsx("div",{className:"bg-white border-b border-yellow-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-500 p-2 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Recuperaci√≥n de Perfil"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Completa tu perfil para continuar"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{variant:"outline",onClick:N,className:"text-gray-600 border-gray-300",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Cerrar Sesi√≥n"]}),e.jsxs(t,{variant:"outline",onClick:g,className:"text-red-600 border-red-200 hover:bg-red-50",disabled:a,children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Limpiar Todo"]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsx(d,{className:"mb-6 border-yellow-200",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx(V,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"¬øQu√© est√° pasando?"}),e.jsxs("p",{className:"text-gray-700 mb-3",children:["Tu cuenta ",e.jsxs("strong",{children:["(",u==null?void 0:u.email,")"]})," est√° autenticada pero necesita completar la informaci√≥n del perfil. Esto puede pasar si:"]}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-4",children:[e.jsx("li",{children:"‚Ä¢ Te registraste antes de que la base de datos estuviera configurada"}),e.jsx("li",{children:"‚Ä¢ Hubo un error durante el registro inicial"}),e.jsx("li",{children:"‚Ä¢ Tu perfil se perdi√≥ por una actualizaci√≥n del sistema"}),e.jsx("li",{children:"‚Ä¢ La tabla 'users' no existe en la base de datos"})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Soluci√≥n:"}),' Completa la informaci√≥n abajo para recuperar tu cuenta, o usa "Limpiar Todo" para empezar completamente de nuevo.']})})]})]})})}),e.jsx(d,{className:"mb-6 border-red-200",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-800",children:"¬øNo funciona la recuperaci√≥n?"}),e.jsx("p",{className:"text-sm text-red-600",children:"Si hay problemas con la base de datos, puedes limpiar todo y empezar de nuevo."})]}),e.jsxs(t,{variant:"destructive",onClick:g,disabled:a,size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Limpiar y Reiniciar"]})]})})}),e.jsxs(d,{children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Completar Perfil"]})}),e.jsx(m,{children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{children:"Selecciona tu rol *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:["comprador","vendedor","repartidor"].map(s=>{const i=D(s);return e.jsx(d,{className:`cursor-pointer transition-all border-2 ${l===s?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>S(s),children:e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:`bg-gradient-to-r ${i.color} p-3 rounded-full w-12 h-12 mx-auto mb-3`,children:e.jsx("div",{className:"text-white",children:i.icon})}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:i.title}),e.jsx("p",{className:"text-xs text-gray-600",children:i.description})]})},s)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Nombre completo *"}),e.jsx(h,{id:"name",value:r.name,onChange:s=>o({...r,name:s.target.value}),placeholder:"Tu nombre completo",required:!0,disabled:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Tel√©fono"}),e.jsx(h,{id:"phone",type:"tel",value:r.phone,onChange:s=>o({...r,phone:s.target.value}),placeholder:"+502 1234-5678",disabled:a})]})]}),l==="vendedor"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"businessName",children:"Nombre del negocio *"}),e.jsx(h,{id:"businessName",value:r.businessName,onChange:s=>o({...r,businessName:s.target.value}),placeholder:"Nombre de tu negocio",required:!0,disabled:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"businessDescription",children:"Descripci√≥n del negocio"}),e.jsx(q,{id:"businessDescription",value:r.businessDescription,onChange:s=>o({...r,businessDescription:s.target.value}),placeholder:"Describe tu negocio y productos",rows:3,disabled:a})]})]}),l==="repartidor"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"vehicleType",children:"Tipo de veh√≠culo *"}),e.jsxs(k,{onValueChange:s=>o({...r,vehicleType:s}),disabled:a,children:[e.jsx(P,{children:e.jsx(I,{placeholder:"Selecciona tu veh√≠culo"})}),e.jsxs(B,{children:[e.jsx(p,{value:"bicicleta",children:"üö≤ Bicicleta"}),e.jsx(p,{value:"motocicleta",children:"üèçÔ∏è Motocicleta"}),e.jsx(p,{value:"carro",children:"üöó Carro"}),e.jsx(p,{value:"camioneta",children:"üöö Camioneta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"licenseNumber",children:"N√∫mero de licencia *"}),e.jsx(h,{id:"licenseNumber",value:r.licenseNumber,onChange:s=>o({...r,licenseNumber:s.target.value}),placeholder:"N√∫mero de licencia de conducir",required:!0,disabled:a})]})]}),j&&e.jsxs(z,{variant:"destructive",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsxs(A,{children:[j,j.includes("table")&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 rounded",children:e.jsxs("p",{className:"text-xs text-red-700",children:[e.jsx("strong",{children:"Sugerencia:"}),' Parece que la base de datos no est√° configurada. Usa "Limpiar Todo" y luego configura Supabase siguiendo las instrucciones.']})})]})]}),e.jsx(t,{type:"submit",disabled:v||a,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",size:"lg",children:v||a?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2 animate-spin"}),"Recuperando perfil..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Recuperar Mi Cuenta"]})})]})})]}),e.jsxs("div",{className:"mt-6 text-center space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"¬øPrefieres empezar completamente desde cero?"}),e.jsxs(t,{variant:"outline",onClick:g,className:"text-red-600 border-red-300 hover:bg-red-50",disabled:a,children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Eliminar Cuenta y Empezar de Nuevo"]})]}),e.jsx("div",{className:"text-xs text-gray-500 max-w-md mx-auto",children:e.jsx("p",{children:'Al hacer clic en "Limpiar Todo" se eliminar√° toda la informaci√≥n de sesi√≥n y podr√°s registrarte nuevamente desde cero.'})})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center",children:e.jsx(d,{className:"w-full max-w-md",children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full w-16 h-16 mx-auto mb-6",children:e.jsx(R,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No se detect√≥ usuario hu√©rfano"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No hay informaci√≥n de usuario autenticado para recuperar."}),e.jsx(t,{onClick:()=>window.location.reload(),children:"Recargar Aplicaci√≥n"})]})})})}export{le as ProfileRecovery};
