import{g as ge,u as xe,r as m,j as e,B as k,C as W,a as te,b as X,c as B,X as Ce,L as oe,f as se,d as we,s as w,i as os,I as Le,E as Es,q as ls,e as ie,v as cs,t as z,R as Ne,N as Ps,p as ds,w as Ts,x as Is,y as As,z as Ds}from"./index-u8vAgmjF.js";import{A as de,a as me}from"./alert-HtrYg_mu.js";import{P as ue,D as Qe,T as He,a as Je,b as he,d as ce,N as Os,M as $s,c as Ms}from"./NotificationSystem-DapRT9yU.js";import{I as H}from"./input-DmLNYdwZ.js";import{T as Ze}from"./textarea-irWv1OP5.js";import{L as F}from"./label-D8XzBPsc.js";import{S as Ls,a as qs,b as Rs,c as zs,d as Fs}from"./select-ERGZIR5W.js";import{A as ms}from"./arrow-left-GdfI3wFS.js";import{U as us}from"./upload-D_ekdbrf.js";import{S as Re}from"./save-Bjt7eJzQ.js";import{C as ae}from"./clock-vEA5kH2y.js";import{a as gs,F as Us,g as Vs,f as Gs,S as Ws,B as Bs,R as Hs,u as Js,T as Qs,H as Zs,O as Ks,P as We}from"./TimeoutAlerts-B3bK-lGy.js";import{A as xs,a as ps,b as hs,c as fs,d as bs,e as js,f as vs,g as Ns,h as ys}from"./alert-dialog-vtj2ql1Z.js";import{E as Ys}from"./eye-off-BOm9pXnX.js";import{T as ws}from"./trash-2-CSi994Md.js";import{C as Xs,a as fe,P as qe,M as ea,N as Me,b as sa}from"./CriticalNotifications-B0vcEQZO.js";import{S as be}from"./store-Bxx5et7U.js";import{I as es}from"./info-DLXqeSRm.js";import{M as le}from"./map-pin-ok09ZdQZ.js";import{T as Ee}from"./truck-ClKel8sK.js";import{M as aa}from"./mail-Bkri-hs7.js";import{G as ss}from"./globe-Ba0640nm.js";import{T as _e}from"./triangle-alert-Bdv5VT5P.js";import{C as ye}from"./circle-x-DNasVzMJ.js";import{E as ra}from"./external-link-DEiA2Ppc.js";import{U as Ke}from"./user-Cv90ZORD.js";import{L as ta}from"./log-out-CMKLvwRy.js";import{S as ia}from"./shopping-bag-BAktL79I.js";import{S as na}from"./star-yJvYdeg8.js";import"./shopping-cart-CTfJLhck.js";import"./users-DFvmLCit.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],la=ge("bell-ring",oa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],da=ge("chart-column",ca);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ua=ge("clipboard-list",ma);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],xa=ge("facebook",ga);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],_s=ge("hash",pa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ss=ge("image",ha);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],ba=ge("instagram",fa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],va=ge("message-square",ja);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ye=ge("pen",Na),ya=["Alimentos","Bebidas","Ropa","Electr√≥nicos","Hogar","Belleza","Deportes","Libros","Juguetes","Mascotas","Salud","Herramientas","Jard√≠n","M√∫sica","Arte","Otros"];function as({product:s,onSuccess:f,onCancel:g}){const{user:j}=xe(),[x,S]=m.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.category)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||"",is_public:(s==null?void 0:s.is_public)!==!1}),[b,r]=m.useState(null),[l,$]=m.useState((s==null?void 0:s.image_url)||""),[A,L]=m.useState(!1),[i,v]=m.useState(!1),[E,C]=m.useState(""),N=m.useRef(null),P=a=>{var d;const c=(d=a.target.files)==null?void 0:d[0];if(c){if(!c.type.startsWith("image/")){C("Por favor selecciona una imagen v√°lida");return}if(c.size>5*1024*1024){C("La imagen debe ser menor a 5MB");return}r(c),C("");const p=new FileReader;p.onload=t=>{var h;$((h=t.target)==null?void 0:h.result)},p.readAsDataURL(c)}},U=async a=>{var c;v(!0);try{const{data:{session:d}}=await w.auth.getSession();if(!((c=d==null?void 0:d.user)!=null&&c.id))throw new Error("No autorizado - sesi√≥n inv√°lida");const p=a.name.split(".").pop(),h=`products/${`${d.user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${p}`}`;for(let _=0;_<3;_++)try{const{error:D}=await w.storage.from("products").upload(h,a,{cacheControl:"3600",upsert:!0});if(D){if(D.message.includes("JWT")||D.message.includes("token")){await w.auth.refreshSession();continue}throw D}const{data:q}=w.storage.from("products").getPublicUrl(h);if(!q.publicUrl)throw new Error("No se pudo obtener la URL p√∫blica");return q.publicUrl}catch(D){if(_===2)throw D;await new Promise(q=>setTimeout(q,1e3));continue}throw new Error("No se pudo subir la imagen despu√©s de 3 intentos")}catch(d){throw console.error("Error uploading image:",d),new Error("Error al subir la imagen: "+d.message)}finally{v(!1)}},Z=async a=>{try{const c=a.split("/"),d=c[c.length-3],p=c[c.length-2],t=c[c.length-1],h=`${p}/${t}`;d==="products"&&await w.storage.from("products").remove([h])}catch(c){console.error("Error deleting old image:",c)}},V=async a=>{if(a.preventDefault(),C(""),!x.name.trim()){C("El nombre del producto es requerido");return}if(!x.price||parseFloat(x.price.toString())<=0){C("El precio debe ser mayor a 0");return}if(!x.category){C("Selecciona una categor√≠a");return}if(!x.stock_quantity||parseInt(x.stock_quantity.toString())<0){C("La cantidad debe ser mayor a 0");return}if(!s&&!b&&!l){C("Selecciona una imagen para el producto");return}L(!0);try{let c=(s==null?void 0:s.image_url)||"";b&&(c=await U(b),s!=null&&s.image_url&&await Z(s.image_url));const d={name:x.name.trim(),description:x.description.trim(),price:parseFloat(x.price.toString())||0,category:x.category,stock_quantity:parseInt(x.stock_quantity.toString())||1,is_public:x.is_public,image_url:c,seller_id:j==null?void 0:j.id};if(s){const{error:p}=await w.from("products").update(d).eq("id",s.id);if(p)throw p}else{const{error:p}=await w.from("products").insert([d]);if(p)throw p}f()}catch(c){console.error("Error saving product:",c),C(c.message||"Error al guardar el producto")}finally{L(!1)}},J=()=>{r(null),$(""),N.current&&(N.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:g,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(ue,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto":"Agregar Producto"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica la informaci√≥n de tu producto":"Crea un nuevo producto para tu tienda"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(W,{children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"Informaci√≥n del Producto"]})}),e.jsx(B,{children:e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"Imagen del Producto *"}),l?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:J,children:e.jsx(Ce,{className:"w-4 h-4"})}),i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-500 transition-colors",onClick:()=>{var a;return(a=N.current)==null?void 0:a.click()},children:[e.jsx(Ss,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, WEBP hasta 5MB"})]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:P,className:"hidden"}),!l&&e.jsxs(k,{type:"button",variant:"outline",onClick:()=>{var a;return(a=N.current)==null?void 0:a.click()},className:"w-full",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:x.name,onChange:a=>S({...x,name:a.target.value}),placeholder:"Ej: Manzanas Rojas Org√°nicas",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(Ze,{id:"description",value:x.description,onChange:a=>S({...x,description:a.target.value}),placeholder:"Describe las caracter√≠sticas y beneficios de tu producto...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"price",children:"Precio (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:x.price,onChange:a=>S({...x,price:a.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:x.stock_quantity,onChange:a=>S({...x,stock_quantity:a.target.value}),placeholder:"1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Categor√≠a *"}),e.jsxs(Ls,{onValueChange:a=>S({...x,category:a}),children:[e.jsx(qs,{children:e.jsx(Rs,{placeholder:x.category||"Selecciona una categor√≠a"})}),e.jsx(zs,{children:ya.map(a=>e.jsx(Fs,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(F,{children:"Visibilidad"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(k,{type:"button",variant:x.is_public?"default":"outline",onClick:()=>S({...x,is_public:!0}),className:"flex-1",children:["P√∫blico",x.is_public&&e.jsx(se,{variant:"secondary",className:"ml-2",children:"Activo"})]}),e.jsxs(k,{type:"button",variant:x.is_public?"outline":"default",onClick:()=>S({...x,is_public:!1}),className:"flex-1",children:["Privado",!x.is_public&&e.jsx(se,{variant:"secondary",className:"ml-2",children:"Activo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Los productos p√∫blicos aparecen en el cat√°logo general. Los privados solo los ves t√∫."})]}),E&&e.jsxs(de,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(me,{children:E})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:g,className:"flex-1",disabled:A||i,children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:A||i,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:A?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Producto"]})})]})]})})]})})]})}function rs({dailyProduct:s,onSuccess:f,onCancel:g}){const{user:j}=xe(),[x,S]=m.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:s!=null&&s.price?String(s.price):"",stock_quantity:s!=null&&s.stock_quantity?String(s.stock_quantity):""}),[b,r]=m.useState(null),[l,$]=m.useState((s==null?void 0:s.image_url)||""),[A,L]=m.useState(!1),[i,v]=m.useState(!1),[E,C]=m.useState(""),N=m.useRef(null),P=()=>{const d=new Date;return new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999).toISOString()},U=()=>{const d=new Date,p=new Date;p.setHours(23,59,59,999);const t=p.getTime()-d.getTime(),h=Math.floor(t/(1e3*60*60)),_=Math.floor(t%(1e3*60*60)/(1e3*60));return`${h}h ${_}m`},Z=d=>{var t;const p=(t=d.target.files)==null?void 0:t[0];if(p){if(!p.type.startsWith("image/")){C("Por favor selecciona una imagen v√°lida");return}if(p.size>5*1024*1024){C("La imagen debe ser menor a 5MB");return}r(p),C("");const h=new FileReader;h.onload=_=>{var D;$((D=_.target)==null?void 0:D.result)},h.readAsDataURL(p)}},V=async d=>{v(!0);try{const p=new Date().toISOString().split("T")[0],t=d.name.split(".").pop(),_=`daily-products/${`${j==null?void 0:j.id}/${p}/${Date.now()}.${t}`}`,{error:D}=await w.storage.from("products").upload(_,d,{cacheControl:"3600",upsert:!1});if(D)throw D;const{data:q}=w.storage.from("products").getPublicUrl(_);return q.publicUrl}catch(p){throw console.error("Error uploading image:",p),new Error("Error al subir la imagen: "+p.message)}finally{v(!1)}},J=async d=>{try{const p=d.split("/"),t=p.findIndex(h=>h==="products");if(t!==-1){const _=p.slice(t+1).join("/");await w.storage.from("products").remove([_])}}catch(p){console.error("Error deleting old image:",p)}},a=async d=>{if(d.preventDefault(),C(""),!x.name.trim()){C("El nombre del producto es requerido");return}if(parseFloat(x.price)<=0){C("El precio debe ser mayor a 0");return}if(parseInt(x.stock_quantity)<0){C("La cantidad no puede ser negativa");return}if(!s&&!b&&!l){C("Selecciona una imagen para el producto");return}if(new Date().getHours()>=23){C("Es muy tarde para crear productos del d√≠a. Int√©ntalo ma√±ana temprano.");return}L(!0);try{let h=(s==null?void 0:s.image_url)||"";b&&(h=await V(b),s!=null&&s.image_url&&await J(s.image_url));const _={name:x.name.trim(),description:x.description.trim(),price:parseFloat(x.price)||0,stock_quantity:parseInt(x.stock_quantity)||0,image_url:h,seller_id:j==null?void 0:j.id,expires_at:P()};if(s){const{error:D}=await w.from("daily_products").update(_).eq("id",s.id);if(D)throw D}else{const{error:D}=await w.from("daily_products").insert([_]);if(D)throw D}f()}catch(h){console.error("Error saving daily product:",h),C(h.message||"Error al guardar el producto del d√≠a")}finally{L(!1)}},c=()=>{r(null),$(""),N.current&&(N.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:g,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto del D√≠a":"Tu Venta del D√≠a"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica tu oferta especial":"Crea una oferta especial que dura hasta medianoche"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800",children:["Tiempo restante: ",U()]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Este producto se eliminar√° autom√°ticamente a las 23:59:59 de hoy. Las im√°genes tambi√©n se eliminar√°n del servidor."})]}),e.jsxs(W,{children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Informaci√≥n del Producto del D√≠a"]})}),e.jsx(B,{children:e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"Imagen del Producto *"}),l?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:c,children:e.jsx(Ce,{className:"w-4 h-4"})}),i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})}),e.jsxs(se,{variant:"destructive",className:"absolute bottom-2 left-2",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Expira a medianoche"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-orange-300 rounded-lg p-8 text-center cursor-pointer hover:border-orange-500 transition-colors bg-orange-50",onClick:()=>{var d;return(d=N.current)==null?void 0:d.click()},children:[e.jsx(Ss,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-orange-600",children:"PNG, JPG, WEBP hasta 5MB"}),e.jsx(se,{variant:"outline",className:"mt-2 border-orange-300 text-orange-700",children:"Se elimina autom√°ticamente"})]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:Z,className:"hidden"}),!l&&e.jsxs(k,{type:"button",variant:"outline",onClick:()=>{var d;return(d=N.current)==null?void 0:d.click()},className:"w-full border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:x.name,onChange:d=>S({...x,name:d.target.value}),placeholder:"Ej: Combo Especial del D√≠a",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(Ze,{id:"description",value:x.description,onChange:d=>S({...x,description:d.target.value}),placeholder:"Describe tu oferta especial del d√≠a...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"price",children:"Precio Especial (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:x.price,onChange:d=>S({...x,price:d.target.value}),placeholder:"0.00",required:!0}),e.jsx("p",{className:"text-xs text-orange-600",children:"Precio especial v√°lido solo hoy"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:x.stock_quantity,onChange:d=>S({...x,stock_quantity:d.target.value}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-orange-600",children:"¬°Solo por hoy!"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Caracter√≠sticas de Productos del D√≠a"]}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Se elimina autom√°ticamente a las 23:59:59"}),e.jsx("li",{children:'‚Ä¢ Aparece marcado como "Oferta del D√≠a" en el cat√°logo'}),e.jsx("li",{children:"‚Ä¢ Las im√°genes se almacenan en carpeta temporal"}),e.jsx("li",{children:"‚Ä¢ Ideal para ofertas especiales y productos perecederos"})]})]}),E&&e.jsxs(de,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(me,{children:E})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:g,className:"flex-1",disabled:A||i,children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:A||i,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:A?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Venta del D√≠a"]})})]})]})})]})]})]})}function wa({product:s,onEdit:f,onDelete:g}){const[j,x]=m.useState(!1),{openImageModal:S}=os(),b=l=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(l),r=l=>new Date(l).toLocaleDateString("es-GT",{day:"numeric",month:"short",year:"numeric"});return e.jsxs(W,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border border-gray-200",style:{backgroundColor:"white"},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-gray-100",children:j?e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sin imagen"})]})}):e.jsx(Le,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>x(!0),expandable:!0,onExpand:S})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(se,{variant:s.is_public?"default":"secondary",className:"text-xs font-medium",style:{backgroundColor:s.is_public?"#22c55e":"#6b7280",color:"white",border:"none"},children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"w-3 h-3 mr-1"}),"P√∫blico"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-3 h-3 mr-1"}),"Privado"]})})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(se,{variant:"destructive",className:"text-xs font-medium",style:{backgroundColor:"#ef4444",color:"white",border:"none"},children:"Sin stock"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(se,{variant:"outline",className:"text-xs font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",color:"#374151",border:"1px solid #d1d5db"},children:s.category})})]}),e.jsx(B,{className:"p-3 md:p-4",style:{backgroundColor:"white"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1 text-sm md:text-base",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm md:text-lg text-green-600",children:b(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"w-3 h-3 md:w-4 md:h-4 text-gray-500 flex-shrink-0"}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Creado el ",r(s.created_at)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>f(s),className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#d1d5db",color:"#374151"},children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(xs,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#fecaca",color:"#dc2626",backgroundColor:"white"},children:[e.jsx(ws,{className:"w-3 h-3 mr-1"}),"Eliminar"]})}),e.jsxs(hs,{children:[e.jsxs(fs,{children:[e.jsx(bs,{children:"¬øEliminar producto?"}),e.jsxs(js,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda.']})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(ys,{onClick:()=>g(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]})}function _a({dailyProduct:s,onEdit:f,onDelete:g}){const[j,x]=m.useState(!1),[S,b]=m.useState(""),[r,l]=m.useState(!1),{openImageModal:$}=os();m.useEffect(()=>{const i=()=>{const E=Vs(s.expires_at);b(E.formattedTime),l(E.isExpired)};i();const v=setInterval(i,1e3);return()=>clearInterval(v)},[s.expires_at]);const A=i=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(i),L=i=>Gs(i);return e.jsxs(W,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:j?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-12 h-12 text-orange-400"})}):e.jsx(Le,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>x(!0),expandable:!0,onExpand:$})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(se,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs",children:[e.jsx(Us,{className:"w-3 h-3 mr-1"}),"Oferta del D√≠a"]})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(se,{variant:"destructive",className:"text-xs",children:"Agotado"})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(se,{variant:r?"destructive":"secondary",className:`text-xs ${r?"bg-red-500 text-white":"bg-white/90 backdrop-blur-sm text-orange-700"}`,children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),S]})})]}),e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:A(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-orange-700",children:["Creado a las ",L(s.created_at)]}),e.jsxs("span",{className:"text-orange-700 font-medium",children:["Expira: ",L(s.expires_at)]})]})}),!r&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:["‚è∞ Se elimina autom√°ticamente en ",S]})}),r&&e.jsx("div",{className:"text-center bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"‚ùå Este producto ha expirado y ser√° eliminado pronto"})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>f(s),className:"flex-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:r,children:[e.jsx(Ye,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(xs,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ws,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(hs,{children:[e.jsxs(fs,{children:[e.jsx(bs,{children:"¬øEliminar producto del d√≠a?"}),e.jsxs(js,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda y su imagen del servidor.',!r&&e.jsxs("span",{className:"block mt-2 text-orange-600 font-medium",children:["Nota: Este producto se eliminar√° autom√°ticamente en ",S," de todas formas."]})]})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(ys,{onClick:()=>g(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar Ahora"})]})]})]})]})]})})]})}const $e={north:15.2,south:15,east:-89.3,west:-89.5};function Sa(){var s,f;try{return(f=(s=import.meta)==null?void 0:s.env)==null?void 0:f.VITE_GOOGLE_MAPS_API_KEY}catch{return}}function ka(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")?"Safari":s.includes("edge")?"Edge":"tu navegador"}function Ca(){const[s,f]=m.useState(!1),[g,j]=m.useState(null),[x,S]=m.useState(null),b=m.useCallback(()=>{j(null)},[]),r=m.useCallback((i,v)=>i>=$e.south&&i<=$e.north&&v>=$e.west&&v<=$e.east,[]),l=m.useCallback(async()=>{try{if("permissions"in navigator&&"query"in navigator.permissions){const i=await navigator.permissions.query({name:"geolocation"});return S(i.state),i.state}return S("prompt"),"prompt"}catch(i){return console.warn("Could not check geolocation permissions:",i),S("prompt"),"prompt"}},[]),$=m.useCallback(async()=>{try{const i=await new Promise(v=>{navigator.geolocation.getCurrentPosition(()=>v(!0),E=>{console.log("Permission request result:",E.code,E.message),v(E.code!==E.PERMISSION_DENIED)},{timeout:1e3,maximumAge:0})});return i&&await l(),i}catch(i){return console.error("Error requesting permissions:",i),!1}},[l]),A=m.useCallback(async(i,v)=>{try{j(null);const E=Sa();if(E&&typeof fetch<"u")try{const C=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${i},${v}&key=${E}&language=es&region=GT`);if(C.ok){const N=await C.json();if(N.status==="OK"&&N.results&&N.results.length>0){const P=N.results[0],U=P.address_components||[];let Z="",V="",J="",a="";return U.forEach(c=>{const d=c.types||[];d.includes("locality")||d.includes("administrative_area_level_2")?Z=c.long_name||"":d.includes("administrative_area_level_1")?V=c.long_name||"":d.includes("country")?J=c.long_name||"":d.includes("postal_code")&&(a=c.long_name||"")}),{latitude:i,longitude:v,address:P.formatted_address||`Ubicaci√≥n GPS: ${i.toFixed(6)}, ${v.toFixed(6)}`,formatted_address:P.formatted_address||`Coordenadas: ${i.toFixed(6)}, ${v.toFixed(6)}`,city:Z||"Gual√°n",state:V||"Zacapa",country:J||"Guatemala",postal_code:a,place_id:P.place_id}}}}catch(C){console.warn("Google Maps API request failed, using fallback:",C)}return{latitude:i,longitude:v,address:`Gual√°n, Zacapa, Guatemala (${i.toFixed(6)}, ${v.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS verificada en Gual√°n: ${i.toFixed(6)}, ${v.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}catch(E){return console.error("Error in reverse geocoding:",E),{latitude:i,longitude:v,address:`Gual√°n, Zacapa, Guatemala (${i.toFixed(6)}, ${v.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS: ${i.toFixed(6)}, ${v.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}},[]),L=m.useCallback(async()=>new Promise((i,v)=>{if(f(!0),j(null),!(navigator!=null&&navigator.geolocation)){const N=`‚ùå Geolocalizaci√≥n no disponible

Tu navegador no soporta geolocalizaci√≥n GPS. 

‚úÖ Soluciones:
‚Ä¢ Usa un navegador moderno (Chrome, Firefox, Safari, Edge)
‚Ä¢ Verifica que est√©s usando HTTPS (no HTTP)
‚Ä¢ Intenta desde un dispositivo m√≥vil
‚Ä¢ Actualiza tu navegador a la versi√≥n m√°s reciente`;console.error("Geolocation not supported"),j(N),f(!1),v(new Error(N));return}const E={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5},C=ka();navigator.geolocation.getCurrentPosition(async N=>{try{const{latitude:P,longitude:U}=N.coords,Z=N.coords.accuracy;if(console.log(`üìç GPS Location obtained: ${P.toFixed(6)}, ${U.toFixed(6)} (accuracy: ${Z}m)`),!r(P,U)){const J=`üó∫Ô∏è Ubicaci√≥n fuera del √°rea de servicio

üìç Coordenadas detectadas: ${P.toFixed(4)}, ${U.toFixed(4)}
üè¢ √Årea de servicio: Gual√°n, Zacapa

‚ö†Ô∏è Posibles causas:
‚Ä¢ Tu negocio no est√° en Gual√°n, Zacapa
‚Ä¢ El GPS no es preciso (intenta ir al aire libre)
‚Ä¢ Est√°s usando VPN que cambia tu ubicaci√≥n

‚úÖ Si tu negocio S√ç est√° en Gual√°n:
‚Ä¢ Ve al exterior para mejor se√±al GPS
‚Ä¢ Desactiva VPN si usas una
‚Ä¢ Espera unos segundos y vuelve a intentar
‚Ä¢ La ubicaci√≥n se guardar√° aunque est√© fuera del √°rea estimada`;console.warn(`Location validation failed: lat=${P}, lng=${U}, accuracy=${Z}m`),j(J),f(!1),v(new Error(J));return}const V=await A(P,U);console.log("‚úÖ Location successfully processed:",V),f(!1),i(V)}catch(P){console.error("Error processing location:",P);const U=P instanceof Error?P.message:"Error al procesar la ubicaci√≥n detectada";j(U),f(!1),v(P)}},N=>{console.error("Geolocation error details:",{code:N.code,message:N.message,PERMISSION_DENIED:N.PERMISSION_DENIED,POSITION_UNAVAILABLE:N.POSITION_UNAVAILABLE,TIMEOUT:N.TIMEOUT});let P="Error al detectar la ubicaci√≥n";switch(N.code){case N.PERMISSION_DENIED:P=`üö´ Permiso de ubicaci√≥n denegado

üì± SOLUCI√ìN R√ÅPIDA para ${C}:

üîí **M√©todo 1 - √çcono de ubicaci√≥n:**
1. Busca el √≠cono üîí o üåê en la barra de direcciones
2. Haz clic en √©l
3. Cambia "Ubicaci√≥n" de "Bloqueado" a "Permitir"
4. Recarga la p√°gina

‚öôÔ∏è **M√©todo 2 - Configuraci√≥n del navegador:**
‚Ä¢ Chrome: Configuraci√≥n ‚Üí Privacidad ‚Üí Configuraci√≥n del sitio ‚Üí Ubicaci√≥n
‚Ä¢ Firefox: Preferencias ‚Üí Privacidad ‚Üí Permisos ‚Üí Ubicaci√≥n  
‚Ä¢ Safari: Preferencias ‚Üí Sitios web ‚Üí Ubicaci√≥n
‚Ä¢ Edge: Configuraci√≥n ‚Üí Permisos del sitio ‚Üí Ubicaci√≥n

üìç **¬øPor qu√© necesitamos tu ubicaci√≥n?**
Los repartidores necesitan las coordenadas GPS exactas de tu negocio para hacer entregas correctas.

üîÑ Despu√©s de cambiar los permisos, recarga esta p√°gina y vuelve a intentar.`;break;case N.POSITION_UNAVAILABLE:P=`üì° Se√±al GPS no disponible

üõ∞Ô∏è **Posibles causas:**
‚Ä¢ Est√°s en un lugar cerrado (edificio, s√≥tano)
‚Ä¢ Se√±al GPS d√©bil en tu √°rea
‚Ä¢ Interferencia de otros dispositivos
‚Ä¢ GPS desactivado en el dispositivo

‚úÖ **Soluciones:**
‚Ä¢ Ve cerca de una ventana o al aire libre
‚Ä¢ Verifica que el GPS est√© activado en tu dispositivo
‚Ä¢ Espera 1-2 minutos para que mejore la se√±al
‚Ä¢ Intenta desde otro lugar o dispositivo
‚Ä¢ Aseg√∫rate de tener conexi√≥n a internet estable

üì± En m√≥viles: Configuraci√≥n ‚Üí Ubicaci√≥n ‚Üí Activar GPS de alta precisi√≥n`;break;case N.TIMEOUT:P=`‚è∞ Tiempo de espera agotado (15 segundos)

üîÑ **La detecci√≥n GPS tard√≥ demasiado:**

üì∂ **Soluciones r√°pidas:**
‚Ä¢ Ve a un lugar con mejor se√±al (ventana o exterior)
‚Ä¢ Verifica tu conexi√≥n a internet
‚Ä¢ Reinicia el GPS en tu dispositivo si es m√≥vil
‚Ä¢ Cierra otras apps que usen ubicaci√≥n

üöÄ **Int√©ntalo de nuevo:**
La detecci√≥n puede ser m√°s r√°pida en el segundo intento.

üí° **Tip:** En dispositivos m√≥viles, el GPS suele ser m√°s r√°pido y preciso que en computadoras.`;break;default:P=`‚ùå Error GPS desconocido

üîß **Informaci√≥n t√©cnica:**
‚Ä¢ C√≥digo de error: ${N.code}
‚Ä¢ Mensaje: ${N.message}

üõ†Ô∏è **Soluciones generales:**
‚Ä¢ Recarga la p√°gina e intenta de nuevo
‚Ä¢ Verifica los permisos de ubicaci√≥n
‚Ä¢ Intenta desde otro navegador o dispositivo
‚Ä¢ Aseg√∫rate de usar HTTPS (no HTTP)

üìß Si el problema persiste, contacta soporte t√©cnico con esta informaci√≥n.`}console.error("Geolocation error processed:",P),j(P),f(!1),v(new Error(P))},E)}),[r,A]);return m.useEffect(()=>{l()},[l]),{getCurrentLocation:L,reverseGeocode:A,validateLocation:r,checkPermissions:l,requestPermissions:$,loading:s,error:g,permissionState:x,clearError:b}}const Ea={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWRkenlsb3RxZGNrdWJsZmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTU4NjEsImV4cCI6MjA3MTM3MTg2MX0.ktxZ0H7mI9NVdxu48sPd90kqPerSP-vkysQlIM1JpG8",VITE_SUPABASE_URL:"https://deaddzylotqdckublfed.supabase.co"},ks=[{key:"monday",label:"Lunes",short:"Lun"},{key:"tuesday",label:"Martes",short:"Mar"},{key:"wednesday",label:"Mi√©rcoles",short:"Mi√©"},{key:"thursday",label:"Jueves",short:"Jue"},{key:"friday",label:"Viernes",short:"Vie"},{key:"saturday",label:"S√°bado",short:"S√°b"},{key:"sunday",label:"Domingo",short:"Dom"}],Pa={monday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},saturday:{isOpen:!0,openTime:"09:00",closeTime:"17:00"},sunday:{isOpen:!1,openTime:"09:00",closeTime:"15:00"}};function Ta(){try{return!!(import.meta&&Ea&&!1)}catch{return!1}}function Ia(s){const[f,g]=m.useState(()=>{if(s)try{return JSON.parse(s)}catch{console.log("Using default weekly hours")}return Pa});return{weeklyHours:f,setWeeklyHours:g,updateWeeklyHours:(b,r,l)=>{g($=>({...$,[b]:{...$[b],[r]:l}}))},generateWeeklyHoursText:()=>{const b=ks.filter(r=>f[r.key].isOpen);return b.length===0?"Cerrado toda la semana":b.map(r=>{const l=f[r.key];return`${r.short}: ${l.openTime}-${l.closeTime}`}).join(", ")},getHoursAsJSON:()=>JSON.stringify(f)}}function Aa({weeklyHours:s,updateWeeklyHours:f,generateWeeklyHoursText:g}){const[j,x]=m.useState(!1),S=()=>{x(!1)},b=()=>{x(!1)};return e.jsxs(W,{className:"seller-profile",children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5 text-purple-500"}),"Horarios de Atenci√≥n"]}),!j&&e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>x(!0),className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Editar Horarios"]})]})}),e.jsx(B,{className:"space-y-4",children:j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configurar Horarios"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:b,className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Cancelar"]}),e.jsxs(k,{size:"sm",onClick:S,className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Guardar"]})]})]}),e.jsx("div",{className:"space-y-3",children:ks.map(r=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 min-w-[80px]",children:r.label}),e.jsx(ls,{checked:s[r.key].isOpen,onCheckedChange:l=>f(r.key,"isOpen",l)}),e.jsx("span",{className:`text-sm font-medium ${s[r.key].isOpen?"text-green-600":"text-red-600"}`,children:s[r.key].isOpen?"Abierto":"Cerrado"})]})}),s[r.key].isOpen&&e.jsxs("div",{className:"flex items-center gap-4 ml-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"text-sm whitespace-nowrap",children:"Apertura:"}),e.jsx(H,{type:"time",value:s[r.key].openTime,onChange:l=>f(r.key,"openTime",l.target.value),className:"w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"text-sm whitespace-nowrap",children:"Cierre:"}),e.jsx(H,{type:"time",value:s[r.key].closeTime,onChange:l=>f(r.key,"closeTime",l.target.value),className:"w-32"})]})]})]},r.key))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Vista previa:"}),e.jsx("p",{className:"text-sm text-blue-800",children:g()})]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-center",children:"Vista previa de horarios:"}),e.jsx("div",{className:"text-sm text-blue-800 leading-relaxed",children:g()})]})})]})}function Da(s,f){if(s&&f){const g=`https://www.google.com/maps/@${s},${f},18z`;window.open(g,"_blank")}}function Oa(s){return s.business_name.trim()?null:"El nombre del negocio es requerido"}const Be=({active:s,onClick:f,children:g,icon:j})=>e.jsxs("button",{onClick:f,className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 ${s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:g})]});function ts(){const{user:s}=xe(),{getCurrentLocation:f,loading:g,error:j,permissionState:x,clearError:S}=Ca(),[b,r]=m.useState(null),[l,$]=m.useState(!0),[A,L]=m.useState(!1),[i,v]=m.useState(""),[E,C]=m.useState(""),[N,P]=m.useState(!1),[U,Z]=m.useState(!1),[V,J]=m.useState(!1),[a,c]=m.useState(!1),[d,p]=m.useState(""),[t,h]=m.useState(!1),[_,D]=m.useState(!1),[q,re]=m.useState(!1),[K,ne]=m.useState("info"),je=m.useRef(null),Pe=m.useRef(null),{weeklyHours:ze,setWeeklyHours:Fe,updateWeeklyHours:Ue,generateWeeklyHoursText:Ve,getHoursAsJSON:Te}=Ia(b==null?void 0:b.business_hours),[y,ee]=m.useState({business_name:"",business_description:"",business_logo:"",cover_image_url:"",business_category:"",phone:"",email:"",address:"",latitude:0,longitude:0,delivery_time:30,delivery_radius:5,minimum_order:50,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:{facebook:"",instagram:"",whatsapp:"",website:""}});m.useEffect(()=>{s?Se():(r(null),re(!1),$(!1)),h(Ta())},[s]),m.useEffect(()=>{if(!s||!l)return;const n=setTimeout(()=>{$(!1),re(!0)},8e3);return()=>clearTimeout(n)},[s,l]),m.useEffect(()=>{j&&(D(!0),v(""))},[j]);const Se=async()=>{var n;try{$(!0);const{data:o,error:O}=await w.from("sellers").select("*").eq("id",s==null?void 0:s.id).single();if(O){const T=O.code,M=((n=O.message)==null?void 0:n.toString().toLowerCase())||"";if(T==="PGRST116"||T==="PGRST403"||T==="42501"||T==="PGRST114"||M.includes("permission")||M.includes("rls")||M.includes("forbidden")||M.includes("not authorized"))re(!0);else throw O}if(o){if(r(o),ee({business_name:o.business_name||"",business_description:o.business_description||"",business_logo:o.business_logo||"",cover_image_url:o.cover_image_url||"",business_category:o.business_category||"",phone:o.phone||"",email:o.email||"",address:o.address||"",latitude:o.latitude||0,longitude:o.longitude||0,delivery_time:o.delivery_time||30,delivery_radius:o.delivery_radius||5,minimum_order:o.minimum_order||50,is_active:o.is_active!==!1,is_open_now:o.is_open_now||!1,is_accepting_orders:o.is_accepting_orders!==!1,location_verified:o.location_verified||!1,social_media:o.social_media||{facebook:"",instagram:"",whatsapp:"",website:""}}),o.business_hours)try{Fe(JSON.parse(o.business_hours))}catch{console.log("Using default weekly hours")}const T=o.latitude&&o.longitude&&Math.abs(o.latitude)>.001&&Math.abs(o.longitude)>.001;c(T),T&&p(`${o.latitude.toFixed(6)}, ${o.longitude.toFixed(6)}`)}}catch(o){console.error("Error loading profile:",o),v("Error al cargar el perfil del negocio")}finally{$(!1)}},Ie=async()=>{var n,o,O,T,M;if(s)try{L(!0),v("");const R={business_name:((n=y.business_name)==null?void 0:n.trim())||"Mi Negocio",business_description:((o=y.business_description)==null?void 0:o.trim())||"",business_logo:"",cover_image_url:"",business_category:y.business_category||"",phone:((O=y.phone)==null?void 0:O.trim())||"",email:((T=y.email)==null?void 0:T.trim())||"",address:((M=y.address)==null?void 0:M.trim())||"",latitude:y.latitude||0,longitude:y.longitude||0,business_hours:Te(),delivery_time:y.delivery_time||30,delivery_radius:y.delivery_radius||5,minimum_order:y.minimum_order||0,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:y.social_media,is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:G}=await w.from("sellers").upsert({id:s.id,...R});if(G)throw G;C("‚úÖ Perfil de vendedor creado. Completa la informaci√≥n y guarda los cambios."),re(!1),P(!0),await Se(),setTimeout(()=>C(""),4e3)}catch(R){console.error("Error creating minimal seller profile:",R),v("No se pudo crear el perfil de vendedor. Intenta de nuevo.")}finally{L(!1)}},ke=async()=>{var n,o,O,T,M,R;try{L(!0),v("");const G=Oa(y);if(G){v(G);return}console.log("üíæ Guardando perfil con datos:",{business_name:y.business_name,address:y.address,latitude:y.latitude,longitude:y.longitude,business_logo:((n=y.business_logo)==null?void 0:n.substring(0,50))+"...",cover_image_url:((o=y.cover_image_url)==null?void 0:o.substring(0,50))+"..."});const Q={business_name:y.business_name.trim(),business_description:((O=y.business_description)==null?void 0:O.trim())||null,business_category:y.business_category||null,phone:((T=y.phone)==null?void 0:T.trim())||null,email:((M=y.email)==null?void 0:M.trim())||null,address:((R=y.address)==null?void 0:R.trim())||null,latitude:y.latitude||null,longitude:y.longitude||null,business_hours:Te(),delivery_time:y.delivery_time||30,delivery_radius:y.delivery_radius||5,minimum_order:y.minimum_order||0,is_active:y.is_active,is_open_now:y.is_open_now,location_verified:y.location_verified||!1,social_media:y.social_media||{},business_logo:y.business_logo||null,cover_image_url:y.cover_image_url||null,updated_at:new Date().toISOString()},{error:Y}=await w.from("sellers").upsert({id:s==null?void 0:s.id,...Q});if(Y)throw console.error("üí• Error al guardar:",Y),Y;console.log("‚úÖ Perfil guardado exitosamente"),C("‚úÖ Perfil guardado exitosamente"),P(!1),await Se(),setTimeout(()=>C(""),4e3)}catch(G){console.error("üí• Error saving profile:",G),v(`Error al guardar el perfil: ${G.message||"Error desconocido"}`)}finally{L(!1)}},Ae=(n,o,O,T=.8)=>new Promise(M=>{const R=document.createElement("canvas"),G=R.getContext("2d"),Q=new Image;Q.onload=()=>{let{width:Y,height:pe}=Q;Y>pe?Y>o&&(pe=pe*o/Y,Y=o):pe>O&&(Y=Y*O/pe,pe=O),R.width=Y,R.height=pe,G.drawImage(Q,0,0,Y,pe),R.toBlob(Xe=>{Xe&&M(Xe)},"image/jpeg",T)},Q.src=URL.createObjectURL(n)}),Ge=async n=>{var O;const o=(O=n.target.files)==null?void 0:O[0];if(!(!o||!s))try{if(Z(!0),v(""),console.log("ÔøΩ SUBIENDO LOGO:",o.name),!o.type.startsWith("image/")){v("Solo im√°genes permitidas");return}const T=await Ae(o,400,400,.9),M=`${s.id}/logo-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-logos...");const{error:R}=await w.storage.from("business-logos").upload(M,T,{upsert:!0});if(R){console.error("‚ùå Error upload:",R),v(`Error subiendo: ${R.message}`);return}const{data:G}=w.storage.from("business-logos").getPublicUrl(M);console.log("üîó URL generada:",G.publicUrl);const{error:Q}=await w.from("sellers").upsert({id:s.id,business_logo:G.publicUrl,business_name:y.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(Q){console.error("‚ùå Error BD:",Q),v(`Error guardando: ${Q.message}`);return}console.log("‚úÖ LOGO GUARDADO EXITOSAMENTE"),ee(Y=>({...Y,business_logo:G.publicUrl})),C("‚úÖ Logo guardado correctamente"),setTimeout(()=>C(""),3e3)}catch(T){console.error("üí• ERROR COMPLETO:",T),v(`Error: ${T.message}`)}finally{Z(!1)}},De=async n=>{var O;const o=(O=n.target.files)==null?void 0:O[0];if(!(!o||!s))try{if(Z(!0),v(""),console.log("ÔøΩ SUBIENDO PORTADA:",o.name),!o.type.startsWith("image/")){v("Solo im√°genes permitidas");return}const T=await Ae(o,1200,400,.9),M=`${s.id}/cover-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-covers...");const{error:R}=await w.storage.from("business-covers").upload(M,T,{upsert:!0});if(R){console.error("‚ùå Error upload:",R),v(`Error subiendo: ${R.message}`);return}const{data:G}=w.storage.from("business-covers").getPublicUrl(M);console.log("üîó URL generada:",G.publicUrl);const{error:Q}=await w.from("sellers").upsert({id:s.id,cover_image_url:G.publicUrl,business_name:y.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(Q){console.error("‚ùå Error BD:",Q),v(`Error guardando: ${Q.message}`);return}console.log("‚úÖ PORTADA GUARDADA EXITOSAMENTE"),ee(Y=>({...Y,cover_image_url:G.publicUrl})),C("‚úÖ Portada guardada correctamente"),setTimeout(()=>C(""),3e3)}catch(T){console.error("üí• ERROR COMPLETO:",T),v(`Error: ${T.message}`)}finally{Z(!1)}},ve=async()=>{try{v(""),D(!1),S();const n=await f();ee(o=>({...o,latitude:n.latitude,longitude:n.longitude})),c(!0),p(`${n.latitude.toFixed(6)}, ${n.longitude.toFixed(6)}`),C(`üéØ ¬°Ubicaci√≥n GPS verificada exitosamente!
      
Ô∏è Ciudad: ${n.city}, ${n.state}
üìä Coordenadas: ${n.latitude.toFixed(6)}, ${n.longitude.toFixed(6)}
      
‚úÖ Los repartidores podr√°n encontrar tu negocio f√°cilmente.
üìù Ahora escribe la direcci√≥n de tu negocio en el campo correspondiente.

üîî No olvides guardar el perfil para mantener estos cambios.`)}catch(n){console.error("Error detecting location:",n),D(!0)}},Oe=()=>{D(!1),S(),ve()},u=()=>{D(!1),S()},I=async()=>{const n=!y.is_open_now;try{const{error:o}=await w.from("sellers").update({is_open_now:n,updated_at:new Date().toISOString()}).eq("id",s==null?void 0:s.id);if(o)throw o;ee(O=>({...O,is_open_now:n})),C(n?"üü¢ ¬°Negocio ABIERTO! Ahora apareces en el listado de compradores":"üî¥ Negocio CERRADO. No aparecer√°s en el listado hasta que abras"),setTimeout(()=>C(""),4e3)}catch(o){console.error("Error updating business status:",o),v("Error al actualizar el estado del negocio")}};return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{className:"w-10 h-10 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Cargando tu perfil de negocio..."})]})}):!l&&q?e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:e.jsxs(W,{className:"text-center shadow-lg border-none",children:[e.jsxs(te,{children:[e.jsx(X,{children:"¬°Bienvenido, Vendedor!"}),e.jsx("p",{className:"text-gray-600",children:"Parece que a√∫n no has configurado tu perfil. ¬°Es el primer paso para empezar a vender!"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Crearemos un perfil b√°sico para ti. Podr√°s editar y completar toda la informaci√≥n m√°s adelante."}),e.jsxs(k,{onClick:Ie,disabled:A,size:"lg",className:"w-full sm:w-auto",children:[A?e.jsx(oe,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(be,{className:"w-5 h-5 mr-2"}),"Crear Mi Perfil Ahora"]})]})]})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil de Negocio"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestiona la informaci√≥n que ven tus clientes."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>P(!N),children:N?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"})," Editar"]})}),N&&e.jsxs(k,{onClick:ke,disabled:A,children:[A?e.jsx(oe,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})]})]})}),i&&e.jsxs(de,{variant:"destructive",className:"mb-6 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(me,{className:"whitespace-pre-line",children:i})]}),E&&e.jsxs(de,{className:"mb-6 border-green-200 bg-green-50 text-green-800 flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(me,{className:"text-green-800 whitespace-pre-line",children:E})]}),!t&&e.jsxs(de,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(cs,{className:"h-4 w-4 text-blue-600"}),e.jsxs(me,{className:"text-blue-800",children:[e.jsx("strong",{children:"Sistema GPS:"})," Funcionando con detecci√≥n b√°sica. Para direcciones m√°s detalladas, puedes configurar Google Maps API (opcional).",e.jsx("br",{}),e.jsx("small",{children:"Ver: /GOOGLE_MAPS_SETUP_OPCIONAL.md"})]})]}),e.jsxs(W,{className:"w-full overflow-hidden shadow-lg border-none",children:[e.jsxs("div",{className:"relative h-40 sm:h-56 bg-gradient-to-r from-blue-500 to-purple-600",children:[y.cover_image_url?e.jsx(Le,{src:y.cover_image_url,alt:"Portada del negocio",className:"w-full h-full object-cover",width:800,height:200}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-2 opacity-70"}),e.jsx("p",{className:"text-sm opacity-90",children:"Imagen de portada"}),N&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Cualquier imagen se optimizar√° autom√°ticamente"})]})}),N&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var n;return(n=Pe.current)==null?void 0:n.click()},children:[e.jsxs(k,{variant:"secondary",disabled:U,children:[U?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(fe,{className:"w-4 h-4 mr-2"}),y.cover_image_url?"Cambiar Portada":"Agregar Portada"]}),e.jsx("input",{ref:Pe,type:"file",accept:"image/*",className:"hidden",onChange:De})]})]}),e.jsx("div",{className:"relative px-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-16 sm:-mt-12",children:[e.jsxs("div",{className:"relative h-32 w-32 rounded-full border-4 border-white bg-gradient-to-br from-green-400 to-blue-500 shadow-md flex items-center justify-center",children:[y.business_logo?e.jsx(Le,{src:y.business_logo,alt:"Logo del negocio",className:"w-full h-full object-cover rounded-full"}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-1"}),N&&e.jsx("p",{className:"text-xs opacity-80",children:"Logo - Auto-optimizado"})]}),N&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var n;return(n=je.current)==null?void 0:n.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white/90 rounded-full flex items-center justify-center",children:U?e.jsx(oe,{className:"w-5 h-5 animate-spin text-slate-800"}):e.jsx(fe,{className:"w-5 h-5 text-slate-800"})}),e.jsx("input",{ref:je,type:"file",accept:"image/*",className:"hidden",onChange:Ge})]})]}),e.jsxs("div",{className:"mt-4 sm:ml-6 text-center sm:text-left",children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:y.business_name}),(b==null?void 0:b.is_verified)&&e.jsx(Bs,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-gray-500",children:y.business_category})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-auto",children:e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium ${y.is_open_now?"bg-green-500 text-white":"bg-gray-400 text-white"}`,children:[e.jsx("span",{children:y.is_open_now?"Abierto":"Cerrado"}),e.jsx(ls,{checked:y.is_open_now,onCheckedChange:I,className:"h-3 w-5 scale-75"})]})})]})}),e.jsx("div",{className:"px-6 mt-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 -mb-px overflow-x-auto",children:[e.jsx(Be,{active:K==="info",onClick:()=>ne("info"),icon:es,children:"Informaci√≥n"}),e.jsx(Be,{active:K==="location",onClick:()=>ne("location"),icon:le,children:"Ubicaci√≥n"}),e.jsx(Be,{active:K==="delivery",onClick:()=>ne("delivery"),icon:Ee,children:"Delivery"})]})}),e.jsxs(B,{className:"p-6",children:[K==="info"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-green-500"})," Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"business_name",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(be,{className:"w-4 h-4 text-green-500"}),"Nombre del Negocio"]}),e.jsx(H,{id:"business_name",value:y.business_name,onChange:n=>ee(o=>({...o,business_name:n.target.value})),disabled:!N,placeholder:"Mi Negocio",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs(F,{htmlFor:"business_description",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(es,{className:"w-4 h-4 text-purple-500"}),"Descripci√≥n (opcional)"]}),e.jsx(Ze,{id:"business_description",value:y.business_description,onChange:n=>ee(o=>({...o,business_description:n.target.value})),disabled:!N,rows:3,placeholder:"Cu√©ntales a tus clientes sobre tu negocio...",className:"border-gray-200 focus:border-purple-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-500"})," Contacto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(qe,{className:"w-4 h-4 text-green-500"}),"Tel√©fono"]}),e.jsx(H,{id:"phone",value:y.phone,onChange:n=>ee(o=>({...o,phone:n.target.value})),disabled:!N,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(aa,{className:"w-4 h-4 text-blue-500"}),"Email (opcional)"]}),e.jsx(H,{id:"email",type:"email",value:y.email,onChange:n=>ee(o=>({...o,email:n.target.value})),disabled:!N,placeholder:"contacto@negocio.com",className:"border-gray-200 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2 mb-4",children:[e.jsx(ss,{className:"w-5 h-5 text-purple-500"})," Redes Sociales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"whatsapp",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ea,{className:"w-4 h-4 text-green-500"})," WhatsApp"]}),e.jsx(H,{id:"whatsapp",value:y.social_media.whatsapp,onChange:n=>ee(o=>({...o,social_media:{...o.social_media,whatsapp:n.target.value}})),disabled:!N,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"facebook",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(xa,{className:"w-4 h-4 text-blue-600"})," Facebook"]}),e.jsx(H,{id:"facebook",value:y.social_media.facebook,onChange:n=>ee(o=>({...o,social_media:{...o.social_media,facebook:n.target.value}})),disabled:!N,placeholder:"@mi_negocio",className:"border-gray-200 focus:border-blue-500"})]})]}),N&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"+ M√°s redes sociales (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"instagram",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ba,{className:"w-4 h-4 text-pink-500"})," Instagram"]}),e.jsx(H,{id:"instagram",value:y.social_media.instagram,onChange:n=>ee(o=>({...o,social_media:{...o.social_media,instagram:n.target.value}})),placeholder:"@mi_negocio",className:"border-gray-200 focus:border-pink-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"website",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-500"})," Sitio Web"]}),e.jsx(H,{id:"website",value:y.social_media.website,onChange:n=>ee(o=>({...o,social_media:{...o.social_media,website:n.target.value}})),placeholder:"www.mi-negocio.com",className:"border-gray-200 focus:border-gray-500"})]})]})]})]})]}),K==="location"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Ubicaci√≥n del Negocio"}),a&&e.jsx(ie,{className:"w-5 h-5 text-green-500"})]}),_&&j&&e.jsxs(de,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsxs(me,{className:"flex flex-col gap-3",children:[e.jsx("span",{children:j}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:Oe,className:"bg-white hover:bg-gray-50",children:[e.jsx(Hs,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),e.jsxs(k,{size:"sm",variant:"ghost",onClick:u,className:"text-red-800 hover:bg-red-50",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Cerrar"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"address",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(le,{className:"w-4 h-4 text-red-500"}),"Direcci√≥n"]}),e.jsx(H,{id:"address",value:y.address,onChange:n=>ee(o=>({...o,address:n.target.value})),disabled:!N,placeholder:"Direcci√≥n de tu negocio",className:"border-gray-200 focus:border-red-500"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"GPS Autom√°tico"})]}),a&&e.jsx(ie,{className:"w-5 h-5 text-green-500"})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-green-700 bg-green-100 p-3 rounded-md",children:["‚úÖ ",e.jsx("strong",{children:"Ubicaci√≥n verificada"}),e.jsx("br",{}),"üìç ",d]}),N&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:ve,disabled:g,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[g?e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(k,{onClick:()=>Da(y.latitude,y.longitude),variant:"outline",size:"sm",disabled:!y.latitude||!y.longitude,children:[e.jsx(ra,{className:"w-4 h-4 mr-2"}),"Ver Mapa"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Detecta tu ubicaci√≥n para que los repartidores te encuentren f√°cilmente"}),N&&e.jsxs(k,{onClick:ve,disabled:g,className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:[g?e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Me,{className:"w-4 h-4 mr-2"}),g?"Detectando...":"Detectar Mi Ubicaci√≥n"]}),x==="denied"&&e.jsxs(de,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(_e,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(me,{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"GPS bloqueado."})," Haz clic en üîí en la barra del navegador para permitir ubicaci√≥n."]})]})]})]})]})]}),e.jsx("div",{children:e.jsx(Aa,{weeklyHours:ze,updateWeeklyHours:Ue,generateWeeklyHoursText:Ve})})]}),K==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-500"})," Configuraci√≥n de Delivery"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-500"}),e.jsx(F,{htmlFor:"delivery_time",className:"text-sm font-medium",children:"Tiempo de Preparaci√≥n"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_time",type:"number",value:y.delivery_time,onChange:n=>ee(o=>({...o,delivery_time:parseInt(n.target.value)||0})),disabled:!N,min:"5",max:"120",className:"border-gray-200 focus:border-orange-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-500"}),e.jsx(F,{htmlFor:"delivery_radius",className:"text-sm font-medium",children:"Radio de Entrega"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_radius",type:"number",value:y.delivery_radius,onChange:n=>ee(o=>({...o,delivery_radius:parseInt(n.target.value)||0})),disabled:!N,min:"1",max:"20",className:"border-gray-200 focus:border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"km"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-500"}),e.jsx(F,{htmlFor:"minimum_order",className:"text-sm font-medium",children:"Pedido M√≠nimo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Q"}),e.jsx(H,{id:"minimum_order",type:"number",value:y.minimum_order,onChange:n=>ee(o=>({...o,minimum_order:parseInt(n.target.value)||0})),disabled:!N,min:"0",className:"border-gray-200 focus:border-green-500"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-lg",children:"üí° Estos valores ayudan a los clientes a saber qu√© esperar de tu servicio"})]})]})]})]})})}async function $a(s){try{const{data:{user:f}}=await w.auth.getUser();if(!f)throw new Error("Usuario no autenticado");console.log(`üöÄ Intentando aceptar orden ${s}...`);const{data:g,error:j}=await w.rpc("seller_accept_order",{p_order_id:s,p_seller_id:f.id});return j?(console.error("‚ùå Error:",j),{success:!1,error:j.message}):(console.log("‚úÖ Resultado:",g),{success:!0,data:g})}catch(f){return console.error("üí• Error:",f),{success:!1,error:f instanceof Error?f.message:"Error desconocido"}}}const Ma={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-purple-100 text-purple-800",assigned:"bg-indigo-100 text-indigo-800",picked_up:"bg-green-100 text-green-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},is={pending:"Pendiente",accepted:"Aceptado",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",assigned:"Asignado",picked_up:"Recogido",in_transit:"En camino",delivered:"Entregado",completed:"Completado",cancelled:"Cancelado",rejected:"Rechazado"};function ns(){const{user:s}=xe(),[f,g]=m.useState([]),[j,x]=m.useState(!0),[S,b]=m.useState(!1),[r,l]=m.useState(new Set),[$,A]=m.useState("pending");m.useEffect(()=>{s!=null&&s.id&&(i(),L())},[s==null?void 0:s.id]);const L=()=>{if(!(s!=null&&s.id))return;const a=w.channel("seller-orders-management").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},()=>{i()}).subscribe();return()=>{a.unsubscribe()}},i=async()=>{g([]);try{const{data:a,error:c}=await w.from("orders").select(`
          *,
          order_items (
            id,
            product_name,
            quantity,
            unit_price,
            product_image,
            notes
          ),
          users!orders_buyer_id_fkey (
            name,
            phone
          ),
          drivers:users!orders_driver_id_fkey (
            name
          )
        `).eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(c)throw c;console.log("üìä √ìrdenes cargadas:",(a==null?void 0:a.length)||0),console.log("üìã Datos de √≥rdenes:",a);const d=(a==null?void 0:a.map(p=>{var t,h,_;return console.log(`üîç Orden ${p.order_number}:`,{id:p.id,status:p.status,delivery_type:p.delivery_type,buyer_id:p.buyer_id}),{...p,buyer_id:p.buyer_id,buyer_name:((t=p.users)==null?void 0:t.name)||"Cliente",buyer_phone:(h=p.users)==null?void 0:h.phone,driver_name:(_=p.drivers)==null?void 0:_.name,items:p.order_items||[]}}))||[];g(d)}catch(a){console.error("Error loading orders:",a),z.error("Error al cargar las √≥rdenes")}finally{x(!1),b(!1)}},v=()=>{b(!0),i()},E=async a=>{console.log(`üß™ Probando aceptar orden directa: ${a}`);const c=await $a(a);console.log("üìä Resultado:",c),c.success?(z.success("Orden aceptada exitosamente!"),i()):z.error(`Error: ${c.error}`)},C=async a=>{if(!r.has(a)){l(c=>new Set([...c,a]));try{console.log(`üéØ Marcando orden como lista: ${a}`);let c,d;try{console.log("üîÑ Intento 1: seller_mark_ready_improved");const p=await w.rpc("seller_mark_ready_improved",{p_order_id:a,p_seller_id:s==null?void 0:s.id});c=p.data,d=p.error,!d&&c&&console.log("‚úÖ √âxito con funci√≥n mejorada")}catch{console.log("‚ö†Ô∏è Funci√≥n mejorada fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_ready_safe");const t=await w.rpc("seller_mark_ready_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});c=t.data,d=t.error,!d&&c&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_ready_basic");const h=await w.rpc("seller_mark_ready_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});c=h.data,d=h.error,!d&&c&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(h){throw console.error("üí• Todos los m√©todos fallaron:",h),new Error("No se pudo marcar la orden como lista")}}}if(d){console.error("‚ùå Error RPC:",d),z.error(`Error: ${d.message}`);return}if(console.log("‚úÖ Resultado final:",c),c&&c.length>0){const p=c[0];p.success?(z.success(p.message),i()):z.error(p.message)}else z.success("Orden marcada como lista"),i()}catch(c){console.error("üí• Error en handleMarcarListo:",c),z.error("Error al marcar orden como lista")}finally{l(c=>{const d=new Set(c);return d.delete(a),d})}}},N=async a=>{if(!r.has(a)){l(c=>new Set([...c,a]));try{console.log(`üì¶ Completando orden pickup/dine-in: ${a}`);let c,d;try{console.log("üîÑ Intento 1: seller_mark_completed_pickup");const p=await w.rpc("seller_mark_completed_pickup",{p_order_id:a,p_seller_id:s==null?void 0:s.id});c=p.data,d=p.error,!d&&c&&console.log("‚úÖ √âxito con funci√≥n completa")}catch{console.log("‚ö†Ô∏è Funci√≥n completa fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_completed_pickup_safe");const t=await w.rpc("seller_mark_completed_pickup_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});c=t.data,d=t.error,!d&&c&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_completed_pickup_basic");const h=await w.rpc("seller_mark_completed_pickup_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});c=h.data,d=h.error,!d&&c&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(h){throw console.error("üí• Todos los m√©todos fallaron:",h),new Error("No se pudo completar la orden pickup/dine-in")}}}if(d){console.error("‚ùå Error RPC:",d),z.error(`Error: ${d.message}`);return}if(console.log("‚úÖ Resultado final:",c),c&&c.length>0){const p=c[0];p.success?(z.success(p.message),i()):z.error(p.message)}else z.success("Orden completada exitosamente"),i()}catch(c){console.error("üí• Error en handleCompletarPickup:",c),z.error("Error al completar la orden")}finally{l(c=>{const d=new Set(c);return d.delete(a),d})}}},P=async(a,c)=>{var t,h;if(r.has(a))return;const p={confirmed:"accepted",preparing:"ready",ready:"ready",delivered:"delivered",cancelled:"cancelled"}[c];l(_=>new Set([..._,a]));try{let _;if(p==="accepted"&&(_=await w.rpc("seller_accept_order",{p_order_id:a,p_seller_id:s==null?void 0:s.id})),_&&(_.error||_.data&&_.data[0]&&!_.data[0].success)){const q=((t=_.error)==null?void 0:t.message)||((h=_.data[0])==null?void 0:h.message)||"Error al actualizar el estado";console.error("RPC error:",q),z.error(q),l(re=>{const K=new Set(re);return K.delete(a),K});return}const D=f.find(q=>q.id===a);if(D&&p==="accepted"){await w.from("notifications").insert({user_id:D.buyer_id,order_id:D.id,message:`Tu orden #${D.order_number} ha sido aceptada.`,type:"order_accepted"}),console.log("üîÑ Orden aceptada, actualizando stock...");const{data:q,error:re}=await w.from("order_items").select("product_id, daily_product_id, quantity, product_name, product_type").eq("order_id",a);if(re)console.error("‚ùå Error obteniendo items de la orden:",re),z.error("Orden aceptada pero error al actualizar stock");else if(q&&q.length>0){console.log("üì¶ Items encontrados:",q.length),q.forEach((ne,je)=>{console.log(`   ${je+1}. ${ne.product_name} - Cantidad: ${ne.quantity} - Tipo: ${ne.product_type}`)}),console.log("üöÄ Llamando updateProductStock...");const K=await Js(q,a);console.log("üìä Resultado del stock manager:",K),K.success?(console.log("‚úÖ Stock actualizado exitosamente:",K.updatedProducts),z.success("Orden aceptada y stock actualizado")):(console.error("‚ùå Error actualizando stock:",K.message),z.error(`Orden aceptada pero ${K.message}`))}else console.log("‚ö†Ô∏è No se encontraron items en la orden"),z.success("Orden aceptada (sin items para actualizar stock)")}z.success(`Orden actualizada a ${is[p]||p}.`),i(),l(q=>{const re=new Set(q);return re.delete(a),re})}catch(_){console.error("Error updating order status:",_),z.error("Error al actualizar el estado de la orden")}finally{l(_=>{const D=new Set(_);return D.delete(a),D})}},U=async(a,c)=>{if(!r.has(a)){l(d=>new Set([...d,a]));try{const{error:d}=await w.from("orders").update({status:"rejected",rejection_reason:c,updated_at:new Date().toISOString()}).eq("id",a);if(d)throw d;const p=f.find(t=>t.id===a);p&&await w.from("notifications").insert({user_id:p.buyer_id,order_id:p.id,message:`Tu orden #${p.order_number} fue rechazada.`,type:"order_rejected"}),z.success("Orden rechazada"),i()}catch(d){console.error("Error rejecting order:",d),z.error("Error al rechazar la orden")}finally{l(d=>{const p=new Set(d);return p.delete(a),p})}}},Z=a=>{try{return new Date(a).toLocaleString("es-GT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha inv√°lida"}},V=a=>a==="active"?f.filter(c=>["accepted","ready","assigned","picked_up","in_transit"].includes(c.status)):a==="completed"?f.filter(c=>["delivered","completed"].includes(c.status)):a==="cancelled"?f.filter(c=>["cancelled","rejected"].includes(c.status)):f.filter(c=>c.status===a),J=a=>{const c=r.has(a.id);return console.log(`üé® Renderizando orden ${a.order_number}:`,{id:a.id,status:a.status,delivery_type:a.delivery_type,buyer_id:a.buyer_id,isProcessing:c,orderObject:a}),console.log(`‚ùì Status actual: "${a.status}" (tipo: ${typeof a.status})`),console.log(`‚ùì Delivery type actual: "${a.delivery_type}" (tipo: ${typeof a.delivery_type})`),console.log(`‚ùì ¬øStatus === 'pending'? ${a.status==="pending"}`),console.log(`‚ùì ¬øDelivery type === 'delivery'? ${a.delivery_type==="delivery"}`),console.log(`‚ùì ¬øStatus incluye pending? ${String(a.status).includes("pending")}`),console.log(`‚ùì ¬øDelivery incluye delivery? ${String(a.delivery_type).includes("delivery")}`),e.jsxs(W,{className:"border-l-4 border-l-orange-500",children:[e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"text-lg",children:["Orden #",a.order_number]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Z(a.created_at)})]}),e.jsx(se,{className:Ma[a.status],children:is[a.status]})]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.buyer_name}),a.buyer_phone&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 text-gray-500 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.buyer_phone})]})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"?"bg-blue-50 border-blue-300":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"bg-green-50 border-green-300":"bg-blue-50 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?e.jsx(Ee,{className:"w-8 h-8 text-blue-600"}):String(a.delivery_type||"").trim().toLowerCase()==="pickup"?e.jsx(ue,{className:"w-8 h-8 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-xl font-bold ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"text-blue-800":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"text-green-800":"text-orange-800"}`,children:String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"SERVICIO A DOMICILIO":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"RECOGER EN TIENDA":"COMER EN EL LUGAR"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["M√©todo de entrega: ",a.delivery_type||"No especificado"]})]})]})}),a.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[e.jsx(le,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.delivery_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Productos:"}),a.items.map((d,p)=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsxs("span",{children:[d.quantity,"x ",d.product_name]}),e.jsxs("span",{className:"font-medium",children:["Q",(d.quantity*d.unit_price).toFixed(2)]})]},p))]}),a.notes&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(va,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Notas:"}),e.jsx("p",{className:"text-sm text-blue-700",children:a.notes})]})]})}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["Q",a.total.toFixed(2)]})]}),a.delivery_fee>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Incluye Q",a.delivery_fee.toFixed(2)," de entrega"]})]}),a.driver_name&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Repartidor: ",a.driver_name]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[String(a.status).trim().toLowerCase()==="pending"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:()=>E(a.id),disabled:r.has(a.id),className:"flex-1 bg-green-600 hover:bg-green-700",children:[r.has(a.id)?e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Aceptar Orden"]}),e.jsxs(k,{onClick:()=>U(a.id,"No disponible"),disabled:r.has(a.id),variant:"destructive",size:"lg",className:"px-6 bg-red-600 hover:bg-red-700 text-white border-red-600",style:{backgroundColor:"#dc2626",borderColor:"#dc2626"},children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})}),a.status==="accepted"&&e.jsxs(k,{onClick:()=>C(a.id),disabled:r.has(a.id),className:"w-full bg-purple-600 hover:bg-purple-700",children:[r.has(a.id)?e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Marcar Orden Lista"]}),a.status==="ready"&&e.jsxs("div",{className:"space-y-3",children:[(a.delivery_type==="delivery"||!a.delivery_type)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Orden lista para recoger"}),e.jsx("p",{className:"text-sm text-blue-600",children:"El repartidor recoger√° y entregar√° esta orden"})]})]})}),(a.delivery_type==="pickup"||a.delivery_type==="dine-in")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${a.delivery_type==="pickup"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.delivery_type==="pickup"?e.jsx(ue,{className:"w-6 h-6 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.delivery_type==="pickup"?"text-green-800":"text-orange-800"}`,children:a.delivery_type==="pickup"?"Cliente debe recoger en tienda":"Cliente consume en el lugar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Marcar como entregado cuando el cliente complete la orden"})]})]})}),e.jsxs(k,{onClick:()=>N(a.id),disabled:r.has(a.id),className:"w-full bg-green-600 hover:bg-green-700",children:[r.has(a.id)?e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ie,{className:"w-4 h-4 mr-2"}),a.delivery_type==="pickup"?"Marcar como Recogido":"Marcar como Servido"]})]})]}),a.status==="delivered"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:()=>P(a.id,"confirmed"),disabled:c,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[c?e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Re-procesar"]}),e.jsxs(k,{onClick:()=>U(a.id,"Orden rechazada"),disabled:c,variant:"destructive",size:"lg",className:"px-6",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})]})]})]},a.id)};return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{className:"border-orange-200 shadow-lg",children:e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-orange-500"}),"Gesti√≥n de √ìrdenes"]}),e.jsxs(k,{variant:"outline",onClick:v,disabled:S,size:"sm",children:[S?e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})})}),e.jsxs(He,{value:$,onValueChange:A,children:[e.jsxs(Je,{className:"grid w-full grid-cols-4",children:[e.jsxs(he,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Pendientes",V("pending").length>0&&e.jsx(se,{variant:"destructive",className:"ml-1 px-1.5 py-0.5 text-xs",children:V("pending").length})]}),e.jsxs(he,{value:"active",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Activas",V("active").length>0&&e.jsx(se,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:V("active").length})]}),e.jsxs(he,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Completadas"]}),e.jsxs(he,{value:"cancelled",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Canceladas"]})]}),e.jsx(ce,{value:"pending",className:"space-y-4",children:V("pending").length===0?e.jsx(W,{children:e.jsxs(B,{className:"text-center py-8",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes pendientes"})]})}):V("pending").map(J)}),e.jsx(ce,{value:"active",className:"space-y-4",children:V("active").length===0?e.jsx(W,{children:e.jsxs(B,{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes activas"})]})}):V("active").map(J)}),e.jsx(ce,{value:"completed",className:"space-y-4",children:V("completed").length===0?e.jsx(W,{children:e.jsxs(B,{className:"text-center py-8",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes completadas"})]})}):V("completed").map(J)}),e.jsx(ce,{value:"cancelled",className:"space-y-4",children:V("cancelled").length===0?e.jsx(W,{children:e.jsxs(B,{className:"text-center py-8",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes canceladas"})]})}):V("cancelled").map(J)})]})]})}function La({userRole:s,onVerificationComplete:f}){const{user:g}=xe(),[j,x]=m.useState({latitude:null,longitude:null,address:""}),[S,b]=m.useState({latitude:null,longitude:null,address:""}),[r,l]=m.useState({phone:"",profileImage:"",coverImage:"",vehicleType:"",licenseNumber:""}),[$,A]=m.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1}),[L,i]=m.useState(!1),[v,E]=m.useState(!1);m.useEffect(()=>{g&&C()},[g]);const C=async()=>{if(g)try{const{data:t,error:h}=await w.from("users").select("*").eq("id",g.id).single();if(h)throw h;if(t&&(x({latitude:t.latitude,longitude:t.longitude,address:t.address||""}),l({phone:t.phone||"",profileImage:t.profile_image_url||"",coverImage:t.cover_image_url||"",vehicleType:t.vehicle_type||"",licenseNumber:t.license_number||""}),A(_=>({..._,locationVerified:t.location_verified||!1,profileCompleted:t.profile_completed||!1}))),s==="vendedor"){const{data:_,error:D}=await w.from("sellers").select("*").eq("user_id",g.id).single();_&&(b({latitude:_.business_latitude,longitude:_.business_longitude,address:_.business_address||""}),l(q=>({...q,coverImage:_.cover_image_url||""})),A(q=>({...q,businessLocationVerified:_.business_location_verified||!1,canPublish:_.can_publish_products||!1})))}}catch(t){console.error("Error loading user data:",t),z.error("Error al cargar datos del usuario")}},N=async()=>{if(!navigator.geolocation){z.error("Tu navegador no soporta geolocalizaci√≥n");return}E(!0),navigator.geolocation.getCurrentPosition(async t=>{const{latitude:h,longitude:_}=t.coords;try{const D=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${_},${h}.json?access_token=`);if(D.ok){const q=await D.json();q.features&&q.features.length>0&&x(re=>({...re,latitude:h,longitude:_}))}else x(q=>({...q,latitude:h,longitude:_}));z.success("Ubicaci√≥n obtenida correctamente")}catch(D){console.error("Error getting address:",D),x(q=>({...q,latitude:h,longitude:_})),z.success("Ubicaci√≥n obtenida (sin direcci√≥n)")}finally{E(!1)}},t=>{console.error("Geolocation error:",t),E(!1),z.error("No se pudo obtener tu ubicaci√≥n. Verifica los permisos del navegador.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},P=async()=>{if(!g||!j.latitude||!j.longitude){z.error("Primero obt√©n tu ubicaci√≥n");return}i(!0);try{const{error:t}=await w.rpc("update_user_location",{user_id:g.id,lat:j.latitude,lng:j.longitude,user_address:j.address});if(t)throw t;A(h=>({...h,locationVerified:!0})),z.success("Ubicaci√≥n personal verificada"),await V()}catch(t){console.error("Error saving location:",t),z.error("Error al guardar ubicaci√≥n")}finally{i(!1)}},U=async()=>{if(!g||!S.latitude||!S.longitude){z.error("Primero obt√©n la ubicaci√≥n del negocio");return}i(!0);try{const{error:t}=await w.rpc("update_business_location",{seller_user_id:g.id,lat:S.latitude,lng:S.longitude,business_addr:S.address});if(t)throw t;A(h=>({...h,businessLocationVerified:!0})),z.success("Ubicaci√≥n del negocio verificada"),await V()}catch(t){console.error("Error saving business location:",t),z.error("Error al guardar ubicaci√≥n del negocio")}finally{i(!1)}},Z=async()=>{if(g){i(!0);try{const t={phone:r.phone,profile_image_url:r.profileImage,updated_at:new Date().toISOString()};s==="repartidor"&&(t.vehicle_type=r.vehicleType,t.license_number=r.licenseNumber);const{error:h}=await w.from("users").update(t).eq("id",g.id);if(h)throw h;if(s==="vendedor"&&r.coverImage){const{error:_}=await w.from("sellers").update({cover_image_url:r.coverImage}).eq("user_id",g.id);if(_)throw _}z.success("Perfil actualizado"),await V()}catch(t){console.error("Error updating profile:",t),z.error("Error al actualizar perfil")}finally{i(!1)}}},V=async()=>{if(g)try{let t=!1;if(s==="vendedor"){const{data:h,error:_}=await w.rpc("check_seller_can_publish",{seller_user_id:g.id});_||(t=h)}else if(s==="comprador"){const{data:h,error:_}=await w.rpc("check_buyer_can_purchase",{buyer_user_id:g.id});_||(t=h)}else if(s==="repartidor"){const{data:h,error:_}=await w.rpc("check_driver_can_work",{driver_user_id:g.id});_||(t=h)}A(h=>({...h,canPublish:s==="vendedor"?t:h.canPublish,canPurchase:s==="comprador"?t:h.canPurchase,canWork:s==="repartidor"?t:h.canWork})),t&&f&&f()}catch(t){console.error("Error checking verification status:",t)}},J=()=>{const t=[{name:"Tel√©fono",completed:!!r.phone,icon:qe},{name:"Ubicaci√≥n verificada",completed:$.locationVerified,icon:le}];return s==="vendedor"?[...t,{name:"Foto de perfil",completed:!!r.profileImage,icon:fe},{name:"Foto de portada",completed:!!r.coverImage,icon:fe},{name:"Ubicaci√≥n del negocio",completed:$.businessLocationVerified,icon:le}]:s==="repartidor"?[...t,{name:"Tipo de veh√≠culo",completed:!!r.vehicleType&&r.vehicleType!=="No especificado",icon:Me},{name:"N√∫mero de licencia",completed:!!r.licenseNumber&&r.licenseNumber!=="No especificado",icon:fe}]:t},a=()=>s==="vendedor"&&$.canPublish?{message:"¬°Puedes publicar productos!",type:"success"}:s==="comprador"&&$.canPurchase?{message:"¬°Puedes realizar compras!",type:"success"}:s==="repartidor"&&$.canWork?{message:"¬°Puedes tomar √≥rdenes!",type:"success"}:{message:"Completa todos los requisitos",type:"warning"},c=J(),d=c.filter(t=>t.completed).length,p=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(W,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[p.type==="success"?e.jsx(ie,{className:"w-5 h-5 text-green-500"}):e.jsx(_e,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{children:"Estado de Verificaci√≥n"})]})}),e.jsx(B,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${p.type==="success"?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:[e.jsx("p",{className:`font-medium ${p.type==="success"?"text-green-800":"text-orange-800"}`,children:p.message}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[d," de ",c.length," requisitos completados"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:c.map(t=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border",children:[e.jsx(t.icon,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:t.name}),t.completed?e.jsx(ie,{className:"w-4 h-4 text-green-500 ml-auto"}):e.jsx(ye,{className:"w-4 h-4 text-red-500 ml-auto"})]},t.name))})]})})]}),e.jsxs(W,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{children:"Ubicaci√≥n Personal"}),$.locationVerified&&e.jsx(se,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(B,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n"}),e.jsx(H,{value:j.address,onChange:t=>x(h=>({...h,address:t.target.value})),placeholder:"Tu direcci√≥n",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(k,{onClick:N,disabled:v,className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50",variant:"outline",style:{borderColor:"#2563eb",color:"#2563eb",backgroundColor:"white",fontWeight:"600"},children:v?"Obteniendo...":"Obtener Ubicaci√≥n Actual"})})]}),j.latitude&&j.longitude&&e.jsx("div",{className:"p-3 bg-gray-50 rounded border",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas: ",j.latitude,", ",j.longitude]})}),e.jsx(k,{onClick:P,disabled:L||!j.latitude||!j.longitude,className:"w-full",children:L?"Guardando...":"Verificar Ubicaci√≥n Personal"})]})]}),s==="vendedor"&&e.jsxs(W,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Ubicaci√≥n del Negocio"}),$.businessLocationVerified&&e.jsx(se,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(B,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n del Negocio"}),e.jsx(H,{value:S.address,onChange:t=>b(h=>({...h,address:t.target.value})),placeholder:"Direcci√≥n de tu negocio",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(k,{onClick:()=>{N(),j.latitude&&j.longitude&&b(t=>({...t,latitude:j.latitude,longitude:j.longitude}))},disabled:v,className:"w-full",variant:"outline",children:"Usar Ubicaci√≥n Actual"})})]}),e.jsx(k,{onClick:U,disabled:L||!S.latitude||!S.longitude,className:"w-full",children:L?"Guardando...":"Verificar Ubicaci√≥n del Negocio"})]})]}),e.jsxs(W,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{children:"Informaci√≥n del Perfil"})]})}),e.jsxs(B,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tel√©fono"}),e.jsx(H,{value:r.phone,onChange:t=>l(h=>({...h,phone:t.target.value})),placeholder:"+502 1234-5678",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Perfil"}),e.jsx(H,{value:r.profileImage,onChange:t=>l(h=>({...h,profileImage:t.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="vendedor"&&e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Portada"}),e.jsx(H,{value:r.coverImage,onChange:t=>l(h=>({...h,coverImage:t.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="repartidor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tipo de Veh√≠culo"}),e.jsx(H,{value:r.vehicleType,onChange:t=>l(h=>({...h,vehicleType:t.target.value})),placeholder:"Motocicleta, Autom√≥vil, Bicicleta...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"N√∫mero de Licencia"}),e.jsx(H,{value:r.licenseNumber,onChange:t=>l(h=>({...h,licenseNumber:t.target.value})),placeholder:"M-123456",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]})]})]}),e.jsx(k,{onClick:Z,disabled:L,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold",style:{backgroundColor:"#2563eb",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"600"},children:L?"Actualizando...":"Actualizar Perfil"})]})]})]})}function Cs(s){const{user:f}=xe(),[g,j]=m.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1,requirements:{phone:!1,profileImage:!1,coverImage:!1,location:!1,businessLocation:!1,vehicleType:!1,licenseNumber:!1,adminApproval:!1}}),[x,S]=m.useState(!0);m.useEffect(()=>{f&&b()},[f,s]);const b=async()=>{if(f)try{S(!0);const{data:i,error:v}=await w.from("users").select("*").eq("id",f.id).single();if(v)throw v;let E=null;if(s==="vendedor"){const{data:P,error:U}=await w.from("sellers").select("*").eq("user_id",f.id).single();U||(E=P)}const C={phone:!!(i.phone&&i.phone.trim()!==""),profileImage:!!(i.profile_image_url&&i.profile_image_url.trim()!==""),coverImage:s==="vendedor"?!!(E!=null&&E.cover_image_url&&E.cover_image_url.trim()!==""):!0,location:!!(i.location_verified&&i.latitude&&i.longitude&&i.address),businessLocation:s==="vendedor"?!!(E!=null&&E.business_location_verified&&E.business_latitude&&E.business_longitude&&E.business_address):!0,vehicleType:s==="repartidor"?!!(i.vehicle_type&&i.vehicle_type!=="No especificado"):!0,licenseNumber:s==="repartidor"?!!(i.license_number&&i.license_number!=="No especificado"):!0,adminApproval:s==="repartidor"?!!(i.is_verified&&i.is_active):!0};let N=!1;if(s==="vendedor"){const{data:P,error:U}=await w.rpc("check_seller_can_publish",{seller_user_id:f.id});U||(N=P)}else if(s==="comprador"){const{data:P,error:U}=await w.rpc("check_buyer_can_purchase",{buyer_user_id:f.id});U||(N=P)}else if(s==="repartidor"){const{data:P,error:U}=await w.rpc("check_driver_can_work",{driver_user_id:f.id});U||(N=P)}j({locationVerified:i.location_verified||!1,businessLocationVerified:(E==null?void 0:E.business_location_verified)||!1,profileCompleted:i.profile_completed||!1,canPublish:s==="vendedor"?N:!1,canPurchase:s==="comprador"?N:!1,canWork:s==="repartidor"?N:!1,requirements:C})}catch(i){console.error("Error checking verification status:",i)}finally{S(!1)}};return{status:g,loading:x,refreshStatus:()=>{b()},getCompletionPercentage:()=>{const i=Object.values(g.requirements).length,v=Object.values(g.requirements).filter(Boolean).length;return Math.round(v/i*100)},getMissingRequirements:()=>{const i=[];return g.requirements.phone||i.push("Tel√©fono"),g.requirements.profileImage||i.push("Foto de perfil"),g.requirements.location||i.push("Ubicaci√≥n verificada"),s==="vendedor"&&(g.requirements.coverImage||i.push("Foto de portada"),g.requirements.businessLocation||i.push("Ubicaci√≥n del negocio")),s==="repartidor"&&(g.requirements.vehicleType||i.push("Tipo de veh√≠culo"),g.requirements.licenseNumber||i.push("N√∫mero de licencia"),g.requirements.adminApproval||i.push("Aprobaci√≥n del administrador")),i},canPerformMainAction:()=>{switch(s){case"vendedor":return g.canPublish;case"comprador":return g.canPurchase;case"repartidor":return g.canWork;default:return!1}},getMainActionText:()=>{switch(s){case"vendedor":return g.canPublish?"Puedes publicar productos":"No puedes publicar productos a√∫n";case"comprador":return g.canPurchase?"Puedes realizar compras":"No puedes comprar a√∫n";case"repartidor":return g.canWork?"Puedes tomar √≥rdenes":"No puedes trabajar a√∫n";default:return""}}}}function qa({userRole:s,onOpenVerification:f,showIfComplete:g=!1}){const{loading:j,canPerformMainAction:x,getMissingRequirements:S,getCompletionPercentage:b}=Cs(s);if(j)return null;const r=x(),l=S(),$=b();if(s==="vendedor"||r&&!g)return null;const A=()=>{switch(s){case"vendedor":return Ke;case"comprador":return le;case"repartidor":return Ee;default:return _e}},L=()=>{if(r)switch(s){case"vendedor":return"¬°Perfil completo! Puedes publicar productos";case"comprador":return"¬°Perfil completo! Puedes realizar compras";case"repartidor":return"¬°Perfil completo! Puedes tomar √≥rdenes";default:return"¬°Perfil completo!"}switch(s){case"vendedor":return"Completa tu perfil para publicar productos";case"comprador":return"Completa tu perfil para realizar compras";case"repartidor":return"Completa tu perfil para trabajar como repartidor";default:return"Completa tu perfil"}},i=()=>r?"Tu perfil est√° completamente verificado y puedes usar todas las funciones de TRATO.":l.length===0?"Casi listo, solo faltan algunos detalles por verificar.":l.length===1?`Te falta 1 requisito: ${l[0]}.`:`Te faltan ${l.length} requisitos: ${l.slice(0,2).join(", ")}${l.length>2?" y m√°s...":""}.`,v=A();return e.jsx(de,{className:`verification-alert mb-6 ${r?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 w-full",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:`w-6 h-6 flex-shrink-0 mt-1 ${r?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-lg leading-tight ${r?"text-green-800":"text-orange-800"}`,children:L()}),e.jsx(me,{className:`alert-description mt-1 text-sm ${r?"text-green-700":"text-orange-700"}`,children:i()}),!r&&e.jsxs("div",{className:"verification-progress mt-3 space-y-2",children:[e.jsxs("div",{className:"verification-progress-label flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-orange-800",children:"Progreso del perfil"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[$,"%"]})]}),e.jsx("div",{className:"verification-progress-bar w-full bg-orange-200 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${$}%`}})})]})]})]}),e.jsx("div",{className:"flex justify-center md:justify-end mt-4 md:mt-0 md:ml-4",children:e.jsx(k,{onClick:f,className:`verification-button px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 ${r?"bg-green-500 hover:bg-green-600 hover:shadow-green-200":"bg-orange-500 hover:bg-orange-600 hover:shadow-orange-200"}`,style:{minWidth:"160px",borderRadius:"8px",fontSize:"14px",fontWeight:"600"},children:r?"Ver Estado":"Completar Perfil"})})]})})}function Ra({onDismiss:s}){const{user:f}=xe(),{permission:g,requestPermission:j,supported:x}=Ps(),[S,b]=m.useState(!1),[r,l]=m.useState(!1);m.useEffect(()=>{const v=x&&g!=="granted"&&g!=="denied"&&((f==null?void 0:f.role)==="vendedor"||(f==null?void 0:f.role)==="repartidor");l(v)},[x,g,f==null?void 0:f.role]);const $=async()=>{b(!0);try{await j()&&(l(!1),s==null||s())}catch(v){console.error("Error al solicitar permisos:",v)}finally{b(!1)}},A=()=>{l(!1),s==null||s()};if(!r)return null;const i=(()=>{switch(f==null?void 0:f.role){case"vendedor":return{title:"Notificaciones de Nuevas √ìrdenes",description:"Recibe alertas inmediatas cuando lleguen nuevos pedidos, incluso con la pantalla apagada.",benefits:["üì± Notificaciones incluso con pantalla apagada","üîî Alertas sonoras para nuevos pedidos","‚ö° Respuesta m√°s r√°pida a clientes"]};case"repartidor":return{title:"Notificaciones de Entregas",description:"Mantente informado sobre nuevas entregas disponibles y asignaciones.",benefits:["üöõ Alertas de nuevas entregas","üìç Notificaciones de asignaciones","üí∞ No pierdas oportunidades de entrega"]};default:return{title:"Notificaciones Push",description:"Recibe notificaciones importantes de la aplicaci√≥n.",benefits:["üîî Alertas importantes","üì± Notificaciones push","‚ö° Informaci√≥n en tiempo real"]}}})();return e.jsxs(W,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-lg",children:[e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(la,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx(X,{className:"text-lg text-orange-900",children:i.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:i.description})]})]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:A,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:e.jsx(Ce,{className:"w-4 h-4"})})]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:i.benefits.map((v,E)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-800",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),v]},E))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:g==="granted"?"default":g==="denied"?"destructive":"secondary",className:"flex items-center gap-1",children:g==="granted"?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-3 h-3"}),"Activadas"]}):g==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3"}),"Denegadas"]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-3 h-3"}),"Pendientes"]})}),!x&&e.jsx(se,{variant:"outline",className:"text-gray-600",children:"No soportadas en este navegador"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(k,{onClick:$,disabled:S||!x||g==="granted",className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",children:S?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2 animate-spin"}),"Solicitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Activar Notificaciones"]})}),e.jsx(k,{variant:"outline",onClick:A,className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:"Ahora no"})]}),g==="denied"&&e.jsxs(de,{className:"border-red-200 bg-red-50",children:[e.jsx(_e,{className:"w-4 h-4 text-red-600"}),e.jsx(me,{className:"text-red-800 text-sm",children:"Las notificaciones fueron denegadas. Para activarlas, ve a configuraci√≥n del navegador ‚Üí Notificaciones ‚Üí Permitir para este sitio."})]})]})]})}function za({onPermissionChange:s,userRole:f="buyer",className:g=""}){const[j,x]=m.useState("default"),[S,b]=m.useState(!1);m.useEffect(()=>{"Notification"in window&&x(Notification.permission)},[]);const r=async()=>{if(!("Notification"in window)){alert("Tu navegador no soporta notificaciones");return}if(j!=="granted"){b(!0);try{const l=await Notification.requestPermission();x(l),l==="granted"?(s==null||s(!0),new Notification("¬°TRATO Notificaciones Activas!",{body:"Las notificaciones est√°n funcionando correctamente",icon:"/favicon.ico"})):s==null||s(!1)}catch(l){console.error("Error requesting notification permission:",l)}finally{b(!1)}}};return j==="granted"?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-green-700 ${g}`,children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Notificaciones activas"})]}):e.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${g}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Configurar Notificaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:j==="denied"?"Notificaciones bloqueadas":"Activa las notificaciones para recibir alertas"})]})]}),j!=="denied"&&e.jsx("button",{onClick:r,disabled:S,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:S?"Activando...":"Activar"})]}),j==="denied"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("p",{className:"text-sm text-red-700",children:'Las notificaciones est√°n bloqueadas. Para activarlas, haz clic en el √≠cono del candado en la barra de direcciones y selecciona "Permitir".'})})]})}function Fa({onNotification:s}){const{user:f}=xe(),g=m.useCallback(()=>{try{const b=new(window.AudioContext||window.webkitAudioContext),r=(l,$,A=0)=>{setTimeout(()=>{const L=b.createOscillator(),i=b.createGain();L.connect(i),i.connect(b.destination),L.frequency.setValueAtTime(l,b.currentTime),L.type="sine",i.gain.setValueAtTime(.4,b.currentTime),i.gain.exponentialRampToValueAtTime(.01,b.currentTime+$),L.start(b.currentTime),L.stop(b.currentTime+$)},A)};r(880,.3,0),r(1100,.3,400),r(1320,.4,800),setTimeout(()=>{r(880,.3,0),r(1100,.3,400),r(1320,.4,800)},1500),setTimeout(()=>{r(880,.3,0),r(1100,.3,400),r(1320,.4,800)},3e3)}catch(b){console.warn("Web Audio API no disponible:",b)}if(navigator.vibrate&&navigator.vibrate([500,200,300,200,500,200,300,200,500]),"Notification"in window&&Notification.permission==="granted"){const b=new Notification("üõí Nueva Orden - TRATO",{body:"Tienes un nuevo pedido esperando confirmaci√≥n",icon:"/assets/trato-logo.png",badge:"/assets/trato-logo.png",tag:"critical-order",requireInteraction:!0,silent:!1,data:{type:"new_order",timestamp:Date.now(),sound:"critical"}});setTimeout(()=>{b&&typeof b.close=="function"&&b.close()},3e4)}},[]),j=m.useCallback(async()=>{if(f)try{if("Notification"in window){let r=Notification.permission;if(r==="default"&&(r=await Notification.requestPermission()),r!=="granted"){console.warn("‚ùå Permisos de notificaci√≥n denegados");return}console.log("‚úÖ Permisos de notificaci√≥n concedidos")}if("serviceWorker"in navigator){const r=await navigator.serviceWorker.ready;console.log("‚úÖ Service Worker activo:",r.scope),navigator.serviceWorker.addEventListener("message",l=>{console.log("üì® Mensaje desde Service Worker:",l.data),l.data.type==="PLAY_NOTIFICATION_SOUND"?g():l.data.type==="NOTIFICATION_CLICK"&&(window.focus(),l.data.url&&l.data.url!==window.location.pathname&&(window.location.href=l.data.url))})}const b=w.channel(`push-notifications-${f.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"push_notifications_queue",filter:`user_id=eq.${f.id}`},async r=>{console.log("üî• Nueva notificaci√≥n push:",r);const l=r.new;if((l.type==="new_order"||l.priority>=3)&&g(),"Notification"in window&&Notification.permission==="granted"){const $=new Notification(l.title,{body:l.body,icon:"/assets/trato-logo.png",badge:"/assets/trato-logo.png",tag:`push-${l.id}`,requireInteraction:l.priority>=3,silent:!1,data:l.data});l.priority<3&&setTimeout(()=>{$.close()},15e3)}s==null||s(l.type,l.body,l.data),await w.from("push_notifications_queue").update({sent:!0,sent_at:new Date().toISOString()}).eq("id",l.id)}).subscribe();return console.log("‚úÖ Suscripci√≥n a notificaciones push configurada"),()=>{b.unsubscribe()}}catch(b){console.error("‚ùå Error configurando notificaciones push:",b)}},[f,g,s]),x=m.useCallback(()=>{console.log("üß™ Probando notificaci√≥n cr√≠tica..."),g(),s==null||s("test","Notificaci√≥n de prueba - Nuevo pedido simulado"),"Notification"in window&&Notification.permission==="granted"&&new Notification("üß™ Prueba de Sonido - TRATO",{body:"Si escuchas esto, las notificaciones funcionan correctamente",icon:"/assets/trato-logo.png",requireInteraction:!0,silent:!1})},[g,s]),S=m.useCallback(()=>{document.hidden?console.log("üì± App en background - notificaciones cr√≠ticas activadas"):console.log("üì± App en foreground - notificaciones normales")},[]);return m.useEffect(()=>{if(!f)return;let b;return(async()=>{b=await j()})(),document.addEventListener("visibilitychange",S),window.testTratoNotifications=x,console.log("üéØ Sistema de notificaciones cr√≠ticas inicializado"),console.log("Para probar: window.testTratoNotifications()"),()=>{b==null||b(),document.removeEventListener("visibilitychange",S),delete window.testTratoNotifications}},[f,j,S,x]),null}function jr(){const{user:s,signOut:f}=xe(),{canPerformMainAction:g,refreshStatus:j}=Cs("vendedor"),[x,S]=m.useState("dashboard"),[b,r]=m.useState("list"),[l,$]=m.useState([]),[A,L]=m.useState([]),[i,v]=m.useState(!0),[E,C]=m.useState(""),[N,P]=m.useState(0),[U,Z]=m.useState(""),[V,J]=m.useState([]),[a,c]=m.useState(null),[d,p]=m.useState(null),[t,h]=m.useState(!1),[_,D]=m.useState({totalProducts:0,dailyProducts:0,totalViews:0,totalSales:0,revenue:0,avgRating:0}),q=(u,I)=>{console.log(`üö® Alerta cr√≠tica: ${u} - ${I}`),u==="new_order"?(J(n=>[...n,{id:Date.now().toString(),message:`üî• ¬°NUEVO PEDIDO! ${I}`,timestamp:new Date().toISOString(),type:"order",color:"green"}].slice(0,10)),"Notification"in window&&Notification.permission==="granted"&&new Notification("¬°Nuevo Pedido!",{body:I,icon:"/favicon.ico",badge:"/favicon.ico"})):u.includes("stock")?J(n=>[...n,{id:Date.now().toString(),message:`‚ö†Ô∏è ${I}`,timestamp:new Date().toISOString(),type:"product",color:"red"}].slice(0,10)):J(n=>[...n,{id:Date.now().toString(),message:`üö® ${I}`,timestamp:new Date().toISOString(),type:"order",color:"yellow"}].slice(0,10))},re=u=>{console.log(`‚è∞ Timeout cr√≠tico: Orden ${u.orderId} - ${u.timeSinceStatus} min`),J(I=>[...I,{id:Date.now().toString(),message:`üïí Orden #${u.orderId.slice(-6)} lleva ${u.timeSinceStatus} min en ${u.status}`,timestamp:new Date().toISOString(),type:"order",color:"orange"}].slice(0,10))};m.useEffect(()=>{s&&(K(),ne(),je(),ke(),Se(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(u=>{console.log(`üîî Permisos de notificaci√≥n: ${u}`),u==="granted"?console.log("‚úÖ Notificaciones habilitadas para nuevos pedidos"):console.warn("‚ö†Ô∏è Notificaciones bloqueadas - solo sonido y alertas visuales")}))},[s]),m.useEffect(()=>{const u=setInterval(()=>{(x==="dashboard"||x==="products")&&ne()},6e4);return()=>clearInterval(u)},[x]);const K=async()=>{try{const{data:u,error:I}=await w.from("products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(I)throw I;$(u||[])}catch(u){console.error("Error loading products:",u),C("Error al cargar productos")}},ne=async()=>{try{const{data:u,error:I}=await w.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(I)throw I;L(u||[])}catch(u){console.error("Error loading daily products:",u),C("Error al cargar productos del d√≠a")}finally{v(!1)}},je=async()=>{try{const u=l.length,I=A.length;let n=0,o=0,O=0;try{const{data:T,error:M}=await w.from("orders").select("id").limit(1);if(M)console.log("Orders table not available yet, using default stats");else{const{data:R,error:G}=await w.from("orders").select("id, total, status, created_at").eq("seller_id",s==null?void 0:s.id);!G&&R&&(n=R.length,o=R.filter(Q=>Q.status==="delivered").reduce((Q,Y)=>Q+(Y.total||0),0),console.log(`Loaded ${n} orders, revenue: Q${o}`));try{const{data:Q,error:Y}=await w.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s==null?void 0:s.id).single();!Y&&Q?(O=Q.average_rating||0,console.log(`üåü Seller rating: ${O} from ${Q.total_reviews} reviews`)):console.log("No ratings found for seller, showing 0.0")}catch{console.log("Rating system not available, using 0.0")}}}catch{console.log("Orders system not configured yet, using default stats")}D({totalProducts:u,dailyProducts:I,totalViews:Math.floor(Math.random()*1e3)+500,totalSales:n,revenue:o,avgRating:O})}catch(u){console.error("Error loading stats:",u),D({totalProducts:l.length,dailyProducts:A.length,totalViews:0,totalSales:0,revenue:0,avgRating:0})}},Pe=()=>{K(),ke(),r("list")},ze=()=>{ne(),ke(),r("list")},Fe=u=>{c(u),r("edit-product")},Ue=u=>{p(u),r("edit-daily")},Ve=()=>{K(),c(null),r("list")},Te=()=>{ne(),p(null),r("list")},y=async u=>{try{const{error:I}=await w.from("products").delete().eq("id",u);if(I)throw I;K()}catch(I){console.error("Error deleting product:",I),C("Error al eliminar producto")}},ee=async u=>{try{const{error:I}=await w.from("daily_products").delete().eq("id",u);if(I)throw I;ne()}catch(I){console.error("Error deleting daily product:",I),C("Error al eliminar producto del d√≠a")}},Se=m.useCallback(async()=>{if(s!=null&&s.id)try{const u=w.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},I=>{console.log("üîî Nueva orden recibida:",I),P(T=>T+1);const n=I.new,o=new CustomEvent("criticalNotification",{detail:{type:"new_order",message:`üéØ NUEVA ORDEN: Q${n.total||"0.00"} - ${n.notes||"Sin notas"}`,urgency:"high",sound:!0,persist:!0,metadata:{order_id:n.id,total:n.total,buyer_name:n.buyer_name,created_at:n.created_at}}});window.dispatchEvent(o),Notification.permission==="granted"&&new Notification("¬°Nueva orden en TRATO!",{body:`Tienes un nuevo pedido por Q${n.total||"0.00"}`,icon:"/favicon.ico",tag:"new-order",requireInteraction:!0}),(async()=>{try{await w.from("critical_alerts").insert({alert_type:"new_order",order_id:n.id,user_id:s==null?void 0:s.id,message:`Nueva orden recibida: Q${n.total||"0.00"}`,urgency_level:"high",metadata:{total:n.total,buyer_name:n.buyer_name,notification_sent:!0}})}catch(T){console.error("Error logging critical alert:",T)}})(),Z(new Date().toISOString())}).subscribe();if(Notification.permission==="default"){const I=await Notification.requestPermission();console.log("Notification permission:",I)}return()=>{u.unsubscribe()}}catch(u){console.error("Error setting up order notifications:",u)}},[s==null?void 0:s.id]),Ie=m.useCallback(async()=>{if(s!=null&&s.id)try{const{data:u,error:I}=await w.from("orders").select("id").limit(1);if(!I){const n=new Date().toISOString(),o=`seller_last_notification_${s.id}`,O=localStorage.getItem(o);if(O){const{data:T,error:M}=await w.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).gt("created_at",O).order("created_at",{ascending:!1});!M&&T&&T.length>0&&(P(R=>R+T.length),localStorage.setItem(o,n),console.log(`üì¶ Found ${T.length} new orders since ${O}`))}else{const{data:T,error:M}=await w.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).eq("status","pending").order("created_at",{ascending:!1});!M&&T&&T.length>0&&(P(T.length),console.log(`üì¶ Found ${T.length} pending orders (first check)`)),localStorage.setItem(o,n)}}}catch(u){console.log("üì¶ Orders table not available for notifications:",u)}},[s==null?void 0:s.id]);m.useEffect(()=>{if(!(s!=null&&s.id))return;Ie();const u=setInterval(()=>{Ie()},3e4);return()=>clearInterval(u)},[s==null?void 0:s.id]);const ke=async()=>{try{const u=[];if(l.length>0){const n=l[0];u.push({id:`product-${n.id}`,type:"product",message:`Producto agregado: "${n.name}"`,timestamp:n.created_at,color:"green"})}if(A.length>0){const n=A[0];u.push({id:`daily-${n.id}`,type:"daily_product",message:`Venta del d√≠a creada: "${n.name}"`,timestamp:n.created_at,color:"orange"})}try{const{data:n,error:o}=await w.from("orders").select("id").limit(1);if(!o){const{data:O,error:T}=await w.from("orders").select("id, status, created_at, total").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1}).limit(3);!T&&O&&O.length>0&&O.forEach(M=>{let R="",G="blue";switch(M.status){case"pending":R=`Nueva orden recibida (Q${M.total})`,G="yellow";break;case"confirmed":R=`Orden confirmada (Q${M.total})`,G="blue";break;case"preparing":R=`Orden en preparaci√≥n (Q${M.total})`,G="orange";break;case"ready":R=`Orden lista (Q${M.total})`,G="purple";break;case"delivered":R=`Orden entregada (Q${M.total})`,G="green";break;case"cancelled":R=`Orden cancelada (Q${M.total})`,G="red";break;default:R=`Orden ${M.status} (Q${M.total})`,G="blue"}u.push({id:`order-${M.id}`,type:"order",message:R,timestamp:M.created_at,color:G})})}}catch{console.log("Orders table not available for activity")}const I=u.sort((n,o)=>new Date(o.timestamp).getTime()-new Date(n.timestamp).getTime()).slice(0,5);J(I)}catch(u){console.error("Error loading recent activity:",u)}},Ae=u=>{const I=new Date().getTime(),n=new Date(u).getTime(),o=I-n,O=Math.floor(o/(1e3*60)),T=Math.floor(o/(1e3*60*60)),M=Math.floor(o/(1e3*60*60*24));return O<60?O<=1?"Hace un momento":`Hace ${O} minutos`:T<24?T===1?"Hace 1 hora":`Hace ${T} horas`:M===1?"Ayer":`Hace ${M} d√≠as`},Ge=()=>{const u=new Date,I=new Date;I.setHours(23,59,59,999);const n=I.getTime()-u.getTime(),o=Math.floor(n/(1e3*60*60)),O=Math.floor(n%(1e3*60*60)/(1e3*60));return`${o}h ${O}m`},De=[{id:"dashboard",label:"Inicio",icon:Zs,description:"Resumen y estad√≠sticas"},{id:"products",label:"Productos",icon:ia,description:"Gestiona tu men√∫"},{id:"orders",label:"Pedidos",icon:ua,description:"√ìrdenes y analytics",hasNotification:N>0,notificationCount:N},{id:"profile",label:"Perfil",icon:Ke,description:"Configuraci√≥n del negocio"}],ve=()=>e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(W,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dashboard-welcome",style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",color:"white",padding:"24px",borderRadius:"16px",marginBottom:"16px"},children:e.jsx(te,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-2 md:p-3 rounded-xl",children:e.jsx(be,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(X,{className:"text-lg md:text-2xl text-white leading-tight",style:{color:"white",fontSize:"20px"},children:"¬°Bienvenido, Interlano Fernando Interiano! üëã"}),e.jsx("p",{className:"text-sm md:text-base text-white mt-1",style:{color:"white",fontSize:"16px"},children:"Gestiona tu negocio y conecta con m√°s clientes en Gual√°n"})]})]})})}),e.jsxs("div",{className:"dashboard-stats",style:{display:"grid",gridTemplateColumns:window.innerWidth<=768?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:"12px",marginBottom:"16px"},children:[e.jsx(W,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Productos"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:_.totalProducts})]}),e.jsx(ue,{className:"w-6 h-6 md:w-8 md:h-8 text-blue-500"})]})})}),e.jsx(W,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas del D√≠a"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:_.dailyProducts})]}),e.jsx(ae,{className:"w-6 h-6 md:w-8 md:h-8 text-orange-500"})]})})}),e.jsx(W,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:_.totalSales})]}),e.jsx(Ms,{className:"w-6 h-6 md:w-8 md:h-8 text-green-500"})]})})}),e.jsx(W,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(B,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Calificaci√≥n"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:_.avgRating.toFixed(1)})]}),e.jsx(na,{className:"w-6 h-6 md:w-8 md:h-8 text-yellow-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(W,{children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-green-500"}),"Ingresos del Mes"]})}),e.jsxs(B,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["Q",_.revenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"+12% comparado al mes pasado"})]})]}),e.jsxs(W,{children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(da,{className:"w-5 h-5 text-blue-500"}),"Vistas del Perfil"]})}),e.jsxs(B,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:_.totalViews.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vistas esta semana"})]})]})]}),e.jsxs(W,{children:[e.jsx(te,{children:e.jsx(X,{children:"Acciones R√°pidas"})}),e.jsx(B,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(k,{onClick:()=>{if(!g()){h(!0);return}S("products"),r("add-product")},className:"h-20 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx(We,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Nuevo Producto"})]})}),e.jsx(k,{onClick:()=>{if(!g()){h(!0);return}S("products"),r("add-daily")},variant:"outline",className:"h-20 border-orange-500 text-orange-600 hover:bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Venta del D√≠a"})]})}),e.jsx(k,{onClick:()=>S("profile"),variant:"outline",className:"h-20 border-blue-500 text-blue-600 hover:bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Editar Perfil"})]})})]})})]}),e.jsxs(W,{children:[e.jsx(te,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Actividad Reciente"]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-3",children:V.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay actividad reciente"})]}):V.map(u=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-${u.color}-50 rounded-lg`,children:[e.jsx("div",{className:`w-2 h-2 bg-${u.color}-500 rounded-full`}),e.jsx("p",{className:"text-sm flex-1",children:u.message}),e.jsx("span",{className:"text-xs text-gray-500",children:Ae(u.timestamp)})]},u.id))})})]})]}),Oe=()=>b==="add-product"?e.jsx(as,{onSuccess:Pe,onCancel:()=>r("list")}):b==="add-daily"?e.jsx(rs,{onSuccess:ze,onCancel:()=>r("list")}):b==="edit-product"&&a?e.jsx(as,{product:a,onSuccess:Ve,onCancel:()=>{c(null),r("list")}}):b==="edit-daily"&&d?e.jsx(rs,{dailyProduct:d,onSuccess:Te,onCancel:()=>{p(null),r("list")}}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 leading-tight",children:"Gesti√≥n de Productos"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Administra tu men√∫ y ofertas especiales"})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[e.jsxs(k,{onClick:()=>r("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),e.jsxs(k,{onClick:()=>r("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Venta del D√≠a"]})]})]}),e.jsxs(He,{defaultValue:"products",className:"space-y-6",children:[e.jsxs(Je,{className:"grid w-full grid-cols-2 h-auto p-1 bg-gray-100 rounded-lg",children:[e.jsxs(he,{value:"products",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ue,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos Normales"}),e.jsx("span",{className:"sm:hidden",children:"Normales"}),e.jsxs("span",{className:"ml-1",children:["(",l.length,")"]})]}),e.jsxs(he,{value:"daily",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos del D√≠a"}),e.jsx("span",{className:"sm:hidden",children:"Del D√≠a"}),e.jsxs("span",{className:"ml-1",children:["(",A.length,")"]})]})]}),e.jsx(ce,{value:"products",className:"space-y-4",children:i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-gray-400"})}):l.length===0?e.jsx(W,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(B,{className:"p-8 md:p-12 text-center",children:[e.jsx(ue,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos a√∫n"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Comienza agregando tu primer producto para empezar a vender"}),e.jsxs(k,{onClick:()=>r("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Agregar Primer Producto"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:l.map(u=>e.jsx(wa,{product:u,onEdit:Fe,onDelete:y},u.id))})}),e.jsxs(ce,{value:"daily",className:"space-y-4",children:[A.length>0&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-orange-800 text-sm sm:text-base",children:"Tiempo restante:"})]}),e.jsx("span",{className:"font-bold text-orange-800 text-sm sm:text-base",children:Ge()})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Los productos del d√≠a se eliminan autom√°ticamente a las 23:59:59"})]}),i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-gray-400"})}):A.length===0?e.jsx(W,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(B,{className:"p-8 md:p-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos del d√≠a"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Crea ofertas especiales que duran solo hasta medianoche"}),e.jsxs(k,{onClick:()=>r("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Crear Venta del D√≠a"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:A.map(u=>e.jsx(_a,{dailyProduct:u,onEdit:Ue,onDelete:ee},u.id))})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx(Os,{showBanner:!0,enableAutoActivation:!0}),e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx(za,{onPermissionChange:u=>{console.log("üîî Permisos de notificaci√≥n cambiados:",u)}})}),e.jsx(sa,{onNotification:q}),e.jsx(Fa,{onNotification:q}),e.jsx(Qs,{onAlert:re}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"TRATO Vendedor"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Panel de control empresarial"})]})]}),e.jsxs(k,{variant:"outline",onClick:f,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(ta,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar Sesi√≥n"}),e.jsx("span",{className:"sm:hidden",children:"Salir"})]})]})})}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[E&&e.jsxs(de,{variant:"destructive",className:"mb-4 md:mb-6",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(me,{className:"text-sm md:text-base",children:E})]}),e.jsx(qa,{userRole:"vendedor",onOpenVerification:()=>h(!0)}),e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(Ra,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-4 gap-1",children:De.map(u=>{const I=u.icon,n=x===u.id;return e.jsxs("button",{onClick:()=>{S(u.id),u.id==="orders"&&P(0)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:n?"#fef3c7":"transparent",color:n?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"w-5 h-5"}),u.hasNotification&&u.notificationCount&&u.notificationCount>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#ef4444",color:"white",fontSize:"10px",borderRadius:"50%",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 2s infinite"},children:u.notificationCount>9?"9+":u.notificationCount})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:u.label})]},u.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(He,{value:x,onValueChange:u=>S(u),className:"space-y-6",children:[e.jsx(Je,{className:"grid w-full grid-cols-4 lg:w-2/3 mx-auto bg-white border border-gray-200",children:De.map(u=>{const I=u.icon;return e.jsxs(he,{value:u.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",onClick:()=>{u.id==="orders"&&P(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"w-5 h-5"}),u.hasNotification&&u.notificationCount&&u.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:u.notificationCount>9?"9+":u.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:u.label})]},u.id)})}),e.jsx(ce,{value:"dashboard",className:"space-y-6",children:ve()}),e.jsx(ce,{value:"products",className:"space-y-6",children:Oe()}),e.jsx(ce,{value:"orders",className:"space-y-6",children:e.jsx(ns,{})}),e.jsx(ce,{value:"profile",className:"space-y-6",children:e.jsx(ts,{})})]})}),e.jsxs("div",{className:"block md:hidden mt-4",children:[x==="dashboard"&&ve(),x==="products"&&Oe(),x==="orders"&&e.jsx(ns,{}),x==="profile"&&e.jsx(ts,{})]})]}),e.jsx(Ts,{open:t,onOpenChange:h,children:e.jsxs(Is,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(As,{children:e.jsxs(Ds,{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Verificaci√≥n de Perfil y Ubicaci√≥n"})]})}),e.jsx(La,{userRole:"vendedor",onVerificationComplete:()=>{h(!1),j()}})]})}),e.jsx(Ks,{}),e.jsx($s,{onNewOrder:()=>{x==="orders"&&window.location.reload()}})]})}export{jr as SellerDashboard};
