import{g as ve,r as u,s as $,h as we,j as e,B as F,f as K,R as ke,X as Ie,C as G,c as U,I as ge,a as W,b as X,u as Ne,i as vs,E as We,t as H,e as ae,P as Ns,d as be,S as de,k as Xe,l as Se,m as Ws,n as bs,o as De,p as qe,q as Ge,v as Xs,w as Zs,x as Ys,y as Js,z as ea,A as sa,F as aa,G as ys,H as Ue,J as ra,K as ta,M as ia}from"./index-9d4LIYkQ.js";import{P as te,T as $e,a as Le,b as pe,c as Oe,d as xe,D as na,e as ws,R as la,I as oa,u as ca,N as da}from"./NotificationSystem-Ddtne5eA.js";import{g as as,a as ma,F as _e,P as fe,B as _s,u as Ze,p as ks,R as xa,S as ua,C as Te,A as Cs,b as rs,O as ts,T as ga,H as is,c as ha}from"./TimeoutAlerts-wkxpdcwV.js";import{S as je}from"./shopping-cart-1rXuWJmP.js";import{S as Ee,M as Qe,A as pa,a as fa,b as ja,c as va,d as Na,e as ba,f as ya,g as wa,h as _a}from"./alert-dialog-8z5-otMa.js";import{I as he}from"./input-DD8qTseN.js";import{S as ka,a as Ca,b as Sa,c as Ea,d as ns}from"./select-D6a4Dncp.js";import{S as ie}from"./store-B3Rc6OOo.js";import{S as re}from"./star-BemJn4BC.js";import{M as ye}from"./map-pin-Ctpb2SRl.js";import{C as me}from"./clock-BLcblUBq.js";import{C as Re}from"./circle-x-CvCVlv_1.js";import{T as ne}from"./truck-B_KZSvWh.js";import{T as Fe}from"./textarea-3tMjESen.js";import{A as Pa,a as Ia}from"./alert-BYteypOu.js";import{T as ze}from"./trash-2-Q3a_8Zc1.js";import{T as ls}from"./triangle-alert-BAlJ0FTm.js";import{C as Pe,a as Ta,P as He,b as Ra}from"./CriticalNotifications-ol96pFnl.js";import{L as ce}from"./label-lZvX4CTh.js";import{M as Aa}from"./mail-Bzl61Jxz.js";import{S as os}from"./shield-DAyvt0PQ.js";import{U as Ce}from"./user-DVJm9NeR.js";import{S as cs}from"./save-PXOx3gZA.js";import{S as Da}from"./shopping-bag-tYwf8ov7.js";import{L as qa}from"./lock-ZAdKo1ct.js";import{A as Ae}from"./arrow-left-DOI7IDWT.js";import{I as ds}from"./info-yRHcm34Y.js";import{D as Oa}from"./DeliveryTracking-MC7rPAMd.js";import{L as Fa}from"./log-out-CMaFcibJ.js";import"./users-BMnL9NIw.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Ma=ve("banknote",za);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],La=ve("circle",$a);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Va=ve("funnel",Ba);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Me=ve("heart",Ga);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Qa=ve("share-2",Ua);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],Ka=ve("thumbs-up",Ha);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]],Xa=ve("utensils-crossed",Wa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Ss=ve("utensils",Za);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Ja=ve("wallet",Ya),er=()=>{const[s,t]=u.useState(()=>typeof document<"u"?!document.hidden:!0);return u.useEffect(()=>{if(typeof document>"u")return;const r=()=>{t(!document.hidden)};return document.addEventListener("visibilitychange",r),()=>document.removeEventListener("visibilitychange",r)},[]),s};function Es(){const[s,t]=u.useState([]),[r,d]=u.useState([]),[c,i]=u.useState([]),[p,o]=u.useState({products:!1,dailyProducts:!1,businesses:!1}),m=er(),N=async h=>{var j,P;try{o(n=>({...n,products:!0}));let w=$.from("products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            business_description,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0);h!=null&&h.search&&(w=w.or(`name.ilike.%${h.search}%,description.ilike.%${h.search}%`)),h!=null&&h.category&&h.category!=="all"&&(w=w.eq("category",h.category)),h!=null&&h.limit&&(w=w.limit(h.limit));let{data:q,error:l}=await w.order("created_at",{ascending:!1});if(l){const n=(l==null?void 0:l.code)||"",a=((P=(j=l==null?void 0:l.message)==null?void 0:j.toLowerCase)==null?void 0:P.call(j))||"";if(n==="PGRST201"||n==="PGRST200"||n==="42P01"||n==="42703"||a.includes("relationship")||a.includes("column")||a.includes("relation")){let g=$.from("products").select("*").eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0);h!=null&&h.search&&(g=g.or(`name.ilike.%${h.search}%,description.ilike.%${h.search}%`)),h!=null&&h.category&&h.category!=="all"&&(g=g.eq("category",h.category)),h!=null&&h.limit&&(g=g.limit(h.limit));const R=await g.order("created_at",{ascending:!1});q=R.data,l=R.error}}l?(console.error("Error fetching products:",l),t([])):t(q||[])}catch(w){console.error("Error fetching products:",w)}finally{o(w=>({...w,products:!1}))}},I=async()=>{var h,j;try{o(n=>({...n,dailyProducts:!0}));const P=new Date,w=new Date(P);w.setHours(23,59,59,999);let{data:q,error:l}=await $.from("daily_products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",w.toISOString()).order("created_at",{ascending:!1});if(l){const n=(l==null?void 0:l.code)||"",a=((j=(h=l==null?void 0:l.message)==null?void 0:h.toLowerCase)==null?void 0:j.call(h))||"";if(n==="PGRST205"){console.log("daily_products table does not exist yet"),d([]);return}if(n==="PGRST201"||n==="PGRST200"||n==="42P01"||n==="42703"||a.includes("relationship")||a.includes("relation")||a.includes("column")){const g=await $.from("daily_products").select(`
              *,
              seller:sellers(
                id,
                business_name,
                logo_url,
                is_verified
              )
            `).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",w.toISOString()).order("created_at",{ascending:!1});if(g.error){const R=await $.from("daily_products").select("*").gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",w.toISOString()).order("created_at",{ascending:!1});q=R.data,l=R.error}else q=g.data,l=g.error}}if(l)console.error("Error fetching daily products:",l),d([]);else{const n=q?q.filter((a,S,g)=>S===g.findIndex(R=>R.name===a.name)):[];console.log(`üì¶ Productos del d√≠a cargados: ${(q==null?void 0:q.length)||0} total, ${n.length} √∫nicos`),d(n)}}catch(P){console.error("Error fetching daily products:",P)}finally{o(P=>({...P,dailyProducts:!1}))}},f=async()=>{var h,j;try{o(g=>({...g,businesses:!0}));let{data:P,error:w}=await $.from("sellers").select(`
          id,
          business_name,
          business_description,
          business_address,
          business_phone,
          phone,
          address,
          business_logo,
          cover_image_url,
          logo_url,
          is_verified,
          user:users(name, phone, email, address, avatar_url)
        `).not("business_name","is",null).order("is_verified",{ascending:!1});if(w){const g=(w==null?void 0:w.code)||"",R=((j=(h=w==null?void 0:w.message)==null?void 0:h.toLowerCase)==null?void 0:j.call(h))||"";if(g==="PGRST201"||g==="PGRST200"||g==="42P01"||g==="42703"||R.includes("relationship")||R.includes("column")||R.includes("relation")){const M=await $.from("sellers").select("id,business_name,business_description,business_address,business_phone,phone,address,business_logo,cover_image_url,logo_url,is_verified").not("business_name","is",null).order("is_verified",{ascending:!1});P=M.data,w=M.error}}if(w){console.error("Error fetching businesses:",w),i([]);return}const q=P||[],l=q.map(g=>g.id);let n=new Map,a=new Map;if(l.length>0){try{const{data:g,error:R}=await $.from("products").select("seller_id").in("seller_id",l).eq("is_public",!0);R?console.error("Error fetching products for counts:",R):n=(g==null?void 0:g.reduce((V,M)=>(V.set(M.seller_id,(V.get(M.seller_id)||0)+1),V),new Map))??new Map}catch(g){console.error("Error aggregating product counts:",g)}try{const{data:g,error:R}=await $.from("seller_ratings_view").select("seller_id, average_rating").in("seller_id",l);R?console.error("Error fetching ratings:",R):a=(g==null?void 0:g.reduce((V,M)=>(V.set(M.seller_id,M.average_rating||0),V),new Map))??new Map}catch(g){console.error("Error aggregating ratings:",g)}}const S=q.map(g=>{var C,Z,le,ee,Y,oe;const R=g.cover_image_url||g.business_logo||g.logo_url,V=g.business_logo||g.logo_url,M=as({logo_url:V??void 0,user:g.user?{avatar_url:g.user.avatar_url}:void 0});console.log("üî• BUSINESS DATA:",{id:g.id,name:g.business_name,cover_image_url:g.cover_image_url,business_logo:g.business_logo,logo_url:g.logo_url,final_cover:R,final_logo:V});const y=n.get(g.id)||0,E=a.get(g.id)||0;return{id:g.id,business_name:g.business_name,business_description:g.business_description??void 0,business_address:g.business_address??void 0,business_phone:g.business_phone??void 0,logo_url:V??void 0,cover_image_url:R??void 0,is_verified:g.is_verified,products_count:y,rating:E,phone:g.phone,address:g.address,user:{name:((C=g.user)==null?void 0:C.name)??"Usuario",phone:((Z=g.user)==null?void 0:Z.phone)??void 0,email:((le=g.user)==null?void 0:le.email)??void 0,address:((ee=g.user)==null?void 0:ee.address)??void 0,avatar_url:((Y=g.user)==null?void 0:Y.avatar_url)??void 0},cover_image:R??void 0,category:"General",phone_number:g.phone||g.business_phone||((oe=g.user)==null?void 0:oe.phone)||void 0,is_open_now:!0}});i(S)}catch(P){console.error("Error fetching businesses:",P)}finally{o(P=>({...P,businesses:!1}))}},T=async h=>{var j,P;try{let w=$.from("products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified
          )
        `).eq("seller_id",h).eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}),{data:q,error:l}=await w;if(l){const a=(l==null?void 0:l.code)||"",S=((P=(j=l==null?void 0:l.message)==null?void 0:j.toLowerCase)==null?void 0:P.call(j))||"";if(a==="PGRST201"||a==="PGRST200"||a==="42P01"||a==="42703"||S.includes("relationship")||S.includes("column")||S.includes("relation")){const R=await $.from("products").select("*").eq("seller_id",h).eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0).order("created_at",{ascending:!1});q=R.data,l=R.error}}if(l)return console.error("Error fetching business products:",l),[];const n=(q==null?void 0:q.map(a=>({...a,is_actually_available:a.is_available&&a.stock_quantity>0,stock_info:{has_stock:a.stock_quantity>0,is_low_stock:a.stock_quantity<=5&&a.stock_quantity>0,is_last_units:a.stock_quantity<=3&&a.stock_quantity>0,count:a.stock_quantity}})))||[];return console.log("üì¶ Productos procesados (USANDO COLUMNA REAL):",{total:n.length,available:n.filter(a=>a.is_actually_available).length,with_stock:n.filter(a=>a.stock_info.has_stock).length,low_stock:n.filter(a=>a.stock_info.is_low_stock).length,products_sample:n.slice(0,3).map(a=>({name:a.name,is_available:a.is_available,stock_quantity:a.stock_quantity,is_actually_available:a.is_actually_available}))}),n}catch(w){return console.error("Error fetching business products:",w),[]}},_=async h=>{var j,P;try{const w=new Date,q=new Date(w);q.setHours(23,59,59,999);let{data:l,error:n}=await $.from("daily_products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).eq("seller_id",h).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",q.toISOString()).order("created_at",{ascending:!1});if(n){const a=n==null?void 0:n.code;if(a==="PGRST205")return console.log("daily_products table does not exist yet"),[];const S=((P=(j=n==null?void 0:n.message)==null?void 0:j.toLowerCase)==null?void 0:P.call(j))||"";if(a==="PGRST200"||a==="42P01"||a==="42703"||S.includes("relationship")||S.includes("column")||S.includes("relation")){const R=await $.from("daily_products").select("*").eq("seller_id",h).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",q.toISOString()).order("created_at",{ascending:!1});l=R.data,n=R.error}}return n?(console.error("Error fetching business daily products:",n),[]):l||[]}catch(w){return console.error("Error fetching business daily products:",w),[]}},A=async h=>{try{const{data:j,error:P}=await $.from("sellers").select(`
          id,
          business_name,
          business_description,
          business_address,
          business_phone,
          phone,
          address,
          business_logo,
          cover_image_url,
          logo_url,
          is_verified,
          rating_avg
        `).eq("id",h).single();if(P)return console.error("Error fetching business:",P),null;const{data:w,error:q}=await $.from("users").select("name, phone, email, address, avatar_url").eq("id",h).single();q&&console.error("Error fetching user data:",q);const{count:l}=await $.from("products").select("*",{count:"exact",head:!0}).eq("seller_id",h).eq("is_public",!0);let n=0;try{const{data:M,error:y}=await $.from("seller_ratings_view").select("average_rating").eq("seller_id",h).single();!y&&M&&(n=M.average_rating||0)}catch(M){console.error("Error fetching business rating:",M)}const a={...j,user:w||null,products_count:l||0,rating:n};console.log("üî• COMBINED DATA DEBUG:",{seller_data:{phone:j.phone,address:j.address,business_phone:j.business_phone,business_address:j.business_address},user_data:w,combined_user:a.user});const S=(j==null?void 0:j.cover_image_url)||(j==null?void 0:j.business_logo)||(j==null?void 0:j.logo_url),g=(j==null?void 0:j.business_logo)||(j==null?void 0:j.logo_url),R=as({logo_url:g??void 0,user:j!=null&&j.user?{avatar_url:j.user.avatar_url}:void 0});console.log("üî• getBusinessById DATA:",{id:j==null?void 0:j.id,name:j==null?void 0:j.business_name,cover_image_url:j==null?void 0:j.cover_image_url,business_logo:j==null?void 0:j.business_logo,logo_url:j==null?void 0:j.logo_url,final_cover:S,final_logo:g});const V=j;return{id:a.id,business_name:a.business_name,business_description:a.business_description??void 0,business_address:a.business_address??void 0,business_phone:a.business_phone??void 0,logo_url:g??void 0,cover_image_url:S??void 0,is_verified:a.is_verified,products_count:a.products_count,rating:a.rating,phone:a.phone,address:a.address,user:a.user?{name:a.user.name,phone:a.user.phone,email:a.user.email,address:a.user.address,avatar_url:a.user.avatar_url}:void 0,cover_image:S??void 0,category:"General",is_open_now:!0}}catch(j){return console.error("Error fetching business by ID:",j),null}},v=async h=>{await Promise.all([N({search:h})])},k=async(h=8)=>{try{const{data:j,error:P}=await $.from("products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).eq("is_public",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}).limit(h);return P?(console.error("Error fetching featured products:",P),[]):j||[]}catch(j){return console.error("Error fetching featured products:",j),[]}},O=h=>{const j=new Date,w=new Date(h).getTime()-j.getTime();if(w<=0)return"Expirado";const q=Math.floor(w/(1e3*60*60)),l=Math.floor(w%(1e3*60*60)/(1e3*60));return q>0?`${q}h ${l}m restantes`:`${l}m restantes`};u.useEffect(()=>{N(),I(),f();const h=setInterval(()=>{m?(console.log("üî• Actualizando productos del d√≠a autom√°ticamente..."),I()):console.log("‚è∏Ô∏è App en background - pausando actualizaci√≥n de productos del d√≠a")},5*60*1e3),j=setInterval(()=>{m?(console.log("üîÑ Actualizando productos autom√°ticamente (stock en tiempo real)..."),N()):console.log("‚è∏Ô∏è App en background - pausando actualizaci√≥n de productos")},30*1e3),P=setInterval(()=>{m?(console.log("üè™ Actualizando negocios autom√°ticamente..."),f()):console.log("‚è∏Ô∏è App en background - pausando actualizaci√≥n de negocios")},10*60*1e3);return()=>{clearInterval(h),clearInterval(j),clearInterval(P)}},[m]),u.useEffect(()=>{m&&(console.log("üì± App volvi√≥ a primer plano - refrescando datos..."),N(),I())},[m]),u.useEffect(()=>{const h=j=>{console.log("üö® Stock actualizado - refrescando datos:",j.detail),z(),I()};return window.addEventListener("stockUpdated",h),()=>{window.removeEventListener("stockUpdated",h)}},[]);const Q=async()=>{console.log("üîÑ Refrescando todos los datos manualmente..."),await Promise.all([N(),I(),f()])},z=async()=>{console.log("üé≤ Mezclando productos para mostrar nuevos...");try{o(n=>({...n,products:!0,dailyProducts:!0}));const{data:h,error:j}=await $.from("products").select("*").eq("is_public",!0).gt("stock_quantity",0).order("created_at",{ascending:!1});if(j)console.error("‚ùå Error al obtener productos:",j);else{const n=h?[...h].sort(()=>Math.random()-.5):[];console.log("‚úÖ Productos mezclados:",(n==null?void 0:n.length)||0),t(n||[])}const P=new Date,w=new Date(P);w.setHours(23,59,59,999);const{data:q,error:l}=await $.from("daily_products").select("*").gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",w.toISOString()).order("created_at",{ascending:!1});if(l&&l.code!=="PGRST205")console.error("‚ùå Error al obtener productos del d√≠a:",l);else{const a=(q?[...q].sort(()=>Math.random()-.5):[]).filter((S,g,R)=>g===R.findIndex(V=>V.name===S.name));console.log("‚úÖ Productos del d√≠a mezclados:",(a==null?void 0:a.length)||0),d(a)}}catch(h){console.error("‚ùå Error cr√≠tico al mezclar productos:",h)}finally{o(h=>({...h,products:!1,dailyProducts:!1}))}console.log("‚úÖ Productos nuevos listos para descubrir")};return{products:s,dailyProducts:r,businesses:c,loading:p,isPageVisible:m,fetchProducts:N,fetchDailyProducts:I,fetchBusinesses:f,refreshAllData:Q,refreshProductStock:z,getBusinessProducts:T,getBusinessDailyProducts:_,getBusinessById:A,searchAll:v,getFeaturedProducts:k,getTimeRemaining:O}}function Ye({onCartClick:s}){const{items:t,getCartItemCount:r,getCartTotal:d}=we(),c=r(),i=d();return c===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs(F,{onClick:()=>{console.log("FloatingCart clicked!"),s?s():alert(`Carrito: ${c} productos - Q${i.toFixed(2)}`)},className:"relative h-16 w-16 rounded-full bg-orange-500 hover:bg-orange-600 shadow-xl",children:[e.jsx(je,{className:"w-6 h-6 text-white"}),e.jsx(K,{className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center",children:c})]})})}function sr({viewMode:s,setViewMode:t,onRefreshStock:r,onRefreshAll:d,isLoading:c,isRefreshing:i,lastUpdated:p,searchQuery:o,selectedCategory:m}){return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Explorar Productos"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:[e.jsxs("span",{children:["Actualizado: ",p.toLocaleTimeString()]}),(o||m!=="all")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-orange-600 font-medium",children:[o&&`"${o}"`,o&&m!=="all"&&" ‚Ä¢ ",m!=="all"&&m]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(F,{onClick:r,disabled:i,size:"sm",variant:"outline",className:"gap-2 border-green-300 text-green-600 hover:bg-green-50 bg-green-50",children:[e.jsx(ke,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Descubrir"]})})]})})}function ar({searchQuery:s,setSearchQuery:t,selectedCategory:r,setSelectedCategory:d,categories:c,onSearch:i,isLoading:p}){const[o,m]=u.useState(!1),N=u.useRef(null);u.useEffect(()=>{o&&N.current&&N.current.focus()},[o]),u.useEffect(()=>{const T=_=>{_.key==="Escape"&&o&&m(!1)};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[o]);const I=()=>{i(),m(!1)},f=()=>{t(""),d("all"),m(!1)};return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 backdrop-blur-sm z-40",onClick:()=>m(!1)}),!o&&e.jsx(F,{onClick:()=>m(!0),className:"fixed bottom-24 right-4 z-50 w-14 h-14 rounded-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-white",size:"sm",children:e.jsx(Ee,{className:"w-6 h-6 text-white"})}),o&&e.jsx("div",{className:"fixed bottom-24 left-4 right-4 z-50 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 space-y-4 animate-in slide-in-from-bottom-2 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"font-semibold text-gray-800",children:"Buscar productos"})]}),e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>m(!1),className:"h-8 w-8 p-0 hover:bg-gray-100",children:e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(he,{ref:N,placeholder:"¬øQu√© est√°s buscando?",value:s,onChange:T=>t(T.target.value),className:"pl-10 h-12 border-gray-200 focus:border-orange-300 focus:ring-orange-200",onKeyPress:T=>{T.key==="Enter"&&I()}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Categor√≠a"})]}),e.jsxs(ka,{value:r,onValueChange:d,children:[e.jsx(Ca,{className:"h-10 border-gray-200",children:e.jsx(Sa,{placeholder:"Todas las categor√≠as"})}),e.jsxs(Ea,{children:[e.jsx(ns,{value:"all",children:"Todas las categor√≠as"}),c.map(T=>e.jsx(ns,{value:T,children:T},T))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(F,{variant:"outline",onClick:f,className:"flex-1 h-10",disabled:p,children:"Limpiar"}),e.jsx(F,{onClick:I,disabled:p,className:"flex-1 h-10 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Buscar"]})})]}),(s||r!=="all")&&e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs",children:[e.jsxs("span",{children:['"',s,'"']}),e.jsx("button",{onClick:()=>t(""),className:"hover:text-orange-900",children:e.jsx(Ie,{className:"w-3 h-3"})})]}),r!=="all"&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:[e.jsx("span",{children:r}),e.jsx("button",{onClick:()=>d("all"),className:"hover:text-blue-900",children:e.jsx(Ie,{className:"w-3 h-3"})})]})]})})]})})]})}function rr(s,t="regular"){const[r,d]=u.useState({stock_quantity:0,sold_quantity:0,available_stock:0,loading:!0,error:null});return u.useEffect(()=>{if(!s)return;const c=async()=>{try{if(d(p=>({...p,loading:!0,error:null})),t==="daily"){const{data:p,error:o}=await $.from("daily_products").select("stock_quantity").eq("id",s).single();if(o)throw o;const{data:m,error:N}=await $.from("order_items").select(`
              quantity,
              orders!inner (
                status
              )
            `).eq("product_id",s).eq("product_type","daily").in("orders.status",["confirmed","preparing","ready","out_for_delivery","delivered"]);N&&console.warn("Error fetching sold quantity:",N);const I=(m==null?void 0:m.reduce((_,A)=>_+(A.quantity||0),0))||0,f=p.stock_quantity||0,T=Math.max(0,f-I);d({stock_quantity:f,sold_quantity:I,available_stock:T,loading:!1,error:null})}else{const{data:p,error:o}=await $.from("products").select("stock_quantity").eq("id",s).single();if(o)throw o;const m=p.stock_quantity||0;d({stock_quantity:m,sold_quantity:0,available_stock:m,loading:!1,error:null})}}catch(p){console.error("Error fetching real-time stock:",p),d(o=>({...o,loading:!1,error:p.message||"Error loading stock"}))}};c();const i=setInterval(c,3e4);return()=>clearInterval(i)},[s,t]),r}function tr(s){const[t,r]=u.useState({average_rating:0,total_reviews:0,loading:!0});return u.useEffect(()=>{if(!s)return;(async()=>{try{const{data:c,error:i}=await $.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s).single();if(i){console.warn("No rating found for seller:",s),r({average_rating:0,total_reviews:0,loading:!1});return}r({average_rating:c.average_rating||0,total_reviews:c.total_reviews||0,loading:!1})}catch(c){console.error("Error fetching seller rating:",c),r({average_rating:0,total_reviews:0,loading:!1})}})()},[s]),t}function ir(s){const[t,r]=u.useState({hours:0,minutes:0,isExpired:!0,formattedTime:"Expirado"});return u.useEffect(()=>{if(!s)return;const d=()=>{const i=ma(s);r({hours:i.hours,minutes:i.minutes,isExpired:i.isExpired,formattedTime:i.isExpired?"Expirado":i.hours>0?`${i.hours}h ${i.minutes}m restantes`:`${i.minutes}m restantes`})};d();const c=setInterval(d,6e4);return()=>clearInterval(c)},[s]),t}function Ke({product:s,viewMode:t,cartQuantity:r,onAddToCart:d,onUpdateQuantity:c,onImageClick:i,onBusinessClick:p,addingToCart:o,editingQuantity:m,tempQuantity:N,onQuantityClick:I,onQuantityChange:f,onQuantitySubmit:T,onQuantityKeyDown:_}){var g,R,V;const[A,v]=u.useState(!1),k="expires_at"in s,O=s.image_url||"",Q=((g=s.seller)==null?void 0:g.name)||"Tienda",{available_stock:z,stock_quantity:h,sold_quantity:j,loading:P}=rr(s.id,k?"daily":"regular"),{average_rating:w,total_reviews:q,loading:l}=tr(s.seller_id||""),n=ir(k&&"expires_at"in s?s.expires_at:void 0),a=P?s.stock_quantity||0:z,S=()=>{v(!A)};return t==="list"?e.jsx(G,{className:"mb-4 overflow-hidden hover:shadow-lg transition-all duration-200 border-gray-200",children:e.jsx(U,{className:"p-0",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-32 h-32 flex-shrink-0 relative",children:[e.jsx(ge,{src:O,alt:s.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>O&&i(O)}),k&&e.jsx(K,{className:"absolute top-2 left-2 bg-red-500 text-white text-xs",children:"Del d√≠a"}),e.jsx(F,{size:"sm",variant:"ghost",className:"absolute top-2 right-2 h-8 w-8 p-0 bg-white/80 hover:bg-white",onClick:S,children:e.jsx(Me,{className:`w-4 h-4 ${A?"fill-red-500 text-red-500":"text-gray-600"}`})})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 line-clamp-1",children:s.name}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xl font-bold text-green-600",children:["Q",(R=s.price)==null?void 0:R.toFixed(2)]})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsx("button",{onClick:()=>p(s.seller_id),className:"hover:text-orange-600 hover:underline",children:Q})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),l?e.jsx("span",{className:"animate-pulse bg-gray-200 w-6 h-3 rounded"}):e.jsxs("span",{className:"font-medium",children:[w>0?w.toFixed(1):"0.0",q>0&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",q,")"]})]})]}),k&&!n.isExpired&&e.jsxs("div",{className:"flex items-center gap-1 text-orange-600 font-medium",children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{children:"Termina hoy"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("span",{children:"2.1 km"})]})]}),k&&!n.isExpired&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-md mb-3",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:n.formattedTime})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-1",children:a>0?e.jsxs(K,{variant:"outline",className:"text-green-600 border-green-300",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),P?e.jsx("span",{className:"animate-pulse",children:"Cargando..."}):e.jsxs(e.Fragment,{children:["Stock: ",a,k&&j>0&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",h-j,"/",h,")"]})]})]}):e.jsxs(K,{variant:"outline",className:"text-red-600 border-red-300",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Agotado"]})}),e.jsx("div",{className:"flex items-center gap-2",children:r>0?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>c(s.id,r-1),className:"h-8 w-8 p-0",children:e.jsx(Qe,{className:"w-3 h-3"})}),m?e.jsx(he,{type:"number",value:N,onChange:M=>f(M.target.value),onBlur:()=>T(s.id),onKeyDown:M=>_(M,s.id),className:"w-16 h-8 text-center text-sm",autoFocus:!0}):e.jsx("button",{onClick:()=>I(s.id,r),className:"w-16 h-8 text-sm font-medium bg-gray-100 rounded border hover:bg-gray-200",children:r}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>c(s.id,r+1),className:"h-8 w-8 p-0",disabled:r>=a,children:e.jsx(fe,{className:"w-3 h-3"})})]}):e.jsxs(F,{size:"sm",onClick:()=>d(s.id,k,s.name),disabled:o||a<=0,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Agregar"]})})]})]})]})})}):e.jsx(G,{className:"overflow-hidden hover:shadow-lg transition-all duration-200 border-gray-200 h-full",children:e.jsxs(U,{className:"p-0",children:[e.jsxs("div",{className:"relative aspect-square",children:[e.jsx(ge,{src:O,alt:s.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>O&&i(O)}),e.jsxs("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[k&&e.jsx(K,{className:"bg-red-500 text-white text-xs",children:"Del d√≠a"}),a<=5&&a>0&&e.jsxs(K,{variant:"outline",className:"bg-yellow-500 text-white text-xs border-yellow-500",children:["√öltimos ",a]})]}),e.jsx(F,{size:"sm",variant:"ghost",className:"absolute top-2 right-2 h-8 w-8 p-0 bg-white/80 hover:bg-white",onClick:S,children:e.jsx(Me,{className:`w-4 h-4 ${A?"fill-red-500 text-red-500":"text-gray-600"}`})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:a>0?e.jsxs(K,{variant:"outline",className:"bg-white text-green-600 border-green-300 text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),P?"...":a,k&&j>0&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["/",h]})]}):e.jsxs(K,{variant:"outline",className:"bg-white text-red-600 border-red-300 text-xs",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Agotado"]})}),k&&!n.isExpired&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(K,{className:"bg-orange-500 text-white text-xs font-semibold",children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"Del D√≠a"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-800 line-clamp-2 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("button",{onClick:()=>p(s.seller_id),className:"flex items-center gap-1 hover:text-orange-600 hover:underline",children:[e.jsx(ie,{className:"w-3 h-3"}),Q]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),l?e.jsx("span",{className:"animate-pulse bg-gray-200 w-6 h-3 rounded"}):e.jsxs("span",{children:[w>0?w.toFixed(1):"0.0",q>0&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",q,")"]})]})]})]}),k&&!n.isExpired&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-md mb-2",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:n.formattedTime})]}),e.jsxs("div",{className:"text-xl font-bold text-green-600 mb-3",children:["Q",(V=s.price)==null?void 0:V.toFixed(2)]})]}),e.jsx("div",{className:"space-y-2",children:r>0?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>c(s.id,r-1),className:"h-8 w-8 p-0",children:e.jsx(Qe,{className:"w-3 h-3"})}),m?e.jsx(he,{type:"number",value:N,onChange:M=>f(M.target.value),onBlur:()=>T(s.id),onKeyDown:M=>_(M,s.id),className:"w-16 h-8 text-center text-sm",autoFocus:!0}):e.jsx("button",{onClick:()=>I(s.id,r),className:"w-16 h-8 text-sm font-medium bg-gray-100 rounded border hover:bg-gray-200",children:r}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>c(s.id,r+1),className:"h-8 w-8 p-0",disabled:r>=a,children:e.jsx(fe,{className:"w-3 h-3"})})]}):e.jsxs(F,{onClick:()=>d(s.id,k,s.name),disabled:o||a<=0,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Agregar al carrito"]})})]})]})})}function nr({products:s,viewMode:t,cartItems:r,onAddToCart:d,onUpdateQuantity:c,onImageClick:i,onBusinessClick:p,addingToCart:o,editingQuantity:m,tempQuantity:N,onQuantityClick:I,onQuantityChange:f,onQuantitySubmit:T,onQuantityKeyDown:_,loading:A=!1}){const v=k=>{const O=r.find(Q=>Q.product_id===k);return(O==null?void 0:O.quantity)||0};return A?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(8)].map((k,O)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-200 aspect-square rounded-lg mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"})]})]},O))})}):!s||s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2m13-8l-8 8-4-4"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron productos"}),e.jsx("p",{className:"text-gray-500",children:"Intenta cambiar los filtros de b√∫squeda o revisa m√°s tarde."})]}):e.jsxs("div",{className:"space-y-6",children:[t==="grid"?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:s.map(k=>e.jsx(Ke,{product:k,viewMode:t,cartQuantity:v(k.id),onAddToCart:d,onUpdateQuantity:c,onImageClick:i,onBusinessClick:p,addingToCart:o===k.id,editingQuantity:m===k.id,tempQuantity:N,onQuantityClick:I,onQuantityChange:f,onQuantitySubmit:T,onQuantityKeyDown:_},k.id))}):e.jsx("div",{className:"space-y-4",children:s.map(k=>e.jsx(Ke,{product:k,viewMode:t,cartQuantity:v(k.id),onAddToCart:d,onUpdateQuantity:c,onImageClick:i,onBusinessClick:p,addingToCart:o===k.id,editingQuantity:m===k.id,tempQuantity:N,onQuantityClick:I,onQuantityChange:f,onQuantitySubmit:T,onQuantityKeyDown:_},k.id))}),s.length>0&&s.length%20===0&&e.jsx("div",{className:"text-center pt-8",children:e.jsx("button",{className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium",children:"Cargar m√°s productos"})})]})}function lr({dailyProducts:s,cartItems:t,onAddToCart:r,onUpdateQuantity:d,onImageClick:c,onBusinessClick:i,addingToCart:p,editingQuantity:o,tempQuantity:m,onQuantityClick:N,onQuantityChange:I,onQuantitySubmit:f,onQuantityKeyDown:T,loading:_=!1}){const A=v=>{const k=t.find(O=>O.product_id===v);return(k==null?void 0:k.quantity)||0};return _?e.jsxs(G,{className:"border-red-200 shadow-lg",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(_e,{className:"w-6 h-6"}),"Productos del D√≠a"]}),e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})})]})}),e.jsx(U,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((v,k)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-200 aspect-square rounded-lg mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]},k))})})]}):!s||s.length===0?e.jsxs(G,{className:"border-red-200 shadow-lg",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(_e,{className:"w-6 h-6"}),"Productos del D√≠a"]})}),e.jsx(U,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay productos del d√≠a disponibles en este momento."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"¬°Vuelve ma√±ana para ver las nuevas ofertas!"})]})})]}):e.jsxs(G,{className:"border-red-200 shadow-lg",children:[e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(_e,{className:"w-6 h-6"}),"Productos del D√≠a"]}),e.jsxs(K,{variant:"destructive",className:"animate-pulse",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Oferta especial"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ofertas especiales disponibles solo por hoy. ¬°No te las pierdas!"})]}),e.jsxs(U,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(v=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsxs(K,{className:"bg-red-500 text-white text-xs font-semibold",children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"Oferta del d√≠a"]})}),e.jsx(Ke,{product:v,viewMode:"grid",cartQuantity:A(v.id),onAddToCart:r,onUpdateQuantity:d,onImageClick:c,onBusinessClick:i,addingToCart:p===v.id,editingQuantity:o===v.id,tempQuantity:m,onQuantityClick:N,onQuantityChange:I,onQuantitySubmit:f,onQuantityKeyDown:T})]},v.id))}),s.length>3&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{className:"text-red-600 hover:text-red-700 font-medium text-sm hover:underline",children:"Ver todos los productos del d√≠a ‚Üí"})})]})]})}function ms({onBusinessClick:s,onShowCart:t}){const{user:r}=Ne(),{items:d,addToCart:c,updateCartItem:i,removeFromCart:p}=we(),{products:o,dailyProducts:m,businesses:N,loading:I,refreshProductStock:f,refreshAllData:T}=Es(),{openImageModal:_}=vs(),[A,v]=u.useState(""),[k,O]=u.useState("all"),[Q,z]=u.useState("grid"),[h,j]=u.useState(null),[P,w]=u.useState(!1),[q,l]=u.useState(new Date),[n,a]=u.useState(null),[S,g]=u.useState(""),[R,V]=u.useState([]),M=["Comida","Bebidas","Dulces","Panader√≠a","L√°cteos","Carnes","Verduras","Frutas","Limpieza","Cuidado Personal"],y=async()=>{const x=o.filter(b=>{var B;const L=!A||b.name.toLowerCase().includes(A.toLowerCase())||((B=b.description)==null?void 0:B.toLowerCase().includes(A.toLowerCase())),D=k==="all"||b.category===k;return L&&D});V(x)};u.useEffect(()=>{y()},[o,A,k]),u.useEffect(()=>{V(o)},[o]);const E=async(x,b=!1,L="Producto")=>{if(!r){H.error("Debes iniciar sesi√≥n para agregar productos");return}try{j(x);const D=await c(x,1,b?"daily":"regular");D!=null&&D.success?H.success("Agregado al carrito"):H.error(`‚ùå Error: ${(D==null?void 0:D.message)||"No se pudo agregar el producto"}`)}catch(D){console.error("Error adding to cart:",D),H.error("‚ùå Error al agregar producto al carrito")}finally{j(null)}},C=async(x,b)=>{const L=d.find(D=>D.product_id===x);L&&(b<=0?await p(L.id):await i(L.id,b))},Z=(x,b)=>{a(x),g(b.toString())},le=x=>{const b=parseInt(x);!isNaN(b)&&b>=0&&g(x)},ee=async x=>{const b=parseInt(S);isNaN(b)||await C(x,b),a(null),g("")},Y=async(x,b)=>{x.key==="Enter"?await ee(b):x.key==="Escape"&&(a(null),g(""))},oe=async()=>{if(!P)try{w(!0),await f(),l(new Date),H.success("‚úÖ Productos actualizados - Nuevos productos disponibles")}catch(x){console.error("‚ùå Error en refresco manual:",x),H.error("‚ùå Error al actualizar productos - Intenta de nuevo")}finally{w(!1)}};u.useEffect(()=>{o.length>0&&l(new Date)},[o]);const ue=x=>{s(x)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(sr,{searchQuery:A,setSearchQuery:v,selectedCategory:k,setSelectedCategory:O,viewMode:Q,setViewMode:z,categories:M,onSearch:y,onRefreshStock:oe,onRefreshAll:T,isLoading:Object.values(I).some(Boolean),isRefreshing:P,lastUpdated:q}),e.jsxs($e,{defaultValue:"products",className:"w-full",children:[e.jsxs(Le,{className:"grid w-full grid-cols-3",children:[e.jsxs(pe,{value:"products",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Productos"]}),e.jsxs(pe,{value:"daily",className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Del D√≠a"]}),e.jsxs(pe,{value:"businesses",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Negocios"]})]}),e.jsx(xe,{value:"products",className:"space-y-6",children:e.jsxs(G,{className:"border-orange-200 shadow-lg",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-orange-500"}),"Todos los Productos"]})}),e.jsx(U,{children:e.jsx(nr,{products:R,viewMode:Q,cartItems:d,onAddToCart:E,onUpdateQuantity:C,onImageClick:_,onBusinessClick:ue,addingToCart:h,editingQuantity:n,tempQuantity:S,onQuantityClick:Z,onQuantityChange:le,onQuantitySubmit:ee,onQuantityKeyDown:Y,loading:I.products})})]})}),e.jsx(xe,{value:"daily",className:"space-y-6",children:e.jsx(lr,{dailyProducts:m,cartItems:d,onAddToCart:E,onUpdateQuantity:C,onImageClick:_,onBusinessClick:ue,addingToCart:h,editingQuantity:n,tempQuantity:S,onQuantityClick:Z,onQuantityChange:le,onQuantitySubmit:ee,onQuantityKeyDown:Y,loading:I.dailyProducts})}),e.jsx(xe,{value:"businesses",className:"space-y-6",children:e.jsxs(G,{className:"border-green-200 shadow-lg",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-green-500"}),"Negocios Locales"]})}),e.jsx(U,{children:I.businesses?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((x,b)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-200 h-32 rounded-t-lg mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]},b))}):N&&N.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(x=>{var D,B;const b=x.cover_image_url||x.cover_image,L=x.logo_url;return e.jsxs(G,{className:"cursor-pointer hover:shadow-xl transition-all duration-300 border-green-200",onClick:()=>ue(x.id),children:[e.jsxs("div",{className:"relative",children:[b?e.jsx(ge,{src:b,alt:`Portada de ${x.business_name}`,className:"w-full h-32 object-cover rounded-t-lg",expandable:!0,onExpand:_}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-r from-orange-400 to-green-400 flex items-center justify-center rounded-t-lg",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(ie,{className:"w-8 h-8 mx-auto mb-1"}),e.jsx("p",{className:"text-sm font-semibold",children:x.business_name})]})}),x.is_verified&&e.jsxs(K,{className:"absolute top-2 right-2 bg-blue-500 text-white",children:[e.jsx(_s,{className:"w-3 h-3 mr-1"}),"Verificado"]}),L&&e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white shadow-lg p-1",children:e.jsx(ge,{src:L,alt:`Logo de ${x.business_name}`,className:"w-full h-full object-cover rounded-full",expandable:!0,onExpand:_})})})]}),e.jsxs(U,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:x.business_name}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 line-clamp-2",children:x.business_description||"Comercio local en Gual√°n"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:((D=x.rating)==null?void 0:D.toFixed(1))||"5.0"})]}),e.jsx(K,{variant:"outline",children:x.category||"General"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(ye,{className:"w-3 h-3 mr-1"}),x.address||x.business_address||((B=x.user)==null?void 0:B.address)||"Gual√°n, Zacapa"]}),e.jsxs(F,{size:"sm",variant:"outline",children:[e.jsx(We,{className:"w-3 h-3 mr-1"}),"Ver productos"]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("span",{className:"text-xs text-gray-500",children:[x.products_count||0," productos disponibles"]})})]})]},x.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay negocios disponibles"}),e.jsx("p",{className:"text-gray-500",children:"Los negocios aparecer√°n aqu√≠ cuando est√©n disponibles."})]})})]})})]}),e.jsx(Ye,{onCartClick:()=>{t&&t()}}),e.jsx(ar,{searchQuery:A,setSearchQuery:v,selectedCategory:k,setSelectedCategory:O,categories:M,onSearch:y,isLoading:I.products||I.dailyProducts||I.businesses})]})}const xs={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",description:"Esperando confirmaci√≥n del vendedor"},accepted:{label:"Aceptado",color:"bg-blue-100 text-blue-800",description:"El vendedor est√° preparando tu pedido"},ready:{label:"Listo",color:"bg-green-100 text-green-800",description:"Tu pedido est√° listo"},assigned:{label:"Repartidor asignado",color:"bg-purple-100 text-purple-800",description:"Un repartidor fue asignado"},"picked-up":{label:"En camino",color:"bg-orange-100 text-orange-800",description:"El repartidor est√° en camino"},"in-transit":{label:"En tr√°nsito",color:"bg-indigo-100 text-indigo-800",description:"Tu pedido est√° siendo entregado"},delivered:{label:"Entregado",color:"bg-green-100 text-green-800",description:"Tu pedido fue entregado"},completed:{label:"Completado",color:"bg-gray-100 text-gray-800",description:"Pedido completado exitosamente"},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800",description:"El pedido fue cancelado"},rejected:{label:"Rechazado",color:"bg-red-100 text-red-800",description:"El vendedor rechaz√≥ tu pedido"}},us={pickup:{label:"Recoger en tienda",icon:e.jsx(ie,{className:"w-4 h-4"}),color:"text-blue-600",description:"Recoge tu pedido en el establecimiento"},"dine-in":{label:"Comer en el lugar",icon:e.jsx(Ss,{className:"w-4 h-4"}),color:"text-purple-600",description:"Tu pedido ser√° servido en tu mesa"},delivery:{label:"Servicio a domicilio",icon:e.jsx(ne,{className:"w-4 h-4"}),color:"text-green-600",description:"Tu pedido ser√° entregado a tu direcci√≥n"}};function or(s){return xs[s]||xs.pending}function cr(s){return us[s]||us.pickup}function Ps(s){return new Date(s).toLocaleTimeString("es-GT",{hour:"2-digit",minute:"2-digit"})}function dr(s){return new Date(s).toLocaleDateString("es-GT")}function mr(s){return s.status==="delivered"||s.status==="completed"}function xr(s){switch(s){case"pickup":return"15-25 min";case"dine-in":return"20-30 min";case"delivery":return"30-45 min";default:return"20-30 min"}}function Is(s){const t=[{key:"pending",label:"Pedido realizado",icon:e.jsx(te,{className:"w-4 h-4"}),completed:!0,current:s.status==="pending",timestamp:s.created_at},{key:"accepted",label:"Pedido aceptado",icon:e.jsx(ae,{className:"w-4 h-4"}),completed:["accepted","ready","assigned","picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="accepted",timestamp:s.accepted_at},{key:"ready",label:s.delivery_type==="pickup"?"Listo para recoger":"Pedido listo",icon:s.delivery_type==="pickup"?e.jsx(ie,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"}),completed:["ready","assigned","picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="ready",timestamp:s.ready_at}];return s.delivery_type==="delivery"&&t.push({key:"assigned",label:"Repartidor asignado",icon:e.jsx(ne,{className:"w-4 h-4"}),completed:["assigned","picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="assigned",timestamp:s.status==="assigned"?s.updated_at:void 0},{key:"picked_up",label:"Pedido recogido",icon:e.jsx(te,{className:"w-4 h-4"}),completed:["picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="picked_up",timestamp:s.picked_up_at},{key:"in_transit",label:"En camino",icon:e.jsx(ne,{className:"w-4 h-4"}),completed:["in_transit","delivered","completed"].includes(s.status),current:s.status==="in_transit",timestamp:s.status==="in_transit"?s.updated_at:void 0}),t.push({key:"delivered",label:s.delivery_type==="pickup"?"Recogido":"Entregado",icon:e.jsx(ae,{className:"w-4 h-4"}),completed:["delivered","completed"].includes(s.status),current:s.status==="delivered",timestamp:s.delivered_at}),t}function ur(s){const t=s.filter(r=>r.completed).length;return Math.round(t/s.length*100)}function gr({order:s}){const t=or(s.status),r=cr(s.delivery_type),d=Is(s),c=ur(d);return e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"flex items-center gap-2",children:[r.icon,"Estado del Pedido"]}),e.jsx(K,{variant:t.color,children:t.label})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progreso"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[c,"%"]})]}),e.jsx(Ns,{value:c,className:"h-3"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.icon,e.jsx("span",{className:"font-medium",children:r.label})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description}),s.estimated_time&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{children:["Tiempo estimado: ",xr(s.delivery_type)]})]})]}),(s.status==="rejected"||s.status==="cancelled")&&s.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(be,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium text-red-800",children:s.status==="rejected"?"Raz√≥n del rechazo":"Raz√≥n de cancelaci√≥n"})]}),e.jsx("p",{className:"text-sm text-red-700",children:s.rejection_reason})]})]})]})}function hr({order:s}){const t=Is(s);return e.jsxs(G,{children:[e.jsx(W,{children:e.jsx(X,{children:"Seguimiento del Pedido"})}),e.jsx(U,{children:e.jsx("div",{className:"space-y-4",children:t.map((r,d)=>e.jsxs("div",{className:"relative flex gap-4",children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full border-2 flex items-center justify-center ${r.completed?"bg-green-500 border-green-500 text-white":r.current?"bg-orange-500 border-orange-500 text-white animate-pulse":"border-gray-300 text-gray-400"}`,children:r.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${r.completed?"text-green-700":r.current?"text-orange-700":"text-gray-500"}`,children:r.label}),r.timestamp&&e.jsx("div",{className:"text-sm text-gray-600",children:Ps(r.timestamp)})]}),d<t.length-1&&e.jsx("div",{className:`absolute left-4 mt-8 w-0.5 h-4 ${r.completed?"bg-green-500":"bg-gray-300"}`,style:{marginLeft:"15px"}})]},r.key))})})]})}function pr({orderId:s,type:t,onClose:r,onRatingSubmitted:d}){const{rateOrder:c}=Ze(),[i,p]=u.useState(0),[o,m]=u.useState(0),[N,I]=u.useState(""),[f,T]=u.useState(!1),[_,A]=u.useState(null),[v,k]=u.useState(!1),O=async()=>{if(i===0){A("Por favor selecciona una calificaci√≥n");return}T(!0),A(null);try{const P=await c(s,i,t,N.trim()||void 0);P.success?(k(!0),setTimeout(()=>{d()},1500)):A(P.message)}catch(P){console.error("Error submitting rating:",P),A("Error inesperado al enviar la calificaci√≥n")}finally{T(!1)}},Q=P=>{switch(P){case 1:return"Muy malo";case 2:return"Malo";case 3:return"Regular";case 4:return"Bueno";case 5:return"Excelente";default:return"Selecciona una calificaci√≥n"}},z=()=>t==="seller"?e.jsx(ie,{className:"w-6 h-6"}):e.jsx(ne,{className:"w-6 h-6"}),h=()=>t==="seller"?"Calificar Vendedor":"Calificar Repartidor",j=()=>t==="seller"?"¬øC√≥mo fue tu experiencia con el vendedor y la calidad de los productos?":"¬øC√≥mo fue la experiencia con el servicio de entrega?";return v?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(G,{className:"w-full max-w-md bg-white",children:e.jsxs(U,{className:"p-8 text-center bg-white",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900",children:"¬°Gracias por tu calificaci√≥n!"}),e.jsx("p",{className:"text-gray-600",children:"Tu opini√≥n nos ayuda a mejorar el servicio"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(G,{className:"w-full max-w-md bg-white border border-gray-200 shadow-xl",children:[e.jsxs(W,{className:"text-center bg-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-100 to-green-100 p-3 rounded-full w-16 h-16 mx-auto mb-4",children:e.jsx("div",{className:"text-orange-600",children:z()})}),e.jsx(X,{className:"text-gray-900",children:h()}),e.jsx("p",{className:"text-sm text-gray-600 font-normal",children:j()})]}),e.jsxs(U,{className:"space-y-6 bg-white",children:[_&&e.jsx(Pa,{variant:"destructive",children:e.jsx(Ia,{children:_})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(P=>e.jsx("button",{className:"transition-all duration-200 hover:scale-110",onMouseEnter:()=>m(P),onMouseLeave:()=>m(0),onClick:()=>p(P),disabled:f,children:e.jsx(re,{className:`w-8 h-8 ${P<=(o||i)?"text-yellow-400 fill-current":"text-gray-300"}`})},P))}),e.jsx("p",{className:"text-sm text-gray-600",children:Q(o||i)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Comentarios (opcional)"}),e.jsx(Fe,{placeholder:t==="seller"?"Cu√©ntanos sobre la calidad de los productos, el servicio al cliente, etc.":"Cu√©ntanos sobre la puntualidad, el trato, el estado de los productos, etc.",value:N,onChange:P=>I(P.target.value),rows:3,maxLength:500,disabled:f,className:"bg-white border border-gray-300"}),e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[N.length,"/500"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",onClick:r,disabled:f,className:"flex-1 bg-white border-gray-300 text-gray-700 hover:bg-gray-50",children:"Cancelar"}),e.jsx(F,{onClick:O,disabled:f||i===0,className:"flex-1 bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Enviar Calificaci√≥n"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center bg-white",children:"Tu calificaci√≥n ser√° visible para otros usuarios y ayudar√° a mejorar la calidad del servicio"})]})]})})}function fr({order:s,onOrderUpdate:t}){var p;const[r,d]=u.useState(!1),[c,i]=u.useState("seller");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{className:"sticky top-4",children:[e.jsx(W,{children:e.jsx(X,{children:"Resumen del Pedido"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:(p=s.items)==null?void 0:p.map(o=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:e.jsx(ge,{src:ks(o.product_image),alt:o.product_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:o.product_name}),e.jsxs("div",{className:"text-xs text-gray-600",children:[o.quantity," x Q",o.price.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm font-medium",children:["Q",(o.price*o.quantity).toFixed(2)]})]},o.id))}),e.jsx(de,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{children:s.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tel√©fono:"}),e.jsx("span",{children:s.phone_number})]})]}),s.delivery_type==="delivery"&&s.delivery_address&&e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Direcci√≥n de Entrega"]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.delivery_address})]})]}),s.customer_notes&&e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Notas especiales:"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:s.customer_notes})]})]}),e.jsx(de,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Q",s.subtotal.toFixed(2)]})]}),s.delivery_fee>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Env√≠o"}),e.jsxs("span",{children:["Q",s.delivery_fee.toFixed(2)]})]}),e.jsx(de,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Q",s.total.toFixed(2)]})]})]}),mr(s)&&e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Calificar experiencia"}),e.jsxs("div",{className:"space-y-2",children:[!s.seller_rating&&e.jsxs(F,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{i("seller"),d(!0)},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Calificar Vendedor"]}),s.delivery_type==="delivery"&&s.driver_id&&!s.driver_rating&&e.jsxs(F,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{i("driver"),d(!0)},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Calificar Repartidor"]})]}),(s.seller_rating||s.driver_rating)&&e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[s.seller_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Vendedor:"}),e.jsx("div",{className:"flex",children:[...Array(5)].map((o,m)=>e.jsx(re,{className:`w-3 h-3 ${m<s.seller_rating?"text-yellow-400 fill-current":"text-gray-300"}`},m))})]}),s.driver_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Repartidor:"}),e.jsx("div",{className:"flex",children:[...Array(5)].map((o,m)=>e.jsx(re,{className:`w-3 h-3 ${m<s.driver_rating?"text-yellow-400 fill-current":"text-gray-300"}`},m))})]})]})]})]})]})]}),r&&e.jsx(pr,{orderId:s.id,type:c,onClose:()=>d(!1),onRatingSubmitted:()=>{d(!1),t==null||t()}})]})}function Ts({orderId:s,onBack:t}){const{getOrderById:r,refreshOrders:d,loading:c}=Ze(),[i,p]=u.useState(null),[o,m]=u.useState(!1);u.useEffect(()=>{N()},[s]);const N=async()=>{const f=await r(s);p(f)},I=async()=>{m(!0),await d(),await N(),m(!1)};return c&&!i?e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}):i?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{variant:"outline",onClick:t,children:"‚Üê Volver"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Orden #",i.id.slice(-8).toUpperCase()]}),e.jsxs("p",{className:"text-gray-600",children:["Realizada el ",dr(i.created_at)," a las ",Ps(i.created_at)]})]})]}),e.jsxs(F,{variant:"outline",onClick:I,disabled:o,size:"sm",children:[e.jsx(ke,{className:`w-4 h-4 mr-2 ${o?"animate-spin":""}`}),o?"Actualizando...":"Actualizar"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(gr,{order:i}),e.jsx(hr,{order:i})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(fr,{order:i,onOrderUpdate:N})})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-4 text-center",children:[e.jsx(be,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Orden no encontrada"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No se pudo cargar la informaci√≥n de la orden"}),e.jsx(F,{onClick:t,children:"Volver a mis √≥rdenes"})]})}function jr({order:s,isHistory:t=!1,onViewOrder:r,onDeleteOrder:d,onConfirmReceived:c,onReorderFn:i,deletingOrderId:p,confirmingOrderId:o}){var l;const m=n=>{const a={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",icon:me,description:"Esperando confirmaci√≥n del vendedor"},accepted:{label:"Aceptado",color:"bg-blue-100 text-blue-800",icon:ae,description:"El vendedor est√° preparando tu pedido"},ready:{label:"Listo",color:"bg-green-100 text-green-800",icon:te,description:"Tu pedido est√° listo"},assigned:{label:"Repartidor asignado",color:"bg-purple-100 text-purple-800",icon:ne,description:"Un repartidor fue asignado"},picked_up:{label:"En camino",color:"bg-orange-100 text-orange-800",icon:ne,description:"El repartidor est√° en camino"},"in-transit":{label:"En tr√°nsito",color:"bg-indigo-100 text-indigo-800",icon:ne,description:"Tu pedido est√° siendo entregado"},delivered:{label:"Entregado",color:"bg-green-100 text-green-800",icon:ae,description:"Tu pedido fue entregado"},completed:{label:"Completado",color:"bg-gray-100 text-gray-800",icon:Ka,description:"Pedido completado exitosamente"},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800",icon:Re,description:"El pedido fue cancelado"},rejected:{label:"Rechazado",color:"bg-red-100 text-red-800",icon:Re,description:"El vendedor rechaz√≥ tu pedido"}};return a[n]||a.pending},N=n=>{const a={pickup:{label:"Recoger en tienda",icon:ie,color:"text-blue-600"},"dine-in":{label:"Comer dentro",icon:Ss,color:"text-purple-600"},delivery:{label:"Servicio a domicilio",icon:ne,color:"text-green-600"}};return a[n]||a.pickup},I=n=>({pending:10,accepted:25,ready:50,assigned:60,picked_up:75,in_transit:85,delivered:95,completed:100,cancelled:0,rejected:0})[n]||0,f=n=>n==="pending",T=n=>n==="delivered",_=m(s.status),A=N(s.delivery_type),v=I(s.status),k=_.icon,O=A.icon,Q=f(s.status),z=T(s.status),h=p===s.id,j=o===s.id,P=t?"border-gray-200 hover:shadow-md transition-shadow":"border-orange-200 shadow-lg hover:shadow-xl transition-shadow",w=t?"bg-gray-100":"bg-orange-100",q=t?"text-gray-600":"text-orange-600";return e.jsx(G,{className:P,children:e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${w} p-2 rounded-lg`,children:e.jsx(k,{className:`w-5 h-5 ${q}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.seller_name||"Vendedor"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Pedido #",s.id.slice(-8).toUpperCase()]})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[e.jsx(K,{className:_.color,children:_.label}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("es-GT")}),Q&&d&&e.jsxs(pa,{children:[e.jsx(fa,{asChild:!0,children:e.jsx(F,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 h-8 px-2",disabled:h,title:"Eliminar pedido no confirmado",children:h?e.jsx(ke,{className:"w-3 h-3 animate-spin"}):e.jsx(ze,{className:"w-3 h-3"})})}),e.jsxs(ja,{children:[e.jsxs(va,{children:[e.jsxs(Na,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-red-600"}),"¬øEliminar pedido no confirmado?"]}),e.jsxs(ba,{children:["Est√°s a punto de eliminar tu pedido de ",e.jsx("strong",{children:s.seller_name})," por un total de ",e.jsxs("strong",{children:["Q",s.total.toFixed(2)]}),".",e.jsx("br",{}),e.jsx("br",{}),"Esta acci√≥n no se puede deshacer. El pedido ser√° eliminado permanentemente y no podr√°s recuperarlo.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-yellow-600 font-medium",children:"üí° Tip:"})," Tambi√©n puedes esperar a que el vendedor responda a tu pedido."]})]}),e.jsxs(ya,{children:[e.jsx(wa,{children:"Mantener pedido"}),e.jsx(_a,{onClick:()=>d(s.id,s.seller_name||"Vendedor"),className:"bg-red-600 hover:bg-red-700",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Eliminando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"S√≠, eliminar pedido"]})})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[!t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:_.description}),e.jsxs("span",{className:"font-medium",children:[v,"%"]})]}),e.jsx(Ns,{value:v,className:"h-2"})]}),Q&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(ls,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsx("p",{className:"text-yellow-700 font-medium",children:"Pedido pendiente de confirmaci√≥n"}),e.jsx("p",{className:"text-yellow-600 text-xs mt-1",children:"Si el vendedor no acepta tu pedido o demora mucho en responder, puedes eliminarlo usando el bot√≥n üóëÔ∏è arriba."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:`w-4 h-4 ${A.color}`}),e.jsx("span",{className:"text-sm font-medium",children:A.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[((l=s.items)==null?void 0:l.length)||0," productos"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[s.estimated_time||30," min estimado"]})]})]}),s.items&&s.items.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[s.items.slice(0,t?4:3).map(n=>{var a;return e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 bg-white border rounded-lg p-2",children:[e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-gray-100",children:e.jsx(ge,{src:ks(n.product_image)||"",alt:n.product_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium truncate w-24",children:n.product_name}),e.jsxs("div",{className:"text-gray-500",children:[n.quantity,"x Q",((a=n.price)==null?void 0:a.toFixed(2))||"0.00"]})]})]},n.id)}),s.items.length>(t?4:3)&&e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-lg w-16 h-16",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["+",s.items.length-(t?4:3)]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-600",children:["Q",s.total.toFixed(2)]}),t&&(s.seller_rating||s.driver_rating)&&e.jsxs("div",{className:"flex items-center gap-2",children:[s.seller_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm",children:s.seller_rating})]}),s.driver_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4 text-blue-500"}),e.jsx(re,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm",children:s.driver_rating})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>r(s.id),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Ver detalles"]}),z&&c&&e.jsx(F,{variant:"default",size:"sm",onClick:()=>c(s.id,s.seller_name||"Vendedor"),disabled:j,className:"bg-green-600 hover:bg-green-700",children:j?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Confirmando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Confirmar recibido"]})}),t&&i&&e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>i(s.id),children:[e.jsx(xa,{className:"w-4 h-4 mr-2"}),"Volver a pedir"]})]})]})]})]})})}function gs({orders:s,isHistory:t=!1,loading:r=!1,onViewOrder:d,onDeleteOrder:c,onConfirmReceived:i,onReorderFn:p,deletingOrderId:o,confirmingOrderId:m,emptyTitle:N,emptyDescription:I}){if(r)return e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((f,T)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-200 w-10 h-10 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-gray-200 h-5 w-32 rounded"}),e.jsx("div",{className:"bg-gray-200 h-4 w-24 rounded"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-gray-200 h-6 w-20 rounded-full"}),e.jsx("div",{className:"bg-gray-200 h-4 w-16 rounded"})]})]}),!t&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"bg-gray-200 h-4 w-full rounded"}),e.jsx("div",{className:"bg-gray-200 h-2 w-full rounded"})]}),e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gray-200 h-4 w-24 rounded"}),e.jsx("div",{className:"bg-gray-200 h-4 w-20 rounded"}),e.jsx("div",{className:"bg-gray-200 h-4 w-28 rounded"})]})}),e.jsx("div",{className:"flex gap-2 mb-4",children:[...Array(3)].map((_,A)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded-lg",children:[e.jsx("div",{className:"bg-gray-200 w-10 h-10 rounded"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-gray-200 h-3 w-20 rounded"}),e.jsx("div",{className:"bg-gray-200 h-3 w-12 rounded"})]})]},A))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsx("div",{className:"bg-gray-200 h-6 w-20 rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-gray-200 h-8 w-24 rounded"}),e.jsx("div",{className:"bg-gray-200 h-8 w-28 rounded"})]})]})]})},T))});if(s.length===0){const f=t?"No hay pedidos en el historial":"No tienes pedidos activos",T=t?"Tus pedidos completados, cancelados o rechazados aparecer√°n aqu√≠":"Tus pedidos en proceso aparecer√°n aqu√≠";return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"bg-gray-100 rounded-full p-6 mb-6",children:e.jsx(je,{className:"w-16 h-16 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2 text-center",children:N||f}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:I||T}),!t&&e.jsx("div",{className:"mt-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-orange-700 font-medium text-sm mb-2",children:"üí° ¬øQuieres hacer tu primer pedido?"}),e.jsx("p",{className:"text-orange-600 text-sm",children:"Explora los productos disponibles y agrega algunos al carrito"})]})})]})}return e.jsx("div",{className:"space-y-4",children:s.map(f=>e.jsx(jr,{order:f,isHistory:t,onViewOrder:d,onDeleteOrder:c,onConfirmReceived:i,onReorderFn:p,deletingOrderId:o,confirmingOrderId:m},f.id))})}function vr({stats:s,loading:t=!1}){if(t)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((i,p)=>e.jsx(G,{className:"animate-pulse",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-gray-200 h-4 w-20 rounded"}),e.jsx("div",{className:"bg-gray-200 h-6 w-16 rounded"})]}),e.jsx("div",{className:"bg-gray-200 w-8 h-8 rounded"})]})})},p))});const r=[{title:"Total de Pedidos",value:s.totalOrders,icon:je,color:"text-blue-600",bgColor:"bg-blue-100",description:"Pedidos realizados"},{title:"Pedidos Activos",value:s.activeOrders,icon:me,color:"text-orange-600",bgColor:"bg-orange-100",description:"En proceso"},{title:"Completados",value:s.completedOrders,icon:ae,color:"text-green-600",bgColor:"bg-green-100",description:"Exitosos"},{title:"Total Gastado",value:`Q${s.totalSpent.toFixed(2)}`,icon:na,color:"text-purple-600",bgColor:"bg-purple-100",description:"Inversi√≥n total"}],d=[{label:"Promedio por pedido",value:`Q${s.averageOrderValue.toFixed(2)}`,icon:Oe,color:"text-green-600"},{label:"Calificaci√≥n promedio",value:s.averageRating>0?`${s.averageRating.toFixed(1)} ‚òÖ`:"Sin calificar",icon:re,color:"text-yellow-600"},{label:"Este mes",value:`${s.thisMonthOrders} pedidos`,icon:Pe,color:"text-indigo-600"}],c=[{label:"A domicilio",value:s.deliveryOrders,icon:ne,color:"text-green-600",percentage:s.totalOrders>0?(s.deliveryOrders/s.totalOrders*100).toFixed(0):0},{label:"Recoger en tienda",value:s.pickupOrders,icon:te,color:"text-blue-600",percentage:s.totalOrders>0?(s.pickupOrders/s.totalOrders*100).toFixed(0):0},{label:"Comer en lugar",value:s.dineInOrders,icon:te,color:"text-purple-600",percentage:s.totalOrders>0?(s.dineInOrders/s.totalOrders*100).toFixed(0):0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.map((i,p)=>{const o=i.icon;return e.jsx(G,{className:"border-orange-200 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:i.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.value}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]}),e.jsx("div",{className:`${i.bgColor} p-3 rounded-lg`,children:e.jsx(o,{className:`w-6 h-6 ${i.color}`})})]})})},p)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"border-orange-200 shadow-lg",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Oe,{className:"w-5 h-5 text-orange-500"}),"M√©tricas Adicionales"]})}),e.jsx(U,{className:"space-y-4",children:d.map((i,p)=>{const o=i.icon;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:`w-4 h-4 ${i.color}`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i.label})]}),e.jsx(K,{variant:"outline",className:"font-medium",children:i.value})]},p)})})]}),e.jsxs(G,{className:"border-orange-200 shadow-lg",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ne,{className:"w-5 h-5 text-orange-500"}),"Tipos de Entrega"]})}),e.jsx(U,{className:"space-y-4",children:c.map((i,p)=>{const o=i.icon;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:`w-4 h-4 ${i.color}`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:i.value}),e.jsxs(K,{variant:"secondary",className:"text-xs",children:[i.percentage,"%"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`${i.color.replace("text-","bg-")} h-2 rounded-full transition-all duration-300`,style:{width:`${i.percentage}%`}})})]},p)})})]})]}),s.totalOrders>0&&e.jsx(G,{className:"border-green-200 bg-green-50",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-lg",children:e.jsx(Oe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-1",children:"Resumen de tu actividad"}),e.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("p",{children:["‚Ä¢ Has realizado ",e.jsx("strong",{children:s.totalOrders})," pedidos con un gasto total de ",e.jsxs("strong",{children:["Q",s.totalSpent.toFixed(2)]})]}),e.jsxs("p",{children:["‚Ä¢ Tu pedido promedio es de ",e.jsxs("strong",{children:["Q",s.averageOrderValue.toFixed(2)]})]}),s.cancelledOrders>0&&e.jsxs("p",{children:["‚Ä¢ Tasa de √©xito: ",e.jsxs("strong",{children:[(s.completedOrders/s.totalOrders*100).toFixed(0),"%"]}),"(",s.cancelledOrders," cancelados)"]}),s.averageRating>0&&e.jsxs("p",{children:["‚Ä¢ Calificaci√≥n promedio que das: ",e.jsxs("strong",{children:[s.averageRating.toFixed(1)," estrellas"]})]})]})]})]})})})]})}function hs({onViewOrder:s}){const{orders:t,loading:r,refreshOrders:d,deleteUnconfirmedOrder:c}=Ze(),{user:i}=Ne(),[p,o]=u.useState("orders"),[m,N]=u.useState(null),[I,f]=u.useState(!1),[T,_]=u.useState(null),[A,v]=u.useState(null),k=w=>{N(w),s&&s(w)},O=async(w,q)=>{_(w);try{const l=await c(w);l.success?(H.success("Pedido eliminado",{description:`El pedido de ${q} ha sido eliminado exitosamente.`,duration:4e3}),await d()):H.error("Error",{description:l.message||"No se pudo eliminar el pedido.",duration:5e3})}catch(l){console.error("Error deleting order:",l),H.error("Error",{description:"Error inesperado al eliminar el pedido.",duration:5e3})}finally{_(null)}},Q=async(w,q)=>{var l;if(i!=null&&i.id){v(w);try{const{error:n}=await $.from("orders").update({status:"completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",w);if(n)throw n;const{error:a}=await $.from("notifications").insert([{recipient_id:(l=(await $.from("orders").select("seller_id").eq("id",w).single()).data)==null?void 0:l.seller_id,type:"order_completed_by_buyer",title:"‚úÖ Comprador confirm√≥ recepci√≥n",message:`El comprador confirm√≥ que recibi√≥ su pedido #${w.slice(0,8)}. ¬°Pedido completado exitosamente!`,data:{order_id:w,buyer_id:i.id},created_at:new Date().toISOString()}]);a&&console.error("Error enviando notificaci√≥n:",a),H.success("¬°Orden confirmada!",{description:`Has confirmado que recibiste tu pedido de ${q}.`,duration:4e3}),await d()}catch(n){console.error("Error confirming order received:",n),H.error("Error",{description:"No se pudo confirmar la recepci√≥n de la orden.",duration:5e3})}finally{v(null)}}},z=async w=>{H.info("Funci√≥n en desarrollo",{description:"La funcionalidad de volver a pedir estar√° disponible pronto.",duration:3e3})},h=t.filter(w=>!["delivered","completed","cancelled","rejected"].includes(w.status)),j=t.filter(w=>["delivered","completed","cancelled","rejected"].includes(w.status)),P=u.useMemo(()=>{const w=t.length,q=t.filter(C=>!["delivered","completed","cancelled","rejected"].includes(C.status)).length,l=t.filter(C=>["delivered","completed"].includes(C.status)).length,n=t.filter(C=>["cancelled","rejected"].includes(C.status)).length,a=t.filter(C=>["delivered","completed"].includes(C.status)).reduce((C,Z)=>C+Z.total,0),S=l>0?a/l:0,g=0,R=new Date;R.setDate(1);const V=t.filter(C=>new Date(C.created_at)>=R).length,M=t.filter(C=>C.delivery_type==="delivery").length,y=t.filter(C=>C.delivery_type==="pickup").length,E=t.filter(C=>C.delivery_type==="dine-in").length;return{totalOrders:w,activeOrders:q,completedOrders:l,cancelledOrders:n,totalSpent:a,averageOrderValue:S,averageRating:g,thisMonthOrders:V,deliveryOrders:M,pickupOrders:y,dineInOrders:E}},[t]);return m?e.jsx(Ts,{orderId:m,onBack:()=>N(null)}):e.jsx("div",{className:"space-y-6",children:e.jsxs($e,{value:p,onValueChange:o,className:"space-y-6",children:[e.jsxs(Le,{className:"grid w-full grid-cols-3 lg:w-[400px] mx-auto bg-white border border-orange-200",children:[e.jsxs(pe,{value:"orders",className:"data-[state=active]:bg-orange-100 data-[state=active]:text-orange-700",children:["Pedidos (",h.length,")"]}),e.jsxs(pe,{value:"history",className:"data-[state=active]:bg-gray-100 data-[state=active]:text-gray-700",children:["Historial (",j.length,")"]}),e.jsx(pe,{value:"stats",className:"data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700",children:"Estad√≠sticas"})]}),e.jsx(xe,{value:"orders",className:"space-y-4",children:e.jsx(gs,{orders:h,isHistory:!1,loading:r,onViewOrder:k,onDeleteOrder:O,onConfirmReceived:Q,deletingOrderId:T,confirmingOrderId:A,emptyTitle:"No tienes pedidos activos",emptyDescription:"Tus pedidos en proceso aparecer√°n aqu√≠"})}),e.jsx(xe,{value:"history",className:"space-y-4",children:e.jsx(gs,{orders:j,isHistory:!0,loading:r,onViewOrder:k,onReorderFn:z,emptyTitle:"No hay pedidos en el historial",emptyDescription:"Tus pedidos completados, cancelados o rechazados aparecer√°n aqu√≠"})}),e.jsx(xe,{value:"stats",className:"space-y-6",children:e.jsx(vr,{stats:P,loading:r})})]})})}var Je="Avatar",[Nr,yt]=Xe(Je),[br,Rs]=Nr(Je),As=u.forwardRef((s,t)=>{const{__scopeAvatar:r,...d}=s,[c,i]=u.useState("idle");return e.jsx(br,{scope:r,imageLoadingStatus:c,onImageLoadingStatusChange:i,children:e.jsx(Se.span,{...d,ref:t})})});As.displayName=Je;var Ds="AvatarImage",qs=u.forwardRef((s,t)=>{const{__scopeAvatar:r,src:d,onLoadingStatusChange:c=()=>{},...i}=s,p=Rs(Ds,r),o=yr(d,i.referrerPolicy),m=Ws(N=>{c(N),p.onImageLoadingStatusChange(N)});return bs(()=>{o!=="idle"&&m(o)},[o,m]),o==="loaded"?e.jsx(Se.img,{...i,ref:t,src:d}):null});qs.displayName=Ds;var Os="AvatarFallback",Fs=u.forwardRef((s,t)=>{const{__scopeAvatar:r,delayMs:d,...c}=s,i=Rs(Os,r),[p,o]=u.useState(d===void 0);return u.useEffect(()=>{if(d!==void 0){const m=window.setTimeout(()=>o(!0),d);return()=>window.clearTimeout(m)}},[d]),p&&i.imageLoadingStatus!=="loaded"?e.jsx(Se.span,{...c,ref:t}):null});Fs.displayName=Os;function yr(s,t){const[r,d]=u.useState("idle");return bs(()=>{if(!s){d("error");return}let c=!0;const i=new window.Image,p=o=>()=>{c&&d(o)};return d("loading"),i.onload=p("loaded"),i.onerror=p("error"),i.src=s,t&&(i.referrerPolicy=t),()=>{c=!1}},[s,t]),r}var wr=As,_r=qs,kr=Fs;function Cr({className:s,...t}){return e.jsx(wr,{"data-slot":"avatar",className:De("relative flex size-10 shrink-0 overflow-hidden rounded-full",s),...t})}function Sr({className:s,...t}){return e.jsx(_r,{"data-slot":"avatar-image",className:De("aspect-square size-full",s),...t})}function Er({className:s,...t}){return e.jsx(kr,{"data-slot":"avatar-fallback",className:De("bg-muted flex size-full items-center justify-center rounded-full",s),...t})}function ps({onShowCart:s}){const{user:t,updateProfile:r}=Ne(),{getCartItemCount:d}=we(),[c,i]=u.useState(null),[p,o]=u.useState(!1),[m,N]=u.useState(!1),[I,f]=u.useState(!1),[T,_]=u.useState(""),[A,v]=u.useState(""),k=u.useRef(null),[O,Q]=u.useState({total_orders:0,completed_orders:0,total_spent:0,average_rating:0});u.useEffect(()=>{t&&(z(),P())},[t]);const z=async()=>{if(t)try{const{data:l,error:n}=await $.from("users").select("*").eq("id",t.id).single();if(n)throw n;i({...l,notification_preferences:l.notification_preferences||{order_updates:!0,promotions:!0,new_products:!1}})}catch(l){console.error("Error loading profile:",l)}},h=(l,n,a,S=.9)=>new Promise(g=>{const R=document.createElement("canvas"),V=R.getContext("2d"),M=new Image;M.onload=()=>{let{width:y,height:E}=M;y>E?y>n&&(E=E*n/y,y=n):E>a&&(y=y*a/E,E=a),R.width=y,R.height=E,V.drawImage(M,0,0,y,E),R.toBlob(g,"image/jpeg",S)},M.src=URL.createObjectURL(l)}),j=async l=>{var a;const n=(a=l.target.files)==null?void 0:a[0];if(!(!n||!t))try{f(!0),_(""),v("");const S=["image/jpeg","image/jpg","image/png","image/webp"],g=5*1024*1024;if(!S.includes(n.type.toLowerCase())){_("Solo se permiten im√°genes JPG, PNG o WebP");return}if(n.size>g){_("La imagen debe ser menor a 5MB");return}const R=await h(n,400,400,.85);if(!R){_("Error al procesar la imagen");return}const V=`${t.id}/avatar-${Date.now()}.jpg`,{error:M}=await $.storage.from("user-avatars").upload(V,R,{upsert:!0,contentType:"image/jpeg"});if(M){console.error("Upload error:",M),_(`Error subiendo imagen: ${M.message}`);return}const{data:y}=$.storage.from("user-avatars").getPublicUrl(V),{error:E}=await $.from("users").update({avatar_url:y.publicUrl,updated_at:new Date().toISOString()}).eq("id",t.id);if(E){_(`Error guardando en base de datos: ${E.message}`);return}i(C=>C?{...C,avatar_url:y.publicUrl}:null),await r({avatar_url:y.publicUrl}),v("‚úÖ Foto de perfil actualizada correctamente"),setTimeout(()=>v(""),3e3)}catch(S){console.error("Avatar upload error:",S),_(`Error: ${S.message||"Error desconocido"}`)}finally{f(!1),k.current&&(k.current.value="")}},P=async()=>{if(t)try{const{data:l,error:n}=await $.from("orders").select("total, status, seller_rating, created_at, delivery_type").eq("buyer_id",t.id);if(n){console.error("Error loading orders:",n);return}if(!l||l.length===0){Q({total_orders:0,completed_orders:0,total_spent:0,average_rating:0});return}const a=l.reduce((g,R)=>{g.total_orders++;const V=Number(R.total)||0;return R.status==="completed"&&(g.completed_orders++,g.total_spent+=V),R.seller_rating&&R.seller_rating>0&&g.ratings.push(Number(R.seller_rating)),g},{total_orders:0,completed_orders:0,total_spent:0,ratings:[]}),S=a.ratings.length>0?a.ratings.reduce((g,R)=>g+R,0)/a.ratings.length:0;Q({total_orders:a.total_orders,completed_orders:a.completed_orders,total_spent:a.total_spent,average_rating:Math.round(S*10)/10})}catch(l){console.error("Error loading order stats:",l),Q({total_orders:0,completed_orders:0,total_spent:0,average_rating:0})}},w=async()=>{if(c){N(!0),_("");try{const{error:l}=await $.from("users").update({name:c.name,phone:c.phone,address:c.address,preferred_delivery_address:c.preferred_delivery_address}).eq("id",c.id);if(l)throw l;await r({name:c.name,phone:c.phone}),v("‚úÖ Perfil actualizado correctamente"),o(!1),setTimeout(()=>v(""),3e3)}catch(l){console.error("Error updating profile:",l),_("Error al actualizar perfil: "+l.message)}finally{N(!1)}}},q=(l,n)=>{c&&i({...c,notification_preferences:{...c.notification_preferences,[l]:n}})};return c?e.jsxs("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-0",children:[T&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"break-words",children:T})}),A&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"break-words",children:A})}),e.jsx(G,{className:"border-orange-200 shadow-lg",children:e.jsx(U,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 sm:gap-6",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs(Cr,{className:"w-20 h-20 sm:w-24 sm:h-24 border-4 border-white shadow-lg",children:[e.jsx(Sr,{src:c.avatar_url,className:"object-cover"}),e.jsx(Er,{className:"text-xl sm:text-2xl bg-gradient-to-r from-orange-500 to-green-500 text-white",children:c.name.charAt(0).toUpperCase()})]}),e.jsx("input",{ref:k,type:"file",accept:"image/*",className:"hidden",onChange:j}),e.jsx(F,{size:"sm",variant:"outline",className:"absolute -bottom-2 -right-2 h-8 w-8 p-0 rounded-full bg-white shadow-lg hover:bg-orange-50 transition-colors",onClick:()=>{var l;return(l=k.current)==null?void 0:l.click()},disabled:I,children:I?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500"}):e.jsx(Ta,{className:"w-4 h-4 text-orange-600"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:c.name}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>o(!p),children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),p?"Cancelar":"Editar perfil"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 text-sm text-gray-600 mb-3 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-1 break-all",children:[e.jsx(Aa,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:c.email})]}),c.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:c.phone})]}),e.jsxs(K,{variant:"outline",className:"border-green-200 text-green-700 w-fit",children:[e.jsx(os,{className:"w-3 h-3 mr-1"}),"Comprador verificado"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg border border-orange-100",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-600",children:O.total_orders}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pedidos totales"}),O.completed_orders>0&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:[O.completed_orders," completados"]})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:["Q",O.total_spent.toFixed(0)]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total gastado"}),O.total_orders>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Promedio: Q",(O.total_spent/O.completed_orders||0).toFixed(0)]})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-100",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600 flex items-center justify-center gap-1",children:[O.average_rating>0?O.average_rating.toFixed(1):"0.0",e.jsx(re,{className:"w-4 h-4 fill-current"})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Tu calificaci√≥n"}),O.average_rating===0&&O.total_orders>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Sin calificar a√∫n"})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(G,{className:"border-blue-200",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-500"}),"Informaci√≥n Personal"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"name",children:"Nombre completo"}),e.jsx(he,{id:"name",value:c.name,onChange:l=>i({...c,name:l.target.value}),disabled:!p,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx(he,{id:"email",type:"email",value:c.email,disabled:!0,className:"mt-1 bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"El correo no se puede cambiar"})]}),e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"phone",children:"Tel√©fono"}),e.jsx(he,{id:"phone",value:c.phone||"",onChange:l=>i({...c,phone:l.target.value}),disabled:!p,placeholder:"Tu n√∫mero de tel√©fono",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"date_of_birth",children:"Fecha de nacimiento"}),e.jsx(he,{id:"date_of_birth",type:"date",value:c.date_of_birth||"",onChange:l=>i({...c,date_of_birth:l.target.value}),disabled:!p,className:"mt-1"})]})]}),p&&e.jsxs(F,{onClick:w,disabled:m,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),m?"Guardando...":"Guardar cambios"]}),T&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:T})}),A&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-700 text-sm",children:A})})]})]}),e.jsxs(G,{className:"border-green-200",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-green-500"}),"Gesti√≥n de Direcciones"]})}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ce,{htmlFor:"preferred_delivery_address",children:"Direcci√≥n principal de entrega"}),e.jsx(Fe,{id:"preferred_delivery_address",className:"mt-1",rows:3,placeholder:"Ingresa tu direcci√≥n completa (calle, n√∫mero, colonia, referencias)",value:c.preferred_delivery_address||"",onChange:l=>i({...c,preferred_delivery_address:l.target.value}),disabled:!p}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Incluye referencias importantes (edificio, color de casa, puntos de referencia)"})]}),e.jsx(F,{variant:"outline",className:"w-full h-auto py-3",onClick:()=>{if(!navigator.geolocation){_("GPS no disponible en este dispositivo");return}if(N(!0),_(""),!t){_("Usuario no disponible"),N(!1);return}navigator.geolocation.getCurrentPosition(async l=>{try{const{latitude:n,longitude:a}=l.coords,{error:S}=await $.from("users").update({latitude:n,longitude:a,updated_at:new Date().toISOString()}).eq("id",t.id);if(S)throw S;v(`‚úÖ Ubicaci√≥n GPS actualizada: ${n.toFixed(6)}, ${a.toFixed(6)}`),setTimeout(()=>v(""),5e3)}catch{_("Error al guardar ubicaci√≥n GPS")}finally{N(!1)}},l=>{switch(N(!1),l.code){case l.PERMISSION_DENIED:_("Permiso de ubicaci√≥n denegado. Activa el GPS en configuraci√≥n.");break;case l.POSITION_UNAVAILABLE:_("Informaci√≥n de ubicaci√≥n no disponible.");break;case l.TIMEOUT:_("Tiempo de espera agotado para obtener ubicaci√≥n.");break;default:_("Error desconocido al obtener ubicaci√≥n.");break}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},disabled:m,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-center leading-tight",children:m?"Obteniendo ubicaci√≥n...":"Actualizar ubicaci√≥n GPS"})]})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 break-words",children:"La ubicaci√≥n GPS nos ayuda a mostrar vendedores cercanos y calcular costos de entrega"})})]})})]})]}),e.jsxs(G,{className:"border-purple-200",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-purple-500"}),"Preferencias de Notificaciones"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ce,{htmlFor:"order_updates",className:"text-base",children:"Actualizaciones de pedidos"}),e.jsx("p",{className:"text-sm text-gray-500 break-words",children:"Recibe notificaciones sobre el estado de tus pedidos"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ge,{id:"order_updates",checked:c.notification_preferences.order_updates,onCheckedChange:l=>q("order_updates",l),disabled:!p})})]}),e.jsx(de,{}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ce,{htmlFor:"promotions",className:"text-base",children:"Promociones y ofertas"}),e.jsx("p",{className:"text-sm text-gray-500 break-words",children:"Recibe ofertas especiales y promociones"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ge,{id:"promotions",checked:c.notification_preferences.promotions,onCheckedChange:l=>q("promotions",l),disabled:!p})})]}),e.jsx(de,{}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ce,{htmlFor:"new_products",className:"text-base",children:"Nuevos productos"}),e.jsx("p",{className:"text-sm text-gray-500 break-words",children:"Notificaciones cuando hay nuevos productos disponibles"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ge,{id:"new_products",checked:c.notification_preferences.new_products,onCheckedChange:l=>q("new_products",l),disabled:!p})})]})]}),p&&e.jsxs(F,{onClick:w,disabled:m,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Guardar preferencias"]})]})]}),e.jsxs(G,{className:"border-gray-200",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5 text-gray-500"}),"Acciones R√°pidas"]})}),e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(F,{variant:"outline",className:"h-16 flex flex-col gap-2 text-center",children:[e.jsx(Me,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm leading-tight",children:"Productos favoritos"})]}),e.jsxs(F,{variant:"outline",className:"h-16 flex flex-col gap-2 text-center",children:[e.jsx(Da,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-sm leading-tight",children:"Historial de compras"})]}),e.jsxs(F,{variant:"outline",className:"h-16 flex flex-col gap-2 text-center",children:[e.jsx(Te,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm leading-tight",children:"M√©todos de pago"})]})]})})]}),e.jsxs(G,{className:"border-yellow-200",children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"w-5 h-5 text-yellow-500"}),"Seguridad de la Cuenta"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(os,{className:"w-8 h-8 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-yellow-800",children:"Cuenta protegida"}),e.jsx("p",{className:"text-sm text-yellow-700 break-words",children:"Tu cuenta est√° protegida por autenticaci√≥n segura de Supabase"})]})]})}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:e.jsx("p",{className:"break-words",children:"Para cambios de seguridad como contrase√±a, contacta al soporte t√©cnico"})})]})]}),e.jsx(Ye,{onCartClick:s||(()=>{alert(`Tienes ${d()} productos en tu carrito. Funcionalidad de carrito implementada.`)})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})}function Pr({onContinueShopping:s,onProceedToCheckout:t}){const{user:r}=Ne(),{items:d,updateCartItem:c,removeFromCart:i,clearCart:p,getCartTotal:o,getCartItemCount:m}=we(),[N,I]=u.useState(null),[f,T]=u.useState(null),[_,A]=u.useState(""),[v,k]=u.useState(null),O=o(),Q=O,z=d.reduce((n,a)=>{var R,V,M;const S=((R=a.product)==null?void 0:R.seller_id)||"unknown",g=((M=(V=a.product)==null?void 0:V.seller)==null?void 0:M.business_name)||"Vendedor";return n[S]||(n[S]={sellerId:S,sellerName:g,items:[]}),n[S].items.push(a),n},{}),h=async(n,a)=>{if(!(a<0)){I(n);try{a===0?(await i(n),H.success("Eliminado")):await c(n,a)}catch(S){console.error("Error updating cart:",S),H.error("Error al actualizar el carrito")}finally{I(null)}}},j=(n,a)=>{T(n),A(a.toString())},P=n=>{const a=parseInt(_);!isNaN(a)&&a>=0&&h(n,a),T(null),A("")},w=(n,a)=>{n.key==="Enter"?P(a):n.key==="Escape"&&(T(null),A(""))},q=async n=>{try{await i(n),H.success("Eliminado")}catch(a){console.error("Error removing item:",a),H.error("Error al eliminar producto")}},l=async()=>{try{await p(),H.success("Carrito vac√≠o")}catch(n){console.error("Error clearing cart:",n),H.error("Error al vaciar carrito")}};return d.length===0?e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"w-24 h-24 text-gray-300 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Tu carrito est√° vac√≠o"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Agrega algunos productos para comenzar tu pedido"}),e.jsxs(F,{onClick:s,className:"bg-orange-500 hover:bg-orange-600 text-white px-8 py-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Explorar Productos"]})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-4 lg:p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(je,{className:"w-7 h-7 text-orange-500"}),"Mi Carrito"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[m()," ",m()===1?"producto":"productos"," en tu carrito"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(F,{variant:"outline",onClick:s,className:"border-orange-200 text-orange-600 hover:bg-orange-50",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Continuar Comprando"]}),d.length>0&&e.jsxs(F,{variant:"outline",onClick:l,className:"border-red-200 text-red-600 hover:bg-red-50",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Vaciar Carrito"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:Object.values(z).map(n=>e.jsxs(G,{className:"shadow-sm border border-gray-200",children:[e.jsx(W,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx(X,{className:"text-lg font-semibold",children:n.sellerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.items.length," productos"]})]})]})}),e.jsx(U,{children:e.jsx("div",{className:"space-y-4",children:n.items.map(a=>{var S,g,R,V,M,y;return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx(ge,{src:((S=a.product)==null?void 0:S.image_url)||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300&h=200&fit=crop",alt:((g=a.product)==null?void 0:g.name)||"Producto",className:"w-16 h-16 object-cover rounded-lg flex-shrink-0 cursor-pointer",onClick:()=>{var E,C;return k({src:((E=a.product)==null?void 0:E.image_url)||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=800&h=600&fit=crop",alt:((C=a.product)==null?void 0:C.name)||"Producto"})}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:(R=a.product)==null?void 0:R.name}),e.jsxs("p",{className:"text-green-600 font-semibold text-lg",children:["Q",(V=a.product)==null?void 0:V.price]}),((M=a.product)==null?void 0:M.description)&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:a.product.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(a.id,a.quantity-1),disabled:N===a.id,className:"h-8 w-8 p-0",children:e.jsx(Qe,{className:"w-3 h-3"})}),f===a.id?e.jsx(he,{value:_,onChange:E=>A(E.target.value),onBlur:()=>P(a.id),onKeyDown:E=>w(E,a.id),className:"w-16 h-8 text-center text-sm font-medium p-1",autoFocus:!0}):e.jsx("span",{className:"px-3 py-1 bg-white border rounded font-medium cursor-pointer hover:bg-gray-50 min-w-[3rem] text-center",onClick:()=>j(a.id,a.quantity),title:"Haz clic para editar cantidad",children:N===a.id?"...":a.quantity}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(a.id,a.quantity+1),disabled:N===a.id,className:"h-8 w-8 p-0",children:e.jsx(fe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-lg",children:["Q",(((y=a.product)==null?void 0:y.price)*a.quantity).toFixed(2)]})}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>q(a.id),className:"h-8 w-8 p-0 text-red-600 border-red-200 hover:bg-red-50",children:e.jsx(ze,{className:"w-3 h-3"})})]})]})]},a.id)})})})]},n.sellerId))}),e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{className:"shadow-sm border border-gray-200",children:[e.jsx(W,{children:e.jsx(X,{className:"text-lg",children:"Resumen del Pedido"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["Q",O.toFixed(2)]})]}),e.jsx(de,{}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-orange-600",children:["Q",Q.toFixed(2)]})]}),e.jsxs(F,{onClick:t,className:"w-full bg-orange-500 hover:bg-orange-600 text-white py-3 text-lg font-medium",size:"lg",children:[e.jsx(Te,{className:"w-5 h-5 mr-2"}),"Proceder al Pago",e.jsx(Cs,{className:"w-5 h-5 ml-2"})]})]})]})})]}),e.jsx(Zs,{open:!!v,onOpenChange:()=>k(null),children:e.jsxs(Ys,{className:"max-w-4xl max-h-[90vh] p-2",children:[e.jsx(Js,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ea,{className:"text-lg font-semibold",children:v==null?void 0:v.alt}),e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>k(null),className:"h-8 w-8 p-0",children:e.jsx(Ie,{className:"h-4 w-4"})})]})}),v&&e.jsx("div",{className:"flex items-center justify-center max-h-[70vh]",children:e.jsx("img",{src:v.src,alt:v.alt,className:"max-w-full max-h-full object-contain rounded-lg shadow-lg",onError:n=>{const a=n.target;a.src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=800&h=600&fit=crop"}})})]})})]})}var es="Radio",[Ir,zs]=Xe(es),[Tr,Rr]=Ir(es),Ms=u.forwardRef((s,t)=>{const{__scopeRadio:r,name:d,checked:c=!1,required:i,disabled:p,value:o="on",onCheck:m,form:N,...I}=s,[f,T]=u.useState(null),_=ys(t,k=>T(k)),A=u.useRef(!1),v=f?N||!!f.closest("form"):!0;return e.jsxs(Tr,{scope:r,checked:c,disabled:p,children:[e.jsx(Se.button,{type:"button",role:"radio","aria-checked":c,"data-state":Bs(c),"data-disabled":p?"":void 0,disabled:p,value:o,...I,ref:_,onClick:Ue(s.onClick,k=>{c||m==null||m(),v&&(A.current=k.isPropagationStopped(),A.current||k.stopPropagation())})}),v&&e.jsx(Ar,{control:f,bubbles:!A.current,name:d,value:o,checked:c,required:i,disabled:p,form:N,style:{transform:"translateX(-100%)"}})]})});Ms.displayName=es;var $s="RadioIndicator",Ls=u.forwardRef((s,t)=>{const{__scopeRadio:r,forceMount:d,...c}=s,i=Rr($s,r);return e.jsx(ra,{present:d||i.checked,children:e.jsx(Se.span,{"data-state":Bs(i.checked),"data-disabled":i.disabled?"":void 0,...c,ref:t})})});Ls.displayName=$s;var Ar=s=>{const{control:t,checked:r,bubbles:d=!0,...c}=s,i=u.useRef(null),p=ta(r),o=ia(t);return u.useEffect(()=>{const m=i.current,N=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(N,"checked").set;if(p!==r&&f){const T=new Event("click",{bubbles:d});f.call(m,r),m.dispatchEvent(T)}},[p,r,d]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:i,style:{...s.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Bs(s){return s?"checked":"unchecked"}var Dr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ss="RadioGroup",[qr,wt]=Xe(ss,[ws,zs]),Vs=ws(),Gs=zs(),[Or,Fr]=qr(ss),Us=u.forwardRef((s,t)=>{const{__scopeRadioGroup:r,name:d,defaultValue:c,value:i,required:p=!1,disabled:o=!1,orientation:m,dir:N,loop:I=!0,onValueChange:f,...T}=s,_=Vs(r),A=sa(N),[v,k]=aa({prop:i,defaultProp:c,onChange:f});return e.jsx(Or,{scope:r,name:d,required:p,disabled:o,value:v,onValueChange:k,children:e.jsx(la,{asChild:!0,..._,orientation:m,dir:A,loop:I,children:e.jsx(Se.div,{role:"radiogroup","aria-required":p,"aria-orientation":m,"data-disabled":o?"":void 0,dir:A,...T,ref:t})})})});Us.displayName=ss;var Qs="RadioGroupItem",Hs=u.forwardRef((s,t)=>{const{__scopeRadioGroup:r,disabled:d,...c}=s,i=Fr(Qs,r),p=i.disabled||d,o=Vs(r),m=Gs(r),N=u.useRef(null),I=ys(t,N),f=i.value===c.value,T=u.useRef(!1);return u.useEffect(()=>{const _=v=>{Dr.includes(v.key)&&(T.current=!0)},A=()=>T.current=!1;return document.addEventListener("keydown",_),document.addEventListener("keyup",A),()=>{document.removeEventListener("keydown",_),document.removeEventListener("keyup",A)}},[]),e.jsx(oa,{asChild:!0,...o,focusable:!p,active:f,children:e.jsx(Ms,{disabled:p,required:i.required,checked:f,...m,...c,name:i.name,ref:I,onCheck:()=>i.onValueChange(c.value),onKeyDown:Ue(_=>{_.key==="Enter"&&_.preventDefault()}),onFocus:Ue(c.onFocus,()=>{var _;T.current&&((_=N.current)==null||_.click())})})})});Hs.displayName=Qs;var zr="RadioGroupIndicator",Ks=u.forwardRef((s,t)=>{const{__scopeRadioGroup:r,...d}=s,c=Gs(r);return e.jsx(Ls,{...c,...d,ref:t})});Ks.displayName=zr;var Mr=Us,$r=Hs,Lr=Ks;function fs({className:s,...t}){return e.jsx(Mr,{"data-slot":"radio-group",className:De("grid gap-3",s),...t})}function js({className:s,...t}){return e.jsx($r,{"data-slot":"radio-group-item",className:De("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Lr,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(La,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Br({onBack:s,onComplete:t}){const{user:r}=Ne(),{items:d,clearCart:c,getCartTotal:i}=we(),{notify:p}=ca(),[o,m]=u.useState("complete-info"),[N,I]=u.useState("pickup"),[f,T]=u.useState(!1),[_,A]=u.useState(!1),[v,k]=u.useState({customer_name:"",phone_number:"",delivery_address:"",customer_notes:"",payment_method:"cash"});u.useEffect(()=>{r&&O()},[r]);const O=async()=>{try{const{data:y,error:E}=await $.from("users").select("name, phone, address, preferred_delivery_address").eq("id",r==null?void 0:r.id).single();if(E)throw E;k(y?C=>({...C,customer_name:y.name||(r==null?void 0:r.name)||"",phone_number:y.phone||(r==null?void 0:r.phone)||"",delivery_address:y.preferred_delivery_address||y.address||"",customer_notes:""}):C=>({...C,customer_name:(r==null?void 0:r.name)||"",phone_number:(r==null?void 0:r.phone)||"",delivery_address:"",customer_notes:""}))}catch(y){console.error("Error loading user profile:",y),k(E=>({...E,customer_name:(r==null?void 0:r.name)||"",phone_number:(r==null?void 0:r.phone)||"",delivery_address:"",customer_notes:""}))}},Q=d.reduce((y,E)=>{var C;return y+(((C=E.product)==null?void 0:C.price)||0)*E.quantity},0),z=N==="delivery"?15:0,h=Q+z,j=[{type:"pickup",title:"Recoger en tienda",description:"Recoge tu pedido directamente en la tienda",icon:ie,fee:0},{type:"dine-in",title:"Comer en el lugar",description:"Disfruta tu comida en el restaurante",icon:Xa,fee:0},{type:"delivery",title:"Servicio a domicilio",description:"Te llevamos tu pedido a tu direcci√≥n",icon:ne,fee:15}],P=[{type:"cash",title:"Efectivo",description:"Paga al recibir tu pedido",icon:Ma},{type:"card",title:"Tarjeta",description:"Tarjeta de d√©bito o cr√©dito",icon:Te},{type:"transfer",title:"Transferencia",description:"Transferencia bancaria",icon:Ja}],w=y=>{switch(y){case"complete-info":return N==="delivery"&&!v.delivery_address.trim()?"Ingresa tu direcci√≥n de entrega":v.customer_name.trim()?v.phone_number.trim()?null:"Ingresa tu tel√©fono":"Ingresa tu nombre";case"payment":return v.payment_method?null:"Selecciona un m√©todo de pago";default:return null}},q=()=>{const y=w(o);if(y){H.error(y);return}const E=["complete-info","payment","review"],C=E.indexOf(o);C<E.length-1&&m(E[C+1])},l=()=>{const y=["complete-info","payment","review"],E=y.indexOf(o);E>0&&m(y[E-1])},n=async()=>{var E;if(!r){H.error("Debes iniciar sesi√≥n para crear un pedido");return}if(!v.customer_name.trim()||!v.phone_number.trim()){H.error("Por favor completa toda la informaci√≥n requerida"),m("complete-info");return}if(N==="delivery"&&!v.delivery_address.trim()){H.error("La direcci√≥n de entrega es requerida para servicio a domicilio"),m("complete-info");return}if(!d||d.length===0){H.error("Tu carrito est√° vac√≠o");return}if(d.filter(C=>!C.product_id||!C.quantity||C.quantity<=0).length>0){H.error("Hay productos inv√°lidos en tu carrito. Por favor actualiza tu carrito.");return}m("processing"),T(!0);try{console.log("Cart items:",d);let C=null;for(const b of d){if(b.seller_id){C=b.seller_id;break}if((E=b.product)!=null&&E.seller_id){C=b.product.seller_id;break}}if(console.log("Seller ID encontrado:",C),!C&&d.length>0){console.log("Intentando obtener seller_id del producto...");try{const{data:b,error:L}=await $.from("products").select("seller_id").eq("id",d[0].product_id).single();!L&&(b!=null&&b.seller_id)&&(C=b.seller_id,console.log("Seller ID obtenido del producto:",C))}catch(b){console.error("Error obteniendo seller_id del producto:",b)}}if(!C)throw new Error(`No se pudo identificar el vendedor. Por favor:
1. Vac√≠a tu carrito
2. Agrega los productos nuevamente
3. Si el problema persiste, contacta soporte`);const Z={buyer_id:r.id,seller_id:C,subtotal:Number(Q.toFixed(2)),delivery_fee:Number(z.toFixed(2)),total_amount:Number(h.toFixed(2)),total:Number(h.toFixed(2)),delivery_type:N,delivery_address:N==="delivery"?v.delivery_address.trim():N==="pickup"?"Recoger en tienda":"Comer en el lugar",customer_notes:v.customer_notes.trim()||null,phone_number:v.phone_number.trim(),customer_name:v.customer_name.trim(),payment_method:v.payment_method,status:"pending"};console.log("üîç Validando stock disponible...");const ee=(await Promise.all(d.map(async b=>{var se;let L=null,D="",B=0;if(b.product_type==="daily"){const{data:J}=await $.from("daily_products").select("stock_quantity, name, expires_at").eq("id",b.product_id).single();J&&(L=J,D=J.name,B=new Date(J.expires_at)<=new Date?0:J.stock_quantity)}else{const{data:J}=await $.from("products").select("stock_quantity, name").eq("id",b.product_id).single();J&&(L=J,D=J.name,B=J.stock_quantity)}return{productId:b.product_id,productName:D||((se=b.product)==null?void 0:se.name)||"Producto",requestedQuantity:b.quantity,availableStock:B||0,isValid:(B||0)>=b.quantity}}))).filter(b=>!b.isValid);if(ee.length>0){const b=ee.map(L=>L.availableStock===0?`‚ùå ${L.productName}: AGOTADO`:`‚ö†Ô∏è ${L.productName}: Solo ${L.availableStock} disponibles (solicitaste ${L.requestedQuantity})`).join(`
`);throw new Error(`‚ùå STOCK INSUFICIENTE:

${b}

üí° Actualiza las cantidades en tu carrito y vuelve a intentar.`)}console.log("‚úÖ Stock validado correctamente");const{data:Y,error:oe}=await $.from("orders").insert(Z).select().single();if(oe)throw console.error("Error creating order:",oe),new Error(`Error al crear la orden: ${oe.message}`);if(!Y)throw new Error("No se pudo crear la orden");const ue=d.map(b=>{var L,D,B,se,J;return{order_id:Y.id,product_id:b.product_id,product_name:((L=b.product)==null?void 0:L.name)||b.product_name||"Producto",product_image:((D=b.product)==null?void 0:D.image_url)||b.product_image||null,price:Number((((B=b.product)==null?void 0:B.price)||b.product_price||0).toFixed(2)),price_per_unit:Number((((se=b.product)==null?void 0:se.price)||b.product_price||0).toFixed(2)),quantity:Number(b.quantity),total_price:Number(((((J=b.product)==null?void 0:J.price)||b.product_price||0)*b.quantity).toFixed(2)),product_type:b.product_type||"regular",notes:null}}),{error:x}=await $.from("order_items").insert(ue);if(x)throw console.error("Error creating order items:",x),await $.from("orders").delete().eq("id",Y.id),new Error(`Error al agregar productos a la orden: ${x.message}`);try{await $.from("notifications").insert({recipient_id:C,type:"new_order",title:"üõí Nueva orden recibida",message:`${v.customer_name} ha realizado un pedido por Q${h.toFixed(2)} - ${N==="pickup"?"Recoger en tienda":N==="dine-in"?"Comer en el lugar":"Servicio a domicilio"}`,data:{order_id:Y.id,delivery_type:N,payment_method:v.payment_method,customer_name:v.customer_name,customer_phone:v.phone_number,total:h}})}catch(b){console.error("Error creating notification:",b)}try{await p("üõí Nueva Orden Recibida",{body:`${v.customer_name} realiz√≥ un pedido por Q${h.toFixed(2)}`,sound:"NEW_ORDER",push:!0,data:{orderId:Y.id,customerId:r==null?void 0:r.id,total:h}})}catch(b){console.error("Error sending sound notification:",b)}await c(),A(!0),H.success("¬°Pedido creado exitosamente!"),setTimeout(()=>{t()},2e3)}catch(C){console.error("Error creating order:",C);const Z=C instanceof Error?C.message:"Error desconocido al crear el pedido";H.error(Z),m("review")}finally{T(!1)}},a=()=>{const y=[{key:"complete-info",label:"Informaci√≥n",icon:Ce},{key:"payment",label:"Pago",icon:Te},{key:"review",label:"Revisar",icon:ae}],E=y.findIndex(C=>C.key===o);return e.jsx("div",{className:"flex items-center justify-between mb-8",children:y.map((C,Z)=>{const le=C.icon,ee=C.key===o,Y=Z<E;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${ee?"bg-orange-500 text-white":Y?"bg-green-500 text-white":"bg-gray-200 text-gray-400"}`,children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("span",{className:`ml-2 text-sm ${ee?"text-orange-600 font-medium":Y?"text-green-600":"text-gray-400"}`,children:C.label}),Z<y.length-1&&e.jsx("div",{className:`w-8 h-0.5 mx-4 ${Y?"bg-green-500":"bg-gray-200"}`})]},C.key)})})},S=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Opciones de entrega"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx(fs,{value:N,onValueChange:y=>I(y),children:j.map(y=>{const E=y.icon;return e.jsxs("div",{className:"flex items-center space-x-2 p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx(js,{value:y.type,id:y.type}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ce,{htmlFor:y.type,className:"font-medium cursor-pointer",children:y.title}),e.jsx("p",{className:"text-sm text-gray-600",children:y.description})]}),e.jsx("div",{className:"text-right",children:y.fee>0?e.jsxs("span",{className:"font-medium",children:["Q",y.fee.toFixed(2)]}):e.jsx("span",{className:"text-green-600 font-medium",children:"Gratis"})})]})]},y.type)})}),N==="delivery"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"address",children:"Direcci√≥n de entrega *"}),e.jsx(Fe,{id:"address",placeholder:"Ingresa tu direcci√≥n completa con referencias...",value:v.delivery_address,onChange:y=>k(E=>({...E,delivery_address:y.target.value})),rows:3,className:!v.delivery_address&&N==="delivery"?"border-red-300":""}),v.delivery_address&&e.jsxs("p",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"Direcci√≥n cargada desde tu perfil"]})]})]})]}),e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Confirmar informaci√≥n de contacto",v.customer_name&&v.phone_number&&e.jsx(ae,{className:"w-5 h-5 text-green-500 ml-auto"})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"name",children:"Nombre completo *"}),e.jsx(he,{id:"name",placeholder:"Tu nombre completo",value:v.customer_name,onChange:y=>k(E=>({...E,customer_name:y.target.value})),className:v.customer_name?"border-green-300 bg-green-50":""}),v.customer_name&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Cargado desde tu perfil"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"phone",children:"N√∫mero de tel√©fono *"}),e.jsx(he,{id:"phone",placeholder:"+502 1234-5678",value:v.phone_number,onChange:y=>k(E=>({...E,phone_number:y.target.value})),className:v.phone_number?"border-green-300 bg-green-50":""}),v.phone_number&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Cargado desde tu perfil"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"notes",children:"Instrucciones especiales (opcional)"}),e.jsx(Fe,{id:"notes",placeholder:"Alguna instrucci√≥n especial para tu pedido...",value:v.customer_notes,onChange:y=>k(E=>({...E,customer_notes:y.target.value})),rows:2})]})]})]}),e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"Resumen del pedido"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:d.map((y,E)=>{var C,Z;return e.jsxs("div",{className:"flex justify-between items-center py-1 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:((C=y.product)==null?void 0:C.name)||y.name}),e.jsxs("span",{className:"text-gray-600 ml-2",children:["x",y.quantity]})]}),e.jsxs("span",{className:"font-medium",children:["Q",((((Z=y.product)==null?void 0:Z.price)||0)*y.quantity).toFixed(2)]})]},E)})}),e.jsx(de,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["Q",Q.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Entrega:"}),e.jsx("span",{children:z>0?`Q${z.toFixed(2)}`:"Gratis"})]}),e.jsx(de,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-orange-600",children:["Q",h.toFixed(2)]})]})]})]})]})]}),g=()=>e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"M√©todo de pago"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx(fs,{value:v.payment_method,onValueChange:y=>k(E=>({...E,payment_method:y})),children:P.map(y=>{const E=y.icon;return e.jsxs("div",{className:"flex items-center space-x-2 p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx(js,{value:y.type,id:y.type}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx(ce,{htmlFor:y.type,className:"font-medium cursor-pointer",children:y.title}),e.jsx("p",{className:"text-sm text-gray-600",children:y.description})]})]})]},y.type)})}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Pago seguro"})]}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Todos los pagos son procesados de forma segura. Tu informaci√≥n est√° protegida."})]})]})]}),R=()=>{const y=j.find(C=>C.type===N),E=P.find(C=>C.type===v.payment_method);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"Resumen del pedido"]})}),e.jsxs(U,{className:"space-y-4",children:[d.map((C,Z)=>{var le,ee,Y,oe,ue;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[((le=C.product)==null?void 0:le.image_url)&&e.jsx("img",{src:C.product.image_url,alt:C.product.name,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:(ee=C.product)==null?void 0:ee.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Q",(oe=(Y=C.product)==null?void 0:Y.price)==null?void 0:oe.toFixed(2)," x ",C.quantity]})]}),e.jsxs("span",{className:"font-medium",children:["Q",((((ue=C.product)==null?void 0:ue.price)||0)*C.quantity).toFixed(2)]})]},Z)}),e.jsx(de,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["Q",Q.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Entrega:"}),e.jsx("span",{children:z>0?`Q${z.toFixed(2)}`:"Gratis"})]}),e.jsx(de,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-orange-600",children:["Q",h.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(G,{children:[e.jsx(W,{children:e.jsx(X,{className:"text-base",children:"Entrega"})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[y&&e.jsx(y.icon,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:y==null?void 0:y.title}),N==="delivery"&&v.delivery_address&&e.jsx("p",{className:"text-sm text-gray-600",children:v.delivery_address})]})]})})]}),e.jsxs(G,{children:[e.jsx(W,{children:e.jsx(X,{className:"text-base",children:"Pago"})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[E&&e.jsx(E.icon,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:E==null?void 0:E.title}),e.jsx("p",{className:"text-sm text-gray-600",children:E==null?void 0:E.description})]})]})})]})]}),e.jsxs(G,{children:[e.jsx(W,{children:e.jsx(X,{className:"text-base",children:"Contacto"})}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",v.customer_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",v.phone_number]}),v.customer_notes&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Notas:"})," ",v.customer_notes]})]})})]})]})},V=()=>e.jsx("div",{className:"text-center py-12",children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(ae,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-green-600",children:"¬°Pedido creado exitosamente!"}),e.jsx("p",{className:"text-gray-600",children:"Tu pedido ha sido enviado al vendedor. Te notificaremos cuando sea confirmado."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(me,{className:"w-8 h-8 text-orange-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold",children:"Procesando tu pedido..."}),e.jsx("p",{className:"text-gray-600",children:"Por favor espera mientras creamos tu pedido."})]})}),M=()=>{switch(o){case"complete-info":return S();case"payment":return g();case"review":return R();case"processing":return V();default:return null}};return e.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:s,disabled:f,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Volver al carrito"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Checkout"})]}),o!=="processing"&&a(),M(),o!=="processing"&&e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsxs(F,{variant:"outline",onClick:l,disabled:o==="complete-info"||f,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Anterior"]}),o==="review"?e.jsx(F,{onClick:n,disabled:f,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:f?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:["Confirmar pedido Q",h.toFixed(2),e.jsx(ae,{className:"w-4 h-4 ml-2"})]})}):e.jsxs(F,{onClick:q,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:["Siguiente",e.jsx(Cs,{className:"w-4 h-4 ml-2"})]})]})]})}function Vr({notification:s,onDismiss:t,index:r}){const[d,c]=u.useState(!1),[i,p]=u.useState(!1),[o,m]=u.useState(null),[N,I]=u.useState(null),[f,T]=u.useState(0),[_,A]=u.useState(!1),v=u.useRef(null),k=u.useRef(null);u.useEffect(()=>{const S=setTimeout(()=>c(!0),100+r*150);return()=>clearTimeout(S)},[r]),u.useEffect(()=>(k.current=setTimeout(()=>{O()},5*60*1e3),()=>{k.current&&clearTimeout(k.current)}),[]);const O=()=>{k.current&&clearTimeout(k.current),p(!0),setTimeout(()=>{t(s.id)},300)},Q=S=>({new_order:je,order_accepted:ae,order_ready:te,order_assigned:Ce,order_picked_up:ne,order_in_transit:ne,order_delivered:ae,order_completed:re,order_cancelled:be,order_rejected:be,promotion:ie,new_product:te,message:qe,system:be,rating:re,general:qe})[S]||qe,z=S=>({new_order:"bg-blue-500",order_accepted:"bg-green-500",order_ready:"bg-orange-500",order_assigned:"bg-purple-500",order_picked_up:"bg-indigo-500",order_in_transit:"bg-indigo-500",order_delivered:"bg-green-500",order_completed:"bg-gray-500",order_cancelled:"bg-red-500",order_rejected:"bg-red-500",promotion:"bg-yellow-500",new_product:"bg-pink-500",message:"bg-blue-500",system:"bg-gray-500",rating:"bg-yellow-500",general:"bg-gray-500"})[S]||"bg-gray-500",h=S=>{m(S.targetTouches[0].clientX),A(!0)},j=S=>{if(!o||!_)return;const g=S.targetTouches[0].clientX,R=g-o;T(R),I(g)},P=()=>{if(!o||!N){A(!1),T(0);return}const S=o-N;Math.abs(S)>50?O():T(0),A(!1),m(null),I(null)},w=S=>{m(S.clientX),A(!0)},q=S=>{if(!o||!_)return;const g=S.clientX-o;T(g),I(S.clientX)},l=()=>{if(!o||!N){A(!1),T(0);return}const S=o-N;Math.abs(S)>50?O():T(0),A(!1),m(null),I(null)},n=Q(s.type),a=z(s.type);return e.jsx("div",{ref:v,className:`
        fixed top-4 left-4 right-4 z-50 transform transition-all duration-300 ease-out
        ${d&&!i?"translate-y-0 opacity-100":"-translate-y-full opacity-0"}
        ${_?"transition-none":""}
      `,style:{transform:`translateY(${d&&!i?r*80:-100}px) translateX(${f}px)`,opacity:_?Math.max(.5,1-Math.abs(f)/200):d&&!i?1:0},onTouchStart:h,onTouchMove:j,onTouchEnd:P,onMouseDown:w,onMouseMove:_?q:void 0,onMouseUp:l,onMouseLeave:l,children:e.jsx(G,{className:"bg-white shadow-lg border-l-4 border-orange-500 cursor-grab active:cursor-grabbing select-none",children:e.jsxs(U,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${a} text-white flex-shrink-0`,children:e.jsx(n,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-gray-700 text-sm",children:s.message})]}),e.jsx("button",{onClick:S=>{S.stopPropagation(),O()},className:"p-1 text-gray-400 hover:text-gray-600 flex-shrink-0",children:e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Desliza para eliminar"}),e.jsx("span",{children:"Auto-eliminar en 5min"})]})]})})})}function Gr(){const{user:s}=Ne(),[t,r]=u.useState([]),[d,c]=u.useState(!1),i=async()=>{try{const{error:m}=await $.from("notifications").select("recipient_id, type, title, message, is_read, created_at").limit(1);return m?(console.warn("notifications table is not available:",m.code),!1):!0}catch(m){return console.warn("notifications table availability check failed:",m),!1}},p=async()=>{if(!(!s||!d))try{const m=new Date;m.setDate(m.getDate()-1);const{data:N,error:I}=await $.from("notifications").select("*").eq("recipient_id",s.id).eq("is_read",!1).gte("created_at",m.toISOString()).order("created_at",{ascending:!1}).limit(5);if(I){console.error("Error fetching notifications:",I);return}r(N||[])}catch(m){console.error("Unexpected error fetching notifications:",m)}},o=async m=>{if(r(N=>N.filter(I=>I.id!==m)),d)try{await $.from("notifications").update({is_read:!0}).eq("id",m)}catch(N){console.error("Error marking notification as read:",N)}};return u.useEffect(()=>{(async()=>{const N=await i();c(N),N&&await p()})()},[s==null?void 0:s.id]),u.useEffect(()=>{if(!d||!s)return;const m=$.channel("floating-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{p()}).subscribe();return()=>{$.removeChannel(m)}},[s==null?void 0:s.id,d]),u.useEffect(()=>{const m=setInterval(()=>{d&&p()},6e4);return()=>clearInterval(m)},[d]),!d||t.length===0?null:e.jsx(e.Fragment,{children:t.map((m,N)=>e.jsx(Vr,{notification:m,onDismiss:o,index:N},m.id))})}function Ur({businessId:s,onBack:t,onShowCart:r}){var C,Z,le,ee,Y,oe,ue;const{user:d}=Ne(),{addToCart:c,items:i}=we(),{getBusinessProducts:p,getBusinessDailyProducts:o,getBusinessById:m,refreshProductStock:N}=Es(),{openImageModal:I}=vs(),[f,T]=u.useState(null),[_,A]=u.useState([]),[v,k]=u.useState([]),[O,Q]=u.useState(!0),[z,h]=u.useState("productos"),[j,P]=u.useState(null),[w,q]=u.useState(!1),[l,n]=u.useState(new Date);u.useEffect(()=>{a()},[s]);const a=async()=>{var x,b,L;try{Q(!0),console.log("üîç Cargando datos del negocio:",s);const[D,B,se]=await Promise.all([m(s),p(s),o(s)]);console.log("üìä Datos cargados:",{business:D,products:B,dailyProducts:se,productsWithImages:(B==null?void 0:B.filter(J=>J.image_url).length)||0,productsTotal:(B==null?void 0:B.length)||0,dailyWithImages:(se==null?void 0:se.filter(J=>J.image_url).length)||0,dailyTotal:(se==null?void 0:se.length)||0}),console.log("üî• DEBUG CONTACTO:",{business_phone:D==null?void 0:D.business_phone,phone:D==null?void 0:D.phone,email:D==null?void 0:D.email,address:D==null?void 0:D.address,business_address:D==null?void 0:D.business_address,user:D==null?void 0:D.user,user_phone:(x=D==null?void 0:D.user)==null?void 0:x.phone,user_email:(b=D==null?void 0:D.user)==null?void 0:b.email,user_address:(L=D==null?void 0:D.user)==null?void 0:L.address}),T(D),A(B||[]),k(se||[]),n(new Date)}catch(D){console.error("‚ùå Error loading business data:",D),H.error("Error al cargar informaci√≥n del comercio")}finally{Q(!1)}},S=async()=>{q(!0);try{await N();const[x,b]=await Promise.all([p(s),o(s)]);A(x||[]),k(b||[]),n(new Date),H.success("Productos actualizados correctamente")}catch{H.error("Error al actualizar productos")}finally{q(!1)}},g=async(x,b)=>{if(!d){H.error("Debes iniciar sesi√≥n para agregar productos");return}if(j!==x){P(x);try{console.log("üç∫ Adding daily product to cart:",{productId:x,productName:b,productType:"daily"});const L=await c(x,1,"daily");console.log("üç∫ Daily cart result:",L),L.success?H.success("Agregado al carrito"):(console.error("üç∫ Daily cart failed:",L),H.error(L.message,{icon:e.jsx(be,{className:"w-4 h-4"}),duration:3e3}))}catch(L){console.error("Error adding daily to cart:",L),H.error("Error al agregar al carrito",{icon:e.jsx(Re,{className:"w-4 h-4"}),duration:3e3})}finally{P(null)}}},R=x=>{const b=i==null?void 0:i.find(D=>D.product_id===x),L=(b==null?void 0:b.quantity)||0;return console.log("üõí Cart check:",{productId:x,cartItems:(i==null?void 0:i.length)||0,foundItem:!!b,quantity:L}),L},V=(f==null?void 0:f.logo_url)||((C=f==null?void 0:f.user)==null?void 0:C.avatar_url),M=f==null?void 0:f.cover_image_url,y=({product:x})=>{var Be;const b=rs(x),L=R(x.id),D=j===x.id,B={isAvailable:x.is_available&&x.stock_quantity>0,hasStock:x.stock_quantity>0,isLowStock:x.stock_quantity<=5&&x.stock_quantity>0,isLastUnits:x.stock_quantity<=3&&x.stock_quantity>0,stockCount:x.stock_quantity||0,isDisabledByVendor:x.is_available===!1,isOutOfStock:x.stock_quantity===0};console.log("üõçÔ∏è ProductCard Availability:",{productName:x.name,productId:x.id,is_available:x.is_available,stock_quantity:x.stock_quantity,availabilityInfo:B,cartQuantity:L,isAdding:D});const J=B.isOutOfStock?{text:"Agotado",className:"bg-red-100 text-red-700",icon:"‚ùå"}:B.isDisabledByVendor?{text:"No disponible",className:"bg-gray-100 text-gray-600",icon:"‚è∏Ô∏è"}:B.isLastUnits?{text:`¬°√öltimas ${B.stockCount}!`,className:"bg-red-100 text-red-700 animate-pulse",icon:"üî•"}:B.isLowStock?{text:`${B.stockCount} disponibles`,className:"bg-orange-100 text-orange-700",icon:"‚ö†Ô∏è"}:B.hasStock?{text:`${B.stockCount} disponibles`,className:"bg-green-100 text-green-700",icon:"‚úÖ"}:{text:"Sin stock",className:"bg-gray-100 text-gray-600",icon:"‚ùå"};return e.jsx(G,{className:"bg-white shadow-sm border border-gray-100 rounded-xl overflow-hidden hover:shadow-md transition-all min-h-[100px]",children:e.jsx(U,{className:"p-0 h-full",style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"flex h-full relative",onClick:Ve=>console.log("Card clicked",Ve.target),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"relative w-20 h-20 bg-gray-100 flex-shrink-0 cursor-pointer",onClick:Ve=>{console.log("üñºÔ∏è Image area clicked"),Ve.stopPropagation(),b&&I(b,x.name)},style:{pointerEvents:"auto"},children:[b?e.jsx(ge,{src:b,alt:x.name,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"w-5 h-5 text-orange-300 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-orange-400 font-medium",children:"Sin imagen"})]})}),e.jsxs("div",{className:"absolute top-1 left-1 space-y-1",children:[B.isOutOfStock&&e.jsx(K,{className:"bg-red-500 text-white text-xs px-2 py-1 shadow-lg",children:"Agotado"}),B.isDisabledByVendor&&e.jsx(K,{className:"bg-gray-500 text-white text-xs px-2 py-1 shadow-lg",children:"No disponible"}),B.isLastUnits&&e.jsxs(K,{className:"bg-red-500 text-white text-xs px-2 py-1 shadow-lg animate-pulse",children:["üî• ¬°√öltimas ",B.stockCount,"!"]})]}),b&&e.jsx("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/20 transition-colors duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 hover:opacity-100 transition-opacity bg-black/70 rounded-lg px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-medium",children:[e.jsx(We,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver"})]})})})]}),e.jsxs("div",{className:"flex-1 p-3 pl-4 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 pr-4 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900 mb-1 line-clamp-2 break-words",children:x.name}),x.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-3 mb-2 break-words",children:x.description})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsxs("span",{className:"text-base font-bold text-gray-900 whitespace-nowrap",children:["Q",(Be=x.price)==null?void 0:Be.toFixed(2)]}),x.compare_at_price&&x.compare_at_price>x.price&&e.jsxs("div",{className:"text-xs text-gray-400 line-through whitespace-nowrap",children:["Q",x.compare_at_price.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[L>0&&e.jsxs(K,{className:"bg-orange-100 text-orange-700 text-xs font-semibold w-fit",children:[L," en carrito"]}),e.jsxs(K,{className:`text-xs font-medium w-fit ${J.className}`,children:[e.jsx("span",{className:"mr-1",children:J.icon}),J.text]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{onClick:()=>{B.isAvailable&&g(x.id,x.name)},disabled:!B.isAvailable||D,className:`
                      h-8 px-3 text-xs font-medium rounded transition-all duration-200
                      ${B.isAvailable&&!D?"bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white cursor-pointer shadow-md hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"}
                    `,type:"button",children:D?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):L>0&&B.isAvailable?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),"+1"]}):B.isAvailable?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),"Agregar"]}):B.isOutOfStock?"Agotado":B.isDisabledByVendor?"No disponible":"Sin stock"})})]})]})]})})})},E=({product:x})=>{var se;const b=rs(x),L=R(x.id),D=j===x.id;console.log("üìÖ DailyProductCard:",{productName:x.name,productImageUrl:x.image_url,processedImageUrl:b,hasImage:!!b});const B=()=>{b&&I(b,x.name)};return e.jsx(G,{className:"bg-white shadow-sm border border-gray-100 rounded-xl overflow-hidden",children:e.jsx(U,{className:"p-0",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"relative w-20 h-20 bg-gray-100 flex-shrink-0 cursor-pointer",onClick:B,children:[b?e.jsx(ge,{src:b,alt:x.name,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Pe,{className:"w-4 h-4 text-orange-300 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-orange-400 font-medium",children:"Sin imagen"})]})}),b&&e.jsx("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 hover:opacity-100 transition-opacity bg-black/50 rounded-full p-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-white text-xs",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver"})]})})})]}),e.jsxs("div",{className:"flex-1 p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900 mb-1",children:x.name}),x.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1",children:x.description})]}),e.jsxs("div",{className:"text-right ml-2",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["Q",(se=x.price)==null?void 0:se.toFixed(2)]}),x.compare_at_price&&x.compare_at_price>x.price&&e.jsxs("div",{className:"text-xs text-gray-400 line-through",children:["Q",x.compare_at_price.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[x.is_available?L>0?e.jsxs(K,{className:"bg-orange-100 text-orange-700 text-xs font-semibold",children:[L," en carrito"]}):e.jsx("div",{}):e.jsx(K,{className:"bg-red-100 text-red-700 text-xs",children:"Agotado"}),e.jsx(F,{size:"sm",onClick:()=>{console.log("üç∫ DailyProductCard button clicked - should call handleAddDailyToCart"),g(x.id,x.name)},disabled:!x.is_available||D,className:"h-8 px-3 bg-orange-500 hover:bg-orange-600 text-white text-xs font-medium",children:D?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):L>0?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"+1"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Agregar"]})})]})]})]})})})};return O?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando perfil del comercio..."})]})}):f?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(F,{onClick:t,size:"sm",variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{onClick:S,disabled:w,size:"sm",variant:"ghost",className:"text-green-600 hover:text-green-900 hover:bg-green-50",children:e.jsx(ke,{className:`w-4 h-4 ${w?"animate-spin":""}`})}),e.jsx(F,{size:"sm",variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(F,{size:"sm",variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:e.jsx(Qa,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-4 bg-white",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[V&&e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 shadow-md p-1 flex-shrink-0",children:e.jsx(ge,{src:V,alt:`Logo de ${f.business_name}`,className:"w-full h-full object-cover rounded-xl"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 truncate",children:f.business_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Actualizado: ",l.toLocaleTimeString()]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"w-4 h-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:f.rating.toFixed(1)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",f.products_count," productos)"]})]}),e.jsx(K,{className:`text-xs px-2 py-1 ${f.is_open_now?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200"}`,variant:"outline",children:f.is_open_now?"üü¢ Abierto":"üî¥ Cerrado"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-1 text-gray-400"}),e.jsx("span",{className:"truncate",children:f.address||f.business_address||"Direcci√≥n no disponible"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"w-4 h-4 mr-1 text-gray-400"}),e.jsx("span",{children:"25-35 min"})]})]})]}),f.is_verified&&e.jsx("div",{className:"ml-3",children:e.jsxs(K,{className:"bg-blue-50 text-blue-700 border-blue-200",variant:"outline",children:[e.jsx(_s,{className:"w-3 h-3 mr-1"}),"Verificado"]})})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center mx-auto mb-2",children:e.jsx(je,{className:"w-5 h-5 text-orange-600"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pedido m√≠nimo"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Q50"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-2",children:e.jsx(me,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Costo env√≠o"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Q15"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-2",children:e.jsx(Pe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Tiempo entrega"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"25-35 min"})]})]})})]}),M&&e.jsx("div",{className:"relative w-full h-40 mx-4 mb-4 rounded-xl overflow-hidden",children:e.jsx(ge,{src:M,alt:`Portada de ${f.business_name}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"bg-gray-50",children:e.jsx("div",{className:"px-4 mb-4",children:e.jsx(G,{className:"bg-white shadow-lg border-0 rounded-2xl overflow-hidden",children:e.jsx(U,{className:"p-0",children:e.jsxs($e,{value:z,onValueChange:h,className:"w-full",children:[e.jsxs(Le,{className:"grid w-full grid-cols-3 bg-gray-50 p-1 m-2 rounded-xl",children:[e.jsxs(pe,{value:"productos",className:"rounded-lg text-sm font-medium data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Productos (",_.length,")"]}),e.jsxs(pe,{value:"dia",className:"rounded-lg text-sm font-medium data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Del D√≠a (",v.length,")"]}),e.jsxs(pe,{value:"info",className:"rounded-lg text-sm font-medium data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Info"]})]}),e.jsxs("div",{className:"px-3 py-4",children:[e.jsx(xe,{value:"productos",className:"mt-0",children:O?e.jsx("div",{className:"space-y-3",children:[...Array(6)].map((x,b)=>e.jsx("div",{className:"bg-gray-100 rounded-xl h-24 animate-pulse"},b))}):_&&_.length>0?e.jsx("div",{className:"space-y-3",children:_.map(x=>e.jsx(y,{product:x},x.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No hay productos disponibles"}),e.jsx("p",{className:"text-xs text-gray-400",children:_&&_.length>0?`Se encontraron ${_.length} productos pero no est√°n disponibles`:"No se pudieron cargar los productos"}),_&&_.length>0&&e.jsx("button",{onClick:()=>console.log("üîç Productos encontrados:",_),className:"mt-2 text-xs text-blue-500 hover:text-blue-700",children:"Ver detalles en consola"})]})}),e.jsx(xe,{value:"dia",className:"mt-0",children:O?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((x,b)=>e.jsx("div",{className:"bg-gray-100 rounded-xl h-24 animate-pulse"},b))}):v&&v.length>0?e.jsx("div",{className:"space-y-3",children:v.map(x=>e.jsx(E,{product:x},x.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No hay productos del d√≠a"}),e.jsx("p",{className:"text-xs text-gray-400",children:v&&v.length>0?`Se encontraron ${v.length} productos del d√≠a pero no est√°n disponibles`:"No se pudieron cargar los productos del d√≠a"}),v&&v.length>0&&e.jsx("button",{onClick:()=>console.log("üîç Productos del d√≠a encontrados:",v),className:"mt-2 text-xs text-blue-500 hover:text-blue-700",children:"Ver detalles en consola"})]})}),e.jsx(xe,{value:"info",className:"mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(me,{className:"w-5 h-5 mr-2 text-blue-600"}),"Horarios de Atenci√≥n"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Lunes - Viernes:"}),e.jsx("span",{className:"font-medium",children:"8:00 AM - 9:00 PM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"S√°bados:"}),e.jsx("span",{className:"font-medium",children:"8:00 AM - 10:00 PM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Domingos:"}),e.jsx("span",{className:"font-medium",children:"9:00 AM - 8:00 PM"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(He,{className:"w-5 h-5 mr-2 text-green-600"}),"Contacto"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[console.log("üî• RENDER CONTACTO:",{phone_options:[f.phone,f.business_phone,(Z=f.user)==null?void 0:Z.phone],address_options:[f.address,f.business_address,(le=f.user)==null?void 0:le.address],final_phone:f.phone||f.business_phone||((ee=f.user)==null?void 0:ee.phone)||"No disponible",final_address:f.address||f.business_address||((Y=f.user)==null?void 0:Y.address)||"Direcci√≥n no disponible"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:f.phone||f.business_phone||((oe=f.user)==null?void 0:oe.phone)||"No disponible"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:f.address||f.business_address||((ue=f.user)==null?void 0:ue.address)||"Direcci√≥n no disponible"})]})]})]}),(f.description||f.business_description)&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ds,{className:"w-5 h-5 mr-2 text-purple-600"}),"Acerca de"]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:f.description||f.business_description})]})]})})]})]})})})})}),e.jsx(Ye,{onCartClick:()=>{console.log("üõí Carrito flotante clicked desde BusinessProfile!"),r?r():alert("üõí Carrito flotante funcional! Navegaci√≥n no configurada.")}})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No se pudo cargar el comercio"}),e.jsx(F,{onClick:t,children:"Volver"})]})})}function _t(){var Q;const{user:s,signOut:t}=Ne(),{getCartItemCount:r}=we(),[d,c]=u.useState("home"),[i,p]=u.useState("dashboard"),[o,m]=u.useState(""),[N,I]=u.useState(""),f=z=>{m(z),p("business-profile")},T=()=>{p("dashboard"),m("")},_=()=>{p("dashboard"),c("home")},A=z=>{I(z),p("order-tracking")},v=()=>{p("dashboard"),I("")},k=(z,h)=>{console.log(`üö® Alerta cr√≠tica para comprador: ${z} - ${h}`)},O=z=>{console.log(`‚è∞ Alerta de timeout: Orden ${z.orderId} - ${z.timeSinceStatus} min`)};return i==="business-profile"?e.jsx(Ur,{businessId:o,onBack:T,onShowCart:()=>p("cart")}):i==="cart"?e.jsx(Pr,{onContinueShopping:()=>p("dashboard"),onProceedToCheckout:()=>p("checkout")}):i==="checkout"?e.jsx(Br,{onBack:_,onComplete:()=>{p("dashboard"),c("orders")}}):i==="order-tracking"?e.jsx(ts,{children:e.jsx(Ts,{orderId:N,onBack:v})}):e.jsx(ts,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx(da,{showBanner:!0,enableAutoActivation:!1}),e.jsx("div",{className:"container mx-auto px-4",children:typeof window<"u"&&"Notification"in window&&Notification.permission!=="granted"&&e.jsx("div",{className:"flex justify-end mb-2"})}),e.jsx(Ra,{onNotification:k}),e.jsx(ga,{onAlert:O}),N&&e.jsx("div",{className:"container mx-auto px-4 mb-4",children:e.jsx(Oa,{orderId:N})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"TRATO"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:["¬°Hola, ",((Q=s==null?void 0:s.email)==null?void 0:Q.split("@")[0])||"guichointeriano","!"]})]})]}),e.jsxs(F,{variant:"outline",onClick:t,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(Fa,{className:"w-4 h-4"}),e.jsx("span",{children:"Cerrar Sesi√≥n"})]})]})})}),e.jsx(Gr,{}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-3 gap-1",children:[{id:"home",label:"Inicio",icon:is},{id:"orders",label:"Pedidos",icon:te},{id:"profile",label:"Perfil",icon:Ce}].map(z=>{const h=z.icon,j=d===z.id;return e.jsxs("button",{onClick:()=>c(z.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:j?"#fef3c7":"transparent",color:j?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:z.label})]},z.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs($e,{value:d,onValueChange:c,className:"space-y-6",children:[e.jsx(Le,{className:"grid w-full grid-cols-3 lg:w-2/3 mx-auto bg-white border border-gray-200",children:[{id:"home",label:"Inicio",icon:is},{id:"orders",label:"Pedidos",icon:te},{id:"profile",label:"Perfil",icon:Ce}].map(z=>{const h=z.icon;return e.jsxs(pe,{value:z.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:z.label})]},z.id)})}),e.jsx(xe,{value:"home",className:"space-y-6",children:e.jsx(ms,{onBusinessClick:f,onShowCart:()=>p("cart")})}),e.jsx(xe,{value:"orders",className:"space-y-6",children:e.jsx(hs,{onViewOrder:A})}),e.jsx(xe,{value:"profile",className:"space-y-6",children:e.jsx(ps,{onShowCart:()=>p("cart")})})]})}),e.jsxs("div",{className:"block md:hidden",children:[d==="home"&&e.jsx(ms,{onBusinessClick:f,onShowCart:()=>p("cart")}),d==="orders"&&e.jsx(hs,{onViewOrder:A}),d==="profile"&&e.jsx(ps,{onShowCart:()=>p("cart")})]})]}),i==="order-tracking"&&e.jsx("div",{className:"fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-auto z-50",children:e.jsx(G,{className:"mobile-card border-green-200 bg-green-50",children:e.jsx(U,{className:"mobile-card-content",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"mobile-text font-medium text-green-800 mb-1",children:"¬°Orden creada exitosamente!"}),e.jsx("p",{className:"mobile-text-small text-green-600",children:"Puedes seguir el estado de tu pedido aqu√≠"})]})]})})})}),e.jsx(ha,{})]})})}export{_t as BuyerDashboard};
