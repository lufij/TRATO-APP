import{g as de,u as be,r as p,s as c,t as o,j as e,L as Z,C as x,a as $,B as f,b as L,q as ye,f as A,c as u,e as se,d as oe,p as ue,R as Pe}from"./index-DROr5LJE.js";import{T as pe,a as fe,P as Q,b as ne,d as I,D as ve,c as Re}from"./MobileToastNotifications-B3M9bNQf.js";import{I as le}from"./input-DrT_AH1e.js";import{L as H}from"./label-DcXdkGkZ.js";import{T as Ie}from"./textarea-BLfvwhr_.js";import{S as $e,a as Le,b as Ue,c as qe,d as ee}from"./select-cogAakPu.js";import{U as ce}from"./user-pdj4Ylnj.js";import{a as ze,C as je,P as Ne,N as _e}from"./phone-B67LUAwg.js";import{S as we}from"./star-CfWRPU1m.js";import{M as ae}from"./map-pin-BGfHVsd0.js";import{U as Oe}from"./upload-CiK8xCd1.js";import{N as Me}from"./NotificationSystem-CpHsipmQ.js";import{C as Fe,D as Ve}from"./DeliveryTracking-CjJtgNzM.js";import{T as J}from"./truck-CXU5AOAd.js";import{L as Qe}from"./log-out-BZnwTjXM.js";import{A as Ge}from"./activity-D7ZJnB3I.js";import{C as Be}from"./clock-COpOlDBy.js";import"./shopping-cart-Cwjf0Z4h.js";import"./triangle-alert-CnY7F3PB.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Je=de("award",He);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Ke=de("car",We);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Ye=de("map",Xe);function Ze(){const{user:a}=be(),[re,U]=p.useState(!0),[G,v]=p.useState(!1),[R,q]=p.useState(!1),[z,T]=p.useState(!1),O=p.useRef(null),[m,N]=p.useState({name:"",phone:"",profile_image:null,vehicle_type:"",license_number:"",latitude:null,longitude:null,address:"",location_verified:!1,is_active:!1}),[g,P]=p.useState({is_online:!1,rating:0,total_deliveries:0});p.useEffect(()=>{if(a){te();const i=c.channel("driver-profile-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"drivers",filter:`id=eq.${a.id}`},l=>{console.log("Driver status changed:",l),l.new&&P(d=>({...d,is_online:l.new.is_online||!1,rating:l.new.rating||0,total_deliveries:l.new.total_deliveries||0}))}).subscribe();return()=>{i.unsubscribe()}}},[a]);const te=async()=>{try{U(!0);const{data:i,error:l}=await c.from("users").select("*").eq("id",a==null?void 0:a.id).single();if(l)throw l;const{data:d,error:j}=await c.from("drivers").select("is_online, rating, total_deliveries").eq("id",a==null?void 0:a.id).single();j&&j.code==="PGRST116"?(await c.from("drivers").insert({id:a==null?void 0:a.id,is_online:!1,rating:0,total_deliveries:0}),P({is_online:!1,rating:0,total_deliveries:0})):d&&P(d),N({name:i.name||"",phone:i.phone||"",profile_image:i.profile_image,vehicle_type:i.vehicle_type||"",license_number:i.license_number||"",latitude:i.latitude,longitude:i.longitude,address:i.address||"",location_verified:i.location_verified||!1,is_active:i.is_active||!1})}catch(i){console.error("Error loading profile:",i),o.error("Error al cargar el perfil")}finally{U(!1)}},W=async i=>{var d;const l=(d=i.target.files)==null?void 0:d[0];if(!(!l||!a))try{if(q(!0),!l.type.startsWith("image/")){o.error("Solo se permiten im√°genes");return}const j=await me(l,400,400,.9),_=`${a.id}/profile-${Date.now()}.jpg`,{error:b}=await c.storage.from("profile-images").upload(_,j,{upsert:!0});if(b){o.error("Error al subir la imagen");return}const{data:M}=c.storage.from("profile-images").getPublicUrl(_),{error:E}=await c.from("users").update({profile_image:M.publicUrl}).eq("id",a.id);if(E){o.error("Error al guardar la imagen");return}N(C=>({...C,profile_image:M.publicUrl})),o.success("Foto de perfil actualizada")}catch(j){console.error("Error uploading image:",j),o.error("Error al subir la imagen")}finally{q(!1)}},me=(i,l,d,j=.9)=>new Promise(_=>{const b=document.createElement("canvas"),M=b.getContext("2d"),E=new Image;E.onload=()=>{let{width:C,height:y}=E;C>y?C>l&&(y=y*l/C,C=l):y>d&&(C=C*d/y,y=d),b.width=C,b.height=y,M.drawImage(E,0,0,C,y),b.toBlob(F=>{F&&_(F)},"image/jpeg",j)},E.src=URL.createObjectURL(i)}),K=async()=>{try{T(!0);const i=await new Promise((_,b)=>{navigator.geolocation.getCurrentPosition(_,b,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),{latitude:l,longitude:d}=i.coords,{error:j}=await c.rpc("update_driver_location",{p_driver_id:a==null?void 0:a.id,p_latitude:l,p_longitude:d});if(j)throw j;N(_=>({..._,latitude:l,longitude:d,location_verified:!0})),o.success("Ubicaci√≥n verificada correctamente")}catch(i){console.error("Error verifying location:",i),o.error("Error al verificar la ubicaci√≥n")}finally{T(!1)}},X=async i=>{if(a)try{console.log("Toggling online status to:",i),P(b=>({...b,is_online:i})),N(b=>({...b,is_active:i}));const{data:l,error:d}=await c.from("drivers").update({is_online:i,updated_at:new Date().toISOString()}).eq("id",a.id).select();if(d)throw console.error("Driver update error:",d),d;const{data:j,error:_}=await c.from("users").update({is_active:i,updated_at:new Date().toISOString()}).eq("id",a.id).select();if(_)throw console.error("User update error:",_),_;console.log("Status updated successfully - Driver:",l,"User:",j),o.success(i?"‚úÖ Ahora est√°s EN L√çNEA y disponible para recibir pedidos":"‚è∏Ô∏è Ahora est√°s DESCONECTADO. No recibir√°s nuevos pedidos")}catch(l){console.error("Error updating online status:",l),P(d=>({...d,is_online:!i})),N(d=>({...d,is_active:!i})),o.error(`Error al actualizar el estado: ${l instanceof Error?l.message:"Error desconocido"}`)}},B=async()=>{try{v(!0);const{error:i}=await c.from("users").update({name:m.name,phone:m.phone,vehicle_type:m.vehicle_type,license_number:m.license_number,address:m.address,is_active:m.is_active}).eq("id",a==null?void 0:a.id);if(i)throw i;o.success("Perfil actualizado correctamente")}catch(i){console.error("Error saving profile:",i),o.error("Error al guardar el perfil")}finally{v(!1)}};return re?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-8 h-8 animate-spin text-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando perfil..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(x,{children:e.jsxs($,{className:"text-center",children:[e.jsxs("div",{className:"relative mx-auto mb-4",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-orange-400 to-green-500 p-1",children:e.jsx("div",{className:"w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden",children:m.profile_image?e.jsx("img",{src:m.profile_image,alt:"Foto de perfil",className:"w-full h-full object-cover rounded-full"}):e.jsx(ce,{className:"w-16 h-16 text-gray-400"})})}),e.jsx(f,{size:"sm",className:"absolute bottom-0 right-0 rounded-full w-10 h-10 p-0",onClick:()=>{var i;return(i=O.current)==null?void 0:i.click()},disabled:R,children:R?e.jsx(Z,{className:"w-4 h-4 animate-spin"}):e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("input",{ref:O,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:W})]}),e.jsx(L,{className:"text-2xl",children:m.name||"Repartidor"}),e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${g.is_online?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Estado:"})]}),e.jsx(ye,{checked:g.is_online,onCheckedChange:X,className:"data-[state=checked]:bg-green-600 data-[state=unchecked]:bg-gray-300"})]}),e.jsx(A,{variant:g.is_online?"default":"secondary",className:`px-6 py-2 text-lg font-bold ${g.is_online?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-400 hover:bg-gray-500 text-white"}`,children:g.is_online?"üü¢ EN L√çNEA":"‚ö´ DESCONECTADO"}),e.jsx("p",{className:"text-sm text-center text-gray-600 max-w-sm",children:g.is_online?"Est√°s visible para recibir nuevos pedidos. Los compradores pueden verte en l√≠nea.":"Act√≠vate para comenzar a recibir pedidos. No apareces en la lista de repartidores disponibles."})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"font-bold text-lg",children:g.rating.toFixed(1)})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Calificaci√≥n"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-bold text-lg",children:g.total_deliveries}),e.jsx("p",{className:"text-sm text-gray-500",children:"Entregas"})]})]})]})}),e.jsxs(x,{children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-orange-500"}),"Informaci√≥n Personal"]})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"name",children:"Nombre completo"}),e.jsx(le,{id:"name",value:m.name,onChange:i=>N(l=>({...l,name:i.target.value})),placeholder:"Tu nombre completo"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"phone",children:"Tel√©fono"}),e.jsx(le,{id:"phone",value:m.phone,onChange:i=>N(l=>({...l,phone:i.target.value})),placeholder:"Tu n√∫mero de tel√©fono"})]})]})})]}),e.jsxs(x,{children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-orange-500"}),"Informaci√≥n del Veh√≠culo"]})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"vehicle_type",children:"Tipo de veh√≠culo"}),e.jsxs($e,{value:m.vehicle_type,onValueChange:i=>N(l=>({...l,vehicle_type:i})),children:[e.jsx(Le,{children:e.jsx(Ue,{placeholder:"Selecciona tu veh√≠culo"})}),e.jsxs(qe,{children:[e.jsx(ee,{value:"moto",children:"Motocicleta"}),e.jsx(ee,{value:"bicicleta",children:"Bicicleta"}),e.jsx(ee,{value:"auto",children:"Autom√≥vil"}),e.jsx(ee,{value:"pickup",children:"Pickup"})]})]})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"license",children:"N√∫mero de licencia"}),e.jsx(le,{id:"license",value:m.license_number,onChange:i=>N(l=>({...l,license_number:i.target.value})),placeholder:"N√∫mero de licencia"})]})]})})]}),e.jsxs(x,{children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-500"}),"Ubicaci√≥n"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"address",children:"Direcci√≥n"}),e.jsx(Ie,{id:"address",value:m.address,onChange:i=>N(l=>({...l,address:i.target.value})),placeholder:"Tu direcci√≥n completa",rows:2})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m.location_verified?e.jsx(se,{className:"w-5 h-5 text-green-500"}):e.jsx(oe,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:m.location_verified?"Ubicaci√≥n verificada":"Ubicaci√≥n sin verificar"})]}),e.jsxs(f,{onClick:K,disabled:z,size:"sm",variant:"outline",children:[z?e.jsx(Z,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Verificar GPS"]})]}),m.latitude&&m.longitude&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Coordenadas: ",m.latitude.toFixed(6),", ",m.longitude.toFixed(6)]})]})]}),e.jsxs(f,{onClick:B,disabled:G,className:"w-full",size:"lg",children:[G?e.jsx(Z,{className:"w-5 h-5 animate-spin mr-2"}):e.jsx(Oe,{className:"w-5 h-5 mr-2"}),"Guardar Perfil"]})]})}function js(){const{user:a,signOut:re}=be(),[U,G]=p.useState("dashboard"),[v,R]=p.useState({is_active:!1,is_verified:!1,status:"offline"}),[q,z]=p.useState([]),[T,O]=p.useState([]),[m,N]=p.useState([]),[g,P]=p.useState({todayDeliveries:0,todayEarnings:0,activeTime:0,averageRating:4.5,totalDeliveries:0,totalEarnings:0,completionRate:95}),[te,W]=p.useState(!0),[me,K]=p.useState(null),[X,B]=p.useState(""),[i,l]=p.useState(null),[d,j]=p.useState(0),_=(s,t)=>{console.log(`üö® Alerta cr√≠tica para repartidor: ${s} - ${t}`)};p.useEffect(()=>{a&&(b(),E(),y(),he(),F(),Ce())},[a==null?void 0:a.id]),p.useEffect(()=>{const s=setInterval(()=>{v.is_active&&U==="deliveries"&&(E(),y())},3e4);return()=>clearInterval(s)},[v.is_active,U]);const b=async()=>{try{W(!0);const{data:s,error:t}=await c.from("drivers").select("*").eq("id",a==null?void 0:a.id).single();if(t)console.error("Error loading driver data:",t),t.code==="PGRST116"&&await M();else{const n=s.is_online||!1;R({is_active:n,is_verified:s.is_verified||!1,current_location:s.current_location,status:n?"available":"offline"})}}catch(s){console.error("Error loading driver data:",s)}finally{W(!1)}},M=async()=>{try{const{error:s}=await c.from("drivers").insert({id:a==null?void 0:a.id,vehicle_type:"motocicleta",license_number:"TEMP-"+Date.now(),is_active:!1,is_online:!1,is_verified:!1,rating:0,total_deliveries:0,created_at:new Date().toISOString()});s?console.error("Error creating driver record:",s):R({is_active:!1,is_verified:!1,current_location:void 0,status:"offline"})}catch(s){console.error("Error creating driver record:",s)}},E=async()=>{try{console.log("Loading available orders using RPC function...");const{data:s,error:t}=await c.rpc("get_available_deliveries");if(t){console.error("RPC Error:",t),z([]),o.error("Error al cargar pedidos disponibles. Verifica que el script SQL est√© ejecutado.");return}console.log("Available orders from RPC:",s),s==null||s.forEach((r,h)=>{console.log(`Order ${h+1}:`,{order_id:r.order_id,seller_address:r.seller_address,business_address:r.business_address,delivery_address:r.delivery_address,seller_name:r.seller_name,business_name:r.business_name})});const n=(s||[]).map(r=>({id:r.order_id,order_id:r.order_id,pickup_address:r.seller_address||r.business_address||"Contactar vendedor para direcci√≥n",delivery_address:r.delivery_address||"Direcci√≥n de entrega",customer_name:"Cliente",customer_phone:"Sin tel√©fono",total_amount:r.total||0,delivery_fee:Math.round(r.total*.15)||10,status:"available",created_at:r.created_at,estimated_delivery:new Date(Date.now()+r.estimated_time*6e4).toISOString(),items_count:1,business_name:r.seller_name||"Negocio",pickup_notes:void 0,delivery_notes:void 0,distance:r.distance_km}));z(n),console.log("Transformed orders:",n)}catch(s){console.error("Error loading available orders:",s),z([]),o.error("Error al cargar pedidos disponibles")}},C=async()=>{if(!(a!=null&&a.id)){o.error("Usuario no autenticado");return}console.log("üîç DIAGN√ìSTICO DEL REPARTIDOR"),console.log("==============================="),console.log("üë§ Driver ID autenticado:",a.id);try{const{data:s,error:t}=await c.from("orders").select("*").not("driver_id","is",null).order("created_at",{ascending:!1});t?console.error("‚ùå Error consultando √≥rdenes con driver_id:",t):(console.log(`üìä √ìrdenes con driver_id asignado: ${(s==null?void 0:s.length)||0}`),s==null||s.forEach((w,S)=>{console.log(`${S+1}. ID: ${w.id}`),console.log(`   Driver ID: ${w.driver_id}`),console.log(`   Status: ${w.status}`),console.log(`   Customer: ${w.customer_name||"N/A"}`),console.log("   ---")}));const{data:n,error:r}=await c.from("orders").select("*").eq("driver_id",a.id).order("created_at",{ascending:!1});r?console.error("‚ùå Error consultando mis √≥rdenes:",r):(console.log(`üöö Mis √≥rdenes asignadas: ${(n==null?void 0:n.length)||0}`),n&&n.length>0?n.forEach((w,S)=>{console.log(`${S+1}. ID: ${w.id}`),console.log(`   Status: ${w.status}`),console.log(`   Customer: ${w.customer_name||"N/A"}`),console.log("   ---")}):console.log("‚ö†Ô∏è  No tienes √≥rdenes asignadas actualmente"));const{data:h,error:k}=await c.from("orders").select("*").eq("status","ready").is("driver_id",null).order("created_at",{ascending:!1}).limit(5);if(k)console.error("‚ùå Error buscando √≥rdenes listas:",k);else if(console.log(`üì¶ √ìrdenes listas sin repartidor: ${(h==null?void 0:h.length)||0}`),h&&h.length>0&&confirm(`Se encontraron ${h.length} √≥rdenes listas sin repartidor asignado. ¬øQuieres asignarlas a tu cuenta?`)){console.log("üîß Asignando √≥rdenes listas...");for(const S of h)try{const{error:D}=await c.from("orders").update({driver_id:a.id,status:"assigned",updated_at:new Date().toISOString()}).eq("id",S.id);D?console.error(`‚ùå Error asignando orden ${S.id}:`,D):console.log(`‚úÖ Orden ${S.id} asignada exitosamente`)}catch(D){console.error("‚ùå Error:",D)}o.success(`${h.length} √≥rdenes fueron asignadas a tu cuenta`),await Promise.all([y(),E(),F()])}console.log("‚úÖ Diagn√≥stico completado"),o.success("Diagn√≥stico ejecutado. Revisa la consola para detalles.")}catch(s){console.error("‚ùå Error en diagn√≥stico:",s),o.error("Error ejecutando diagn√≥stico")}},y=async()=>{try{console.log("Loading active deliveries for driver:",a==null?void 0:a.id);const{data:s,error:t}=await c.from("orders").select(`
          *,
          seller_info:sellers!seller_id (
            business_name,
            address
          ),
          seller_business:sellers!seller_id (
            business_name,
            business_address,
            business_phone
          )
        `).eq("driver_id",a==null?void 0:a.id).in("status",["assigned","picked_up","in_transit"]).order("created_at",{ascending:!1});if(t){console.error("Error loading active deliveries:",t),O([]);return}console.log("Active deliveries data with seller info:",s);const n=(s||[]).map(r=>{var w,S,D,V;const h=((w=r.seller_business)==null?void 0:w.business_address)||((S=r.seller_info)==null?void 0:S.address)||"Contactar vendedor para direcci√≥n",k=((D=r.seller_business)==null?void 0:D.business_name)||((V=r.seller_info)==null?void 0:V.name)||"Negocio";return console.log(`üè™ Orden ${r.id.slice(0,8)}: Vendedor = ${k}, Direcci√≥n = ${h}`),{id:r.id,order_id:r.id,pickup_address:h,delivery_address:r.delivery_address||"Direcci√≥n de entrega",customer_name:r.customer_name||"Cliente",customer_phone:r.customer_phone||r.phone_number||"Sin tel√©fono",total_amount:r.total||0,delivery_fee:r.delivery_fee||Math.round((r.total||0)*.15)||10,status:r.status,created_at:r.created_at,estimated_delivery:r.estimated_delivery||new Date(Date.now()+30*6e4).toISOString(),items_count:1,business_name:k,pickup_notes:r.pickup_notes,delivery_notes:r.delivery_notes,picked_up_at:r.picked_up_at,delivered_at:r.delivered_at}});console.log("Transformed active deliveries:",n),O(n)}catch(s){console.error("Error loading active deliveries:",s),O([])}},F=async()=>{try{const s=new Date().toISOString().split("T")[0],{data:t,error:n}=await c.from("orders").select("delivery_fee, total").eq("driver_id",a==null?void 0:a.id).eq("status","delivered").gte("created_at",s),{data:r,error:h}=await c.from("orders").select("delivery_fee, total, created_at").eq("driver_id",a==null?void 0:a.id).eq("status","delivered");if(!n&&t){const k=t.reduce((D,V)=>D+(V.delivery_fee||0),0),w=(r==null?void 0:r.length)||0,S=(r==null?void 0:r.reduce((D,V)=>D+(V.delivery_fee||0),0))||0;P(D=>({...D,todayDeliveries:t.length,todayEarnings:k,totalDeliveries:w,totalEarnings:S,activeTime:Ee(),completionRate:De(r||[])}))}else P({todayDeliveries:8,todayEarnings:120,activeTime:6.5,averageRating:4.8,totalDeliveries:156,totalEarnings:2340,completionRate:96})}catch(s){console.error("Error loading driver stats:",s)}},Ee=()=>Math.random()*8+2,De=s=>s.length===0?95:Math.floor(Math.random()*10)+90,Ce=p.useCallback(async()=>{if(a!=null&&a.id)try{const s=c.channel("driver-orders").on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:"status=eq.ready"},t=>{console.log("New order available:",t),j(n=>n+1),Notification.permission==="granted"&&new Notification("¬°Nueva entrega disponible!",{body:`Pedido de Q${t.new.total} listo para recoger`,icon:"/favicon.ico",tag:"new-delivery"}),E()}).subscribe();return Notification.permission==="default"&&await Notification.requestPermission(),()=>{s.unsubscribe()}}catch(s){console.error("Error setting up notifications:",s)}},[a==null?void 0:a.id]),xe=async s=>{try{if(s&&!v.is_verified){o.error("Tu cuenta debe ser verificada antes de activarte");return}if(s&&!await ge()){o.error("Se requiere acceso a la ubicaci√≥n para activarse");return}const{error:t}=await c.from("drivers").update({is_active:s,is_online:s,current_location:s?await ge():null,updated_at:new Date().toISOString()}).eq("id",a==null?void 0:a.id);if(t){console.error("Error updating driver status:",t),o.error("Error al actualizar estado");return}const{error:n}=await c.from("users").update({is_active:s}).eq("id",a==null?void 0:a.id);n&&console.error("Error updating user status:",n),R(r=>({...r,is_active:s,status:s?"available":"offline"})),s?(Se(),o.success("¬°Est√°s EN L√çNEA! Comenzar√°s a recibir pedidos")):(ke(),o.success("Te has DESCONECTADO"))}catch(t){console.error("Error toggling driver status:",t),o.error("Error al cambiar estado")}},ge=()=>new Promise(s=>{if(!navigator.geolocation){B("Geolocalizaci√≥n no soportada"),s(null);return}navigator.geolocation.getCurrentPosition(t=>{s({lat:t.coords.latitude,lng:t.coords.longitude})},t=>{console.error("Error getting location:",t),B("Error al obtener ubicaci√≥n"),s(null)})}),Se=()=>{if(!navigator.geolocation)return;const s=navigator.geolocation.watchPosition(async t=>{const n={lat:t.coords.latitude,lng:t.coords.longitude};await c.from("drivers").update({current_location:n}).eq("id",a==null?void 0:a.id),R(r=>({...r,current_location:n}))},t=>{console.error("Error tracking location:",t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4});l(s)},ke=()=>{i&&(navigator.geolocation.clearWatch(i),l(null))},Ae=async s=>{var t,n;if(!(a!=null&&a.id)){o.error("Usuario no autenticado");return}try{console.log("Accepting order:",s,"for driver:",a.id);const{data:r,error:h}=await c.rpc("assign_driver_to_order",{p_order_id:s,p_driver_id:a.id});if(h){console.error("RPC Error accepting order:",h),o.error("Error al aceptar pedido");return}console.log("Accept order response:",r),(t=r==null?void 0:r[0])!=null&&t.success?(o.success(r[0].message||"Pedido aceptado exitosamente"),E(),y(),j(k=>Math.max(0,k-1))):o.error(((n=r==null?void 0:r[0])==null?void 0:n.message)||"Error al aceptar pedido")}catch(r){console.error("Error accepting order:",r),o.error("Error al aceptar pedido")}},ie=async(s,t)=>{if(console.log("üü¢ updateDeliveryStatus called with:",s,t),!(a!=null&&a.id)){console.error("‚ùå Usuario no autenticado"),o.error("Usuario no autenticado");return}console.log("üë§ User ID:",a.id),K(s);try{console.log("üîÑ Updating order status:",s,"to:",t,"by driver:",a.id);const n={status:t,updated_at:new Date().toISOString()};t==="picked_up"?n.picked_up_at=new Date().toISOString():t==="in_transit"?n.in_transit_at=new Date().toISOString():t==="delivered"&&(n.delivered_at=new Date().toISOString()),console.log("üìù Update data:",n);const{data:r,error:h}=await c.from("orders").update(n).eq("id",s).eq("driver_id",a.id).select();if(h){console.error("‚ùå Error updating order status:",h),console.error("‚ùå Error details:",JSON.stringify(h,null,2)),o.error("No se pudo actualizar: "+(h.message||"Error desconocido"));return}if(console.log("‚úÖ Update successful! Response:",r),r&&r.length>0){const k={picked_up:"üì¶ Pedido marcado como recogido",in_transit:"üöö En camino al destino",delivered:"‚úÖ Entrega completada exitosamente"};o.success(k[t]||"Estado actualizado"),await Promise.all([y(),F(),he()])}else o.error("No se pudo actualizar el estado")}catch(n){console.error("Error updating delivery status:",n),o.error("Error al actualizar estado")}finally{K(null)}},he=async()=>{try{console.log("Loading completed deliveries for driver:",a==null?void 0:a.id);const{data:s,error:t}=await c.rpc("driver_get_completed_orders",{p_driver_id:a==null?void 0:a.id});if(t){console.error("Error loading delivery history:",t),N([]);return}console.log("Delivery history data:",s);const n=(s||[]).map(r=>({id:r.order_id,order_id:r.order_id,pickup_address:"Recogido",delivery_address:"Entregado",customer_name:r.customer_name,customer_phone:"Completado",total_amount:r.total_amount||0,delivery_fee:r.delivery_fee||0,status:r.status,created_at:r.created_at,estimated_delivery:r.delivered_at||r.created_at,items_count:1,business_name:r.business_name,pickup_notes:void 0,delivery_notes:void 0}));N(n)}catch(s){console.error("Error loading completed deliveries:",s),N([])}},Y=s=>{if(console.log("üó∫Ô∏è Abriendo direcci√≥n en mapas:",s),!s||s==="Direcci√≥n del vendedor"||s==="Direcci√≥n de recogida"||s.includes("Contactar vendedor")){o.error("Direcci√≥n no disponible. Contacta al vendedor.");return}const n=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s)}`;console.log("üîó URL de mapas:",n),window.open(n,"_blank")},Te=[{id:"dashboard",label:"Inicio",icon:Ge,description:"Resumen y estad√≠sticas"},{id:"deliveries",label:"Entregas",icon:Q,description:"Pedidos disponibles y activos",hasNotification:d>0,notificationCount:d},{id:"history",label:"Historial",icon:je,description:"Entregas completadas"},{id:"notifications",label:"Notificaciones",icon:ue,description:"Centro de notificaciones",hasNotification:d>0,notificationCount:d},{id:"profile",label:"Perfil",icon:ce,description:"Configuraci√≥n del repartidor"}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx(Me,{showBanner:!0,enableAutoActivation:!0}),e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx("div",{className:"flex justify-center mb-4"})}),e.jsx(Fe,{onNotification:_}),T.length>0&&e.jsx("div",{className:"container mx-auto px-4 mb-4",children:e.jsx(Ve,{orderId:T[0].order_id})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-green-500 p-2 rounded-lg",children:e.jsx(J,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-orange-600 to-green-600 bg-clip-text text-transparent",children:"TRATO Repartidor"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["¬°Hola, ",a==null?void 0:a.name,"!"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Estado:"}),e.jsx(ye,{checked:v.is_active,onCheckedChange:xe,disabled:te}),e.jsx("span",{className:`text-sm font-medium ${v.is_active?"text-green-600":"text-gray-500"}`,children:v.is_active?"En l√≠nea":"Desconectado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{variant:v.is_verified?"default":"destructive",children:v.is_verified?"Verificado":"Sin verificar"}),e.jsx(A,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:"Repartidor"})]}),e.jsxs(f,{variant:"outline",onClick:re,className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Cerrar Sesi√≥n"]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[X&&e.jsx(x,{className:"mb-6 border-yellow-200 bg-yellow-50",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:X}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>B(""),className:"ml-auto",children:"Cerrar"})]})})}),e.jsxs(pe,{value:U,onValueChange:s=>G(s),className:"space-y-6",children:[e.jsx(fe,{className:"grid w-full grid-cols-5 lg:w-2/3 mx-auto bg-white border border-gray-200",children:Te.map(s=>{const t=s.icon;return e.jsxs(ne,{value:s.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-orange-100 data-[state=active]:text-orange-700 relative",onClick:()=>{s.id==="deliveries"&&j(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"w-5 h-5"}),s.hasNotification&&s.notificationCount&&s.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:s.notificationCount>9?"9+":s.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:s.label})]},s.id)})}),e.jsxs(I,{value:"dashboard",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Entregas hoy"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.todayDeliveries})]}),e.jsx(Q,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ganancias hoy"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["Q",g.todayEarnings]})]}),e.jsx(ve,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tiempo activo"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[g.activeTime.toFixed(1),"h"]})]}),e.jsx(Be,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Calificaci√≥n"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[g.averageRating.toFixed(1),"‚òÖ"]})]}),e.jsx(we,{className:"w-8 h-8 text-yellow-500"})]})})})]}),e.jsxs(x,{children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Estado Actual"]})}),e.jsx(u,{children:v.is_active?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-green-800",children:"En l√≠nea y disponible"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>G("deliveries"),children:"Ver Pedidos"}),v.current_location&&e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{var s,t;return Y(`${(s=v.current_location)==null?void 0:s.lat},${(t=v.current_location)==null?void 0:t.lng}`)},children:[e.jsx(Ye,{className:"w-4 h-4 mr-1"}),"Mi Ubicaci√≥n"]})]})]}),e.jsx("p",{className:"text-sm text-green-700",children:"Est√°s visible para recibir nuevos pedidos. Mant√©n tu ubicaci√≥n actualizada."})]}):e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full"}),e.jsx("span",{className:"font-medium text-gray-600",children:"Desconectado"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Activa tu estado para comenzar a recibir pedidos."}),!v.is_verified&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è Tu cuenta a√∫n no est√° verificada. Contacta al administrador para completar la verificaci√≥n."})})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-green-500"}),"Resumen de Rendimiento"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Entregas totales"}),e.jsx("span",{className:"font-semibold",children:g.totalDeliveries})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Ganancias totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["Q",g.totalEarnings]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tasa de completaci√≥n"}),e.jsxs("span",{className:"font-semibold",children:[g.completionRate,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Promedio por entrega"}),e.jsxs("span",{className:"font-semibold",children:["Q",g.totalDeliveries>0?(g.totalEarnings/g.totalDeliveries).toFixed(2):"0.00"]})]})]})]}),e.jsxs(x,{children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-yellow-500"}),"Logros y Metas"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Entregas esta semana"}),e.jsxs(A,{variant:"outline",children:[Math.floor(g.totalDeliveries/4)," de 50"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Calificaci√≥n 5‚òÖ"}),e.jsx(A,{variant:g.averageRating>=4.8?"default":"outline",children:g.averageRating>=4.8?"‚úì Logrado":"En progreso"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Repartidor del mes"}),e.jsx(A,{variant:"outline",children:"Top 10"})]})]})]})]})]}),e.jsxs(I,{value:"deliveries",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Entregas"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona tus pedidos disponibles y activos"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:E,variant:"outline",className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(f,{onClick:C,variant:"outline",className:"bg-yellow-50 border-yellow-200 text-yellow-700 hover:bg-yellow-100",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Diagn√≥stico"]})]})]}),e.jsxs(pe,{defaultValue:"available",className:"space-y-6",children:[e.jsxs(fe,{children:[e.jsxs(ne,{value:"available",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Disponibles (",q.length,")"]}),e.jsxs(ne,{value:"active",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Activas (",T.length,")"]})]}),e.jsx(I,{value:"available",className:"space-y-4",children:v.is_active?q.length===0?e.jsx(x,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay pedidos disponibles"}),e.jsx("p",{className:"text-gray-600",children:"Los nuevos pedidos aparecer√°n aqu√≠ autom√°ticamente"})]})}):e.jsx("div",{className:"grid gap-4",children:q.map(s=>e.jsx(x,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Pedido #",s.order_id.slice(0,8)]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.business_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["Q",s.delivery_fee]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Tarifa de entrega"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-orange-600",children:"Recoger en:"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.pickup_address}),s.pickup_notes&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Nota: ",s.pickup_notes]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-600",children:"Entregar en:"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.delivery_address}),e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_name})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[s.items_count," productos"]}),e.jsxs("span",{children:["Total: Q",s.total_amount]}),s.distance&&e.jsxs("span",{children:[s.distance," km"]})]}),e.jsxs(A,{variant:"outline",children:[Math.floor((new Date(s.estimated_delivery).getTime()-Date.now())/6e4)," min"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(f,{onClick:()=>Ae(s.id),className:"flex-1 bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Aceptar Pedido"]}),e.jsx(f,{variant:"outline",onClick:()=>Y(s.pickup_address),children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(f,{variant:"outline",onClick:()=>window.open(`tel:${s.customer_phone}`,"_self"),children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})},s.id))}):e.jsx(x,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(J,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Act√≠vate para ver pedidos"}),e.jsx("p",{className:"text-gray-600 mb-4",children:'Cambia tu estado a "En l√≠nea" para comenzar a recibir pedidos disponibles'}),e.jsx(f,{onClick:()=>xe(!0),children:"Activarse ahora"})]})})}),e.jsx(I,{value:"active",className:"space-y-4",children:T.length===0?e.jsx(x,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(J,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes entregas activas"}),e.jsx("p",{className:"text-gray-600",children:"Acepta pedidos disponibles para comenzar a trabajar"})]})}):e.jsx("div",{className:"grid gap-4",children:T.map(s=>e.jsx(x,{className:"border-orange-200 bg-orange-50",children:e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Pedido #",s.order_id.slice(0,8)]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.business_name}),e.jsx(A,{className:`mt-2 ${s.status==="assigned"?"bg-blue-100 text-blue-800":s.status==="picked_up"?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"}`,children:s.status==="assigned"?"Asignado":s.status==="picked_up"?"Recogido":s.status==="in_transit"?"En tr√°nsito":s.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["Q",s.delivery_fee]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Tarifa de entrega"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-orange-600",children:"Recoger en:"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.pickup_address}),e.jsxs(f,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>Y(s.pickup_address),children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"Ir a recoger"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-600",children:"Entregar en:"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.delivery_address}),e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_name}),e.jsxs(f,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>Y(s.delivery_address),children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"Ir a entregar"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[s.items_count," productos"]}),e.jsxs("span",{children:["Total: Q",s.total_amount]})]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>window.open(`tel:${s.customer_phone}`,"_self"),children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Llamar cliente"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[s.status==="assigned"&&e.jsxs(f,{onClick:()=>ie(s.id,"picked_up"),className:"flex-1 bg-orange-500 hover:bg-orange-600",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Marcar como Recogido"]}),s.status==="picked_up"&&e.jsxs(f,{onClick:()=>ie(s.id,"in_transit"),className:"flex-1 bg-blue-500 hover:bg-blue-600",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"En Tr√°nsito"]}),s.status==="in_transit"&&e.jsxs(f,{onClick:()=>ie(s.id,"delivered"),className:"flex-1 bg-green-500 hover:bg-green-600",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Marcar como Entregado"]})]})]})},s.id))})})]})]}),e.jsxs(I,{value:"history",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Historial de Entregas"}),e.jsx("p",{className:"text-gray-600",children:"Revisa tus entregas completadas y ganancias"})]}),m.length===0?e.jsx(x,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(je,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Sin entregas completadas"}),e.jsx("p",{className:"text-gray-600",children:"Aqu√≠ aparecer√°n todas tus entregas completadas"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Entregas Hoy"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(s=>s.delivered_at&&new Date(s.delivered_at).toDateString()===new Date().toDateString()).length})]}),e.jsx(se,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ganancias Hoy"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["Q",m.filter(s=>s.delivered_at&&new Date(s.delivered_at).toDateString()===new Date().toDateString()).reduce((s,t)=>s+t.delivery_fee,0).toFixed(2)]})]}),e.jsx(ve,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Entregas"}),e.jsx("p",{className:"text-2xl font-bold",children:m.length})]}),e.jsx(Q,{className:"w-8 h-8 text-blue-500"})]})})})]}),e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsx(x,{className:"border-green-200 bg-green-50",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs("h3",{className:"font-semibold",children:["Pedido #",s.order_id.slice(0,8)]}),e.jsx(A,{className:"bg-green-100 text-green-800",children:"Entregado"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.business_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Entregado: ",s.delivered_at?new Date(s.delivered_at).toLocaleString("es-GT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Fecha no disponible"]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-2",children:[e.jsxs("span",{children:[s.items_count," productos"]}),e.jsxs("span",{children:["Total: Q",s.total_amount]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xl font-bold text-green-600",children:["Q",s.delivery_fee]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ganancia"})]})]})})},s.id))})]})]}),e.jsxs(I,{value:"notifications",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Notificaciones"}),e.jsx("p",{className:"text-gray-600",children:"Centro de notificaciones del repartidor"})]}),e.jsx(x,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(ue,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Centro de Notificaciones"}),e.jsx("p",{className:"text-gray-600",children:"Aqu√≠ aparecer√°n todas tus notificaciones de pedidos y actualizaciones del sistema"})]})})]}),e.jsx(I,{value:"profile",className:"space-y-6",children:e.jsx(Ze,{})})]})]})]})}export{js as DriverDashboard};
