import{g as ve,u as de,r as o,j as e,B as D,C as U,a as re,b as ee,c as V,X as qe,L as oe,f as te,d as we,s as k,i as ks,I as ye,E as Ps,q as Ts,e as le,v as As,t as B,R as Ae,G as Re,A as pa,k as fa,l as Fe,J as es,H as Ee,m as Se,n as ba,N as ja,o as Ds,h as Is,S as va,w as Ls,x as Os,y as Rs,z as Ms,O as Na,Q as ya,p as $s}from"./index-9d4LIYkQ.js";import{A as xe,a as ge}from"./alert-BYteypOu.js";import{P as fe,D as ls,T as Ye,a as Xe,b as he,d as ce,N as wa,M as _a,c as Sa}from"./NotificationSystem-Ddtne5eA.js";import{I as X}from"./input-DD8qTseN.js";import{T as cs}from"./textarea-3tMjESen.js";import{L as Y}from"./label-lZvX4CTh.js";import{S as Ca,a as Ea,b as ka,c as Pa,d as Ta}from"./select-D6a4Dncp.js";import{A as qs}from"./arrow-left-DOI7IDWT.js";import{U as zs}from"./upload-ueD78s2A.js";import{S as ss}from"./save-PXOx3gZA.js";import{C as ae}from"./clock-BLcblUBq.js";import{d as Fs,F as Aa,a as Da,f as Ia,S as La,B as Oa,R as Ra,e as Ma,P as Ie,C as $a,A as qa,O as Us,p as ns,T as za,H as Fa,c as Ua}from"./TimeoutAlerts-wkxpdcwV.js";import{A as Vs,a as Gs,b as Ws,c as Bs,d as Hs,e as Qs,f as Ys,g as Xs,h as Js,M as Va,S as Ga}from"./alert-dialog-8z5-otMa.js";import{E as Wa}from"./eye-off-CUaL41iP.js";import{T as ds}from"./trash-2-Q3a_8Zc1.js";import{C as Ba,a as Ce,P as Je,M as Ha,N as Qe,b as Qa}from"./CriticalNotifications-ol96pFnl.js";import{S as be}from"./store-B3Rc6OOo.js";import{I as bs}from"./info-yRHcm34Y.js";import{M as pe}from"./map-pin-Ctpb2SRl.js";import{T as ze}from"./truck-B_KZSvWh.js";import{M as Ya}from"./mail-Bzl61Jxz.js";import{G as js}from"./globe-BNfky9zY.js";import{T as Le}from"./triangle-alert-BAlJ0FTm.js";import{C as De}from"./circle-x-CvCVlv_1.js";import{E as Xa}from"./external-link-CTiNF567.js";import{U as ms}from"./user-DVJm9NeR.js";import{S as us}from"./shopping-cart-1rXuWJmP.js";import{S as Zs}from"./star-BemJn4BC.js";import{L as Ja}from"./log-out-CMaFcibJ.js";import{S as Za}from"./shopping-bag-tYwf8ov7.js";import"./users-BMnL9NIw.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],er=ve("bell-ring",Ka);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ar=ve("chart-column",sr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],tr=ve("clipboard-list",rr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],nr=ve("facebook",ir);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ks=ve("hash",or);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ea=ve("image",lr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],dr=ve("instagram",cr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ur=ve("message-square",mr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],xs=ve("pen",xr),gr=["Alimentos","Bebidas","Ropa","Electr√≥nicos","Hogar","Belleza","Deportes","Libros","Juguetes","Mascotas","Salud","Herramientas","Jard√≠n","M√∫sica","Arte","Otros"];function vs({product:s,onSuccess:l,onCancel:r}){const{user:m}=de(),[t,u]=o.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.category)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||"",is_public:(s==null?void 0:s.is_public)!==!1}),[h,n]=o.useState(null),[d,S]=o.useState((s==null?void 0:s.image_url)||""),[w,E]=o.useState(!1),[c,v]=o.useState(!1),[P,I]=o.useState(""),C=o.useRef(null),T=a=>{var f;const p=(f=a.target.files)==null?void 0:f[0];if(p){if(!p.type.startsWith("image/")){I("Por favor selecciona una imagen v√°lida");return}if(p.size>5*1024*1024){I("La imagen debe ser menor a 5MB");return}n(p),I("");const g=new FileReader;g.onload=x=>{var N;S((N=x.target)==null?void 0:N.result)},g.readAsDataURL(p)}},$=async a=>{var p;v(!0);try{const{data:{session:f}}=await k.auth.getSession();if(!((p=f==null?void 0:f.user)!=null&&p.id))throw new Error("No autorizado - sesi√≥n inv√°lida");const g=a.name.split(".").pop(),N=`products/${`${f.user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${g}`}`;for(let i=0;i<3;i++)try{const{error:_}=await k.storage.from("products").upload(N,a,{cacheControl:"3600",upsert:!0});if(_){if(_.message.includes("JWT")||_.message.includes("token")){await k.auth.refreshSession();continue}throw _}const{data:L}=k.storage.from("products").getPublicUrl(N);if(!L.publicUrl)throw new Error("No se pudo obtener la URL p√∫blica");return L.publicUrl}catch(_){if(i===2)throw _;await new Promise(L=>setTimeout(L,1e3));continue}throw new Error("No se pudo subir la imagen despu√©s de 3 intentos")}catch(f){throw console.error("Error uploading image:",f),new Error("Error al subir la imagen: "+f.message)}finally{v(!1)}},J=async a=>{try{const p=a.split("/"),f=p[p.length-3],g=p[p.length-2],x=p[p.length-1],N=`${g}/${x}`;f==="products"&&await k.storage.from("products").remove([N])}catch(p){console.error("Error deleting old image:",p)}},q=async a=>{if(a.preventDefault(),I(""),!t.name.trim()){I("El nombre del producto es requerido");return}if(!t.price||parseFloat(t.price.toString())<=0){I("El precio debe ser mayor a 0");return}if(!t.category){I("Selecciona una categor√≠a");return}if(!t.stock_quantity||parseInt(t.stock_quantity.toString())<0){I("La cantidad debe ser mayor a 0");return}if(!s&&!h&&!d){I("Selecciona una imagen para el producto");return}E(!0);try{let p=(s==null?void 0:s.image_url)||"";h&&(p=await $(h),s!=null&&s.image_url&&await J(s.image_url));const f={name:t.name.trim(),description:t.description.trim(),price:parseFloat(t.price.toString())||0,category:t.category,stock_quantity:parseInt(t.stock_quantity.toString())||1,is_public:t.is_public,image_url:p,seller_id:m==null?void 0:m.id};if(s){const{error:g}=await k.from("products").update(f).eq("id",s.id);if(g)throw g}else{const{error:g}=await k.from("products").insert([f]);if(g)throw g}l()}catch(p){console.error("Error saving product:",p),I(p.message||"Error al guardar el producto")}finally{E(!1)}},H=()=>{n(null),S(""),C.current&&(C.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto":"Agregar Producto"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica la informaci√≥n de tu producto":"Crea un nuevo producto para tu tienda"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(U,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Informaci√≥n del Producto"]})}),e.jsx(V,{children:e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{children:"Imagen del Producto *"}),d?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(D,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:H,children:e.jsx(qe,{className:"w-4 h-4"})}),c&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-500 transition-colors",onClick:()=>{var a;return(a=C.current)==null?void 0:a.click()},children:[e.jsx(ea,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, WEBP hasta 5MB"})]}),e.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:T,className:"hidden"}),!d&&e.jsxs(D,{type:"button",variant:"outline",onClick:()=>{var a;return(a=C.current)==null?void 0:a.click()},className:"w-full",children:[e.jsx(zs,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(X,{id:"name",value:t.name,onChange:a=>u({...t,name:a.target.value}),placeholder:"Ej: Manzanas Rojas Org√°nicas",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(cs,{id:"description",value:t.description,onChange:a=>u({...t,description:a.target.value}),placeholder:"Describe las caracter√≠sticas y beneficios de tu producto...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"price",children:"Precio (Q) *"}),e.jsx(X,{id:"price",type:"number",step:"0.01",min:"0",value:t.price,onChange:a=>u({...t,price:a.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(X,{id:"stock",type:"number",min:"0",value:t.stock_quantity,onChange:a=>u({...t,stock_quantity:a.target.value}),placeholder:"1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{children:"Categor√≠a *"}),e.jsxs(Ca,{onValueChange:a=>u({...t,category:a}),children:[e.jsx(Ea,{children:e.jsx(ka,{placeholder:t.category||"Selecciona una categor√≠a"})}),e.jsx(Pa,{children:gr.map(a=>e.jsx(Ta,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Y,{children:"Visibilidad"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{type:"button",variant:t.is_public?"default":"outline",onClick:()=>u({...t,is_public:!0}),className:"flex-1",children:["P√∫blico",t.is_public&&e.jsx(te,{variant:"secondary",className:"ml-2",children:"Activo"})]}),e.jsxs(D,{type:"button",variant:t.is_public?"outline":"default",onClick:()=>u({...t,is_public:!1}),className:"flex-1",children:["Privado",!t.is_public&&e.jsx(te,{variant:"secondary",className:"ml-2",children:"Activo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Los productos p√∫blicos aparecen en el cat√°logo general. Los privados solo los ves t√∫."})]}),P&&e.jsxs(xe,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(ge,{children:P})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:w||c,children:"Cancelar"}),e.jsx(D,{type:"submit",disabled:w||c,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:w?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Producto"]})})]})]})})]})})]})}function Ns({dailyProduct:s,onSuccess:l,onCancel:r}){const{user:m}=de(),[t,u]=o.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:s!=null&&s.price?String(s.price):"",stock_quantity:s!=null&&s.stock_quantity?String(s.stock_quantity):""}),[h,n]=o.useState(null),[d,S]=o.useState((s==null?void 0:s.image_url)||""),[w,E]=o.useState(!1),[c,v]=o.useState(!1),[P,I]=o.useState(""),C=o.useRef(null),T=()=>{const f=new Date;return new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59,999).toISOString()},$=()=>{const f=new Date,g=new Date;g.setHours(23,59,59,999);const x=g.getTime()-f.getTime(),N=Math.floor(x/(1e3*60*60)),i=Math.floor(x%(1e3*60*60)/(1e3*60));return`${N}h ${i}m`},J=f=>{var x;const g=(x=f.target.files)==null?void 0:x[0];if(g){if(!g.type.startsWith("image/")){I("Por favor selecciona una imagen v√°lida");return}if(g.size>5*1024*1024){I("La imagen debe ser menor a 5MB");return}n(g),I("");const N=new FileReader;N.onload=i=>{var _;S((_=i.target)==null?void 0:_.result)},N.readAsDataURL(g)}},q=async f=>{v(!0);try{const g=new Date().toISOString().split("T")[0],x=f.name.split(".").pop(),i=`daily-products/${`${m==null?void 0:m.id}/${g}/${Date.now()}.${x}`}`,{error:_}=await k.storage.from("products").upload(i,f,{cacheControl:"3600",upsert:!1});if(_)throw _;const{data:L}=k.storage.from("products").getPublicUrl(i);return L.publicUrl}catch(g){throw console.error("Error uploading image:",g),new Error("Error al subir la imagen: "+g.message)}finally{v(!1)}},H=async f=>{try{const g=f.split("/"),x=g.findIndex(N=>N==="products");if(x!==-1){const i=g.slice(x+1).join("/");await k.storage.from("products").remove([i])}}catch(g){console.error("Error deleting old image:",g)}},a=async f=>{if(f.preventDefault(),I(""),!t.name.trim()){I("El nombre del producto es requerido");return}if(parseFloat(t.price)<=0){I("El precio debe ser mayor a 0");return}if(parseInt(t.stock_quantity)<0){I("La cantidad no puede ser negativa");return}if(!s&&!h&&!d){I("Selecciona una imagen para el producto");return}if(new Date().getHours()>=23){I("Es muy tarde para crear productos del d√≠a. Int√©ntalo ma√±ana temprano.");return}E(!0);try{let N=(s==null?void 0:s.image_url)||"";h&&(N=await q(h),s!=null&&s.image_url&&await H(s.image_url));const i={name:t.name.trim(),description:t.description.trim(),price:parseFloat(t.price)||0,stock_quantity:parseInt(t.stock_quantity)||0,image_url:N,seller_id:m==null?void 0:m.id,expires_at:T()};if(s){const{error:_}=await k.from("daily_products").update(i).eq("id",s.id);if(_)throw _}else{const{error:_}=await k.from("daily_products").insert([i]);if(_)throw _}l()}catch(N){console.error("Error saving daily product:",N),I(N.message||"Error al guardar el producto del d√≠a")}finally{E(!1)}},p=()=>{n(null),S(""),C.current&&(C.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto del D√≠a":"Tu Venta del D√≠a"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica tu oferta especial":"Crea una oferta especial que dura hasta medianoche"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800",children:["Tiempo restante: ",$()]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Este producto se eliminar√° autom√°ticamente a las 23:59:59 de hoy. Las im√°genes tambi√©n se eliminar√°n del servidor."})]}),e.jsxs(U,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Informaci√≥n del Producto del D√≠a"]})}),e.jsx(V,{children:e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{children:"Imagen del Producto *"}),d?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(D,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:p,children:e.jsx(qe,{className:"w-4 h-4"})}),c&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})}),e.jsxs(te,{variant:"destructive",className:"absolute bottom-2 left-2",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Expira a medianoche"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-orange-300 rounded-lg p-8 text-center cursor-pointer hover:border-orange-500 transition-colors bg-orange-50",onClick:()=>{var f;return(f=C.current)==null?void 0:f.click()},children:[e.jsx(ea,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-orange-600",children:"PNG, JPG, WEBP hasta 5MB"}),e.jsx(te,{variant:"outline",className:"mt-2 border-orange-300 text-orange-700",children:"Se elimina autom√°ticamente"})]}),e.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:J,className:"hidden"}),!d&&e.jsxs(D,{type:"button",variant:"outline",onClick:()=>{var f;return(f=C.current)==null?void 0:f.click()},className:"w-full border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(zs,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(X,{id:"name",value:t.name,onChange:f=>u({...t,name:f.target.value}),placeholder:"Ej: Combo Especial del D√≠a",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"description",children:"Descripci√≥n"}),e.jsx(cs,{id:"description",value:t.description,onChange:f=>u({...t,description:f.target.value}),placeholder:"Describe tu oferta especial del d√≠a...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"price",children:"Precio Especial (Q) *"}),e.jsx(X,{id:"price",type:"number",step:"0.01",min:"0",value:t.price,onChange:f=>u({...t,price:f.target.value}),placeholder:"0.00",required:!0}),e.jsx("p",{className:"text-xs text-orange-600",children:"Precio especial v√°lido solo hoy"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(X,{id:"stock",type:"number",min:"0",value:t.stock_quantity,onChange:f=>u({...t,stock_quantity:f.target.value}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-orange-600",children:"¬°Solo por hoy!"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Caracter√≠sticas de Productos del D√≠a"]}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Se elimina autom√°ticamente a las 23:59:59"}),e.jsx("li",{children:'‚Ä¢ Aparece marcado como "Oferta del D√≠a" en el cat√°logo'}),e.jsx("li",{children:"‚Ä¢ Las im√°genes se almacenan en carpeta temporal"}),e.jsx("li",{children:"‚Ä¢ Ideal para ofertas especiales y productos perecederos"})]})]}),P&&e.jsxs(xe,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(ge,{children:P})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:w||c,children:"Cancelar"}),e.jsx(D,{type:"submit",disabled:w||c,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:w?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Venta del D√≠a"]})})]})]})})]})]})]})}function hr({product:s,onEdit:l,onDelete:r}){const[m,t]=o.useState(!1),{openImageModal:u}=ks(),h=d=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(d),n=d=>new Date(d).toLocaleDateString("es-GT",{day:"numeric",month:"short",year:"numeric"});return e.jsxs(U,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border border-gray-200",style:{backgroundColor:"white"},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-gray-100",children:m?e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sin imagen"})]})}):e.jsx(ye,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>t(!0),expandable:!0,onExpand:u})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(te,{variant:s.is_public?"default":"secondary",className:"text-xs font-medium",style:{backgroundColor:s.is_public?"#22c55e":"#6b7280",color:"white",border:"none"},children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"w-3 h-3 mr-1"}),"P√∫blico"]}):e.jsxs(e.Fragment,{children:[e.jsx(Wa,{className:"w-3 h-3 mr-1"}),"Privado"]})})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(te,{variant:"destructive",className:"text-xs font-medium",style:{backgroundColor:"#ef4444",color:"white",border:"none"},children:"Sin stock"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(te,{variant:"outline",className:"text-xs font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",color:"#374151",border:"1px solid #d1d5db"},children:s.category})})]}),e.jsx(V,{className:"p-3 md:p-4",style:{backgroundColor:"white"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1 text-sm md:text-base",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm md:text-lg text-green-600",children:h(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ks,{className:"w-3 h-3 md:w-4 md:h-4 text-gray-500 flex-shrink-0"}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Creado el ",n(s.created_at)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>l(s),className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#d1d5db",color:"#374151"},children:[e.jsx(xs,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(Vs,{children:[e.jsx(Gs,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#fecaca",color:"#dc2626",backgroundColor:"white"},children:[e.jsx(ds,{className:"w-3 h-3 mr-1"}),"Eliminar"]})}),e.jsxs(Ws,{children:[e.jsxs(Bs,{children:[e.jsx(Hs,{children:"¬øEliminar producto?"}),e.jsxs(Qs,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda.']})]}),e.jsxs(Ys,{children:[e.jsx(Xs,{children:"Cancelar"}),e.jsx(Js,{onClick:()=>r(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]})}function pr({dailyProduct:s,onEdit:l,onDelete:r}){const[m,t]=o.useState(!1),[u,h]=o.useState(""),[n,d]=o.useState(!1),{openImageModal:S}=ks();o.useEffect(()=>{const c=()=>{const P=Da(s.expires_at);h(P.formattedTime),d(P.isExpired)};c();const v=setInterval(c,1e3);return()=>clearInterval(v)},[s.expires_at]);const w=c=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(c),E=c=>Ia(c);return e.jsxs(U,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:m?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-12 h-12 text-orange-400"})}):e.jsx(ye,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>t(!0),expandable:!0,onExpand:S})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(te,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs",children:[e.jsx(Aa,{className:"w-3 h-3 mr-1"}),"Oferta del D√≠a"]})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(te,{variant:"destructive",className:"text-xs",children:"Agotado"})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(te,{variant:n?"destructive":"secondary",className:`text-xs ${n?"bg-red-500 text-white":"bg-white/90 backdrop-blur-sm text-orange-700"}`,children:[e.jsx(Fs,{className:"w-3 h-3 mr-1"}),u]})})]}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:w(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ks,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-orange-700",children:["Creado a las ",E(s.created_at)]}),e.jsxs("span",{className:"text-orange-700 font-medium",children:["Expira: ",E(s.expires_at)]})]})}),!n&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:["‚è∞ Se elimina autom√°ticamente en ",u]})}),n&&e.jsx("div",{className:"text-center bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"‚ùå Este producto ha expirado y ser√° eliminado pronto"})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>l(s),className:"flex-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:n,children:[e.jsx(xs,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(Vs,{children:[e.jsx(Gs,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ds,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(Ws,{children:[e.jsxs(Bs,{children:[e.jsx(Hs,{children:"¬øEliminar producto del d√≠a?"}),e.jsxs(Qs,{children:['Esta acci√≥n no se puede deshacer. El producto "',s.name,'" se eliminar√° permanentemente de tu tienda y su imagen del servidor.',!n&&e.jsxs("span",{className:"block mt-2 text-orange-600 font-medium",children:["Nota: Este producto se eliminar√° autom√°ticamente en ",u," de todas formas."]})]})]}),e.jsxs(Ys,{children:[e.jsx(Xs,{children:"Cancelar"}),e.jsx(Js,{onClick:()=>r(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar Ahora"})]})]})]})]})]})})]})}const He={north:15.2,south:15,east:-89.3,west:-89.5};function fr(){var s,l;try{return(l=(s=import.meta)==null?void 0:s.env)==null?void 0:l.VITE_GOOGLE_MAPS_API_KEY}catch{return}}function br(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")?"Safari":s.includes("edge")?"Edge":"tu navegador"}function jr(){const[s,l]=o.useState(!1),[r,m]=o.useState(null),[t,u]=o.useState(null),h=o.useCallback(()=>{m(null)},[]),n=o.useCallback((c,v)=>c>=He.south&&c<=He.north&&v>=He.west&&v<=He.east,[]),d=o.useCallback(async()=>{try{if("permissions"in navigator&&"query"in navigator.permissions){const c=await navigator.permissions.query({name:"geolocation"});return u(c.state),c.state}return u("prompt"),"prompt"}catch(c){return console.warn("Could not check geolocation permissions:",c),u("prompt"),"prompt"}},[]),S=o.useCallback(async()=>{try{const c=await new Promise(v=>{navigator.geolocation.getCurrentPosition(()=>v(!0),P=>{console.log("Permission request result:",P.code,P.message),v(P.code!==P.PERMISSION_DENIED)},{timeout:1e3,maximumAge:0})});return c&&await d(),c}catch(c){return console.error("Error requesting permissions:",c),!1}},[d]),w=o.useCallback(async(c,v)=>{try{m(null);const P=fr();if(P&&typeof fetch<"u")try{const I=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${c},${v}&key=${P}&language=es&region=GT`);if(I.ok){const C=await I.json();if(C.status==="OK"&&C.results&&C.results.length>0){const T=C.results[0],$=T.address_components||[];let J="",q="",H="",a="";return $.forEach(p=>{const f=p.types||[];f.includes("locality")||f.includes("administrative_area_level_2")?J=p.long_name||"":f.includes("administrative_area_level_1")?q=p.long_name||"":f.includes("country")?H=p.long_name||"":f.includes("postal_code")&&(a=p.long_name||"")}),{latitude:c,longitude:v,address:T.formatted_address||`Ubicaci√≥n GPS: ${c.toFixed(6)}, ${v.toFixed(6)}`,formatted_address:T.formatted_address||`Coordenadas: ${c.toFixed(6)}, ${v.toFixed(6)}`,city:J||"Gual√°n",state:q||"Zacapa",country:H||"Guatemala",postal_code:a,place_id:T.place_id}}}}catch(I){console.warn("Google Maps API request failed, using fallback:",I)}return{latitude:c,longitude:v,address:`Gual√°n, Zacapa, Guatemala (${c.toFixed(6)}, ${v.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS verificada en Gual√°n: ${c.toFixed(6)}, ${v.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}catch(P){return console.error("Error in reverse geocoding:",P),{latitude:c,longitude:v,address:`Gual√°n, Zacapa, Guatemala (${c.toFixed(6)}, ${v.toFixed(6)})`,formatted_address:`Ubicaci√≥n GPS: ${c.toFixed(6)}, ${v.toFixed(6)}`,city:"Gual√°n",state:"Zacapa",country:"Guatemala"}}},[]),E=o.useCallback(async()=>new Promise((c,v)=>{if(l(!0),m(null),!(navigator!=null&&navigator.geolocation)){const C=`‚ùå Geolocalizaci√≥n no disponible

Tu navegador no soporta geolocalizaci√≥n GPS. 

‚úÖ Soluciones:
‚Ä¢ Usa un navegador moderno (Chrome, Firefox, Safari, Edge)
‚Ä¢ Verifica que est√©s usando HTTPS (no HTTP)
‚Ä¢ Intenta desde un dispositivo m√≥vil
‚Ä¢ Actualiza tu navegador a la versi√≥n m√°s reciente`;console.error("Geolocation not supported"),m(C),l(!1),v(new Error(C));return}const P={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5},I=br();navigator.geolocation.getCurrentPosition(async C=>{try{const{latitude:T,longitude:$}=C.coords,J=C.coords.accuracy;if(console.log(`üìç GPS Location obtained: ${T.toFixed(6)}, ${$.toFixed(6)} (accuracy: ${J}m)`),!n(T,$)){const H=`üó∫Ô∏è Ubicaci√≥n fuera del √°rea de servicio

üìç Coordenadas detectadas: ${T.toFixed(4)}, ${$.toFixed(4)}
üè¢ √Årea de servicio: Gual√°n, Zacapa

‚ö†Ô∏è Posibles causas:
‚Ä¢ Tu negocio no est√° en Gual√°n, Zacapa
‚Ä¢ El GPS no es preciso (intenta ir al aire libre)
‚Ä¢ Est√°s usando VPN que cambia tu ubicaci√≥n

‚úÖ Si tu negocio S√ç est√° en Gual√°n:
‚Ä¢ Ve al exterior para mejor se√±al GPS
‚Ä¢ Desactiva VPN si usas una
‚Ä¢ Espera unos segundos y vuelve a intentar
‚Ä¢ La ubicaci√≥n se guardar√° aunque est√© fuera del √°rea estimada`;console.warn(`Location validation failed: lat=${T}, lng=${$}, accuracy=${J}m`),m(H),l(!1),v(new Error(H));return}const q=await w(T,$);console.log("‚úÖ Location successfully processed:",q),l(!1),c(q)}catch(T){console.error("Error processing location:",T);const $=T instanceof Error?T.message:"Error al procesar la ubicaci√≥n detectada";m($),l(!1),v(T)}},C=>{console.error("Geolocation error details:",{code:C.code,message:C.message,PERMISSION_DENIED:C.PERMISSION_DENIED,POSITION_UNAVAILABLE:C.POSITION_UNAVAILABLE,TIMEOUT:C.TIMEOUT});let T="Error al detectar la ubicaci√≥n";switch(C.code){case C.PERMISSION_DENIED:T=`üö´ Permiso de ubicaci√≥n denegado

üì± SOLUCI√ìN R√ÅPIDA para ${I}:

üîí **M√©todo 1 - √çcono de ubicaci√≥n:**
1. Busca el √≠cono üîí o üåê en la barra de direcciones
2. Haz clic en √©l
3. Cambia "Ubicaci√≥n" de "Bloqueado" a "Permitir"
4. Recarga la p√°gina

‚öôÔ∏è **M√©todo 2 - Configuraci√≥n del navegador:**
‚Ä¢ Chrome: Configuraci√≥n ‚Üí Privacidad ‚Üí Configuraci√≥n del sitio ‚Üí Ubicaci√≥n
‚Ä¢ Firefox: Preferencias ‚Üí Privacidad ‚Üí Permisos ‚Üí Ubicaci√≥n  
‚Ä¢ Safari: Preferencias ‚Üí Sitios web ‚Üí Ubicaci√≥n
‚Ä¢ Edge: Configuraci√≥n ‚Üí Permisos del sitio ‚Üí Ubicaci√≥n

üìç **¬øPor qu√© necesitamos tu ubicaci√≥n?**
Los repartidores necesitan las coordenadas GPS exactas de tu negocio para hacer entregas correctas.

üîÑ Despu√©s de cambiar los permisos, recarga esta p√°gina y vuelve a intentar.`;break;case C.POSITION_UNAVAILABLE:T=`üì° Se√±al GPS no disponible

üõ∞Ô∏è **Posibles causas:**
‚Ä¢ Est√°s en un lugar cerrado (edificio, s√≥tano)
‚Ä¢ Se√±al GPS d√©bil en tu √°rea
‚Ä¢ Interferencia de otros dispositivos
‚Ä¢ GPS desactivado en el dispositivo

‚úÖ **Soluciones:**
‚Ä¢ Ve cerca de una ventana o al aire libre
‚Ä¢ Verifica que el GPS est√© activado en tu dispositivo
‚Ä¢ Espera 1-2 minutos para que mejore la se√±al
‚Ä¢ Intenta desde otro lugar o dispositivo
‚Ä¢ Aseg√∫rate de tener conexi√≥n a internet estable

üì± En m√≥viles: Configuraci√≥n ‚Üí Ubicaci√≥n ‚Üí Activar GPS de alta precisi√≥n`;break;case C.TIMEOUT:T=`‚è∞ Tiempo de espera agotado (15 segundos)

üîÑ **La detecci√≥n GPS tard√≥ demasiado:**

üì∂ **Soluciones r√°pidas:**
‚Ä¢ Ve a un lugar con mejor se√±al (ventana o exterior)
‚Ä¢ Verifica tu conexi√≥n a internet
‚Ä¢ Reinicia el GPS en tu dispositivo si es m√≥vil
‚Ä¢ Cierra otras apps que usen ubicaci√≥n

üöÄ **Int√©ntalo de nuevo:**
La detecci√≥n puede ser m√°s r√°pida en el segundo intento.

üí° **Tip:** En dispositivos m√≥viles, el GPS suele ser m√°s r√°pido y preciso que en computadoras.`;break;default:T=`‚ùå Error GPS desconocido

üîß **Informaci√≥n t√©cnica:**
‚Ä¢ C√≥digo de error: ${C.code}
‚Ä¢ Mensaje: ${C.message}

üõ†Ô∏è **Soluciones generales:**
‚Ä¢ Recarga la p√°gina e intenta de nuevo
‚Ä¢ Verifica los permisos de ubicaci√≥n
‚Ä¢ Intenta desde otro navegador o dispositivo
‚Ä¢ Aseg√∫rate de usar HTTPS (no HTTP)

üìß Si el problema persiste, contacta soporte t√©cnico con esta informaci√≥n.`}console.error("Geolocation error processed:",T),m(T),l(!1),v(new Error(T))},P)}),[n,w]);return o.useEffect(()=>{d()},[d]),{getCurrentLocation:E,reverseGeocode:w,validateLocation:n,checkPermissions:d,requestPermissions:S,loading:s,error:r,permissionState:t,clearError:h}}const vr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWRkenlsb3RxZGNrdWJsZmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTU4NjEsImV4cCI6MjA3MTM3MTg2MX0.ktxZ0H7mI9NVdxu48sPd90kqPerSP-vkysQlIM1JpG8",VITE_SUPABASE_URL:"https://deaddzylotqdckublfed.supabase.co"},sa=[{key:"monday",label:"Lunes",short:"Lun"},{key:"tuesday",label:"Martes",short:"Mar"},{key:"wednesday",label:"Mi√©rcoles",short:"Mi√©"},{key:"thursday",label:"Jueves",short:"Jue"},{key:"friday",label:"Viernes",short:"Vie"},{key:"saturday",label:"S√°bado",short:"S√°b"},{key:"sunday",label:"Domingo",short:"Dom"}],Nr={monday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},saturday:{isOpen:!0,openTime:"09:00",closeTime:"17:00"},sunday:{isOpen:!1,openTime:"09:00",closeTime:"15:00"}};function yr(){try{return!!(import.meta&&vr&&!1)}catch{return!1}}function wr(s){const[l,r]=o.useState(()=>{if(s)try{return JSON.parse(s)}catch{console.log("Using default weekly hours")}return Nr});return{weeklyHours:l,setWeeklyHours:r,updateWeeklyHours:(h,n,d)=>{r(S=>({...S,[h]:{...S[h],[n]:d}}))},generateWeeklyHoursText:()=>{const h=sa.filter(n=>l[n.key].isOpen);return h.length===0?"Cerrado toda la semana":h.map(n=>{const d=l[n.key];return`${n.short}: ${d.openTime}-${d.closeTime}`}).join(", ")},getHoursAsJSON:()=>JSON.stringify(l)}}function _r({weeklyHours:s,updateWeeklyHours:l,generateWeeklyHoursText:r}){const[m,t]=o.useState(!1),u=()=>{t(!1)},h=()=>{t(!1)};return e.jsxs(U,{className:"seller-profile",children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ba,{className:"w-5 h-5 text-purple-500"}),"Horarios de Atenci√≥n"]}),!m&&e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t(!0),className:"flex items-center gap-2",children:[e.jsx(xs,{className:"w-4 h-4"}),"Editar Horarios"]})]})}),e.jsx(V,{className:"space-y-4",children:m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configurar Horarios"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:h,className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Cancelar"]}),e.jsxs(D,{size:"sm",onClick:u,className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),"Guardar"]})]})]}),e.jsx("div",{className:"space-y-3",children:sa.map(n=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 min-w-[80px]",children:n.label}),e.jsx(Ts,{checked:s[n.key].isOpen,onCheckedChange:d=>l(n.key,"isOpen",d)}),e.jsx("span",{className:`text-sm font-medium ${s[n.key].isOpen?"text-green-600":"text-red-600"}`,children:s[n.key].isOpen?"Abierto":"Cerrado"})]})}),s[n.key].isOpen&&e.jsxs("div",{className:"flex items-center gap-4 ml-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"text-sm whitespace-nowrap",children:"Apertura:"}),e.jsx(X,{type:"time",value:s[n.key].openTime,onChange:d=>l(n.key,"openTime",d.target.value),className:"w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"text-sm whitespace-nowrap",children:"Cierre:"}),e.jsx(X,{type:"time",value:s[n.key].closeTime,onChange:d=>l(n.key,"closeTime",d.target.value),className:"w-32"})]})]})]},n.key))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Vista previa:"}),e.jsx("p",{className:"text-sm text-blue-800",children:r()})]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-center",children:"Vista previa de horarios:"}),e.jsx("div",{className:"text-sm text-blue-800 leading-relaxed",children:r()})]})})]})}function Sr(s,l){if(s&&l){const r=`https://www.google.com/maps/@${s},${l},18z`;window.open(r,"_blank")}}function Cr(s){return s.business_name.trim()?null:"El nombre del negocio es requerido"}const os=({active:s,onClick:l,children:r,icon:m})=>e.jsxs("button",{onClick:l,className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 ${s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:r})]});function ys(){const{user:s}=de(),{getCurrentLocation:l,loading:r,error:m,permissionState:t,clearError:u}=jr(),[h,n]=o.useState(null),[d,S]=o.useState(!0),[w,E]=o.useState(!1),[c,v]=o.useState(""),[P,I]=o.useState(""),[C,T]=o.useState(!1),[$,J]=o.useState(!1),[q,H]=o.useState(!1),[a,p]=o.useState(!1),[f,g]=o.useState(""),[x,N]=o.useState(!1),[i,_]=o.useState(!1),[L,O]=o.useState(!1),[G,Q]=o.useState("info"),Z=o.useRef(null),ue=o.useRef(null),{weeklyHours:ke,setWeeklyHours:Pe,updateWeeklyHours:_e,generateWeeklyHoursText:ts,getHoursAsJSON:Ue}=wr(h==null?void 0:h.business_hours),[A,ne]=o.useState({business_name:"",business_description:"",business_logo:"",cover_image_url:"",business_category:"",phone:"",email:"",address:"",latitude:0,longitude:0,delivery_time:30,delivery_radius:5,minimum_order:50,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:{facebook:"",instagram:"",whatsapp:"",website:""}});o.useEffect(()=>{s?Me():(n(null),O(!1),S(!1)),N(yr())},[s]),o.useEffect(()=>{if(!s||!d)return;const b=setTimeout(()=>{S(!1),O(!0)},8e3);return()=>clearTimeout(b)},[s,d]),o.useEffect(()=>{m&&(_(!0),v(""))},[m]);const Me=async()=>{var b;try{S(!0);const{data:j,error:z}=await k.from("sellers").select("*").eq("id",s==null?void 0:s.id).single();if(z){const R=z.code,F=((b=z.message)==null?void 0:b.toString().toLowerCase())||"";if(R==="PGRST116"||R==="PGRST403"||R==="42501"||R==="PGRST114"||F.includes("permission")||F.includes("rls")||F.includes("forbidden")||F.includes("not authorized"))O(!0);else throw z}if(j){if(n(j),ne({business_name:j.business_name||"",business_description:j.business_description||"",business_logo:j.business_logo||"",cover_image_url:j.cover_image_url||"",business_category:j.business_category||"",phone:j.phone||"",email:j.email||"",address:j.address||"",latitude:j.latitude||0,longitude:j.longitude||0,delivery_time:j.delivery_time||30,delivery_radius:j.delivery_radius||5,minimum_order:j.minimum_order||50,is_active:j.is_active!==!1,is_open_now:j.is_open_now||!1,is_accepting_orders:j.is_accepting_orders!==!1,location_verified:j.location_verified||!1,social_media:j.social_media||{facebook:"",instagram:"",whatsapp:"",website:""}}),j.business_hours)try{Pe(JSON.parse(j.business_hours))}catch{console.log("Using default weekly hours")}const R=j.latitude&&j.longitude&&Math.abs(j.latitude)>.001&&Math.abs(j.longitude)>.001;p(R),R&&g(`${j.latitude.toFixed(6)}, ${j.longitude.toFixed(6)}`)}}catch(j){console.error("Error loading profile:",j),v("Error al cargar el perfil del negocio")}finally{S(!1)}},Ve=async()=>{var b,j,z,R,F;if(s)try{E(!0),v("");const W={business_name:((b=A.business_name)==null?void 0:b.trim())||"Mi Negocio",business_description:((j=A.business_description)==null?void 0:j.trim())||"",business_logo:"",cover_image_url:"",business_category:A.business_category||"",phone:((z=A.phone)==null?void 0:z.trim())||"",email:((R=A.email)==null?void 0:R.trim())||"",address:((F=A.address)==null?void 0:F.trim())||"",latitude:A.latitude||0,longitude:A.longitude||0,business_hours:Ue(),delivery_time:A.delivery_time||30,delivery_radius:A.delivery_radius||5,minimum_order:A.minimum_order||0,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:A.social_media,is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:K}=await k.from("sellers").upsert({id:s.id,...W});if(K)throw K;I("‚úÖ Perfil de vendedor creado. Completa la informaci√≥n y guarda los cambios."),O(!1),T(!0),await Me(),setTimeout(()=>I(""),4e3)}catch(W){console.error("Error creating minimal seller profile:",W),v("No se pudo crear el perfil de vendedor. Intenta de nuevo.")}finally{E(!1)}},$e=async()=>{var b,j,z,R,F,W;try{E(!0),v("");const K=Cr(A);if(K){v(K);return}console.log("üíæ Guardando perfil con datos:",{business_name:A.business_name,address:A.address,latitude:A.latitude,longitude:A.longitude,business_logo:((b=A.business_logo)==null?void 0:b.substring(0,50))+"...",cover_image_url:((j=A.cover_image_url)==null?void 0:j.substring(0,50))+"..."});const se={business_name:A.business_name.trim(),business_description:((z=A.business_description)==null?void 0:z.trim())||null,business_category:A.business_category||null,phone:((R=A.phone)==null?void 0:R.trim())||null,email:((F=A.email)==null?void 0:F.trim())||null,address:((W=A.address)==null?void 0:W.trim())||null,latitude:A.latitude||null,longitude:A.longitude||null,business_hours:Ue(),delivery_time:A.delivery_time||30,delivery_radius:A.delivery_radius||5,minimum_order:A.minimum_order||0,is_active:A.is_active,is_open_now:A.is_open_now,location_verified:A.location_verified||!1,social_media:A.social_media||{},business_logo:A.business_logo||null,cover_image_url:A.cover_image_url||null,updated_at:new Date().toISOString()},{error:ie}=await k.from("sellers").upsert({id:s==null?void 0:s.id,...se});if(ie)throw console.error("üí• Error al guardar:",ie),ie;console.log("‚úÖ Perfil guardado exitosamente"),I("‚úÖ Perfil guardado exitosamente"),T(!1),await Me(),setTimeout(()=>I(""),4e3)}catch(K){console.error("üí• Error saving profile:",K),v(`Error al guardar el perfil: ${K.message||"Error desconocido"}`)}finally{E(!1)}},Ge=(b,j,z,R=.8)=>new Promise(F=>{const W=document.createElement("canvas"),K=W.getContext("2d"),se=new Image;se.onload=()=>{let{width:ie,height:Ne}=se;ie>Ne?ie>j&&(Ne=Ne*j/ie,ie=j):Ne>z&&(ie=ie*z/Ne,Ne=z),W.width=ie,W.height=Ne,K.drawImage(se,0,0,ie,Ne),W.toBlob(fs=>{fs&&F(fs)},"image/jpeg",R)},se.src=URL.createObjectURL(b)}),is=async b=>{var z;const j=(z=b.target.files)==null?void 0:z[0];if(!(!j||!s))try{if(J(!0),v(""),console.log("ÔøΩ SUBIENDO LOGO:",j.name),!j.type.startsWith("image/")){v("Solo im√°genes permitidas");return}const R=await Ge(j,400,400,.9),F=`${s.id}/logo-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-logos...");const{error:W}=await k.storage.from("business-logos").upload(F,R,{upsert:!0});if(W){console.error("‚ùå Error upload:",W),v(`Error subiendo: ${W.message}`);return}const{data:K}=k.storage.from("business-logos").getPublicUrl(F);console.log("üîó URL generada:",K.publicUrl);const{error:se}=await k.from("sellers").upsert({id:s.id,business_logo:K.publicUrl,business_name:A.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(se){console.error("‚ùå Error BD:",se),v(`Error guardando: ${se.message}`);return}console.log("‚úÖ LOGO GUARDADO EXITOSAMENTE"),ne(ie=>({...ie,business_logo:K.publicUrl})),I("‚úÖ Logo guardado correctamente"),setTimeout(()=>I(""),3e3)}catch(R){console.error("üí• ERROR COMPLETO:",R),v(`Error: ${R.message}`)}finally{J(!1)}},We=async b=>{var z;const j=(z=b.target.files)==null?void 0:z[0];if(!(!j||!s))try{if(J(!0),v(""),console.log("ÔøΩ SUBIENDO PORTADA:",j.name),!j.type.startsWith("image/")){v("Solo im√°genes permitidas");return}const R=await Ge(j,1200,400,.9),F=`${s.id}/cover-${Date.now()}.jpg`;console.log("üì§ Subiendo a business-covers...");const{error:W}=await k.storage.from("business-covers").upload(F,R,{upsert:!0});if(W){console.error("‚ùå Error upload:",W),v(`Error subiendo: ${W.message}`);return}const{data:K}=k.storage.from("business-covers").getPublicUrl(F);console.log("üîó URL generada:",K.publicUrl);const{error:se}=await k.from("sellers").upsert({id:s.id,cover_image_url:K.publicUrl,business_name:A.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(se){console.error("‚ùå Error BD:",se),v(`Error guardando: ${se.message}`);return}console.log("‚úÖ PORTADA GUARDADA EXITOSAMENTE"),ne(ie=>({...ie,cover_image_url:K.publicUrl})),I("‚úÖ Portada guardada correctamente"),setTimeout(()=>I(""),3e3)}catch(R){console.error("üí• ERROR COMPLETO:",R),v(`Error: ${R.message}`)}finally{J(!1)}},Te=async()=>{try{v(""),_(!1),u();const b=await l();ne(j=>({...j,latitude:b.latitude,longitude:b.longitude})),p(!0),g(`${b.latitude.toFixed(6)}, ${b.longitude.toFixed(6)}`),I(`üéØ ¬°Ubicaci√≥n GPS verificada exitosamente!
      
Ô∏è Ciudad: ${b.city}, ${b.state}
üìä Coordenadas: ${b.latitude.toFixed(6)}, ${b.longitude.toFixed(6)}
      
‚úÖ Los repartidores podr√°n encontrar tu negocio f√°cilmente.
üìù Ahora escribe la direcci√≥n de tu negocio en el campo correspondiente.

üîî No olvides guardar el perfil para mantener estos cambios.`)}catch(b){console.error("Error detecting location:",b),_(!0)}},Be=()=>{_(!1),u(),Te()},y=()=>{_(!1),u()},M=async()=>{const b=!A.is_open_now;try{const{error:j}=await k.from("sellers").update({is_open_now:b,updated_at:new Date().toISOString()}).eq("id",s==null?void 0:s.id);if(j)throw j;ne(z=>({...z,is_open_now:b})),I(b?"üü¢ ¬°Negocio ABIERTO! Ahora apareces en el listado de compradores":"üî¥ Negocio CERRADO. No aparecer√°s en el listado hasta que abras"),setTimeout(()=>I(""),4e3)}catch(j){console.error("Error updating business status:",j),v("Error al actualizar el estado del negocio")}};return d?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{className:"w-10 h-10 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Cargando tu perfil de negocio..."})]})}):!d&&L?e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:e.jsxs(U,{className:"text-center shadow-lg border-none",children:[e.jsxs(re,{children:[e.jsx(ee,{children:"¬°Bienvenido, Vendedor!"}),e.jsx("p",{className:"text-gray-600",children:"Parece que a√∫n no has configurado tu perfil. ¬°Es el primer paso para empezar a vender!"})]}),e.jsxs(V,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Crearemos un perfil b√°sico para ti. Podr√°s editar y completar toda la informaci√≥n m√°s adelante."}),e.jsxs(D,{onClick:Ve,disabled:w,size:"lg",className:"w-full sm:w-auto",children:[w?e.jsx(oe,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(be,{className:"w-5 h-5 mr-2"}),"Crear Mi Perfil Ahora"]})]})]})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil de Negocio"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestiona la informaci√≥n que ven tus clientes."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>T(!C),children:C?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(La,{className:"w-4 h-4 mr-2"})," Editar"]})}),C&&e.jsxs(D,{onClick:$e,disabled:w,children:[w?e.jsx(oe,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})]})]})}),c&&e.jsxs(xe,{variant:"destructive",className:"mb-6 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(ge,{className:"whitespace-pre-line",children:c})]}),P&&e.jsxs(xe,{className:"mb-6 border-green-200 bg-green-50 text-green-800 flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(ge,{className:"text-green-800 whitespace-pre-line",children:P})]}),!x&&e.jsxs(xe,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(As,{className:"h-4 w-4 text-blue-600"}),e.jsxs(ge,{className:"text-blue-800",children:[e.jsx("strong",{children:"Sistema GPS:"})," Funcionando con detecci√≥n b√°sica. Para direcciones m√°s detalladas, puedes configurar Google Maps API (opcional).",e.jsx("br",{}),e.jsx("small",{children:"Ver: /GOOGLE_MAPS_SETUP_OPCIONAL.md"})]})]}),e.jsxs(U,{className:"w-full overflow-hidden shadow-lg border-none",children:[e.jsxs("div",{className:"relative h-40 sm:h-56 bg-gradient-to-r from-blue-500 to-purple-600",children:[A.cover_image_url?e.jsx(ye,{src:A.cover_image_url,alt:"Portada del negocio",className:"w-full h-full object-cover",width:800,height:200}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto mb-2 opacity-70"}),e.jsx("p",{className:"text-sm opacity-90",children:"Imagen de portada"}),C&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Cualquier imagen se optimizar√° autom√°ticamente"})]})}),C&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var b;return(b=ue.current)==null?void 0:b.click()},children:[e.jsxs(D,{variant:"secondary",disabled:$,children:[$?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(Ce,{className:"w-4 h-4 mr-2"}),A.cover_image_url?"Cambiar Portada":"Agregar Portada"]}),e.jsx("input",{ref:ue,type:"file",accept:"image/*",className:"hidden",onChange:We})]})]}),e.jsx("div",{className:"relative px-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-16 sm:-mt-12",children:[e.jsxs("div",{className:"relative h-32 w-32 rounded-full border-4 border-white bg-gradient-to-br from-green-400 to-blue-500 shadow-md flex items-center justify-center",children:[A.business_logo?e.jsx(ye,{src:A.business_logo,alt:"Logo del negocio",className:"w-full h-full object-cover rounded-full"}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-1"}),C&&e.jsx("p",{className:"text-xs opacity-80",children:"Logo - Auto-optimizado"})]}),C&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var b;return(b=Z.current)==null?void 0:b.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white/90 rounded-full flex items-center justify-center",children:$?e.jsx(oe,{className:"w-5 h-5 animate-spin text-slate-800"}):e.jsx(Ce,{className:"w-5 h-5 text-slate-800"})}),e.jsx("input",{ref:Z,type:"file",accept:"image/*",className:"hidden",onChange:is})]})]}),e.jsxs("div",{className:"mt-4 sm:ml-6 text-center sm:text-left",children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:A.business_name}),(h==null?void 0:h.is_verified)&&e.jsx(Oa,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-gray-500",children:A.business_category})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-auto",children:e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium ${A.is_open_now?"bg-green-500 text-white":"bg-gray-400 text-white"}`,children:[e.jsx("span",{children:A.is_open_now?"Abierto":"Cerrado"}),e.jsx(Ts,{checked:A.is_open_now,onCheckedChange:M,className:"h-3 w-5 scale-75"})]})})]})}),e.jsx("div",{className:"px-6 mt-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 -mb-px overflow-x-auto",children:[e.jsx(os,{active:G==="info",onClick:()=>Q("info"),icon:bs,children:"Informaci√≥n"}),e.jsx(os,{active:G==="location",onClick:()=>Q("location"),icon:pe,children:"Ubicaci√≥n"}),e.jsx(os,{active:G==="delivery",onClick:()=>Q("delivery"),icon:ze,children:"Delivery"})]})}),e.jsxs(V,{className:"p-6",children:[G==="info"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-green-500"})," Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"business_name",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(be,{className:"w-4 h-4 text-green-500"}),"Nombre del Negocio"]}),e.jsx(X,{id:"business_name",value:A.business_name,onChange:b=>ne(j=>({...j,business_name:b.target.value})),disabled:!C,placeholder:"Mi Negocio",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs(Y,{htmlFor:"business_description",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(bs,{className:"w-4 h-4 text-purple-500"}),"Descripci√≥n (opcional)"]}),e.jsx(cs,{id:"business_description",value:A.business_description,onChange:b=>ne(j=>({...j,business_description:b.target.value})),disabled:!C,rows:3,placeholder:"Cu√©ntales a tus clientes sobre tu negocio...",className:"border-gray-200 focus:border-purple-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2 mb-4",children:[e.jsx(Je,{className:"w-5 h-5 text-blue-500"})," Contacto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Je,{className:"w-4 h-4 text-green-500"}),"Tel√©fono"]}),e.jsx(X,{id:"phone",value:A.phone,onChange:b=>ne(j=>({...j,phone:b.target.value})),disabled:!C,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ya,{className:"w-4 h-4 text-blue-500"}),"Email (opcional)"]}),e.jsx(X,{id:"email",type:"email",value:A.email,onChange:b=>ne(j=>({...j,email:b.target.value})),disabled:!C,placeholder:"contacto@negocio.com",className:"border-gray-200 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs(ee,{className:"flex items-center gap-2 mb-4",children:[e.jsx(js,{className:"w-5 h-5 text-purple-500"})," Redes Sociales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"whatsapp",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ha,{className:"w-4 h-4 text-green-500"})," WhatsApp"]}),e.jsx(X,{id:"whatsapp",value:A.social_media.whatsapp,onChange:b=>ne(j=>({...j,social_media:{...j.social_media,whatsapp:b.target.value}})),disabled:!C,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"facebook",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(nr,{className:"w-4 h-4 text-blue-600"})," Facebook"]}),e.jsx(X,{id:"facebook",value:A.social_media.facebook,onChange:b=>ne(j=>({...j,social_media:{...j.social_media,facebook:b.target.value}})),disabled:!C,placeholder:"@mi_negocio",className:"border-gray-200 focus:border-blue-500"})]})]}),C&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"+ M√°s redes sociales (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"instagram",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(dr,{className:"w-4 h-4 text-pink-500"})," Instagram"]}),e.jsx(X,{id:"instagram",value:A.social_media.instagram,onChange:b=>ne(j=>({...j,social_media:{...j.social_media,instagram:b.target.value}})),placeholder:"@mi_negocio",className:"border-gray-200 focus:border-pink-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"website",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(js,{className:"w-4 h-4 text-gray-500"})," Sitio Web"]}),e.jsx(X,{id:"website",value:A.social_media.website,onChange:b=>ne(j=>({...j,social_media:{...j.social_media,website:b.target.value}})),placeholder:"www.mi-negocio.com",className:"border-gray-200 focus:border-gray-500"})]})]})]})]})]}),G==="location"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Ubicaci√≥n del Negocio"}),a&&e.jsx(le,{className:"w-5 h-5 text-green-500"})]}),i&&m&&e.jsxs(xe,{variant:"destructive",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsxs(ge,{className:"flex flex-col gap-3",children:[e.jsx("span",{children:m}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{size:"sm",variant:"outline",onClick:Be,className:"bg-white hover:bg-gray-50",children:[e.jsx(Ra,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),e.jsxs(D,{size:"sm",variant:"ghost",onClick:y,className:"text-red-800 hover:bg-red-50",children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Cerrar"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Y,{htmlFor:"address",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(pe,{className:"w-4 h-4 text-red-500"}),"Direcci√≥n"]}),e.jsx(X,{id:"address",value:A.address,onChange:b=>ne(j=>({...j,address:b.target.value})),disabled:!C,placeholder:"Direcci√≥n de tu negocio",className:"border-gray-200 focus:border-red-500"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"GPS Autom√°tico"})]}),a&&e.jsx(le,{className:"w-5 h-5 text-green-500"})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-green-700 bg-green-100 p-3 rounded-md",children:["‚úÖ ",e.jsx("strong",{children:"Ubicaci√≥n verificada"}),e.jsx("br",{}),"üìç ",f]}),C&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{onClick:Te,disabled:r,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[r?e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(D,{onClick:()=>Sr(A.latitude,A.longitude),variant:"outline",size:"sm",disabled:!A.latitude||!A.longitude,children:[e.jsx(Xa,{className:"w-4 h-4 mr-2"}),"Ver Mapa"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Detecta tu ubicaci√≥n para que los repartidores te encuentren f√°cilmente"}),C&&e.jsxs(D,{onClick:Te,disabled:r,className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:[r?e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4 mr-2"}),r?"Detectando...":"Detectar Mi Ubicaci√≥n"]}),t==="denied"&&e.jsxs(xe,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(Le,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(ge,{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"GPS bloqueado."})," Haz clic en üîí en la barra del navegador para permitir ubicaci√≥n."]})]})]})]})]})]}),e.jsx("div",{children:e.jsx(_r,{weeklyHours:ke,updateWeeklyHours:_e,generateWeeklyHoursText:ts})})]}),G==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-orange-500"})," Configuraci√≥n de Delivery"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-500"}),e.jsx(Y,{htmlFor:"delivery_time",className:"text-sm font-medium",children:"Tiempo de Preparaci√≥n"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{id:"delivery_time",type:"number",value:A.delivery_time,onChange:b=>ne(j=>({...j,delivery_time:parseInt(b.target.value)||0})),disabled:!C,min:"5",max:"120",className:"border-gray-200 focus:border-orange-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-500"}),e.jsx(Y,{htmlFor:"delivery_radius",className:"text-sm font-medium",children:"Radio de Entrega"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{id:"delivery_radius",type:"number",value:A.delivery_radius,onChange:b=>ne(j=>({...j,delivery_radius:parseInt(b.target.value)||0})),disabled:!C,min:"1",max:"20",className:"border-gray-200 focus:border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"km"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"w-5 h-5 text-green-500"}),e.jsx(Y,{htmlFor:"minimum_order",className:"text-sm font-medium",children:"Pedido M√≠nimo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Q"}),e.jsx(X,{id:"minimum_order",type:"number",value:A.minimum_order,onChange:b=>ne(j=>({...j,minimum_order:parseInt(b.target.value)||0})),disabled:!C,min:"0",className:"border-gray-200 focus:border-green-500"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-lg",children:"üí° Estos valores ayudan a los clientes a saber qu√© esperar de tu servicio"})]})]})]})]})})}async function Er(s){try{const{data:{user:l}}=await k.auth.getUser();if(!l)throw new Error("Usuario no autenticado");console.log(`üöÄ Intentando aceptar orden ${s}...`);const{data:r,error:m}=await k.rpc("seller_accept_order",{p_order_id:s,p_seller_id:l.id});return m?(console.error("‚ùå Error:",m),{success:!1,error:m.message}):(console.log("‚úÖ Resultado:",r),{success:!0,data:r})}catch(l){return console.error("üí• Error:",l),{success:!1,error:l instanceof Error?l.message:"Error desconocido"}}}const kr={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-purple-100 text-purple-800",assigned:"bg-indigo-100 text-indigo-800",picked_up:"bg-green-100 text-green-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},ws={pending:"Pendiente",accepted:"Aceptado",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",assigned:"Asignado",picked_up:"Recogido",in_transit:"En camino",delivered:"Entregado",completed:"Completado",cancelled:"Cancelado",rejected:"Rechazado"};function _s(){const{user:s}=de(),[l,r]=o.useState([]),[m,t]=o.useState(!0),[u,h]=o.useState(!1),[n,d]=o.useState(new Set),[S,w]=o.useState("pending");o.useEffect(()=>{s!=null&&s.id&&(c(),E())},[s==null?void 0:s.id]);const E=()=>{if(!(s!=null&&s.id))return;const a=k.channel("seller-orders-management").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},()=>{c()}).subscribe();return()=>{a.unsubscribe()}},c=async()=>{r([]);try{const{data:a,error:p}=await k.from("orders").select(`
          *,
          order_items (
            id,
            product_name,
            quantity,
            unit_price,
            product_image,
            notes
          ),
          users!orders_buyer_id_fkey (
            name,
            phone
          ),
          drivers:users!orders_driver_id_fkey (
            name
          )
        `).eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(p)throw p;console.log("üìä √ìrdenes cargadas:",(a==null?void 0:a.length)||0),console.log("üìã Datos de √≥rdenes:",a);const f=(a==null?void 0:a.map(g=>{var x,N,i;return console.log(`üîç Orden ${g.order_number}:`,{id:g.id,status:g.status,delivery_type:g.delivery_type,buyer_id:g.buyer_id}),{...g,buyer_id:g.buyer_id,buyer_name:((x=g.users)==null?void 0:x.name)||"Cliente",buyer_phone:(N=g.users)==null?void 0:N.phone,driver_name:(i=g.drivers)==null?void 0:i.name,items:g.order_items||[]}}))||[];r(f)}catch(a){console.error("Error loading orders:",a),B.error("Error al cargar las √≥rdenes")}finally{t(!1),h(!1)}},v=()=>{h(!0),c()},P=async a=>{console.log(`üß™ Probando aceptar orden directa: ${a}`);const p=await Er(a);console.log("üìä Resultado:",p),p.success?(B.success("Orden aceptada exitosamente!"),c()):B.error(`Error: ${p.error}`)},I=async a=>{if(!n.has(a)){d(p=>new Set([...p,a]));try{console.log(`üéØ Marcando orden como lista: ${a}`);let p,f;try{console.log("üîÑ Intento 1: seller_mark_ready_improved");const g=await k.rpc("seller_mark_ready_improved",{p_order_id:a,p_seller_id:s==null?void 0:s.id});p=g.data,f=g.error,!f&&p&&console.log("‚úÖ √âxito con funci√≥n mejorada")}catch{console.log("‚ö†Ô∏è Funci√≥n mejorada fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_ready_safe");const x=await k.rpc("seller_mark_ready_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});p=x.data,f=x.error,!f&&p&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_ready_basic");const N=await k.rpc("seller_mark_ready_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});p=N.data,f=N.error,!f&&p&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(N){throw console.error("üí• Todos los m√©todos fallaron:",N),new Error("No se pudo marcar la orden como lista")}}}if(f){console.error("‚ùå Error RPC:",f),B.error(`Error: ${f.message}`);return}if(console.log("‚úÖ Resultado final:",p),p&&p.length>0){const g=p[0];g.success?(B.success(g.message),c()):B.error(g.message)}else B.success("Orden marcada como lista"),c()}catch(p){console.error("üí• Error en handleMarcarListo:",p),B.error("Error al marcar orden como lista")}finally{d(p=>{const f=new Set(p);return f.delete(a),f})}}},C=async a=>{if(!n.has(a)){d(p=>new Set([...p,a]));try{console.log(`üì¶ Completando orden pickup/dine-in: ${a}`);let p,f;try{console.log("üîÑ Intento 1: seller_mark_completed_pickup");const g=await k.rpc("seller_mark_completed_pickup",{p_order_id:a,p_seller_id:s==null?void 0:s.id});p=g.data,f=g.error,!f&&p&&console.log("‚úÖ √âxito con funci√≥n completa")}catch{console.log("‚ö†Ô∏è Funci√≥n completa fall√≥, probando segura...");try{console.log("üîÑ Intento 2: seller_mark_completed_pickup_safe");const x=await k.rpc("seller_mark_completed_pickup_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});p=x.data,f=x.error,!f&&p&&console.log("‚úÖ √âxito con funci√≥n segura")}catch{console.log("‚ö†Ô∏è Funci√≥n segura fall√≥, probando b√°sica...");try{console.log("üîÑ Intento 3: seller_mark_completed_pickup_basic");const N=await k.rpc("seller_mark_completed_pickup_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});p=N.data,f=N.error,!f&&p&&console.log("‚úÖ √âxito con funci√≥n b√°sica")}catch(N){throw console.error("üí• Todos los m√©todos fallaron:",N),new Error("No se pudo completar la orden pickup/dine-in")}}}if(f){console.error("‚ùå Error RPC:",f),B.error(`Error: ${f.message}`);return}if(console.log("‚úÖ Resultado final:",p),p&&p.length>0){const g=p[0];g.success?(B.success(g.message),c()):B.error(g.message)}else B.success("Orden completada exitosamente"),c()}catch(p){console.error("üí• Error en handleCompletarPickup:",p),B.error("Error al completar la orden")}finally{d(p=>{const f=new Set(p);return f.delete(a),f})}}},T=async(a,p)=>{var x,N;if(n.has(a))return;const g={confirmed:"accepted",preparing:"ready",ready:"ready",delivered:"delivered",cancelled:"cancelled"}[p];d(i=>new Set([...i,a]));try{let i;if(g==="accepted"&&(i=await k.rpc("seller_accept_order",{p_order_id:a,p_seller_id:s==null?void 0:s.id})),i&&(i.error||i.data&&i.data[0]&&!i.data[0].success)){const L=((x=i.error)==null?void 0:x.message)||((N=i.data[0])==null?void 0:N.message)||"Error al actualizar el estado";console.error("RPC error:",L),B.error(L),d(O=>{const G=new Set(O);return G.delete(a),G});return}const _=l.find(L=>L.id===a);if(_&&g==="accepted"){await k.from("notifications").insert({user_id:_.buyer_id,order_id:_.id,message:`Tu orden #${_.order_number} ha sido aceptada.`,type:"order_accepted"}),console.log("üîÑ Orden aceptada, actualizando stock...");const{data:L,error:O}=await k.from("order_items").select("product_id, daily_product_id, quantity, product_name, product_type").eq("order_id",a);if(O)console.error("‚ùå Error obteniendo items de la orden:",O),B.error("Orden aceptada pero error al actualizar stock");else if(L&&L.length>0){console.log("üì¶ Items encontrados:",L.length),L.forEach((Q,Z)=>{console.log(`   ${Z+1}. ${Q.product_name} - Cantidad: ${Q.quantity} - Tipo: ${Q.product_type}`)}),console.log("üöÄ Llamando updateProductStock...");const G=await Ma(L,a);console.log("üìä Resultado del stock manager:",G),G.success?(console.log("‚úÖ Stock actualizado exitosamente:",G.updatedProducts),B.success("Orden aceptada y stock actualizado")):(console.error("‚ùå Error actualizando stock:",G.message),B.error(`Orden aceptada pero ${G.message}`))}else console.log("‚ö†Ô∏è No se encontraron items en la orden"),B.success("Orden aceptada (sin items para actualizar stock)")}B.success(`Orden actualizada a ${ws[g]||g}.`),c(),d(L=>{const O=new Set(L);return O.delete(a),O})}catch(i){console.error("Error updating order status:",i),B.error("Error al actualizar el estado de la orden")}finally{d(i=>{const _=new Set(i);return _.delete(a),_})}},$=async(a,p)=>{if(!n.has(a)){d(f=>new Set([...f,a]));try{const{error:f}=await k.from("orders").update({status:"rejected",rejection_reason:p,updated_at:new Date().toISOString()}).eq("id",a);if(f)throw f;const g=l.find(x=>x.id===a);g&&await k.from("notifications").insert({user_id:g.buyer_id,order_id:g.id,message:`Tu orden #${g.order_number} fue rechazada.`,type:"order_rejected"}),B.success("Orden rechazada"),c()}catch(f){console.error("Error rejecting order:",f),B.error("Error al rechazar la orden")}finally{d(f=>{const g=new Set(f);return g.delete(a),g})}}},J=a=>{try{return new Date(a).toLocaleString("es-GT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha inv√°lida"}},q=a=>a==="active"?l.filter(p=>["accepted","ready","assigned","picked_up","in_transit"].includes(p.status)):a==="completed"?l.filter(p=>["delivered","completed"].includes(p.status)):a==="cancelled"?l.filter(p=>["cancelled","rejected"].includes(p.status)):l.filter(p=>p.status===a),H=a=>{const p=n.has(a.id);return console.log(`üé® Renderizando orden ${a.order_number}:`,{id:a.id,status:a.status,delivery_type:a.delivery_type,buyer_id:a.buyer_id,isProcessing:p,orderObject:a}),console.log(`‚ùì Status actual: "${a.status}" (tipo: ${typeof a.status})`),console.log(`‚ùì Delivery type actual: "${a.delivery_type}" (tipo: ${typeof a.delivery_type})`),console.log(`‚ùì ¬øStatus === 'pending'? ${a.status==="pending"}`),console.log(`‚ùì ¬øDelivery type === 'delivery'? ${a.delivery_type==="delivery"}`),console.log(`‚ùì ¬øStatus incluye pending? ${String(a.status).includes("pending")}`),console.log(`‚ùì ¬øDelivery incluye delivery? ${String(a.delivery_type).includes("delivery")}`),e.jsxs(U,{className:"border-l-4 border-l-orange-500",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"text-lg",children:["Orden #",a.order_number]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:J(a.created_at)})]}),e.jsx(te,{className:kr[a.status],children:ws[a.status]})]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.buyer_name}),a.buyer_phone&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 text-gray-500 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.buyer_phone})]})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"?"bg-blue-50 border-blue-300":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"bg-green-50 border-green-300":"bg-blue-50 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?e.jsx(ze,{className:"w-8 h-8 text-blue-600"}):String(a.delivery_type||"").trim().toLowerCase()==="pickup"?e.jsx(fe,{className:"w-8 h-8 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-xl font-bold ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"text-blue-800":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"text-green-800":"text-orange-800"}`,children:String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"SERVICIO A DOMICILIO":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"RECOGER EN TIENDA":"COMER EN EL LUGAR"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["M√©todo de entrega: ",a.delivery_type||"No especificado"]})]})]})}),a.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[e.jsx(pe,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.delivery_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Productos:"}),a.items.map((f,g)=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsxs("span",{children:[f.quantity,"x ",f.product_name]}),e.jsxs("span",{className:"font-medium",children:["Q",(f.quantity*f.unit_price).toFixed(2)]})]},g))]}),a.notes&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ur,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Notas:"}),e.jsx("p",{className:"text-sm text-blue-700",children:a.notes})]})]})}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["Q",a.total.toFixed(2)]})]}),a.delivery_fee>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Incluye Q",a.delivery_fee.toFixed(2)," de entrega"]})]}),a.driver_name&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Repartidor: ",a.driver_name]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[String(a.status).trim().toLowerCase()==="pending"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{onClick:()=>P(a.id),disabled:n.has(a.id),className:"flex-1 bg-green-600 hover:bg-green-700",children:[n.has(a.id)?e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(le,{className:"w-4 h-4 mr-2"}),"Aceptar Orden"]}),e.jsxs(D,{onClick:()=>$(a.id,"No disponible"),disabled:n.has(a.id),variant:"destructive",size:"lg",className:"px-6 bg-red-600 hover:bg-red-700 text-white border-red-600",style:{backgroundColor:"#dc2626",borderColor:"#dc2626"},children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})}),a.status==="accepted"&&e.jsxs(D,{onClick:()=>I(a.id),disabled:n.has(a.id),className:"w-full bg-purple-600 hover:bg-purple-700",children:[n.has(a.id)?e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(le,{className:"w-4 h-4 mr-2"}),"Marcar Orden Lista"]}),a.status==="ready"&&e.jsxs("div",{className:"space-y-3",children:[(a.delivery_type==="delivery"||!a.delivery_type)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Orden lista para recoger"}),e.jsx("p",{className:"text-sm text-blue-600",children:"El repartidor recoger√° y entregar√° esta orden"})]})]})}),(a.delivery_type==="pickup"||a.delivery_type==="dine-in")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${a.delivery_type==="pickup"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.delivery_type==="pickup"?e.jsx(fe,{className:"w-6 h-6 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.delivery_type==="pickup"?"text-green-800":"text-orange-800"}`,children:a.delivery_type==="pickup"?"Cliente debe recoger en tienda":"Cliente consume en el lugar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Marcar como entregado cuando el cliente complete la orden"})]})]})}),e.jsxs(D,{onClick:()=>C(a.id),disabled:n.has(a.id),className:"w-full bg-green-600 hover:bg-green-700",children:[n.has(a.id)?e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(le,{className:"w-4 h-4 mr-2"}),a.delivery_type==="pickup"?"Marcar como Recogido":"Marcar como Servido"]})]})]}),a.status==="delivered"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{onClick:()=>T(a.id,"confirmed"),disabled:p,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[p?e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(le,{className:"w-4 h-4 mr-2"}),"Re-procesar"]}),e.jsxs(D,{onClick:()=>$(a.id,"Orden rechazada"),disabled:p,variant:"destructive",size:"lg",className:"px-6",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})]})]})]},a.id)};return m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{className:"border-orange-200 shadow-lg",children:e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-500"}),"Gesti√≥n de √ìrdenes"]}),e.jsxs(D,{variant:"outline",onClick:v,disabled:u,size:"sm",children:[u?e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})})}),e.jsxs(Ye,{value:S,onValueChange:w,children:[e.jsxs(Xe,{className:"grid w-full grid-cols-4",children:[e.jsxs(he,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Pendientes",q("pending").length>0&&e.jsx(te,{variant:"destructive",className:"ml-1 px-1.5 py-0.5 text-xs",children:q("pending").length})]}),e.jsxs(he,{value:"active",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Activas",q("active").length>0&&e.jsx(te,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:q("active").length})]}),e.jsxs(he,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Completadas"]}),e.jsxs(he,{value:"cancelled",className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Canceladas"]})]}),e.jsx(ce,{value:"pending",className:"space-y-4",children:q("pending").length===0?e.jsx(U,{children:e.jsxs(V,{className:"text-center py-8",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes pendientes"})]})}):q("pending").map(H)}),e.jsx(ce,{value:"active",className:"space-y-4",children:q("active").length===0?e.jsx(U,{children:e.jsxs(V,{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes activas"})]})}):q("active").map(H)}),e.jsx(ce,{value:"completed",className:"space-y-4",children:q("completed").length===0?e.jsx(U,{children:e.jsxs(V,{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes completadas"})]})}):q("completed").map(H)}),e.jsx(ce,{value:"cancelled",className:"space-y-4",children:q("cancelled").length===0?e.jsx(U,{children:e.jsxs(V,{className:"text-center py-8",children:[e.jsx(De,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay √≥rdenes canceladas"})]})}):q("cancelled").map(H)})]})]})}function Pr(s,l){return o.useReducer((r,m)=>l[r][m]??r,s)}var gs="ScrollArea",[aa,Tt]=fa(gs),[Tr,me]=aa(gs),ra=o.forwardRef((s,l)=>{const{__scopeScrollArea:r,type:m="hover",dir:t,scrollHideDelay:u=600,...h}=s,[n,d]=o.useState(null),[S,w]=o.useState(null),[E,c]=o.useState(null),[v,P]=o.useState(null),[I,C]=o.useState(null),[T,$]=o.useState(0),[J,q]=o.useState(0),[H,a]=o.useState(!1),[p,f]=o.useState(!1),g=Re(l,N=>d(N)),x=pa(t);return e.jsx(Tr,{scope:r,type:m,dir:x,scrollHideDelay:u,scrollArea:n,viewport:S,onViewportChange:w,content:E,onContentChange:c,scrollbarX:v,onScrollbarXChange:P,scrollbarXEnabled:H,onScrollbarXEnabledChange:a,scrollbarY:I,onScrollbarYChange:C,scrollbarYEnabled:p,onScrollbarYEnabledChange:f,onCornerWidthChange:$,onCornerHeightChange:q,children:e.jsx(Fe.div,{dir:x,...h,ref:g,style:{position:"relative","--radix-scroll-area-corner-width":T+"px","--radix-scroll-area-corner-height":J+"px",...s.style}})})});ra.displayName=gs;var ta="ScrollAreaViewport",ia=o.forwardRef((s,l)=>{const{__scopeScrollArea:r,children:m,nonce:t,...u}=s,h=me(ta,r),n=o.useRef(null),d=Re(l,n,h.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:t}),e.jsx(Fe.div,{"data-radix-scroll-area-viewport":"",...u,ref:d,style:{overflowX:h.scrollbarXEnabled?"scroll":"hidden",overflowY:h.scrollbarYEnabled?"scroll":"hidden",...s.style},children:e.jsx("div",{ref:h.onContentChange,style:{minWidth:"100%",display:"table"},children:m})})]})});ia.displayName=ta;var je="ScrollAreaScrollbar",na=o.forwardRef((s,l)=>{const{forceMount:r,...m}=s,t=me(je,s.__scopeScrollArea),{onScrollbarXEnabledChange:u,onScrollbarYEnabledChange:h}=t,n=s.orientation==="horizontal";return o.useEffect(()=>(n?u(!0):h(!0),()=>{n?u(!1):h(!1)}),[n,u,h]),t.type==="hover"?e.jsx(Ar,{...m,ref:l,forceMount:r}):t.type==="scroll"?e.jsx(Dr,{...m,ref:l,forceMount:r}):t.type==="auto"?e.jsx(oa,{...m,ref:l,forceMount:r}):t.type==="always"?e.jsx(hs,{...m,ref:l}):null});na.displayName=je;var Ar=o.forwardRef((s,l)=>{const{forceMount:r,...m}=s,t=me(je,s.__scopeScrollArea),[u,h]=o.useState(!1);return o.useEffect(()=>{const n=t.scrollArea;let d=0;if(n){const S=()=>{window.clearTimeout(d),h(!0)},w=()=>{d=window.setTimeout(()=>h(!1),t.scrollHideDelay)};return n.addEventListener("pointerenter",S),n.addEventListener("pointerleave",w),()=>{window.clearTimeout(d),n.removeEventListener("pointerenter",S),n.removeEventListener("pointerleave",w)}}},[t.scrollArea,t.scrollHideDelay]),e.jsx(es,{present:r||u,children:e.jsx(oa,{"data-state":u?"visible":"hidden",...m,ref:l})})}),Dr=o.forwardRef((s,l)=>{const{forceMount:r,...m}=s,t=me(je,s.__scopeScrollArea),u=s.orientation==="horizontal",h=rs(()=>d("SCROLL_END"),100),[n,d]=Pr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return o.useEffect(()=>{if(n==="idle"){const S=window.setTimeout(()=>d("HIDE"),t.scrollHideDelay);return()=>window.clearTimeout(S)}},[n,t.scrollHideDelay,d]),o.useEffect(()=>{const S=t.viewport,w=u?"scrollLeft":"scrollTop";if(S){let E=S[w];const c=()=>{const v=S[w];E!==v&&(d("SCROLL"),h()),E=v};return S.addEventListener("scroll",c),()=>S.removeEventListener("scroll",c)}},[t.viewport,u,d,h]),e.jsx(es,{present:r||n!=="hidden",children:e.jsx(hs,{"data-state":n==="hidden"?"hidden":"visible",...m,ref:l,onPointerEnter:Ee(s.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:Ee(s.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),oa=o.forwardRef((s,l)=>{const r=me(je,s.__scopeScrollArea),{forceMount:m,...t}=s,[u,h]=o.useState(!1),n=s.orientation==="horizontal",d=rs(()=>{if(r.viewport){const S=r.viewport.offsetWidth<r.viewport.scrollWidth,w=r.viewport.offsetHeight<r.viewport.scrollHeight;h(n?S:w)}},10);return Oe(r.viewport,d),Oe(r.content,d),e.jsx(es,{present:m||u,children:e.jsx(hs,{"data-state":u?"visible":"hidden",...t,ref:l})})}),hs=o.forwardRef((s,l)=>{const{orientation:r="vertical",...m}=s,t=me(je,s.__scopeScrollArea),u=o.useRef(null),h=o.useRef(0),[n,d]=o.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),S=ua(n.viewport,n.content),w={...m,sizes:n,onSizesChange:d,hasThumb:S>0&&S<1,onThumbChange:c=>u.current=c,onThumbPointerUp:()=>h.current=0,onThumbPointerDown:c=>h.current=c};function E(c,v){return $r(c,h.current,n,v)}return r==="horizontal"?e.jsx(Ir,{...w,ref:l,onThumbPositionChange:()=>{if(t.viewport&&u.current){const c=t.viewport.scrollLeft,v=Ss(c,n,t.dir);u.current.style.transform=`translate3d(${v}px, 0, 0)`}},onWheelScroll:c=>{t.viewport&&(t.viewport.scrollLeft=c)},onDragScroll:c=>{t.viewport&&(t.viewport.scrollLeft=E(c,t.dir))}}):r==="vertical"?e.jsx(Lr,{...w,ref:l,onThumbPositionChange:()=>{if(t.viewport&&u.current){const c=t.viewport.scrollTop,v=Ss(c,n);u.current.style.transform=`translate3d(0, ${v}px, 0)`}},onWheelScroll:c=>{t.viewport&&(t.viewport.scrollTop=c)},onDragScroll:c=>{t.viewport&&(t.viewport.scrollTop=E(c))}}):null}),Ir=o.forwardRef((s,l)=>{const{sizes:r,onSizesChange:m,...t}=s,u=me(je,s.__scopeScrollArea),[h,n]=o.useState(),d=o.useRef(null),S=Re(l,d,u.onScrollbarXChange);return o.useEffect(()=>{d.current&&n(getComputedStyle(d.current))},[d]),e.jsx(ca,{"data-orientation":"horizontal",...t,ref:S,sizes:r,style:{bottom:0,left:u.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:u.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":as(r)+"px",...s.style},onThumbPointerDown:w=>s.onThumbPointerDown(w.x),onDragScroll:w=>s.onDragScroll(w.x),onWheelScroll:(w,E)=>{if(u.viewport){const c=u.viewport.scrollLeft+w.deltaX;s.onWheelScroll(c),ga(c,E)&&w.preventDefault()}},onResize:()=>{d.current&&u.viewport&&h&&m({content:u.viewport.scrollWidth,viewport:u.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:Ke(h.paddingLeft),paddingEnd:Ke(h.paddingRight)}})}})}),Lr=o.forwardRef((s,l)=>{const{sizes:r,onSizesChange:m,...t}=s,u=me(je,s.__scopeScrollArea),[h,n]=o.useState(),d=o.useRef(null),S=Re(l,d,u.onScrollbarYChange);return o.useEffect(()=>{d.current&&n(getComputedStyle(d.current))},[d]),e.jsx(ca,{"data-orientation":"vertical",...t,ref:S,sizes:r,style:{top:0,right:u.dir==="ltr"?0:void 0,left:u.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":as(r)+"px",...s.style},onThumbPointerDown:w=>s.onThumbPointerDown(w.y),onDragScroll:w=>s.onDragScroll(w.y),onWheelScroll:(w,E)=>{if(u.viewport){const c=u.viewport.scrollTop+w.deltaY;s.onWheelScroll(c),ga(c,E)&&w.preventDefault()}},onResize:()=>{d.current&&u.viewport&&h&&m({content:u.viewport.scrollHeight,viewport:u.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:Ke(h.paddingTop),paddingEnd:Ke(h.paddingBottom)}})}})}),[Or,la]=aa(je),ca=o.forwardRef((s,l)=>{const{__scopeScrollArea:r,sizes:m,hasThumb:t,onThumbChange:u,onThumbPointerUp:h,onThumbPointerDown:n,onThumbPositionChange:d,onDragScroll:S,onWheelScroll:w,onResize:E,...c}=s,v=me(je,r),[P,I]=o.useState(null),C=Re(l,g=>I(g)),T=o.useRef(null),$=o.useRef(""),J=v.viewport,q=m.content-m.viewport,H=Se(w),a=Se(d),p=rs(E,10);function f(g){if(T.current){const x=g.clientX-T.current.left,N=g.clientY-T.current.top;S({x,y:N})}}return o.useEffect(()=>{const g=x=>{const N=x.target;(P==null?void 0:P.contains(N))&&H(x,q)};return document.addEventListener("wheel",g,{passive:!1}),()=>document.removeEventListener("wheel",g,{passive:!1})},[J,P,q,H]),o.useEffect(a,[m,a]),Oe(P,p),Oe(v.content,p),e.jsx(Or,{scope:r,scrollbar:P,hasThumb:t,onThumbChange:Se(u),onThumbPointerUp:Se(h),onThumbPositionChange:a,onThumbPointerDown:Se(n),children:e.jsx(Fe.div,{...c,ref:C,style:{position:"absolute",...c.style},onPointerDown:Ee(s.onPointerDown,g=>{g.button===0&&(g.target.setPointerCapture(g.pointerId),T.current=P.getBoundingClientRect(),$.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",v.viewport&&(v.viewport.style.scrollBehavior="auto"),f(g))}),onPointerMove:Ee(s.onPointerMove,f),onPointerUp:Ee(s.onPointerUp,g=>{const x=g.target;x.hasPointerCapture(g.pointerId)&&x.releasePointerCapture(g.pointerId),document.body.style.webkitUserSelect=$.current,v.viewport&&(v.viewport.style.scrollBehavior=""),T.current=null})})})}),Ze="ScrollAreaThumb",da=o.forwardRef((s,l)=>{const{forceMount:r,...m}=s,t=la(Ze,s.__scopeScrollArea);return e.jsx(es,{present:r||t.hasThumb,children:e.jsx(Rr,{ref:l,...m})})}),Rr=o.forwardRef((s,l)=>{const{__scopeScrollArea:r,style:m,...t}=s,u=me(Ze,r),h=la(Ze,r),{onThumbPositionChange:n}=h,d=Re(l,E=>h.onThumbChange(E)),S=o.useRef(void 0),w=rs(()=>{S.current&&(S.current(),S.current=void 0)},100);return o.useEffect(()=>{const E=u.viewport;if(E){const c=()=>{if(w(),!S.current){const v=qr(E,n);S.current=v,n()}};return n(),E.addEventListener("scroll",c),()=>E.removeEventListener("scroll",c)}},[u.viewport,w,n]),e.jsx(Fe.div,{"data-state":h.hasThumb?"visible":"hidden",...t,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...m},onPointerDownCapture:Ee(s.onPointerDownCapture,E=>{const v=E.target.getBoundingClientRect(),P=E.clientX-v.left,I=E.clientY-v.top;h.onThumbPointerDown({x:P,y:I})}),onPointerUp:Ee(s.onPointerUp,h.onThumbPointerUp)})});da.displayName=Ze;var ps="ScrollAreaCorner",ma=o.forwardRef((s,l)=>{const r=me(ps,s.__scopeScrollArea),m=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&m?e.jsx(Mr,{...s,ref:l}):null});ma.displayName=ps;var Mr=o.forwardRef((s,l)=>{const{__scopeScrollArea:r,...m}=s,t=me(ps,r),[u,h]=o.useState(0),[n,d]=o.useState(0),S=!!(u&&n);return Oe(t.scrollbarX,()=>{var E;const w=((E=t.scrollbarX)==null?void 0:E.offsetHeight)||0;t.onCornerHeightChange(w),d(w)}),Oe(t.scrollbarY,()=>{var E;const w=((E=t.scrollbarY)==null?void 0:E.offsetWidth)||0;t.onCornerWidthChange(w),h(w)}),S?e.jsx(Fe.div,{...m,ref:l,style:{width:u,height:n,position:"absolute",right:t.dir==="ltr"?0:void 0,left:t.dir==="rtl"?0:void 0,bottom:0,...s.style}}):null});function Ke(s){return s?parseInt(s,10):0}function ua(s,l){const r=s/l;return isNaN(r)?0:r}function as(s){const l=ua(s.viewport,s.content),r=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,m=(s.scrollbar.size-r)*l;return Math.max(m,18)}function $r(s,l,r,m="ltr"){const t=as(r),u=t/2,h=l||u,n=t-h,d=r.scrollbar.paddingStart+h,S=r.scrollbar.size-r.scrollbar.paddingEnd-n,w=r.content-r.viewport,E=m==="ltr"?[0,w]:[w*-1,0];return xa([d,S],E)(s)}function Ss(s,l,r="ltr"){const m=as(l),t=l.scrollbar.paddingStart+l.scrollbar.paddingEnd,u=l.scrollbar.size-t,h=l.content-l.viewport,n=u-m,d=r==="ltr"?[0,h]:[h*-1,0],S=ja(s,d);return xa([0,h],[0,n])(S)}function xa(s,l){return r=>{if(s[0]===s[1]||l[0]===l[1])return l[0];const m=(l[1]-l[0])/(s[1]-s[0]);return l[0]+m*(r-s[0])}}function ga(s,l){return s>0&&s<l}var qr=(s,l=()=>{})=>{let r={left:s.scrollLeft,top:s.scrollTop},m=0;return function t(){const u={left:s.scrollLeft,top:s.scrollTop},h=r.left!==u.left,n=r.top!==u.top;(h||n)&&l(),r=u,m=window.requestAnimationFrame(t)}(),()=>window.cancelAnimationFrame(m)};function rs(s,l){const r=Se(s),m=o.useRef(0);return o.useEffect(()=>()=>window.clearTimeout(m.current),[]),o.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(r,l)},[r,l])}function Oe(s,l){const r=Se(l);ba(()=>{let m=0;if(s){const t=new ResizeObserver(()=>{cancelAnimationFrame(m),m=window.requestAnimationFrame(r)});return t.observe(s),()=>{window.cancelAnimationFrame(m),t.unobserve(s)}}},[s,r])}var zr=ra,Fr=ia,Ur=ma;function Vr({className:s,children:l,...r}){return e.jsxs(zr,{"data-slot":"scroll-area",className:Ds("relative",s),...r,children:[e.jsx(Fr,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:l}),e.jsx(Gr,{}),e.jsx(Ur,{})]})}function Gr({className:s,orientation:l="vertical",...r}){return e.jsx(na,{"data-slot":"scroll-area-scrollbar",orientation:l,className:Ds("flex touch-none p-px transition-colors select-none",l==="vertical"&&"h-full w-2.5 border-l border-l-transparent",l==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...r,children:e.jsx(da,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function Wr({onClose:s,onProceedToCheckout:l}){const{user:r}=de(),{items:m,updateCartItem:t,removeFromCart:u,clearCart:h,getCartTotal:n,getCartItemCount:d}=Is(),[S,w]=o.useState(!1),[E,c]=o.useState(!1),[v,P]=o.useState(!1),[I,C]=o.useState(null),[T,$]=o.useState(""),J=n(),q=m.reduce((i,_)=>{var O,G;const L=((O=_.product)==null?void 0:O.seller_id)||"unknown";return i[L]||(i[L]={seller:(G=_.product)==null?void 0:G.seller,items:[]}),i[L].items.push(_),i},{}),H=Object.keys(q),a=H.length>1,p=async(i,_)=>{const L=m.find(O=>O.product_id===i);L&&(_===0?await u(L.id):await t(L.id,_))},f=(i,_)=>{C(i),$(_.toString())},g=i=>{const _=parseInt(i);(i===""||!isNaN(_)&&_>=0&&_<=999)&&$(i)},x=async i=>{const _=parseInt(T);!isNaN(_)&&_>=0&&await p(i,_),C(null),$("")},N=async(i,_)=>{i.key==="Enter"?await x(_):i.key==="Escape"&&(C(null),$(""))};return m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsx(us,{className:"w-24 h-24 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Tu carrito est√° vac√≠o"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Agrega productos para comenzar tu pedido"}),e.jsx(D,{onClick:s,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:"Explorar productos"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Vr,{className:"flex-1 mobile-scroll",children:e.jsxs("div",{className:"mobile-space-y pb-24",children:[a&&e.jsx(U,{className:"mobile-card border-red-200 bg-red-50",children:e.jsx(V,{className:"mobile-card-content",children:e.jsxs("div",{className:"flex items-start gap-3 text-red-700",children:[e.jsx(we,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"mobile-text font-medium block mb-1",children:"Solo un vendedor por pedido"}),e.jsxs("p",{className:"mobile-text-small text-red-600",children:["Actualmente tienes productos de ",H.length," vendedores. Debes ordenar de un solo vendedor a la vez."]})]})]})})}),e.jsx("div",{className:"mobile-space-y",children:Object.entries(q).map(([i,{seller:_,items:L}])=>e.jsxs(U,{className:"mobile-card border-orange-200",children:[e.jsx(re,{className:"mobile-card-header",children:e.jsxs(ee,{className:"mobile-heading-3 flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-orange-500 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:(_==null?void 0:_.business_name)||"Vendedor"})]})}),e.jsx(V,{className:"mobile-card-content space-y-3",children:L.map(O=>{var G,Q,Z,ue,ke,Pe;return e.jsx("div",{className:"mobile-product-card border border-gray-200",children:e.jsxs("div",{className:"flex gap-3 p-3",children:[e.jsx(ye,{src:((G=O.product)==null?void 0:G.image_url)||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300&h=200&fit=crop",alt:((Q=O.product)==null?void 0:Q.name)||"Producto",className:"w-16 h-16 md:w-20 md:h-20 object-cover rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"mobile-product-title mb-1",children:(Z=O.product)==null?void 0:Z.name}),e.jsxs("p",{className:"mobile-product-price",children:["Q",(ke=(ue=O.product)==null?void 0:ue.price)==null?void 0:ke.toFixed(2)]}),e.jsx("p",{className:"mobile-text-small text-gray-500",children:(Pe=O.product)==null?void 0:Pe.category})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"mobile-quantity-controls",children:[e.jsx(D,{size:"sm",variant:"outline",onClick:()=>p(O.product_id,O.quantity-1),className:"mobile-quantity-button",children:e.jsx(Va,{className:"w-3 h-3"})}),I===O.id?e.jsx(X,{value:T,onChange:_e=>g(_e.target.value),onBlur:()=>x(O.product_id),onKeyDown:_e=>N(_e,O.product_id),className:"mobile-quantity-display w-12 h-8 text-center",autoFocus:!0}):e.jsx("span",{className:"mobile-quantity-display cursor-pointer hover:bg-gray-100",onClick:()=>f(O.id,O.quantity),title:"Toca para editar cantidad",children:O.quantity}),e.jsx(D,{size:"sm",variant:"outline",onClick:()=>p(O.product_id,O.quantity+1),className:"mobile-quantity-button",children:e.jsx(Ie,{className:"w-3 h-3"})})]}),e.jsx(D,{size:"sm",variant:"outline",onClick:()=>u(O.id),className:"mobile-button-sm text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(ds,{className:"w-3 h-3"})})]})]})},O.id)})})]},i))}),!a&&e.jsxs(U,{className:"mobile-card border-orange-200 bg-orange-50",children:[e.jsx(re,{className:"mobile-card-header",children:e.jsxs(ee,{className:"mobile-heading-3 flex items-center gap-2",children:[e.jsx($a,{className:"w-4 h-4"}),"Resumen del pedido"]})}),e.jsxs(V,{className:"mobile-card-content space-y-3",children:[e.jsxs("div",{className:"flex justify-between mobile-text",children:[e.jsxs("span",{children:["Subtotal (",d()," productos)"]}),e.jsxs("span",{className:"font-medium",children:["Q",J.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between mobile-text",children:[e.jsx("span",{children:"Entrega"}),e.jsx("span",{className:"font-medium text-green-600",children:"Gratis"})]}),e.jsx(va,{}),e.jsxs("div",{className:"flex justify-between mobile-heading-3 text-orange-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Q",J.toFixed(2)]})]})]})]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-white border-t p-4 mobile-safe-bottom",style:{paddingBottom:"max(16px, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"space-y-3",children:a?e.jsx(D,{onClick:()=>h(),variant:"outline",className:"mobile-button w-full border-red-200 text-red-600 hover:bg-red-50",children:"Limpiar carrito"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:l,disabled:S||m.length===0,className:"mobile-button-lg w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:S?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 animate-spin"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:["Proceder al Checkout",e.jsx(qa,{className:"w-4 h-4"})]})}),e.jsx("p",{className:"mobile-text-small text-gray-500 text-center",children:"Revisa tu pedido antes de confirmar"})]})})}),e.jsx(Ls,{open:E,onOpenChange:c,children:e.jsxs(Os,{className:"max-w-md",children:[e.jsxs(Rs,{children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mx-auto mb-4",children:e.jsx(le,{className:"w-8 h-8 text-green-600"})}),e.jsx(Ms,{className:"text-center",children:"¬°Pedido confirmado!"}),e.jsx(Na,{className:"text-center",children:"Tu pedido ha sido enviado al vendedor. Te notificaremos cuando sea aceptado."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total pagado:"}),e.jsxs("span",{className:"font-semibold",children:["Q",J.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Estado:"}),e.jsx("span",{className:"font-medium",children:"Pedido confirmado"})]})]})}),e.jsx(D,{onClick:()=>{c(!1),s()},className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:"Continuar comprando"})]})]})})]})}const Cs={name:"",description:"",price:"",image_url:"",stock_quantity:""};function Br({onProductCreated:s}){const{user:l}=de(),[r,m]=o.useState(Cs),[t,u]=o.useState(!1),[h,n]=o.useState(null),d=w=>{const{name:E,value:c}=w.target;m(v=>({...v,[E]:c}))},S=async w=>{w.preventDefault(),u(!0),n(null);try{const E=new Date,c=new Date(E.getFullYear(),E.getMonth(),E.getDate(),23,59,59,999);if(E.getHours()>=22&&c.setDate(c.getDate()+1),!(l!=null&&l.id))throw new Error("Usuario no autenticado");const{error:v}=await k.from("daily_products").insert({seller_id:l.id,name:r.name,description:r.description,price:parseFloat(r.price)||0,image_url:r.image_url,stock_quantity:Number(r.stock_quantity)||0,expires_at:c.toISOString(),is_available:!0});if(v)throw v;m(Cs),s&&s()}catch(E){E instanceof Error?n(E.message):n("Error desconocido")}finally{u(!1)}};return e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx(X,{name:"name",value:r.name,onChange:d,placeholder:"Nombre del producto",required:!0}),e.jsx(X,{name:"description",value:r.description,onChange:d,placeholder:"Descripci√≥n",required:!0}),e.jsx(X,{name:"price",value:r.price,onChange:d,placeholder:"0.00",type:"number",step:"0.01",min:"0",required:!0}),e.jsx(X,{name:"image_url",value:r.image_url,onChange:d,placeholder:"URL de imagen",required:!0}),e.jsx(X,{name:"stock_quantity",value:r.stock_quantity,onChange:d,placeholder:"1",type:"number",min:"1",required:!0}),e.jsx(D,{type:"submit",disabled:t,children:t?"Guardando...":"Crear producto del d√≠a"}),h&&e.jsx("div",{className:"text-red-500",children:h})]})}function Hr(){const{user:s}=de(),[l,r]=o.useState([]),[m,t]=o.useState(!1),[u,h]=o.useState(null),n=async()=>{t(!0),h(null);try{const{data:d,error:S}=await k.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(S)throw S;r(d||[])}catch(d){h(d instanceof Error?d.message:"Error desconocido")}finally{t(!1)}};return o.useEffect(()=>{s!=null&&s.id&&n()},[s]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{children:[e.jsx(re,{children:e.jsx(ee,{children:"Crear producto del d√≠a"})}),e.jsx(V,{children:e.jsx(Br,{onProductCreated:n})})]}),e.jsx("h2",{className:"text-xl font-semibold",children:"Mis productos del d√≠a"}),m&&e.jsx("div",{children:"Cargando..."}),u&&e.jsx("div",{className:"text-red-500",children:u}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(d=>e.jsxs(U,{children:[e.jsx(re,{children:e.jsx(ee,{children:d.name})}),e.jsxs(V,{children:[e.jsxs("div",{children:["Descripci√≥n: ",d.description]}),e.jsxs("div",{children:["Precio: Q",d.price]}),e.jsxs("div",{children:["Stock: ",d.stock_quantity]}),e.jsxs("div",{children:["Expira: ",new Date(d.expires_at).toLocaleString()]})]})]},d.id))})]})}function Qr(){const{user:s}=de(),{items:l,addToCart:r,getCartItemCount:m}=Is(),[t,u]=o.useState("businesses"),[h,n]=o.useState([]),[d,S]=o.useState([]),[w,E]=o.useState([]),[c,v]=o.useState(""),[P,I]=o.useState(!0),[C,T]=o.useState(null),[$,J]=o.useState(null);o.useEffect(()=>{(async()=>{if(console.log("üîÑ Iniciando carga de datos del marketplace..."),console.log("üë§ Usuario actual:",s==null?void 0:s.name,s==null?void 0:s.id),!(s!=null&&s.id)){console.warn("‚ö†Ô∏è No hay usuario autenticado"),T("Usuario no autenticado"),I(!1);return}try{await Promise.all([q(),H(),a()]),console.log("‚úÖ Carga de datos completada")}catch(_){console.error("‚ùå Error en carga de datos:",_)}})()},[s]);const q=async()=>{try{console.log("üîç Cargando solo negocios ABIERTOS...");const{data:i,error:_}=await k.from("sellers").select(`
          id, 
          business_name,
          business_description,
          business_logo,
          is_open_now,
          is_active
        `).eq("is_active",!0).eq("is_open_now",!0).neq("id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(_)throw console.error("Error loading businesses:",_),_;console.log("‚úÖ Negocios abiertos encontrados:",(i==null?void 0:i.length)||0);const L=(i||[]).map(O=>({id:O.id,name:O.business_name||"Comercio sin nombre",description:O.business_description||"Comercio local en Gual√°n",business_type:"General",business_rating:0,total_reviews:0,profile_image_url:O.business_logo||"",is_open:O.is_open_now||!1}));console.log("üìã Negocios procesados:",L),n(L)}catch(i){console.error("üí• Error loading businesses:",i),T("Error al cargar los comercios: "+i.message)}},H=async()=>{try{const{data:i,error:_}=await k.from("products").select("*").neq("seller_id",s==null?void 0:s.id).eq("is_public",!0).gt("stock_quantity",0).order("created_at",{ascending:!1});if(_)throw console.error("Error loading products:",_),_;console.log("Raw products data:",i);const L=[...new Set((i==null?void 0:i.map(Q=>Q.seller_id))??[])];let O=[];if(L.length>0){const{data:Q,error:Z}=await k.from("users").select("id, name, business_name").in("id",L);Z?console.error("Error loading sellers for products:",Z):O=Q||[]}console.log("Sellers data for products:",O);const G=(i||[]).map(Q=>{const Z=O.find(ue=>ue.id===Q.seller_id);return{...Q,seller_name:(Z==null?void 0:Z.name)||"Vendedor desconocido",seller_business_type:(Z==null?void 0:Z.business_name)||"General"}});console.log("Processed products:",G),S(G)}catch(i){console.error("Error loading products:",i),T("Error al cargar los productos: "+i.message)}},a=async()=>{try{const{data:i,error:_}=await k.from("daily_products").select("*").neq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).gt("stock_quantity",0).order("created_at",{ascending:!1});if(_)throw console.error("Error loading daily products:",_),_;console.log("Raw daily products data:",i);const L=[...new Set((i==null?void 0:i.map(Q=>Q.seller_id))??[])];let O=[];if(L.length>0){const{data:Q,error:Z}=await k.from("users").select("id, name, business_name").in("id",L);Z?console.error("Error loading sellers for daily products:",Z):O=Q||[]}console.log("Sellers data for daily products:",O);const G=(i||[]).map(Q=>{const Z=O.find(ue=>ue.id===Q.seller_id);return{...Q,seller_name:(Z==null?void 0:Z.name)||"Vendedor desconocido",seller_business_type:(Z==null?void 0:Z.business_name)||"General"}});console.log("Processed daily products:",G),E(G)}catch(i){console.error("Error loading daily products:",i),T("Error al cargar las ofertas del d√≠a: "+i.message)}finally{I(!1)}},p=async(i,_="regular")=>{const L=await r(i,1,_);L.success||T(L.message)},f=h.filter(i=>i.name.toLowerCase().includes(c.toLowerCase())||i.business_type.toLowerCase().includes(c.toLowerCase())),g=d.filter(i=>{var _;return i.name.toLowerCase().includes(c.toLowerCase())||i.category.toLowerCase().includes(c.toLowerCase())||((_=i.seller_name)==null?void 0:_.toLowerCase().includes(c.toLowerCase()))}),x=w.filter(i=>{var _;return i.name.toLowerCase().includes(c.toLowerCase())||((_=i.seller_name)==null?void 0:_.toLowerCase().includes(c.toLowerCase()))}),N=i=>{const _=new Date,O=new Date(i).getTime()-_.getTime(),G=Math.floor(O/(1e3*60*60)),Q=Math.floor(O%(1e3*60*60)/(1e3*60));return G>0?`${G}h ${Q}m restantes`:Q>0?`${Q}m restantes`:"Expirado"};return t==="cart"?e.jsx(Us,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{variant:"outline",onClick:()=>u("businesses"),children:"‚Üê Volver al mercado"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Mi Carrito de Compras"})]}),e.jsx(Wr,{onClose:()=>u("businesses")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Mercado TRATO"}),e.jsx("p",{className:"text-gray-600",children:"Compra productos de otros comercios en Gual√°n"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(D,{onClick:()=>{I(!0),T(null),q(),H(),a()},variant:"outline",size:"sm",disabled:P,children:[e.jsx(oe,{className:`w-4 h-4 mr-2 ${P?"animate-spin":""}`}),"Recargar"]}),e.jsxs(D,{onClick:()=>u("cart"),className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Carrito (",m(),")"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ga,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(X,{placeholder:"Buscar comercios, productos...",value:c,onChange:i=>v(i.target.value),className:"pl-10"})]}),C&&e.jsxs(xe,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(ge,{children:C})]}),!1,e.jsxs(Ye,{value:t,onValueChange:i=>u(i),children:[e.jsxs(Xe,{className:"grid w-full grid-cols-4",children:[e.jsxs(he,{value:"my-daily-products",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Mis productos del d√≠a"]}),e.jsx(ce,{value:"my-daily-products",className:"space-y-4",children:e.jsx(Hr,{})}),e.jsxs(he,{value:"businesses",className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Comercios (",f.length,")"]}),e.jsxs(he,{value:"products",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Productos (",g.length,")"]}),e.jsxs(he,{value:"daily-products",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Ofertas del D√≠a (",x.length,")"]})]}),e.jsx(ce,{value:"businesses",className:"space-y-4",children:P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-gray-400"})}):f.length===0?e.jsx(U,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx(be,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay comercios disponibles"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron comercios que coincidan con tu b√∫squeda."})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(i=>e.jsxs(U,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-100",children:e.jsx(ye,{src:ns(i.profile_image_url),alt:i.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"text-lg",children:i.name}),i.is_open&&e.jsx(te,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Abierto"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:i.business_type})]})]})}),e.jsxs(V,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Zs,{className:"w-4 h-4 text-yellow-500 fill-current"}),e.jsx("span",{className:"text-sm font-medium",children:i.business_rating.toFixed(1)})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",i.total_reviews," rese√±as)"]})]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>{J(i),u("products")},children:[e.jsx(Ps,{className:"w-4 h-4 mr-1"}),"Ver productos"]})]})]})]},i.id))})}),e.jsx(ce,{value:"products",className:"space-y-4",children:P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-gray-400"})}):g.length===0?e.jsx(U,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx(fe,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay productos disponibles"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron productos que coincidan con tu b√∫squeda."})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(i=>e.jsxs(U,{className:"hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-t-lg overflow-hidden",children:e.jsx(ye,{src:ns(i.image_url),alt:i.name,className:"w-full h-full object-cover"})}),e.jsxs(V,{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600",children:i.seller_name}),e.jsx(te,{variant:"outline",className:"text-xs mt-1",children:i.category})]}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["Q",i.price.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Stock: ",i.stock_quantity]})]}),e.jsxs(D,{onClick:()=>p(i.id),className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",size:"sm",children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Agregar"]})]})]})]},i.id))})}),e.jsx(ce,{value:"daily-products",className:"space-y-4",children:x.length===0?e.jsx(U,{children:e.jsxs(V,{className:"p-12 text-center",children:[e.jsx(ae,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay ofertas del d√≠a disponibles"}),e.jsx("p",{className:"text-gray-600",children:"No hay ofertas especiales activas en este momento."})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(i=>e.jsxs(U,{className:"hover:shadow-lg transition-shadow border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-t-lg overflow-hidden",children:e.jsx(ye,{src:ns(i.image_url),alt:i.name,className:"w-full h-full object-cover"})}),e.jsx(te,{className:"absolute top-2 right-2 bg-orange-500 text-white",children:"Oferta del d√≠a"})]}),e.jsxs(V,{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600",children:i.seller_name}),e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:[e.jsx(ae,{className:"w-3 h-3 inline mr-1"}),N(i.expires_at)]})]}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-xl font-bold text-orange-600",children:["Q",i.price.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Stock: ",i.stock_quantity]})]}),e.jsxs(D,{onClick:()=>p(i.id,"daily"),className:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",size:"sm",children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Agregar"]})]})]})]},i.id))})})]})]})}function Es(){return e.jsx(Us,{children:e.jsx(Qr,{})})}function Yr({userRole:s,onVerificationComplete:l}){const{user:r}=de(),[m,t]=o.useState({latitude:null,longitude:null,address:""}),[u,h]=o.useState({latitude:null,longitude:null,address:""}),[n,d]=o.useState({phone:"",profileImage:"",coverImage:"",vehicleType:"",licenseNumber:""}),[S,w]=o.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1}),[E,c]=o.useState(!1),[v,P]=o.useState(!1);o.useEffect(()=>{r&&I()},[r]);const I=async()=>{if(r)try{const{data:x,error:N}=await k.from("users").select("*").eq("id",r.id).single();if(N)throw N;if(x&&(t({latitude:x.latitude,longitude:x.longitude,address:x.address||""}),d({phone:x.phone||"",profileImage:x.profile_image_url||"",coverImage:x.cover_image_url||"",vehicleType:x.vehicle_type||"",licenseNumber:x.license_number||""}),w(i=>({...i,locationVerified:x.location_verified||!1,profileCompleted:x.profile_completed||!1}))),s==="vendedor"){const{data:i,error:_}=await k.from("sellers").select("*").eq("user_id",r.id).single();i&&(h({latitude:i.business_latitude,longitude:i.business_longitude,address:i.business_address||""}),d(L=>({...L,coverImage:i.cover_image_url||""})),w(L=>({...L,businessLocationVerified:i.business_location_verified||!1,canPublish:i.can_publish_products||!1})))}}catch(x){console.error("Error loading user data:",x),B.error("Error al cargar datos del usuario")}},C=async()=>{if(!navigator.geolocation){B.error("Tu navegador no soporta geolocalizaci√≥n");return}P(!0),navigator.geolocation.getCurrentPosition(async x=>{const{latitude:N,longitude:i}=x.coords;try{const _=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${i},${N}.json?access_token=`);if(_.ok){const L=await _.json();L.features&&L.features.length>0&&t(O=>({...O,latitude:N,longitude:i}))}else t(L=>({...L,latitude:N,longitude:i}));B.success("Ubicaci√≥n obtenida correctamente")}catch(_){console.error("Error getting address:",_),t(L=>({...L,latitude:N,longitude:i})),B.success("Ubicaci√≥n obtenida (sin direcci√≥n)")}finally{P(!1)}},x=>{console.error("Geolocation error:",x),P(!1),B.error("No se pudo obtener tu ubicaci√≥n. Verifica los permisos del navegador.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},T=async()=>{if(!r||!m.latitude||!m.longitude){B.error("Primero obt√©n tu ubicaci√≥n");return}c(!0);try{const{error:x}=await k.rpc("update_user_location",{user_id:r.id,lat:m.latitude,lng:m.longitude,user_address:m.address});if(x)throw x;w(N=>({...N,locationVerified:!0})),B.success("Ubicaci√≥n personal verificada"),await q()}catch(x){console.error("Error saving location:",x),B.error("Error al guardar ubicaci√≥n")}finally{c(!1)}},$=async()=>{if(!r||!u.latitude||!u.longitude){B.error("Primero obt√©n la ubicaci√≥n del negocio");return}c(!0);try{const{error:x}=await k.rpc("update_business_location",{seller_user_id:r.id,lat:u.latitude,lng:u.longitude,business_addr:u.address});if(x)throw x;w(N=>({...N,businessLocationVerified:!0})),B.success("Ubicaci√≥n del negocio verificada"),await q()}catch(x){console.error("Error saving business location:",x),B.error("Error al guardar ubicaci√≥n del negocio")}finally{c(!1)}},J=async()=>{if(r){c(!0);try{const x={phone:n.phone,profile_image_url:n.profileImage,updated_at:new Date().toISOString()};s==="repartidor"&&(x.vehicle_type=n.vehicleType,x.license_number=n.licenseNumber);const{error:N}=await k.from("users").update(x).eq("id",r.id);if(N)throw N;if(s==="vendedor"&&n.coverImage){const{error:i}=await k.from("sellers").update({cover_image_url:n.coverImage}).eq("user_id",r.id);if(i)throw i}B.success("Perfil actualizado"),await q()}catch(x){console.error("Error updating profile:",x),B.error("Error al actualizar perfil")}finally{c(!1)}}},q=async()=>{if(r)try{let x=!1;if(s==="vendedor"){const{data:N,error:i}=await k.rpc("check_seller_can_publish",{seller_user_id:r.id});i||(x=N)}else if(s==="comprador"){const{data:N,error:i}=await k.rpc("check_buyer_can_purchase",{buyer_user_id:r.id});i||(x=N)}else if(s==="repartidor"){const{data:N,error:i}=await k.rpc("check_driver_can_work",{driver_user_id:r.id});i||(x=N)}w(N=>({...N,canPublish:s==="vendedor"?x:N.canPublish,canPurchase:s==="comprador"?x:N.canPurchase,canWork:s==="repartidor"?x:N.canWork})),x&&l&&l()}catch(x){console.error("Error checking verification status:",x)}},H=()=>{const x=[{name:"Tel√©fono",completed:!!n.phone,icon:Je},{name:"Ubicaci√≥n verificada",completed:S.locationVerified,icon:pe}];return s==="vendedor"?[...x,{name:"Foto de perfil",completed:!!n.profileImage,icon:Ce},{name:"Foto de portada",completed:!!n.coverImage,icon:Ce},{name:"Ubicaci√≥n del negocio",completed:S.businessLocationVerified,icon:pe}]:s==="repartidor"?[...x,{name:"Tipo de veh√≠culo",completed:!!n.vehicleType&&n.vehicleType!=="No especificado",icon:Qe},{name:"N√∫mero de licencia",completed:!!n.licenseNumber&&n.licenseNumber!=="No especificado",icon:Ce}]:x},a=()=>s==="vendedor"&&S.canPublish?{message:"¬°Puedes publicar productos!",type:"success"}:s==="comprador"&&S.canPurchase?{message:"¬°Puedes realizar compras!",type:"success"}:s==="repartidor"&&S.canWork?{message:"¬°Puedes tomar √≥rdenes!",type:"success"}:{message:"Completa todos los requisitos",type:"warning"},p=H(),f=p.filter(x=>x.completed).length,g=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[g.type==="success"?e.jsx(le,{className:"w-5 h-5 text-green-500"}):e.jsx(Le,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{children:"Estado de Verificaci√≥n"})]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${g.type==="success"?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:[e.jsx("p",{className:`font-medium ${g.type==="success"?"text-green-800":"text-orange-800"}`,children:g.message}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[f," de ",p.length," requisitos completados"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:p.map(x=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border",children:[e.jsx(x.icon,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:x.name}),x.completed?e.jsx(le,{className:"w-4 h-4 text-green-500 ml-auto"}):e.jsx(De,{className:"w-4 h-4 text-red-500 ml-auto"})]},x.name))})]})})]}),e.jsxs(U,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{children:"Ubicaci√≥n Personal"}),S.locationVerified&&e.jsx(te,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(V,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n"}),e.jsx(X,{value:m.address,onChange:x=>t(N=>({...N,address:x.target.value})),placeholder:"Tu direcci√≥n",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(D,{onClick:C,disabled:v,className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50",variant:"outline",style:{borderColor:"#2563eb",color:"#2563eb",backgroundColor:"white",fontWeight:"600"},children:v?"Obteniendo...":"Obtener Ubicaci√≥n Actual"})})]}),m.latitude&&m.longitude&&e.jsx("div",{className:"p-3 bg-gray-50 rounded border",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas: ",m.latitude,", ",m.longitude]})}),e.jsx(D,{onClick:T,disabled:E||!m.latitude||!m.longitude,className:"w-full",children:E?"Guardando...":"Verificar Ubicaci√≥n Personal"})]})]}),s==="vendedor"&&e.jsxs(U,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Ubicaci√≥n del Negocio"}),S.businessLocationVerified&&e.jsx(te,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(V,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Direcci√≥n del Negocio"}),e.jsx(X,{value:u.address,onChange:x=>h(N=>({...N,address:x.target.value})),placeholder:"Direcci√≥n de tu negocio",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(D,{onClick:()=>{C(),m.latitude&&m.longitude&&h(x=>({...x,latitude:m.latitude,longitude:m.longitude}))},disabled:v,className:"w-full",variant:"outline",children:"Usar Ubicaci√≥n Actual"})})]}),e.jsx(D,{onClick:$,disabled:E||!u.latitude||!u.longitude,className:"w-full",children:E?"Guardando...":"Verificar Ubicaci√≥n del Negocio"})]})]}),e.jsxs(U,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{children:"Informaci√≥n del Perfil"})]})}),e.jsxs(V,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tel√©fono"}),e.jsx(X,{value:n.phone,onChange:x=>d(N=>({...N,phone:x.target.value})),placeholder:"+502 1234-5678",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Perfil"}),e.jsx(X,{value:n.profileImage,onChange:x=>d(N=>({...N,profileImage:x.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="vendedor"&&e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Portada"}),e.jsx(X,{value:n.coverImage,onChange:x=>d(N=>({...N,coverImage:x.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="repartidor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tipo de Veh√≠culo"}),e.jsx(X,{value:n.vehicleType,onChange:x=>d(N=>({...N,vehicleType:x.target.value})),placeholder:"Motocicleta, Autom√≥vil, Bicicleta...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(Y,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"N√∫mero de Licencia"}),e.jsx(X,{value:n.licenseNumber,onChange:x=>d(N=>({...N,licenseNumber:x.target.value})),placeholder:"M-123456",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]})]})]}),e.jsx(D,{onClick:J,disabled:E,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold",style:{backgroundColor:"#2563eb",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"600"},children:E?"Actualizando...":"Actualizar Perfil"})]})]})]})}function ha(s){const{user:l}=de(),[r,m]=o.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1,requirements:{phone:!1,profileImage:!1,coverImage:!1,location:!1,businessLocation:!1,vehicleType:!1,licenseNumber:!1,adminApproval:!1}}),[t,u]=o.useState(!0);o.useEffect(()=>{l&&h()},[l,s]);const h=async()=>{if(l)try{u(!0);const{data:c,error:v}=await k.from("users").select("*").eq("id",l.id).single();if(v)throw v;let P=null;if(s==="vendedor"){const{data:T,error:$}=await k.from("sellers").select("*").eq("user_id",l.id).single();$||(P=T)}const I={phone:!!(c.phone&&c.phone.trim()!==""),profileImage:!!(c.profile_image_url&&c.profile_image_url.trim()!==""),coverImage:s==="vendedor"?!!(P!=null&&P.cover_image_url&&P.cover_image_url.trim()!==""):!0,location:!!(c.location_verified&&c.latitude&&c.longitude&&c.address),businessLocation:s==="vendedor"?!!(P!=null&&P.business_location_verified&&P.business_latitude&&P.business_longitude&&P.business_address):!0,vehicleType:s==="repartidor"?!!(c.vehicle_type&&c.vehicle_type!=="No especificado"):!0,licenseNumber:s==="repartidor"?!!(c.license_number&&c.license_number!=="No especificado"):!0,adminApproval:s==="repartidor"?!!(c.is_verified&&c.is_active):!0};let C=!1;if(s==="vendedor"){const{data:T,error:$}=await k.rpc("check_seller_can_publish",{seller_user_id:l.id});$||(C=T)}else if(s==="comprador"){const{data:T,error:$}=await k.rpc("check_buyer_can_purchase",{buyer_user_id:l.id});$||(C=T)}else if(s==="repartidor"){const{data:T,error:$}=await k.rpc("check_driver_can_work",{driver_user_id:l.id});$||(C=T)}m({locationVerified:c.location_verified||!1,businessLocationVerified:(P==null?void 0:P.business_location_verified)||!1,profileCompleted:c.profile_completed||!1,canPublish:s==="vendedor"?C:!1,canPurchase:s==="comprador"?C:!1,canWork:s==="repartidor"?C:!1,requirements:I})}catch(c){console.error("Error checking verification status:",c)}finally{u(!1)}};return{status:r,loading:t,refreshStatus:()=>{h()},getCompletionPercentage:()=>{const c=Object.values(r.requirements).length,v=Object.values(r.requirements).filter(Boolean).length;return Math.round(v/c*100)},getMissingRequirements:()=>{const c=[];return r.requirements.phone||c.push("Tel√©fono"),r.requirements.profileImage||c.push("Foto de perfil"),r.requirements.location||c.push("Ubicaci√≥n verificada"),s==="vendedor"&&(r.requirements.coverImage||c.push("Foto de portada"),r.requirements.businessLocation||c.push("Ubicaci√≥n del negocio")),s==="repartidor"&&(r.requirements.vehicleType||c.push("Tipo de veh√≠culo"),r.requirements.licenseNumber||c.push("N√∫mero de licencia"),r.requirements.adminApproval||c.push("Aprobaci√≥n del administrador")),c},canPerformMainAction:()=>{switch(s){case"vendedor":return r.canPublish;case"comprador":return r.canPurchase;case"repartidor":return r.canWork;default:return!1}},getMainActionText:()=>{switch(s){case"vendedor":return r.canPublish?"Puedes publicar productos":"No puedes publicar productos a√∫n";case"comprador":return r.canPurchase?"Puedes realizar compras":"No puedes comprar a√∫n";case"repartidor":return r.canWork?"Puedes tomar √≥rdenes":"No puedes trabajar a√∫n";default:return""}}}}function Xr({userRole:s,onOpenVerification:l,showIfComplete:r=!1}){const{loading:m,canPerformMainAction:t,getMissingRequirements:u,getCompletionPercentage:h}=ha(s);if(m)return null;const n=t(),d=u(),S=h();if(s==="vendedor"||n&&!r)return null;const w=()=>{switch(s){case"vendedor":return ms;case"comprador":return pe;case"repartidor":return ze;default:return Le}},E=()=>{if(n)switch(s){case"vendedor":return"¬°Perfil completo! Puedes publicar productos";case"comprador":return"¬°Perfil completo! Puedes realizar compras";case"repartidor":return"¬°Perfil completo! Puedes tomar √≥rdenes";default:return"¬°Perfil completo!"}switch(s){case"vendedor":return"Completa tu perfil para publicar productos";case"comprador":return"Completa tu perfil para realizar compras";case"repartidor":return"Completa tu perfil para trabajar como repartidor";default:return"Completa tu perfil"}},c=()=>n?"Tu perfil est√° completamente verificado y puedes usar todas las funciones de TRATO.":d.length===0?"Casi listo, solo faltan algunos detalles por verificar.":d.length===1?`Te falta 1 requisito: ${d[0]}.`:`Te faltan ${d.length} requisitos: ${d.slice(0,2).join(", ")}${d.length>2?" y m√°s...":""}.`,v=w();return e.jsx(xe,{className:`verification-alert mb-6 ${n?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 w-full",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:`w-6 h-6 flex-shrink-0 mt-1 ${n?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-lg leading-tight ${n?"text-green-800":"text-orange-800"}`,children:E()}),e.jsx(ge,{className:`alert-description mt-1 text-sm ${n?"text-green-700":"text-orange-700"}`,children:c()}),!n&&e.jsxs("div",{className:"verification-progress mt-3 space-y-2",children:[e.jsxs("div",{className:"verification-progress-label flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-orange-800",children:"Progreso del perfil"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[S,"%"]})]}),e.jsx("div",{className:"verification-progress-bar w-full bg-orange-200 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${S}%`}})})]})]})]}),e.jsx("div",{className:"flex justify-center md:justify-end mt-4 md:mt-0 md:ml-4",children:e.jsx(D,{onClick:l,className:`verification-button px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 ${n?"bg-green-500 hover:bg-green-600 hover:shadow-green-200":"bg-orange-500 hover:bg-orange-600 hover:shadow-orange-200"}`,style:{minWidth:"160px",borderRadius:"8px",fontSize:"14px",fontWeight:"600"},children:n?"Ver Estado":"Completar Perfil"})})]})})}function Jr({onDismiss:s}){const{user:l}=de(),{permission:r,requestPermission:m,supported:t}=ya(),[u,h]=o.useState(!1),[n,d]=o.useState(!1);o.useEffect(()=>{const v=t&&r!=="granted"&&r!=="denied"&&((l==null?void 0:l.role)==="vendedor"||(l==null?void 0:l.role)==="repartidor");d(v)},[t,r,l==null?void 0:l.role]);const S=async()=>{h(!0);try{await m()&&(d(!1),s==null||s())}catch(v){console.error("Error al solicitar permisos:",v)}finally{h(!1)}},w=()=>{d(!1),s==null||s()};if(!n)return null;const c=(()=>{switch(l==null?void 0:l.role){case"vendedor":return{title:"Notificaciones de Nuevas √ìrdenes",description:"Recibe alertas inmediatas cuando lleguen nuevos pedidos, incluso con la pantalla apagada.",benefits:["üì± Notificaciones incluso con pantalla apagada","üîî Alertas sonoras para nuevos pedidos","‚ö° Respuesta m√°s r√°pida a clientes"]};case"repartidor":return{title:"Notificaciones de Entregas",description:"Mantente informado sobre nuevas entregas disponibles y asignaciones.",benefits:["üöõ Alertas de nuevas entregas","üìç Notificaciones de asignaciones","üí∞ No pierdas oportunidades de entrega"]};default:return{title:"Notificaciones Push",description:"Recibe notificaciones importantes de la aplicaci√≥n.",benefits:["üîî Alertas importantes","üì± Notificaciones push","‚ö° Informaci√≥n en tiempo real"]}}})();return e.jsxs(U,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-lg",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(er,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx(ee,{className:"text-lg text-orange-900",children:c.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:c.description})]})]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:w,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:e.jsx(qe,{className:"w-4 h-4"})})]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:c.benefits.map((v,P)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-800",children:[e.jsx(le,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),v]},P))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:r==="granted"?"default":r==="denied"?"destructive":"secondary",className:"flex items-center gap-1",children:r==="granted"?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-3 h-3"}),"Activadas"]}):r==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-3 h-3"}),"Denegadas"]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-3 h-3"}),"Pendientes"]})}),!t&&e.jsx(te,{variant:"outline",className:"text-gray-600",children:"No soportadas en este navegador"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(D,{onClick:S,disabled:u||!t||r==="granted",className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 mr-2 animate-spin"}),"Solicitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"w-4 h-4 mr-2"}),"Activar Notificaciones"]})}),e.jsx(D,{variant:"outline",onClick:w,className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:"Ahora no"})]}),r==="denied"&&e.jsxs(xe,{className:"border-red-200 bg-red-50",children:[e.jsx(Le,{className:"w-4 h-4 text-red-600"}),e.jsx(ge,{className:"text-red-800 text-sm",children:"Las notificaciones fueron denegadas. Para activarlas, ve a configuraci√≥n del navegador ‚Üí Notificaciones ‚Üí Permitir para este sitio."})]})]})]})}function Zr({onPermissionChange:s,userRole:l="buyer",className:r=""}){const[m,t]=o.useState("default"),[u,h]=o.useState(!1);o.useEffect(()=>{"Notification"in window&&t(Notification.permission)},[]);const n=async()=>{if(!("Notification"in window)){alert("Tu navegador no soporta notificaciones");return}if(m!=="granted"){h(!0);try{const d=await Notification.requestPermission();t(d),d==="granted"?(s==null||s(!0),new Notification("¬°TRATO Notificaciones Activas!",{body:"Las notificaciones est√°n funcionando correctamente",icon:"/favicon.ico"})):s==null||s(!1)}catch(d){console.error("Error requesting notification permission:",d)}finally{h(!1)}}};return m==="granted"?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-green-700 ${r}`,children:[e.jsx(le,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Notificaciones activas"})]}):e.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Configurar Notificaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:m==="denied"?"Notificaciones bloqueadas":"Activa las notificaciones para recibir alertas"})]})]}),m!=="denied"&&e.jsx("button",{onClick:n,disabled:u,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:u?"Activando...":"Activar"})]}),m==="denied"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("p",{className:"text-sm text-red-700",children:'Las notificaciones est√°n bloqueadas. Para activarlas, haz clic en el √≠cono del candado en la barra de direcciones y selecciona "Permitir".'})})]})}function At(){const{user:s,signOut:l}=de(),{canPerformMainAction:r,refreshStatus:m}=ha("vendedor"),[t,u]=o.useState("dashboard"),[h,n]=o.useState("list"),[d,S]=o.useState([]),[w,E]=o.useState([]),[c,v]=o.useState(!0),[P,I]=o.useState(""),[C,T]=o.useState(0),[$,J]=o.useState(""),[q,H]=o.useState([]),[a,p]=o.useState(null),[f,g]=o.useState(null),[x,N]=o.useState(!1),[i,_]=o.useState({totalProducts:0,dailyProducts:0,totalViews:0,totalSales:0,revenue:0,avgRating:0}),L=(y,M)=>{console.log(`üö® Alerta cr√≠tica: ${y} - ${M}`),y==="new_order"?(H(b=>[...b,{id:Date.now().toString(),message:`üî• ¬°NUEVO PEDIDO! ${M}`,timestamp:new Date().toISOString(),type:"order",color:"green"}].slice(0,10)),"Notification"in window&&Notification.permission==="granted"&&new Notification("¬°Nuevo Pedido!",{body:M,icon:"/favicon.ico",badge:"/favicon.ico"})):y.includes("stock")?H(b=>[...b,{id:Date.now().toString(),message:`‚ö†Ô∏è ${M}`,timestamp:new Date().toISOString(),type:"product",color:"red"}].slice(0,10)):H(b=>[...b,{id:Date.now().toString(),message:`üö® ${M}`,timestamp:new Date().toISOString(),type:"order",color:"yellow"}].slice(0,10))},O=y=>{console.log(`‚è∞ Timeout cr√≠tico: Orden ${y.orderId} - ${y.timeSinceStatus} min`),H(M=>[...M,{id:Date.now().toString(),message:`üïí Orden #${y.orderId.slice(-6)} lleva ${y.timeSinceStatus} min en ${y.status}`,timestamp:new Date().toISOString(),type:"order",color:"orange"}].slice(0,10))};o.useEffect(()=>{s&&(G(),Q(),Z(),$e(),Me(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(y=>{console.log(`üîî Permisos de notificaci√≥n: ${y}`),y==="granted"?console.log("‚úÖ Notificaciones habilitadas para nuevos pedidos"):console.warn("‚ö†Ô∏è Notificaciones bloqueadas - solo sonido y alertas visuales")}))},[s]),o.useEffect(()=>{const y=setInterval(()=>{(t==="dashboard"||t==="products")&&Q()},6e4);return()=>clearInterval(y)},[t]);const G=async()=>{try{const{data:y,error:M}=await k.from("products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(M)throw M;S(y||[])}catch(y){console.error("Error loading products:",y),I("Error al cargar productos")}},Q=async()=>{try{const{data:y,error:M}=await k.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(M)throw M;E(y||[])}catch(y){console.error("Error loading daily products:",y),I("Error al cargar productos del d√≠a")}finally{v(!1)}},Z=async()=>{try{const y=d.length,M=w.length;let b=0,j=0,z=0;try{const{data:R,error:F}=await k.from("orders").select("id").limit(1);if(F)console.log("Orders table not available yet, using default stats");else{const{data:W,error:K}=await k.from("orders").select("id, total, status, created_at").eq("seller_id",s==null?void 0:s.id);!K&&W&&(b=W.length,j=W.filter(se=>se.status==="delivered").reduce((se,ie)=>se+(ie.total||0),0),console.log(`Loaded ${b} orders, revenue: Q${j}`));try{const{data:se,error:ie}=await k.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s==null?void 0:s.id).single();!ie&&se?(z=se.average_rating||0,console.log(`üåü Seller rating: ${z} from ${se.total_reviews} reviews`)):console.log("No ratings found for seller, showing 0.0")}catch{console.log("Rating system not available, using 0.0")}}}catch{console.log("Orders system not configured yet, using default stats")}_({totalProducts:y,dailyProducts:M,totalViews:Math.floor(Math.random()*1e3)+500,totalSales:b,revenue:j,avgRating:z})}catch(y){console.error("Error loading stats:",y),_({totalProducts:d.length,dailyProducts:w.length,totalViews:0,totalSales:0,revenue:0,avgRating:0})}},ue=()=>{G(),$e(),n("list")},ke=()=>{Q(),$e(),n("list")},Pe=y=>{p(y),n("edit-product")},_e=y=>{g(y),n("edit-daily")},ts=()=>{G(),p(null),n("list")},Ue=()=>{Q(),g(null),n("list")},A=async y=>{try{const{error:M}=await k.from("products").delete().eq("id",y);if(M)throw M;G()}catch(M){console.error("Error deleting product:",M),I("Error al eliminar producto")}},ne=async y=>{try{const{error:M}=await k.from("daily_products").delete().eq("id",y);if(M)throw M;Q()}catch(M){console.error("Error deleting daily product:",M),I("Error al eliminar producto del d√≠a")}},Me=o.useCallback(async()=>{if(s!=null&&s.id)try{const y=k.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},M=>{console.log("üîî Nueva orden recibida:",M),T(R=>R+1);const b=M.new,j=new CustomEvent("criticalNotification",{detail:{type:"new_order",message:`üéØ NUEVA ORDEN: Q${b.total||"0.00"} - ${b.notes||"Sin notas"}`,urgency:"high",sound:!0,persist:!0,metadata:{order_id:b.id,total:b.total,buyer_name:b.buyer_name,created_at:b.created_at}}});window.dispatchEvent(j),Notification.permission==="granted"&&new Notification("¬°Nueva orden en TRATO!",{body:`Tienes un nuevo pedido por Q${b.total||"0.00"}`,icon:"/favicon.ico",tag:"new-order",requireInteraction:!0}),(async()=>{try{await k.from("critical_alerts").insert({alert_type:"new_order",order_id:b.id,user_id:s==null?void 0:s.id,message:`Nueva orden recibida: Q${b.total||"0.00"}`,urgency_level:"high",metadata:{total:b.total,buyer_name:b.buyer_name,notification_sent:!0}})}catch(R){console.error("Error logging critical alert:",R)}})(),J(new Date().toISOString())}).subscribe();if(Notification.permission==="default"){const M=await Notification.requestPermission();console.log("Notification permission:",M)}return()=>{y.unsubscribe()}}catch(y){console.error("Error setting up order notifications:",y)}},[s==null?void 0:s.id]),Ve=o.useCallback(async()=>{if(s!=null&&s.id)try{const{data:y,error:M}=await k.from("orders").select("id").limit(1);if(!M){const b=new Date().toISOString(),j=`seller_last_notification_${s.id}`,z=localStorage.getItem(j);if(z){const{data:R,error:F}=await k.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).gt("created_at",z).order("created_at",{ascending:!1});!F&&R&&R.length>0&&(T(W=>W+R.length),localStorage.setItem(j,b),console.log(`üì¶ Found ${R.length} new orders since ${z}`))}else{const{data:R,error:F}=await k.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).eq("status","pending").order("created_at",{ascending:!1});!F&&R&&R.length>0&&(T(R.length),console.log(`üì¶ Found ${R.length} pending orders (first check)`)),localStorage.setItem(j,b)}}}catch(y){console.log("üì¶ Orders table not available for notifications:",y)}},[s==null?void 0:s.id]);o.useEffect(()=>{if(!(s!=null&&s.id))return;Ve();const y=setInterval(()=>{Ve()},3e4);return()=>clearInterval(y)},[s==null?void 0:s.id]);const $e=async()=>{try{const y=[];if(d.length>0){const b=d[0];y.push({id:`product-${b.id}`,type:"product",message:`Producto agregado: "${b.name}"`,timestamp:b.created_at,color:"green"})}if(w.length>0){const b=w[0];y.push({id:`daily-${b.id}`,type:"daily_product",message:`Venta del d√≠a creada: "${b.name}"`,timestamp:b.created_at,color:"orange"})}try{const{data:b,error:j}=await k.from("orders").select("id").limit(1);if(!j){const{data:z,error:R}=await k.from("orders").select("id, status, created_at, total").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1}).limit(3);!R&&z&&z.length>0&&z.forEach(F=>{let W="",K="blue";switch(F.status){case"pending":W=`Nueva orden recibida (Q${F.total})`,K="yellow";break;case"confirmed":W=`Orden confirmada (Q${F.total})`,K="blue";break;case"preparing":W=`Orden en preparaci√≥n (Q${F.total})`,K="orange";break;case"ready":W=`Orden lista (Q${F.total})`,K="purple";break;case"delivered":W=`Orden entregada (Q${F.total})`,K="green";break;case"cancelled":W=`Orden cancelada (Q${F.total})`,K="red";break;default:W=`Orden ${F.status} (Q${F.total})`,K="blue"}y.push({id:`order-${F.id}`,type:"order",message:W,timestamp:F.created_at,color:K})})}}catch{console.log("Orders table not available for activity")}const M=y.sort((b,j)=>new Date(j.timestamp).getTime()-new Date(b.timestamp).getTime()).slice(0,5);H(M)}catch(y){console.error("Error loading recent activity:",y)}},Ge=y=>{const M=new Date().getTime(),b=new Date(y).getTime(),j=M-b,z=Math.floor(j/(1e3*60)),R=Math.floor(j/(1e3*60*60)),F=Math.floor(j/(1e3*60*60*24));return z<60?z<=1?"Hace un momento":`Hace ${z} minutos`:R<24?R===1?"Hace 1 hora":`Hace ${R} horas`:F===1?"Ayer":`Hace ${F} d√≠as`},is=()=>{const y=new Date,M=new Date;M.setHours(23,59,59,999);const b=M.getTime()-y.getTime(),j=Math.floor(b/(1e3*60*60)),z=Math.floor(b%(1e3*60*60)/(1e3*60));return`${j}h ${z}m`},We=[{id:"dashboard",label:"Inicio",icon:Fa,description:"Resumen y estad√≠sticas"},{id:"products",label:"Productos",icon:Za,description:"Gestiona tu men√∫"},{id:"orders",label:"Pedidos",icon:tr,description:"√ìrdenes y analytics",hasNotification:C>0,notificationCount:C},{id:"profile",label:"Perfil",icon:ms,description:"Configuraci√≥n del negocio"},{id:"marketplace",label:"Comprar",icon:us,description:"Compra de otros comercios"}],Te=()=>e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(U,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dashboard-welcome",style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",color:"white",padding:"24px",borderRadius:"16px",marginBottom:"16px"},children:e.jsx(re,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-2 md:p-3 rounded-xl",children:e.jsx(be,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ee,{className:"text-lg md:text-2xl text-white leading-tight",style:{color:"white",fontSize:"20px"},children:"¬°Bienvenido, Interlano Fernando Interiano! üëã"}),e.jsx("p",{className:"text-sm md:text-base text-white mt-1",style:{color:"white",fontSize:"16px"},children:"Gestiona tu negocio y conecta con m√°s clientes en Gual√°n"})]})]})})}),e.jsxs("div",{className:"dashboard-stats",style:{display:"grid",gridTemplateColumns:window.innerWidth<=768?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:"12px",marginBottom:"16px"},children:[e.jsx(U,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(V,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Productos"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:i.totalProducts})]}),e.jsx(fe,{className:"w-6 h-6 md:w-8 md:h-8 text-blue-500"})]})})}),e.jsx(U,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(V,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas del D√≠a"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:i.dailyProducts})]}),e.jsx(ae,{className:"w-6 h-6 md:w-8 md:h-8 text-orange-500"})]})})}),e.jsx(U,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(V,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:i.totalSales})]}),e.jsx(Sa,{className:"w-6 h-6 md:w-8 md:h-8 text-green-500"})]})})}),e.jsx(U,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(V,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Calificaci√≥n"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:i.avgRating.toFixed(1)})]}),e.jsx(Zs,{className:"w-6 h-6 md:w-8 md:h-8 text-yellow-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(U,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-green-500"}),"Ingresos del Mes"]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["Q",i.revenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"+12% comparado al mes pasado"})]})]}),e.jsxs(U,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ar,{className:"w-5 h-5 text-blue-500"}),"Vistas del Perfil"]})}),e.jsxs(V,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:i.totalViews.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vistas esta semana"})]})]})]}),e.jsxs(U,{children:[e.jsx(re,{children:e.jsx(ee,{children:"Acciones R√°pidas"})}),e.jsx(V,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(D,{onClick:()=>{if(!r()){N(!0);return}u("products"),n("add-product")},className:"h-20 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Nuevo Producto"})]})}),e.jsx(D,{onClick:()=>{if(!r()){N(!0);return}u("products"),n("add-daily")},variant:"outline",className:"h-20 border-orange-500 text-orange-600 hover:bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Venta del D√≠a"})]})}),e.jsx(D,{onClick:()=>u("profile"),variant:"outline",className:"h-20 border-blue-500 text-blue-600 hover:bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Editar Perfil"})]})})]})})]}),e.jsxs(U,{children:[e.jsx(re,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Actividad Reciente"]})}),e.jsx(V,{children:e.jsx("div",{className:"space-y-3",children:q.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay actividad reciente"})]}):q.map(y=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-${y.color}-50 rounded-lg`,children:[e.jsx("div",{className:`w-2 h-2 bg-${y.color}-500 rounded-full`}),e.jsx("p",{className:"text-sm flex-1",children:y.message}),e.jsx("span",{className:"text-xs text-gray-500",children:Ge(y.timestamp)})]},y.id))})})]})]}),Be=()=>h==="add-product"?e.jsx(vs,{onSuccess:ue,onCancel:()=>n("list")}):h==="add-daily"?e.jsx(Ns,{onSuccess:ke,onCancel:()=>n("list")}):h==="edit-product"&&a?e.jsx(vs,{product:a,onSuccess:ts,onCancel:()=>{p(null),n("list")}}):h==="edit-daily"&&f?e.jsx(Ns,{dailyProduct:f,onSuccess:Ue,onCancel:()=>{g(null),n("list")}}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 leading-tight",children:"Gesti√≥n de Productos"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Administra tu men√∫ y ofertas especiales"})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[e.jsxs(D,{onClick:()=>n("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),e.jsxs(D,{onClick:()=>n("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Venta del D√≠a"]})]})]}),e.jsxs(Ye,{defaultValue:"products",className:"space-y-6",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-2 h-auto p-1 bg-gray-100 rounded-lg",children:[e.jsxs(he,{value:"products",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(fe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos Normales"}),e.jsx("span",{className:"sm:hidden",children:"Normales"}),e.jsxs("span",{className:"ml-1",children:["(",d.length,")"]})]}),e.jsxs(he,{value:"daily",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos del D√≠a"}),e.jsx("span",{className:"sm:hidden",children:"Del D√≠a"}),e.jsxs("span",{className:"ml-1",children:["(",w.length,")"]})]})]}),e.jsx(ce,{value:"products",className:"space-y-4",children:c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-gray-400"})}):d.length===0?e.jsx(U,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(V,{className:"p-8 md:p-12 text-center",children:[e.jsx(fe,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos a√∫n"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Comienza agregando tu primer producto para empezar a vender"}),e.jsxs(D,{onClick:()=>n("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Agregar Primer Producto"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:d.map(y=>e.jsx(hr,{product:y,onEdit:Pe,onDelete:A},y.id))})}),e.jsxs(ce,{value:"daily",className:"space-y-4",children:[w.length>0&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-orange-800 text-sm sm:text-base",children:"Tiempo restante:"})]}),e.jsx("span",{className:"font-bold text-orange-800 text-sm sm:text-base",children:is()})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Los productos del d√≠a se eliminan autom√°ticamente a las 23:59:59"})]}),c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-gray-400"})}):w.length===0?e.jsx(U,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(V,{className:"p-8 md:p-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos del d√≠a"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Crea ofertas especiales que duran solo hasta medianoche"}),e.jsxs(D,{onClick:()=>n("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Crear Venta del D√≠a"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:w.map(y=>e.jsx(pr,{dailyProduct:y,onEdit:_e,onDelete:ne},y.id))})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx(wa,{showBanner:!0,enableAutoActivation:!0,showTester:!1}),e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx(Zr,{onPermissionChange:y=>{console.log("üîî Permisos de notificaci√≥n cambiados:",y)}})}),e.jsx(Qa,{onNotification:L}),e.jsx(za,{onAlert:O}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"TRATO Vendedor"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Panel de control empresarial"})]})]}),e.jsxs(D,{variant:"outline",onClick:l,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(Ja,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar Sesi√≥n"}),e.jsx("span",{className:"sm:hidden",children:"Salir"})]})]})})}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[P&&e.jsxs(xe,{variant:"destructive",className:"mb-4 md:mb-6",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(ge,{className:"text-sm md:text-base",children:P})]}),e.jsx(Xr,{userRole:"vendedor",onOpenVerification:()=>N(!0)}),e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(Jr,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-5 gap-1",children:We.map(y=>{const M=y.icon,b=t===y.id;return e.jsxs("button",{onClick:()=>{u(y.id),y.id==="orders"&&T(0)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:b?"#fef3c7":"transparent",color:b?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"w-5 h-5"}),y.hasNotification&&y.notificationCount&&y.notificationCount>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#ef4444",color:"white",fontSize:"10px",borderRadius:"50%",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 2s infinite"},children:y.notificationCount>9?"9+":y.notificationCount})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:y.label})]},y.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(Ye,{value:t,onValueChange:y=>u(y),className:"space-y-6",children:[e.jsx(Xe,{className:"grid w-full grid-cols-6 lg:w-2/3 mx-auto bg-white border border-gray-200",children:We.map(y=>{const M=y.icon;return e.jsxs(he,{value:y.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",onClick:()=>{y.id==="orders"&&T(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"w-5 h-5"}),y.hasNotification&&y.notificationCount&&y.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:y.notificationCount>9?"9+":y.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:y.label})]},y.id)})}),e.jsx(ce,{value:"dashboard",className:"space-y-6",children:Te()}),e.jsx(ce,{value:"products",className:"space-y-6",children:Be()}),e.jsx(ce,{value:"orders",className:"space-y-6",children:e.jsx(_s,{})}),e.jsx(ce,{value:"profile",className:"space-y-6",children:e.jsx(ys,{})}),e.jsx(ce,{value:"marketplace",className:"space-y-6",children:e.jsx(Es,{})})]})}),e.jsxs("div",{className:"block md:hidden mt-4",children:[t==="dashboard"&&Te(),t==="products"&&Be(),t==="orders"&&e.jsx(_s,{}),t==="profile"&&e.jsx(ys,{}),t==="marketplace"&&e.jsx(Es,{})]})]}),e.jsx(Ls,{open:x,onOpenChange:N,children:e.jsxs(Os,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Rs,{children:e.jsxs(Ms,{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Verificaci√≥n de Perfil y Ubicaci√≥n"})]})}),e.jsx(Yr,{userRole:"vendedor",onVerificationComplete:()=>{N(!1),m()}})]})}),e.jsx(Ua,{}),e.jsx(_a,{onNewOrder:()=>{t==="orders"&&window.location.reload()}})]})}export{At as SellerDashboard};
