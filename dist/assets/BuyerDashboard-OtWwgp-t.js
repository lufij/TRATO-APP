import{g as Ne,u as Se,h as Pe,r as m,s as T,j as e,B as $,f as Z,R as De,X as Le,C as Q,c as H,I as ye,a as ee,b as se,i as Os,E as cs,t as G,e as oe,P as Fs,d as Ee,S as fe,k as ds,l as Fe,m as pa,n as $s,o as Ue,p as Ge,q as ts,v as fa,w as ja,x as va,y as ya,z as ba,A as Na,F as _a,G as zs,H as is,J as wa,K as ka,M as Sa,L as Ca}from"./index-u8vAgmjF.js";import{P as me,T as Ze,a as Je,b as _e,c as Qe,d as je,D as Ea,e as Ms,R as Pa,I as Ta,u as Ia,N as qa}from"./NotificationSystem-DapRT9yU.js";import{r as vs,v as Ra,g as Da,F as Ie,P as ke,B as Ls,R as Aa,S as Oa,T as Fa,H as ys,O as $a}from"./TimeoutAlerts-B3bK-lGy.js";import{S as we}from"./shopping-cart-CTfJLhck.js";import{S as ze,M as He}from"./search-Dp53-kRV.js";import{I as be}from"./input-DmLNYdwZ.js";import{S as za,a as Ma,b as La,c as Ba,d as bs}from"./select-ERGZIR5W.js";import{S as de}from"./store-Bxx5et7U.js";import{S as le}from"./star-yJvYdeg8.js";import{M as qe}from"./map-pin-ok09ZdQZ.js";import{C as he}from"./clock-vEA5kH2y.js";import{C as Ae}from"./circle-x-DNasVzMJ.js";import{T as ue}from"./truck-ClKel8sK.js";import{T as We}from"./textarea-irWv1OP5.js";import{A as Va,a as Ua}from"./alert-HtrYg_mu.js";import{A as Ga,a as Qa,b as Ha,c as Wa,d as Ka,e as Xa,f as Ya,g as Za,h as Ja}from"./alert-dialog-vtj2ql1Z.js";import{T as Ke}from"./trash-2-CSi994Md.js";import{T as ns}from"./triangle-alert-Bdv5VT5P.js";import{C as Me,a as er,P as ls,b as sr}from"./CriticalNotifications-B0vcEQZO.js";import{L as ge}from"./label-D8XzBPsc.js";import{M as ar}from"./mail-Bkri-hs7.js";import{S as Ns}from"./shield-BJup4OxB.js";import{U as Oe}from"./user-Cv90ZORD.js";import{S as _s}from"./save-Bjt7eJzQ.js";import{S as rr}from"./shopping-bag-BAktL79I.js";import{L as tr}from"./lock-Bk2wZt3Y.js";import{A as Ve}from"./arrow-left-GdfI3wFS.js";import{I as ws}from"./info-DLXqeSRm.js";import{D as ir}from"./DeliveryTracking-C7-WhHuE.js";import{L as nr}from"./log-out-CMKLvwRy.js";import"./users-DFvmLCit.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Bs=Ne("arrow-right",lr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],cr=Ne("banknote",or);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],mr=Ne("circle",dr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Be=Ne("credit-card",ur);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],gr=Ne("funnel",xr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Xe=Ne("heart",hr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],fr=Ne("share-2",pr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],vr=Ne("thumbs-up",jr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]],br=Ne("utensils-crossed",yr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Vs=Ne("utensils",Nr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],wr=Ne("wallet",_r),Us=m.createContext(void 0);function ks({children:s}){const{user:r}=Se(),{clearCart:n}=Pe(),[x,d]=m.useState([]),[o,p]=m.useState(!1),[u,g]=m.useState(null),[w,q]=m.useState(null),h=async()=>{if(!r){d([]);return}try{p(!0),g(null);const{error:c}=await T.from("orders").select("count",{count:"exact",head:!0});if((c==null?void 0:c.code)==="PGRST205"){console.log("Orders table does not exist yet"),d([]);return}let b=T.from("orders").select(`
          *,
          order_items (*)
        `);switch(r.role){case"comprador":b=b.eq("buyer_id",r.id);break;case"vendedor":b=b.eq("seller_id",r.id);break;case"repartidor":b=b.or(`driver_id.eq.${r.id},status.eq.ready,status.eq.assigned`);break}const{data:i,error:t}=await b.order("created_at",{ascending:!1});if(t){console.error("Error fetching orders:",t),g("Error al cargar las √≥rdenes");return}const a=await Promise.all((i||[]).map(async v=>{let l="",y="";if(v.seller_id){const{data:O}=await T.from("users").select("name").eq("id",v.seller_id).single();l=(O==null?void 0:O.name)||""}if(v.driver_id){const{data:O}=await T.from("users").select("name").eq("id",v.driver_id).single();y=(O==null?void 0:O.name)||""}return{...v,items:v.order_items||[],seller_name:l,driver_name:y}}));d(a)}catch(c){console.error("Unexpected error fetching orders:",c),g("Error inesperado al cargar las √≥rdenes")}finally{p(!1)}},R=async c=>{if(!r)return{success:!1,message:"Debes iniciar sesi√≥n para crear una orden"};try{p(!0),g(null);const{data:b,error:i}=await T.from("cart_items").select(`
          *,
          products!inner (
            id,
            name,
            price,
            seller_id,
            is_public
          )
        `).eq("user_id",r.id);if(i)return console.error("Error fetching cart items:",i),{success:!1,message:"Error al obtener los productos del carrito"};if(!b||b.length===0)return{success:!1,message:"El carrito est√° vac√≠o"};const t=b.filter(U=>U.products?U.products.is_public?!0:(console.warn(`Product ${U.product_id} is not public`),!1):(console.warn(`Cart item ${U.id} has no associated product`),!1));if(t.length===0)return{success:!1,message:"No hay productos v√°lidos en el carrito"};if(t.length!==b.length)return{success:!1,message:"Algunos productos en tu carrito ya no est√°n disponibles. Por favor actualiza tu carrito."};const a=[...new Set(t.map(U=>U.products.seller_id))];if(a.length>1)return{success:!1,message:"Todos los productos deben ser del mismo vendedor"};const v=a[0];if(!v)return{success:!1,message:"Error: productos sin vendedor asignado"};const l=t.reduce((U,Y)=>{const te=Y.products.price||Y.product_price||0;return U+te*Y.quantity},0);let y=0;c.delivery_type==="delivery"&&(y=15);const O=l+y;console.log("üõ°Ô∏è Validando disponibilidad de stock antes de crear orden...");const L=await Ra(t.map(U=>({product_id:U.product_id,quantity:U.quantity,product_name:U.products.name})));if(!L.isValid)return console.warn("‚ö†Ô∏è Stock insuficiente:",L.message),{success:!1,message:L.message};console.log("‚úÖ Stock validado correctamente, procediendo con la orden");const _={buyer_id:r.id,seller_id:v,subtotal:l,delivery_fee:y,total:O,delivery_type:c.delivery_type,delivery_address:c.delivery_address,customer_notes:c.customer_notes,phone_number:c.phone_number,customer_name:c.customer_name,status:"pending",estimated_time:30};c.delivery_location?(_.delivery_latitude=c.delivery_location.latitude,_.delivery_longitude=c.delivery_location.longitude,(c.delivery_location.address_id||c.delivery_location.delivery_instructions||c.delivery_location.landmark)&&(_.delivery_location=c.delivery_location)):(_.delivery_latitude=c.delivery_latitude,_.delivery_longitude=c.delivery_longitude);const{data:E,error:S}=await T.from("orders").insert(_).select().single();if(S||!E)return console.error("Error creating order:",S),{success:!1,message:"Error al crear la orden"};const K=t.map(U=>{const Y=U.products.price||U.product_price||0,te=U.product_type==="daily";return{order_id:E.id,product_id:te?null:U.product_id,daily_product_id:te?U.product_id:null,product_name:U.products.name||U.product_name||"",product_image:U.product_image,price:Y,quantity:U.quantity,product_type:U.product_type||"regular",notes:""}}),{error:ne}=await T.from("order_items").insert(K);if(ne)return console.error("Error creating order items:",ne),await T.from("orders").delete().eq("id",E.id),ne.code==="23503"?{success:!1,message:"Error: algunos productos ya no est√°n disponibles"}:{success:!1,message:"Error al crear los items de la orden"};console.log("üì¶ Orden creada exitosamente. Stock se actualizar√° cuando se marque como entregado.");try{await T.from("notifications").insert({recipient_id:v,type:"new_order",title:"Nueva Orden",message:`Nueva orden por Q${O.toFixed(2)} - ${c.delivery_type}`,data:{order_id:E.id}})}catch(U){console.warn("Failed to create notification:",U)}try{await n()}catch(U){console.warn("Failed to clear cart:",U)}return q(E),await h(),{success:!0,message:"Orden creada exitosamente",orderId:E.id}}catch(b){return console.error("Unexpected error creating order:",b),{success:!1,message:"Error inesperado al crear la orden"}}finally{p(!1)}},C=async(c,b,i)=>{if(!r)return{success:!1,message:"Debes iniciar sesi√≥n"};try{p(!0);const t={status:b,updated_at:new Date().toISOString()};switch(b){case"accepted":t.accepted_at=new Date().toISOString();break;case"ready":t.ready_at=new Date().toISOString();break;case"picked_up":t.picked_up_at=new Date().toISOString();break;case"delivered":t.delivered_at=new Date().toISOString();break;case"completed":t.completed_at=new Date().toISOString();break;case"rejected":t.rejection_reason=i||"Sin raz√≥n especificada";break}const{error:a}=await T.from("orders").update(t).eq("id",c);if(a)return console.error("Error updating order status:",a),{success:!1,message:"Error al actualizar el estado de la orden"};if(b==="cancelled"||b==="rejected")try{const{data:l,error:y}=await T.from("order_items").select("product_id, quantity, product_name").eq("order_id",c);if(!y&&l&&l.length>0){console.log(`üì¶ Restaurando stock para orden ${b}...`);for(const O of l){const L=await vs(O.product_id,O.quantity);L.success?console.log(`‚úÖ Stock restaurado: ${O.product_name} - Cantidad devuelta: ${O.quantity}`):console.warn(`‚ö†Ô∏è No se pudo restaurar stock para ${O.product_name}:`,L.message)}console.log("üéâ Stock restaurado exitosamente")}}catch(l){console.error("‚ùå Error restaurando stock:",l)}const{data:v}=await T.from("orders").select("*, order_items(*)").eq("id",c).single();if(v){const l=[];switch(b){case"accepted":l.push({recipient_id:v.buyer_id,type:"order_accepted",title:"Orden Aceptada",message:`Tu orden ha sido aceptada y ser√° preparada en ${v.estimated_time} minutos`,data:{order_id:c}});break;case"ready":if(l.push({recipient_id:v.buyer_id,type:"order_ready",title:"Orden Lista",message:v.delivery_type==="pickup"?"Tu orden est√° lista para recoger":"Tu orden est√° lista para entrega",data:{order_id:c}}),v.delivery_type==="delivery"){const{data:y}=await T.from("users").select("id").eq("role","repartidor").eq("is_available",!0);y&&y.forEach(O=>{l.push({recipient_id:O.id,type:"delivery_available",title:"Entrega Disponible",message:`Nueva entrega disponible - Q${v.delivery_fee.toFixed(2)}`,data:{order_id:c}})})}break;case"delivered":l.push({recipient_id:v.buyer_id,type:"order_delivered",title:"Orden Entregada",message:"Tu orden ha sido entregada exitosamente",data:{order_id:c}});break}if(l.length>0)try{await T.from("notifications").insert(l)}catch(y){console.warn("Failed to create notifications:",y)}}return await h(),{success:!0,message:"Estado actualizado exitosamente"}}catch(t){return console.error("Unexpected error updating order status:",t),{success:!1,message:"Error inesperado al actualizar el estado"}}finally{p(!1)}},D=async(c,b)=>{if(!r)return{success:!1,message:"Debes iniciar sesi√≥n"};try{const{error:i}=await T.from("orders").update({driver_id:b,status:"assigned",updated_at:new Date().toISOString()}).eq("id",c);if(i)return console.error("Error assigning driver:",i),{success:!1,message:"Error al asignar repartidor"};const{data:t}=await T.from("orders").select("buyer_id, seller_id").eq("id",c).single();if(t){const a=[{recipient_id:t.buyer_id,type:"driver_assigned",title:"Repartidor Asignado",message:"Un repartidor ha sido asignado a tu orden",data:{order_id:c}},{recipient_id:b,type:"delivery_assigned",title:"Entrega Asignada",message:"Se te ha asignado una nueva entrega",data:{order_id:c}}];try{await T.from("notifications").insert(a)}catch(v){console.warn("Failed to create assignment notifications:",v)}}return await h(),{success:!0,message:"Repartidor asignado exitosamente"}}catch(i){return console.error("Unexpected error assigning driver:",i),{success:!1,message:"Error inesperado al asignar repartidor"}}},N=async(c,b,i,t)=>{if(!r)return{success:!1,message:"Debes iniciar sesi√≥n"};try{console.log("üåü Enviando calificaci√≥n:",{orderId:c,rating:b,type:i,comment:t});const{data:a}=await T.from("orders").select("buyer_id, seller_id, driver_id, status").eq("id",c).single();if(!a)return{success:!1,message:"Orden no encontrada"};const v=i==="seller"?a.seller_id:a.driver_id;if(!v)return{success:!1,message:`No hay ${i==="seller"?"vendedor":"repartidor"} asignado`};let l;if(r.id===a.buyer_id)l=i==="seller"?"buyer_to_seller":"buyer_to_driver";else if(r.id===a.seller_id)l=i==="seller"?"seller_to_buyer":"seller_to_driver";else return{success:!1,message:"No tienes permisos para calificar esta orden"};if(console.log("üéØ Tipo de calificaci√≥n:",l),a.status!=="delivered")return{success:!1,message:"Solo se pueden calificar √≥rdenes entregadas"};const{data:y}=await T.from("ratings").select("id").eq("order_id",c).eq("rater_id",r.id).eq("rated_id",v).eq("rating_type",l).eq("status","completed").single();if(y)return{success:!1,message:"Ya has calificado esta orden"};let O;const{data:L}=await T.from("ratings").select("id").eq("order_id",c).eq("rater_id",r.id).eq("rated_id",v).eq("rating_type",l).eq("status","pending").single();if(L)O=L.id;else{const{data:S,error:K}=await T.from("ratings").insert({order_id:c,rater_id:r.id,rated_id:v,rating_type:l,status:"pending"}).select("id").single();if(K)return console.error("Error creating rating:",K),{success:!1,message:"Error al crear la calificaci√≥n: "+K.message};if(!S)return{success:!1,message:"No se pudo crear la calificaci√≥n"};O=S.id}const{data:_,error:E}=await T.rpc("complete_rating",{p_rating_id:O,p_user_id:r.id,p_rating:b,p_comment:t||null});return E?(console.error("Error completing rating:",E),{success:!1,message:"Error al enviar la calificaci√≥n: "+E.message}):_?(console.log("‚úÖ Calificaci√≥n enviada exitosamente"),{success:!0,message:"¬°Calificaci√≥n enviada exitosamente!"}):{success:!1,message:"No se pudo completar la calificaci√≥n"}}catch(a){return console.error("Unexpected error rating order:",a),{success:!1,message:"Error inesperado al enviar la calificaci√≥n"}}},P=async c=>{try{const{data:b,error:i}=await T.from("orders").select(`
          *,
          order_items (*)
        `).eq("id",c).single();return i||!b?(console.error("Error fetching order:",i),null):{...b,items:b.order_items||[]}}catch(b){return console.error("Unexpected error fetching order:",b),null}},M=async(c,b)=>r?await C(c,"cancelled",b):{success:!1,message:"Debes iniciar sesi√≥n"},V=async c=>{if(!r||r.role!=="comprador")return{success:!1,message:"Solo los compradores pueden eliminar pedidos no confirmados"};try{p(!0);const{data:b,error:i}=await T.from("orders").select("status, buyer_id, seller_id, total").eq("id",c).single();if(i||!b)return{success:!1,message:"Orden no encontrada"};if(b.buyer_id!==r.id)return{success:!1,message:"No tienes permisos para eliminar esta orden"};if(b.status!=="pending")return{success:!1,message:"Solo se pueden eliminar pedidos pendientes"};const{data:t,error:a}=await T.from("order_items").select("product_id, quantity, product_name").eq("order_id",c);a&&console.error("Error fetching order items for stock restoration:",a);const{error:v}=await T.from("order_items").delete().eq("order_id",c);if(v)return console.error("Error deleting order items:",v),{success:!1,message:"Error al eliminar los items del pedido"};const{error:l}=await T.from("orders").delete().eq("id",c);if(l)return console.error("Error deleting order:",l),{success:!1,message:"Error al eliminar el pedido"};if(t&&t.length>0){console.log("üì¶ Restaurando stock despu√©s de eliminar orden...");try{for(const y of t){const O=await vs(y.product_id,y.quantity);O.success?console.log(`‚úÖ Stock restaurado: ${y.product_name} - Cantidad devuelta: ${y.quantity}`):console.warn(`‚ö†Ô∏è No se pudo restaurar stock para ${y.product_name}:`,O.message)}console.log("üéâ Stock restaurado exitosamente")}catch(y){console.error("‚ùå Error restaurando stock:",y)}}if(b.seller_id)try{await T.from("notifications").insert({recipient_id:b.seller_id,type:"order_cancelled",title:"Pedido Eliminado",message:`Un pedido por Q${b.total.toFixed(2)} fue eliminado por el cliente`,data:{order_id:c,deleted:!0}})}catch(y){console.warn("Failed to create cancellation notification:",y)}return d(y=>y.filter(O=>O.id!==c)),{success:!0,message:"Pedido eliminado exitosamente"}}catch(b){return console.error("Unexpected error deleting order:",b),{success:!1,message:"Error inesperado al eliminar el pedido"}}finally{p(!1)}},z=async()=>{await h()},f=c=>x.filter(b=>b.status===c),j=()=>x.filter(c=>!["completed","cancelled","rejected"].includes(c.status));m.useEffect(()=>{h()},[r]),m.useEffect(()=>{if(!r)return;const c=T.channel("orders").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:r.role==="comprador"?`buyer_id=eq.${r.id}`:r.role==="vendedor"?`seller_id=eq.${r.id}`:`driver_id=eq.${r.id}`},()=>{h()}).subscribe();return()=>{c.unsubscribe()}},[r]);const I={orders:x,loading:o,error:u,currentOrder:w,createOrder:R,updateOrderStatus:C,assignDriver:D,rateOrder:N,getOrderById:P,refreshOrders:z,getOrdersByStatus:f,getActiveOrders:j,cancelOrder:M,deleteUnconfirmedOrder:V};return e.jsx(Us.Provider,{value:I,children:s})}function ms(){const s=m.useContext(Us);if(s===void 0)throw new Error("useOrder must be used within an OrderProvider");return s}function Ye(s){if(s){if(s.startsWith("http://")||s.startsWith("https://"))return s;if(s.startsWith("business-logos/")||s.startsWith("avatars/")||s.startsWith("products/")){const r=s.startsWith("business-logos/")?"business-logos":s.startsWith("avatars/")?"avatars":"products",{data:n}=T.storage.from(r).getPublicUrl(s);return n.publicUrl}if(!s.includes("/")){const{data:r}=T.storage.from("business-logos").getPublicUrl(s);return r.publicUrl}return s}}function Ss(s){var r;if(s.logo_url)return Ye(s.logo_url);if((r=s.user)!=null&&r.avatar_url)return Ye(s.user.avatar_url)}function Cs(s){if(s.image_url)return Ye(s.image_url)}function Gs(s){return Ye(s)}const kr=()=>{const[s,r]=m.useState(()=>typeof document<"u"?!document.hidden:!0);return m.useEffect(()=>{if(typeof document>"u")return;const n=()=>{r(!document.hidden)};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]),s};function Qs(){const[s,r]=m.useState([]),[n,x]=m.useState([]),[d,o]=m.useState([]),[p,u]=m.useState({products:!1,dailyProducts:!1,businesses:!1}),g=kr(),w=async f=>{var j,I;try{u(t=>({...t,products:!0}));let c=T.from("products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            business_description,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0);f!=null&&f.search&&(c=c.or(`name.ilike.%${f.search}%,description.ilike.%${f.search}%`)),f!=null&&f.category&&f.category!=="all"&&(c=c.eq("category",f.category)),f!=null&&f.limit&&(c=c.limit(f.limit));let{data:b,error:i}=await c.order("created_at",{ascending:!1});if(i){const t=(i==null?void 0:i.code)||"",a=((I=(j=i==null?void 0:i.message)==null?void 0:j.toLowerCase)==null?void 0:I.call(j))||"";if(t==="PGRST201"||t==="PGRST200"||t==="42P01"||t==="42703"||a.includes("relationship")||a.includes("column")||a.includes("relation")){let l=T.from("products").select("*").eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0);f!=null&&f.search&&(l=l.or(`name.ilike.%${f.search}%,description.ilike.%${f.search}%`)),f!=null&&f.category&&f.category!=="all"&&(l=l.eq("category",f.category)),f!=null&&f.limit&&(l=l.limit(f.limit));const y=await l.order("created_at",{ascending:!1});b=y.data,i=y.error}}i?(console.error("Error fetching products:",i),r([])):r(b||[])}catch(c){console.error("Error fetching products:",c)}finally{u(c=>({...c,products:!1}))}},q=async()=>{var f,j;try{u(t=>({...t,dailyProducts:!0}));const I=new Date,c=new Date(I);c.setHours(23,59,59,999);let{data:b,error:i}=await T.from("daily_products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",c.toISOString()).order("created_at",{ascending:!1});if(i){const t=(i==null?void 0:i.code)||"",a=((j=(f=i==null?void 0:i.message)==null?void 0:f.toLowerCase)==null?void 0:j.call(f))||"";if(t==="PGRST205"){console.log("daily_products table does not exist yet"),x([]);return}if(t==="PGRST201"||t==="PGRST200"||t==="42P01"||t==="42703"||a.includes("relationship")||a.includes("relation")||a.includes("column")){const l=await T.from("daily_products").select(`
              *,
              seller:sellers(
                id,
                business_name,
                logo_url,
                is_verified
              )
            `).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",c.toISOString()).order("created_at",{ascending:!1});if(l.error){const y=await T.from("daily_products").select("*").gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",c.toISOString()).order("created_at",{ascending:!1});b=y.data,i=y.error}else b=l.data,i=l.error}}if(i)console.error("Error fetching daily products:",i),x([]);else{const t=b?b.filter((a,v,l)=>v===l.findIndex(y=>y.name===a.name)):[];console.log(`üì¶ Productos del d√≠a cargados: ${(b==null?void 0:b.length)||0} total, ${t.length} √∫nicos`),x(t)}}catch(I){console.error("Error fetching daily products:",I)}finally{u(I=>({...I,dailyProducts:!1}))}},h=async()=>{var f,j;try{u(l=>({...l,businesses:!0}));let{data:I,error:c}=await T.from("sellers").select(`
          id,
          business_name,
          business_description,
          business_address,
          business_phone,
          phone,
          address,
          business_logo,
          cover_image_url,
          logo_url,
          is_verified,
          user:users(name, phone, email, address, avatar_url)
        `).not("business_name","is",null).order("is_verified",{ascending:!1});if(c){const l=(c==null?void 0:c.code)||"",y=((j=(f=c==null?void 0:c.message)==null?void 0:f.toLowerCase)==null?void 0:j.call(f))||"";if(l==="PGRST201"||l==="PGRST200"||l==="42P01"||l==="42703"||y.includes("relationship")||y.includes("column")||y.includes("relation")){const L=await T.from("sellers").select("id,business_name,business_description,business_address,business_phone,phone,address,business_logo,cover_image_url,logo_url,is_verified").not("business_name","is",null).order("is_verified",{ascending:!1});I=L.data,c=L.error}}if(c){console.error("Error fetching businesses:",c),o([]);return}const b=I||[],i=b.map(l=>l.id);let t=new Map,a=new Map;if(i.length>0){try{const{data:l,error:y}=await T.from("products").select("seller_id").in("seller_id",i).eq("is_public",!0);y?console.error("Error fetching products for counts:",y):t=(l==null?void 0:l.reduce((O,L)=>(O.set(L.seller_id,(O.get(L.seller_id)||0)+1),O),new Map))??new Map}catch(l){console.error("Error aggregating product counts:",l)}try{const{data:l,error:y}=await T.from("seller_ratings_view").select("seller_id, average_rating").in("seller_id",i);y?console.error("Error fetching ratings:",y):a=(l==null?void 0:l.reduce((O,L)=>(O.set(L.seller_id,L.average_rating||0),O),new Map))??new Map}catch(l){console.error("Error aggregating ratings:",l)}}const v=b.map(l=>{var S,K,ne,U,Y,te;const y=l.cover_image_url||l.business_logo||l.logo_url,O=l.business_logo||l.logo_url,L=Ss({logo_url:O??void 0,user:l.user?{avatar_url:l.user.avatar_url}:void 0});console.log("üî• BUSINESS DATA:",{id:l.id,name:l.business_name,cover_image_url:l.cover_image_url,business_logo:l.business_logo,logo_url:l.logo_url,final_cover:y,final_logo:O});const _=t.get(l.id)||0,E=a.get(l.id)||0;return{id:l.id,business_name:l.business_name,business_description:l.business_description??void 0,business_address:l.business_address??void 0,business_phone:l.business_phone??void 0,logo_url:O??void 0,cover_image_url:y??void 0,is_verified:l.is_verified,products_count:_,rating:E,phone:l.phone,address:l.address,user:{name:((S=l.user)==null?void 0:S.name)??"Usuario",phone:((K=l.user)==null?void 0:K.phone)??void 0,email:((ne=l.user)==null?void 0:ne.email)??void 0,address:((U=l.user)==null?void 0:U.address)??void 0,avatar_url:((Y=l.user)==null?void 0:Y.avatar_url)??void 0},cover_image:y??void 0,category:"General",phone_number:l.phone||l.business_phone||((te=l.user)==null?void 0:te.phone)||void 0,is_open_now:!0}});o(v)}catch(I){console.error("Error fetching businesses:",I)}finally{u(I=>({...I,businesses:!1}))}},R=async f=>{var j,I;try{let c=T.from("products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified
          )
        `).eq("seller_id",f).eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}),{data:b,error:i}=await c;if(i){const a=(i==null?void 0:i.code)||"",v=((I=(j=i==null?void 0:i.message)==null?void 0:j.toLowerCase)==null?void 0:I.call(j))||"";if(a==="PGRST201"||a==="PGRST200"||a==="42P01"||a==="42703"||v.includes("relationship")||v.includes("column")||v.includes("relation")){const y=await T.from("products").select("*").eq("seller_id",f).eq("is_public",!0).eq("is_available",!0).gt("stock_quantity",0).order("created_at",{ascending:!1});b=y.data,i=y.error}}if(i)return console.error("Error fetching business products:",i),[];const t=(b==null?void 0:b.map(a=>({...a,is_actually_available:a.is_available&&a.stock_quantity>0,stock_info:{has_stock:a.stock_quantity>0,is_low_stock:a.stock_quantity<=5&&a.stock_quantity>0,is_last_units:a.stock_quantity<=3&&a.stock_quantity>0,count:a.stock_quantity}})))||[];return console.log("üì¶ Productos procesados (USANDO COLUMNA REAL):",{total:t.length,available:t.filter(a=>a.is_actually_available).length,with_stock:t.filter(a=>a.stock_info.has_stock).length,low_stock:t.filter(a=>a.stock_info.is_low_stock).length,products_sample:t.slice(0,3).map(a=>({name:a.name,is_available:a.is_available,stock_quantity:a.stock_quantity,is_actually_available:a.is_actually_available}))}),t}catch(c){return console.error("Error fetching business products:",c),[]}},C=async f=>{var j,I;try{const c=new Date,b=new Date(c);b.setHours(23,59,59,999);let{data:i,error:t}=await T.from("daily_products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).eq("seller_id",f).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",b.toISOString()).order("created_at",{ascending:!1});if(t){const a=t==null?void 0:t.code;if(a==="PGRST205")return console.log("daily_products table does not exist yet"),[];const v=((I=(j=t==null?void 0:t.message)==null?void 0:j.toLowerCase)==null?void 0:I.call(j))||"";if(a==="PGRST200"||a==="42P01"||a==="42703"||v.includes("relationship")||v.includes("column")||v.includes("relation")){const y=await T.from("daily_products").select("*").eq("seller_id",f).gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",b.toISOString()).order("created_at",{ascending:!1});i=y.data,t=y.error}}return t?(console.error("Error fetching business daily products:",t),[]):i||[]}catch(c){return console.error("Error fetching business daily products:",c),[]}},D=async f=>{try{const{data:j,error:I}=await T.from("sellers").select(`
          id,
          business_name,
          business_description,
          business_address,
          business_phone,
          phone,
          address,
          business_logo,
          cover_image_url,
          logo_url,
          is_verified,
          rating_avg
        `).eq("id",f).single();if(I)return console.error("Error fetching business:",I),null;const{data:c,error:b}=await T.from("users").select("name, phone, email, address, avatar_url").eq("id",f).single();b&&console.error("Error fetching user data:",b);const{count:i}=await T.from("products").select("*",{count:"exact",head:!0}).eq("seller_id",f).eq("is_public",!0);let t=0;try{const{data:L,error:_}=await T.from("seller_ratings_view").select("average_rating").eq("seller_id",f).single();!_&&L&&(t=L.average_rating||0)}catch(L){console.error("Error fetching business rating:",L)}const a={...j,user:c||null,products_count:i||0,rating:t};console.log("üî• COMBINED DATA DEBUG:",{seller_data:{phone:j.phone,address:j.address,business_phone:j.business_phone,business_address:j.business_address},user_data:c,combined_user:a.user});const v=(j==null?void 0:j.cover_image_url)||(j==null?void 0:j.business_logo)||(j==null?void 0:j.logo_url),l=(j==null?void 0:j.business_logo)||(j==null?void 0:j.logo_url),y=Ss({logo_url:l??void 0,user:j!=null&&j.user?{avatar_url:j.user.avatar_url}:void 0});console.log("üî• getBusinessById DATA:",{id:j==null?void 0:j.id,name:j==null?void 0:j.business_name,cover_image_url:j==null?void 0:j.cover_image_url,business_logo:j==null?void 0:j.business_logo,logo_url:j==null?void 0:j.logo_url,final_cover:v,final_logo:l});const O=j;return{id:a.id,business_name:a.business_name,business_description:a.business_description??void 0,business_address:a.business_address??void 0,business_phone:a.business_phone??void 0,logo_url:l??void 0,cover_image_url:v??void 0,is_verified:a.is_verified,products_count:a.products_count,rating:a.rating,phone:a.phone,address:a.address,user:a.user?{name:a.user.name,phone:a.user.phone,email:a.user.email,address:a.user.address,avatar_url:a.user.avatar_url}:void 0,cover_image:v??void 0,category:"General",is_open_now:!0}}catch(j){return console.error("Error fetching business by ID:",j),null}},N=async f=>{await Promise.all([w({search:f})])},P=async(f=8)=>{try{const{data:j,error:I}=await T.from("products").select(`
          *,
          seller:sellers(
            id,
            business_name,
            logo_url,
            is_verified,
            user:users(name, avatar_url)
          )
        `).eq("is_public",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}).limit(f);return I?(console.error("Error fetching featured products:",I),[]):j||[]}catch(j){return console.error("Error fetching featured products:",j),[]}},M=f=>{const j=new Date,c=new Date(f).getTime()-j.getTime();if(c<=0)return"Expirado";const b=Math.floor(c/(1e3*60*60)),i=Math.floor(c%(1e3*60*60)/(1e3*60));return b>0?`${b}h ${i}m restantes`:`${i}m restantes`};m.useEffect(()=>{w(),q(),h();const f=setInterval(()=>{g?(console.log("üî• Actualizando productos del d√≠a autom√°ticamente..."),q()):console.log("‚è∏Ô∏è App en background - pausando actualizaci√≥n de productos del d√≠a")},5*60*1e3),j=setInterval(()=>{g?(console.log("üîÑ Actualizando productos autom√°ticamente (stock en tiempo real)..."),w()):console.log("‚è∏Ô∏è App en background - pausando actualizaci√≥n de productos")},30*1e3),I=setInterval(()=>{g?(console.log("üè™ Actualizando negocios autom√°ticamente..."),h()):console.log("‚è∏Ô∏è App en background - pausando actualizaci√≥n de negocios")},10*60*1e3);return()=>{clearInterval(f),clearInterval(j),clearInterval(I)}},[g]),m.useEffect(()=>{g&&(console.log("üì± App volvi√≥ a primer plano - refrescando datos..."),w(),q())},[g]),m.useEffect(()=>{const f=j=>{console.log("üö® Stock actualizado - refrescando datos:",j.detail),z(),q()};return window.addEventListener("stockUpdated",f),()=>{window.removeEventListener("stockUpdated",f)}},[]);const V=async()=>{console.log("üîÑ Refrescando todos los datos manualmente..."),await Promise.all([w(),q(),h()])},z=async()=>{console.log("üé≤ Mezclando productos para mostrar nuevos...");try{u(t=>({...t,products:!0,dailyProducts:!0}));const{data:f,error:j}=await T.from("products").select("*").eq("is_public",!0).gt("stock_quantity",0).order("created_at",{ascending:!1});if(j)console.error("‚ùå Error al obtener productos:",j);else{const t=f?[...f].sort(()=>Math.random()-.5):[];console.log("‚úÖ Productos mezclados:",(t==null?void 0:t.length)||0),r(t||[])}const I=new Date,c=new Date(I);c.setHours(23,59,59,999);const{data:b,error:i}=await T.from("daily_products").select("*").gt("stock_quantity",0).gte("expires_at",new Date().toISOString()).lte("expires_at",c.toISOString()).order("created_at",{ascending:!1});if(i&&i.code!=="PGRST205")console.error("‚ùå Error al obtener productos del d√≠a:",i);else{const a=(b?[...b].sort(()=>Math.random()-.5):[]).filter((v,l,y)=>l===y.findIndex(O=>O.name===v.name));console.log("‚úÖ Productos del d√≠a mezclados:",(a==null?void 0:a.length)||0),x(a)}}catch(f){console.error("‚ùå Error cr√≠tico al mezclar productos:",f)}finally{u(f=>({...f,products:!1,dailyProducts:!1}))}console.log("‚úÖ Productos nuevos listos para descubrir")};return{products:s,dailyProducts:n,businesses:d,loading:p,isPageVisible:g,fetchProducts:w,fetchDailyProducts:q,fetchBusinesses:h,refreshAllData:V,refreshProductStock:z,getBusinessProducts:R,getBusinessDailyProducts:C,getBusinessById:D,searchAll:N,getFeaturedProducts:P,getTimeRemaining:M}}function us({onCartClick:s}){const{items:r,getCartItemCount:n,getCartTotal:x}=Pe(),d=n(),o=x();return d===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs($,{onClick:()=>{console.log("FloatingCart clicked!"),s?s():alert(`Carrito: ${d} productos - Q${o.toFixed(2)}`)},className:"relative h-16 w-16 rounded-full bg-orange-500 hover:bg-orange-600 shadow-xl",children:[e.jsx(we,{className:"w-6 h-6 text-white"}),e.jsx(Z,{className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center",children:d})]})})}function Sr({viewMode:s,setViewMode:r,onRefreshStock:n,onRefreshAll:x,isLoading:d,isRefreshing:o,lastUpdated:p,searchQuery:u,selectedCategory:g}){return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Explorar Productos"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:[e.jsxs("span",{children:["Actualizado: ",p.toLocaleTimeString()]}),(u||g!=="all")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-orange-600 font-medium",children:[u&&`"${u}"`,u&&g!=="all"&&" ‚Ä¢ ",g!=="all"&&g]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs($,{onClick:n,disabled:o,size:"sm",variant:"outline",className:"gap-2 border-green-300 text-green-600 hover:bg-green-50 bg-green-50",children:[e.jsx(De,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Descubrir"]})})]})})}function Cr({searchQuery:s,setSearchQuery:r,selectedCategory:n,setSelectedCategory:x,categories:d,onSearch:o,isLoading:p}){const[u,g]=m.useState(!1),w=m.useRef(null);m.useEffect(()=>{u&&w.current&&w.current.focus()},[u]),m.useEffect(()=>{const R=C=>{C.key==="Escape"&&u&&g(!1)};return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)},[u]);const q=()=>{o(),g(!1)},h=()=>{r(""),x("all"),g(!1)};return e.jsxs(e.Fragment,{children:[u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 backdrop-blur-sm z-40",onClick:()=>g(!1)}),!u&&e.jsx($,{onClick:()=>g(!0),className:"fixed bottom-24 right-4 z-50 w-14 h-14 rounded-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-white",size:"sm",children:e.jsx(ze,{className:"w-6 h-6 text-white"})}),u&&e.jsx("div",{className:"fixed bottom-24 left-4 right-4 z-50 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 space-y-4 animate-in slide-in-from-bottom-2 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"font-semibold text-gray-800",children:"Buscar productos"})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>g(!1),className:"h-8 w-8 p-0 hover:bg-gray-100",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(be,{ref:w,placeholder:"¬øQu√© est√°s buscando?",value:s,onChange:R=>r(R.target.value),className:"pl-10 h-12 border-gray-200 focus:border-orange-300 focus:ring-orange-200",onKeyPress:R=>{R.key==="Enter"&&q()}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gr,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Categor√≠a"})]}),e.jsxs(za,{value:n,onValueChange:x,children:[e.jsx(Ma,{className:"h-10 border-gray-200",children:e.jsx(La,{placeholder:"Todas las categor√≠as"})}),e.jsxs(Ba,{children:[e.jsx(bs,{value:"all",children:"Todas las categor√≠as"}),d.map(R=>e.jsx(bs,{value:R,children:R},R))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx($,{variant:"outline",onClick:h,className:"flex-1 h-10",disabled:p,children:"Limpiar"}),e.jsx($,{onClick:q,disabled:p,className:"flex-1 h-10 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Buscar"]})})]}),(s||n!=="all")&&e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs",children:[e.jsxs("span",{children:['"',s,'"']}),e.jsx("button",{onClick:()=>r(""),className:"hover:text-orange-900",children:e.jsx(Le,{className:"w-3 h-3"})})]}),n!=="all"&&e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:[e.jsx("span",{children:n}),e.jsx("button",{onClick:()=>x("all"),className:"hover:text-blue-900",children:e.jsx(Le,{className:"w-3 h-3"})})]})]})})]})})]})}function Er(s,r="regular"){const[n,x]=m.useState({stock_quantity:0,sold_quantity:0,available_stock:0,loading:!0,error:null});return m.useEffect(()=>{if(!s)return;const d=async()=>{try{if(x(p=>({...p,loading:!0,error:null})),r==="daily"){const{data:p,error:u}=await T.from("daily_products").select("stock_quantity").eq("id",s).single();if(u)throw u;const{data:g,error:w}=await T.from("order_items").select(`
              quantity,
              orders!inner (
                status
              )
            `).eq("product_id",s).eq("product_type","daily").in("orders.status",["confirmed","preparing","ready","out_for_delivery","delivered"]);w&&console.warn("Error fetching sold quantity:",w);const q=(g==null?void 0:g.reduce((C,D)=>C+(D.quantity||0),0))||0,h=p.stock_quantity||0,R=Math.max(0,h-q);x({stock_quantity:h,sold_quantity:q,available_stock:R,loading:!1,error:null})}else{const{data:p,error:u}=await T.from("products").select("stock_quantity").eq("id",s).single();if(u)throw u;const g=p.stock_quantity||0;x({stock_quantity:g,sold_quantity:0,available_stock:g,loading:!1,error:null})}}catch(p){console.error("Error fetching real-time stock:",p),x(u=>({...u,loading:!1,error:p.message||"Error loading stock"}))}};d();const o=setInterval(d,3e4);return()=>clearInterval(o)},[s,r]),n}function Pr(s){const[r,n]=m.useState({average_rating:0,total_reviews:0,loading:!0});return m.useEffect(()=>{if(!s)return;(async()=>{try{const{data:d,error:o}=await T.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s).single();if(o){console.warn("No rating found for seller:",s),n({average_rating:0,total_reviews:0,loading:!1});return}n({average_rating:d.average_rating||0,total_reviews:d.total_reviews||0,loading:!1})}catch(d){console.error("Error fetching seller rating:",d),n({average_rating:0,total_reviews:0,loading:!1})}})()},[s]),r}function Tr(s){const[r,n]=m.useState({hours:0,minutes:0,isExpired:!0,formattedTime:"Expirado"});return m.useEffect(()=>{if(!s)return;const x=()=>{const o=Da(s);n({hours:o.hours,minutes:o.minutes,isExpired:o.isExpired,formattedTime:o.isExpired?"Expirado":o.hours>0?`${o.hours}h ${o.minutes}m restantes`:`${o.minutes}m restantes`})};x();const d=setInterval(x,6e4);return()=>clearInterval(d)},[s]),r}function os({product:s,viewMode:r,cartQuantity:n,onAddToCart:x,onUpdateQuantity:d,onImageClick:o,onBusinessClick:p,addingToCart:u,editingQuantity:g,tempQuantity:w,onQuantityClick:q,onQuantityChange:h,onQuantitySubmit:R,onQuantityKeyDown:C}){var L,_,E,S;const[D,N]=m.useState(!1),[P,M]=m.useState(!1),V="expires_at"in s,z=s.image_url||"",f=(((L=s.description)==null?void 0:L.length)||0)>100,j=((_=s.seller)==null?void 0:_.name)||"Tienda",{available_stock:I,stock_quantity:c,sold_quantity:b,loading:i}=Er(s.id,V?"daily":"regular"),{average_rating:t,total_reviews:a,loading:v}=Pr(s.seller_id||""),l=Tr(V&&"expires_at"in s?s.expires_at:void 0),y=i?s.stock_quantity||0:I,O=()=>{N(!D)};return r==="list"?e.jsx(Q,{className:"mb-4 overflow-hidden hover:shadow-lg transition-all duration-200 border-gray-200",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-32 h-32 flex-shrink-0 relative",children:[e.jsx(ye,{src:z,alt:s.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>z&&o(z)}),V&&e.jsx(Z,{className:"absolute top-2 left-2 bg-red-500 text-white text-xs",children:"Del d√≠a"}),e.jsx($,{size:"sm",variant:"ghost",className:"absolute top-2 right-2 h-8 w-8 p-0 bg-white/80 hover:bg-white",onClick:O,children:e.jsx(Xe,{className:`w-4 h-4 ${D?"fill-red-500 text-red-500":"text-gray-600"}`})})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 line-clamp-1",children:s.name}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xl font-bold text-green-600",children:["Q",(E=s.price)==null?void 0:E.toFixed(2)]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:`text-sm text-gray-600 ${f&&!P?"line-clamp-2":""}`,children:s.description}),f&&e.jsx("button",{onClick:()=>M(!P),className:"text-xs text-orange-600 hover:text-orange-700 hover:underline mt-1 block",children:P?"Ver menos":"Ver m√°s"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsx("button",{onClick:()=>p(s.seller_id),className:"hover:text-orange-600 hover:underline",children:j})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),v?e.jsx("span",{className:"animate-pulse bg-gray-200 w-6 h-3 rounded"}):e.jsxs("span",{className:"font-medium",children:[t>0?t.toFixed(1):"0.0",a>0&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",a,")"]})]})]}),V&&!l.isExpired&&e.jsxs("div",{className:"flex items-center gap-1 text-orange-600 font-medium",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{children:"Termina hoy"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),e.jsx("span",{children:"2.1 km"})]})]}),V&&!l.isExpired&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-md mb-3",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:l.formattedTime})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-1",children:y>0?e.jsxs(Z,{variant:"outline",className:"text-green-600 border-green-300",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),i?e.jsx("span",{className:"animate-pulse",children:"Cargando..."}):e.jsxs(e.Fragment,{children:["Stock: ",y,V&&b>0&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",c-b,"/",c,")"]})]})]}):e.jsxs(Z,{variant:"outline",className:"text-red-600 border-red-300",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),"Agotado"]})}),e.jsx("div",{className:"flex items-center gap-2",children:n>0?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>d(s.id,n-1),className:"h-8 w-8 p-0",children:e.jsx(He,{className:"w-3 h-3"})}),g?e.jsx(be,{type:"number",value:w,onChange:K=>h(K.target.value),onBlur:()=>R(s.id),onKeyDown:K=>C(K,s.id),className:"w-16 h-8 text-center text-sm",autoFocus:!0}):e.jsx("button",{onClick:()=>q(s.id,n),className:"w-16 h-8 text-sm font-medium bg-gray-100 rounded border hover:bg-gray-200",children:n}),e.jsx($,{size:"sm",variant:"outline",onClick:()=>d(s.id,n+1),className:"h-8 w-8 p-0",disabled:n>=y,children:e.jsx(ke,{className:"w-3 h-3"})})]}):e.jsxs($,{size:"sm",onClick:()=>x(s.id,V,s.name),disabled:u||y<=0,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"Agregar"]})})]})]})]})})}):e.jsx(Q,{className:"overflow-hidden hover:shadow-lg transition-all duration-200 border-gray-200 h-full",children:e.jsxs(H,{className:"p-0",children:[e.jsxs("div",{className:"relative aspect-square",children:[e.jsx(ye,{src:z,alt:s.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>z&&o(z)}),e.jsxs("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[V&&e.jsx(Z,{className:"bg-red-500 text-white text-xs",children:"Del d√≠a"}),y<=5&&y>0&&e.jsxs(Z,{variant:"outline",className:"bg-yellow-500 text-white text-xs border-yellow-500",children:["√öltimos ",y]})]}),e.jsx($,{size:"sm",variant:"ghost",className:"absolute top-2 right-2 h-8 w-8 p-0 bg-white/80 hover:bg-white",onClick:O,children:e.jsx(Xe,{className:`w-4 h-4 ${D?"fill-red-500 text-red-500":"text-gray-600"}`})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:y>0?e.jsxs(Z,{variant:"outline",className:"bg-white text-green-600 border-green-300 text-xs",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),i?"...":y,V&&b>0&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["/",c]})]}):e.jsxs(Z,{variant:"outline",className:"bg-white text-red-600 border-red-300 text-xs",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),"Agotado"]})}),V&&!l.isExpired&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(Z,{className:"bg-orange-500 text-white text-xs font-semibold",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Del D√≠a"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-800 line-clamp-2 mb-1",children:s.name}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:`text-sm text-gray-600 ${f&&!P?"line-clamp-2":""}`,children:s.description}),f&&e.jsx("button",{onClick:()=>M(!P),className:"text-xs text-orange-600 hover:text-orange-700 hover:underline mt-1 block",children:P?"Ver menos":"Ver m√°s"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("button",{onClick:()=>p(s.seller_id),className:"flex items-center gap-1 hover:text-orange-600 hover:underline",children:[e.jsx(de,{className:"w-3 h-3"}),j]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),v?e.jsx("span",{className:"animate-pulse bg-gray-200 w-6 h-3 rounded"}):e.jsxs("span",{children:[t>0?t.toFixed(1):"0.0",a>0&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",a,")"]})]})]})]}),V&&!l.isExpired&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-md mb-2",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:l.formattedTime})]}),e.jsxs("div",{className:"text-xl font-bold text-green-600 mb-3",children:["Q",(S=s.price)==null?void 0:S.toFixed(2)]})]}),e.jsx("div",{className:"space-y-2",children:n>0?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>d(s.id,n-1),className:"h-8 w-8 p-0",children:e.jsx(He,{className:"w-3 h-3"})}),g?e.jsx(be,{type:"number",value:w,onChange:K=>h(K.target.value),onBlur:()=>R(s.id),onKeyDown:K=>C(K,s.id),className:"w-16 h-8 text-center text-sm",autoFocus:!0}):e.jsx("button",{onClick:()=>q(s.id,n),className:"w-16 h-8 text-sm font-medium bg-gray-100 rounded border hover:bg-gray-200",children:n}),e.jsx($,{size:"sm",variant:"outline",onClick:()=>d(s.id,n+1),className:"h-8 w-8 p-0",disabled:n>=y,children:e.jsx(ke,{className:"w-3 h-3"})})]}):e.jsxs($,{onClick:()=>x(s.id,V,s.name),disabled:u||y<=0,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Agregar al carrito"]})})]})]})})}function Ir({products:s,viewMode:r,cartItems:n,onAddToCart:x,onUpdateQuantity:d,onImageClick:o,onBusinessClick:p,addingToCart:u,editingQuantity:g,tempQuantity:w,onQuantityClick:q,onQuantityChange:h,onQuantitySubmit:R,onQuantityKeyDown:C,loading:D=!1}){const N=P=>{const M=n.find(V=>V.product_id===P);return(M==null?void 0:M.quantity)||0};return D?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(8)].map((P,M)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-200 aspect-square rounded-lg mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"})]})]},M))})}):!s||s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2m13-8l-8 8-4-4"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron productos"}),e.jsx("p",{className:"text-gray-500",children:"Intenta cambiar los filtros de b√∫squeda o revisa m√°s tarde."})]}):e.jsxs("div",{className:"space-y-6",children:[r==="grid"?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:s.map(P=>e.jsx(os,{product:P,viewMode:r,cartQuantity:N(P.id),onAddToCart:x,onUpdateQuantity:d,onImageClick:o,onBusinessClick:p,addingToCart:u===P.id,editingQuantity:g===P.id,tempQuantity:w,onQuantityClick:q,onQuantityChange:h,onQuantitySubmit:R,onQuantityKeyDown:C},P.id))}):e.jsx("div",{className:"space-y-4",children:s.map(P=>e.jsx(os,{product:P,viewMode:r,cartQuantity:N(P.id),onAddToCart:x,onUpdateQuantity:d,onImageClick:o,onBusinessClick:p,addingToCart:u===P.id,editingQuantity:g===P.id,tempQuantity:w,onQuantityClick:q,onQuantityChange:h,onQuantitySubmit:R,onQuantityKeyDown:C},P.id))}),s.length>0&&s.length%20===0&&e.jsx("div",{className:"text-center pt-8",children:e.jsx("button",{className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium",children:"Cargar m√°s productos"})})]})}function qr({dailyProducts:s,cartItems:r,onAddToCart:n,onUpdateQuantity:x,onImageClick:d,onBusinessClick:o,addingToCart:p,editingQuantity:u,tempQuantity:g,onQuantityClick:w,onQuantityChange:q,onQuantitySubmit:h,onQuantityKeyDown:R,loading:C=!1}){const D=N=>{const P=r.find(M=>M.product_id===N);return(P==null?void 0:P.quantity)||0};return C?e.jsxs(Q,{className:"border-red-200 shadow-lg",children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ie,{className:"w-6 h-6"}),"Productos del D√≠a"]}),e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})})]})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((N,P)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-200 aspect-square rounded-lg mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]},P))})})]}):!s||s.length===0?e.jsxs(Q,{className:"border-red-200 shadow-lg",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ie,{className:"w-6 h-6"}),"Productos del D√≠a"]})}),e.jsx(H,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay productos del d√≠a disponibles en este momento."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"¬°Vuelve ma√±ana para ver las nuevas ofertas!"})]})})]}):e.jsxs(Q,{className:"border-red-200 shadow-lg",children:[e.jsxs(ee,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ie,{className:"w-6 h-6"}),"Productos del D√≠a"]}),e.jsxs(Z,{variant:"destructive",className:"animate-pulse",children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Oferta especial"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ofertas especiales disponibles solo por hoy. ¬°No te las pierdas!"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(N=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsxs(Z,{className:"bg-red-500 text-white text-xs font-semibold",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Oferta del d√≠a"]})}),e.jsx(os,{product:N,viewMode:"grid",cartQuantity:D(N.id),onAddToCart:n,onUpdateQuantity:x,onImageClick:d,onBusinessClick:o,addingToCart:p===N.id,editingQuantity:u===N.id,tempQuantity:g,onQuantityClick:w,onQuantityChange:q,onQuantitySubmit:h,onQuantityKeyDown:R})]},N.id))}),s.length>3&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{className:"text-red-600 hover:text-red-700 font-medium text-sm hover:underline",children:"Ver todos los productos del d√≠a ‚Üí"})})]})]})}function Es({onBusinessClick:s,onShowCart:r}){const{user:n}=Se(),{items:x,addToCart:d,updateCartItem:o,removeFromCart:p}=Pe(),{products:u,dailyProducts:g,businesses:w,loading:q,refreshProductStock:h,refreshAllData:R}=Qs(),{openImageModal:C}=Os(),[D,N]=m.useState(""),[P,M]=m.useState("all"),[V,z]=m.useState("grid"),[f,j]=m.useState(null),[I,c]=m.useState(!1),[b,i]=m.useState(new Date),[t,a]=m.useState(null),[v,l]=m.useState(""),[y,O]=m.useState([]),L=["Comida","Bebidas","Dulces","Panader√≠a","L√°cteos","Carnes","Verduras","Frutas","Limpieza","Cuidado Personal"],_=async()=>{const B=u.filter(A=>{var pe;const ae=!D||A.name.toLowerCase().includes(D.toLowerCase())||((pe=A.description)==null?void 0:pe.toLowerCase().includes(D.toLowerCase())),re=P==="all"||A.category===P;return ae&&re});O(B)};m.useEffect(()=>{_()},[u,D,P]),m.useEffect(()=>{O(u)},[u]);const E=async(B,A=!1,ae="Producto")=>{if(!n){G.error("Debes iniciar sesi√≥n para agregar productos");return}try{j(B);const re=await d(B,1,A?"daily":"regular");re!=null&&re.success?G.success("Agregado al carrito"):G.error(`‚ùå Error: ${(re==null?void 0:re.message)||"No se pudo agregar el producto"}`)}catch(re){console.error("Error adding to cart:",re),G.error("‚ùå Error al agregar producto al carrito")}finally{j(null)}},S=async(B,A)=>{const ae=x.find(re=>re.product_id===B);ae&&(A<=0?await p(ae.id):await o(ae.id,A))},K=(B,A)=>{a(B),l(A.toString())},ne=B=>{const A=parseInt(B);!isNaN(A)&&A>=0&&l(B)},U=async B=>{const A=parseInt(v);isNaN(A)||await S(B,A),a(null),l("")},Y=async(B,A)=>{B.key==="Enter"?await U(A):B.key==="Escape"&&(a(null),l(""))},te=async()=>{if(!I)try{c(!0),await h(),i(new Date),G.success("‚úÖ Productos actualizados - Nuevos productos disponibles")}catch(B){console.error("‚ùå Error en refresco manual:",B),G.error("‚ùå Error al actualizar productos - Intenta de nuevo")}finally{c(!1)}};m.useEffect(()=>{u.length>0&&i(new Date)},[u]);const ve=B=>{s(B)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Sr,{searchQuery:D,setSearchQuery:N,selectedCategory:P,setSelectedCategory:M,viewMode:V,setViewMode:z,categories:L,onSearch:_,onRefreshStock:te,onRefreshAll:R,isLoading:Object.values(q).some(Boolean),isRefreshing:I,lastUpdated:b}),e.jsxs(Ze,{defaultValue:"products",className:"w-full",children:[e.jsxs(Je,{className:"grid w-full grid-cols-3",children:[e.jsxs(_e,{value:"products",className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Productos"]}),e.jsxs(_e,{value:"daily",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Del D√≠a"]}),e.jsxs(_e,{value:"businesses",className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Negocios"]})]}),e.jsx(je,{value:"products",className:"space-y-6",children:e.jsxs(Q,{className:"border-orange-200 shadow-lg",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-orange-500"}),"Todos los Productos"]})}),e.jsx(H,{children:e.jsx(Ir,{products:y,viewMode:V,cartItems:x,onAddToCart:E,onUpdateQuantity:S,onImageClick:C,onBusinessClick:ve,addingToCart:f,editingQuantity:t,tempQuantity:v,onQuantityClick:K,onQuantityChange:ne,onQuantitySubmit:U,onQuantityKeyDown:Y,loading:q.products})})]})}),e.jsx(je,{value:"daily",className:"space-y-6",children:e.jsx(qr,{dailyProducts:g,cartItems:x,onAddToCart:E,onUpdateQuantity:S,onImageClick:C,onBusinessClick:ve,addingToCart:f,editingQuantity:t,tempQuantity:v,onQuantityClick:K,onQuantityChange:ne,onQuantitySubmit:U,onQuantityKeyDown:Y,loading:q.dailyProducts})}),e.jsx(je,{value:"businesses",className:"space-y-6",children:e.jsxs(Q,{className:"border-green-200 shadow-lg",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-green-500"}),"Negocios Locales"]})}),e.jsx(H,{children:q.businesses?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((B,A)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-200 h-32 rounded-t-lg mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]},A))}):w&&w.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(B=>{var re;const A=B.cover_image_url||B.cover_image,ae=B.logo_url;return e.jsxs(Q,{className:"cursor-pointer hover:shadow-xl transition-all duration-300 border-green-200",onClick:()=>ve(B.id),children:[e.jsxs("div",{className:"relative",children:[A?e.jsx(ye,{src:A,alt:`Portada de ${B.business_name}`,className:"w-full h-32 object-cover rounded-t-lg",expandable:!0,onExpand:C}):e.jsx("div",{className:"w-full h-32 bg-gradient-to-r from-orange-400 to-green-400 flex items-center justify-center rounded-t-lg",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(de,{className:"w-8 h-8 mx-auto mb-1"}),e.jsx("p",{className:"text-sm font-semibold",children:B.business_name})]})}),B.is_verified&&e.jsxs(Z,{className:"absolute top-2 right-2 bg-blue-500 text-white",children:[e.jsx(Ls,{className:"w-3 h-3 mr-1"}),"Verificado"]}),ae&&e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white shadow-lg p-1",children:e.jsx(ye,{src:ae,alt:`Logo de ${B.business_name}`,className:"w-full h-full object-cover rounded-full",expandable:!0,onExpand:C})})})]}),e.jsxs(H,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:B.business_name}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 line-clamp-2",children:B.business_description||"Comercio local en Gual√°n"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:B.rating&&B.rating>0?B.rating.toFixed(1):"Nuevo"})]}),e.jsx(Z,{variant:"outline",children:B.category||"General"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),B.address||B.business_address||((re=B.user)==null?void 0:re.address)||"Gual√°n, Zacapa"]}),e.jsxs($,{size:"sm",variant:"outline",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),"Ver productos"]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("span",{className:"text-xs text-gray-500",children:[B.products_count||0," productos disponibles"]})})]})]},B.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay negocios disponibles"}),e.jsx("p",{className:"text-gray-500",children:"Los negocios aparecer√°n aqu√≠ cuando est√©n disponibles."})]})})]})})]}),e.jsx(us,{onCartClick:()=>{r&&r()}}),e.jsx(Cr,{searchQuery:D,setSearchQuery:N,selectedCategory:P,setSelectedCategory:M,categories:L,onSearch:_,isLoading:q.products||q.dailyProducts||q.businesses})]})}const Ps={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",description:"Esperando confirmaci√≥n del vendedor"},accepted:{label:"Aceptado",color:"bg-blue-100 text-blue-800",description:"El vendedor est√° preparando tu pedido"},ready:{label:"Listo",color:"bg-green-100 text-green-800",description:"Tu pedido est√° listo"},assigned:{label:"Repartidor asignado",color:"bg-purple-100 text-purple-800",description:"Un repartidor fue asignado"},"picked-up":{label:"En camino",color:"bg-orange-100 text-orange-800",description:"El repartidor est√° en camino"},"in-transit":{label:"En tr√°nsito",color:"bg-indigo-100 text-indigo-800",description:"Tu pedido est√° siendo entregado"},delivered:{label:"Entregado",color:"bg-green-100 text-green-800",description:"Tu pedido fue entregado"},completed:{label:"Completado",color:"bg-gray-100 text-gray-800",description:"Pedido completado exitosamente"},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800",description:"El pedido fue cancelado"},rejected:{label:"Rechazado",color:"bg-red-100 text-red-800",description:"El vendedor rechaz√≥ tu pedido"}},Ts={pickup:{label:"Recoger en tienda",icon:e.jsx(de,{className:"w-4 h-4"}),color:"text-blue-600",description:"Recoge tu pedido en el establecimiento"},"dine-in":{label:"Comer en el lugar",icon:e.jsx(Vs,{className:"w-4 h-4"}),color:"text-purple-600",description:"Tu pedido ser√° servido en tu mesa"},delivery:{label:"Servicio a domicilio",icon:e.jsx(ue,{className:"w-4 h-4"}),color:"text-green-600",description:"Tu pedido ser√° entregado a tu direcci√≥n"}};function Rr(s){return Ps[s]||Ps.pending}function Dr(s){return Ts[s]||Ts.pickup}function Hs(s){return new Date(s).toLocaleTimeString("es-GT",{hour:"2-digit",minute:"2-digit"})}function Ar(s){return new Date(s).toLocaleDateString("es-GT")}function Or(s){return s.status==="delivered"||s.status==="completed"}function Fr(s){switch(s){case"pickup":return"15-25 min";case"dine-in":return"20-30 min";case"delivery":return"30-45 min";default:return"20-30 min"}}function Ws(s){const r=[{key:"pending",label:"Pedido realizado",icon:e.jsx(me,{className:"w-4 h-4"}),completed:!0,current:s.status==="pending",timestamp:s.created_at},{key:"accepted",label:"Pedido aceptado",icon:e.jsx(oe,{className:"w-4 h-4"}),completed:["accepted","ready","assigned","picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="accepted",timestamp:s.accepted_at},{key:"ready",label:s.delivery_type==="pickup"?"Listo para recoger":"Pedido listo",icon:s.delivery_type==="pickup"?e.jsx(de,{className:"w-4 h-4"}):e.jsx(oe,{className:"w-4 h-4"}),completed:["ready","assigned","picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="ready",timestamp:s.ready_at}];return s.delivery_type==="delivery"&&r.push({key:"assigned",label:"Repartidor asignado",icon:e.jsx(ue,{className:"w-4 h-4"}),completed:["assigned","picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="assigned",timestamp:s.status==="assigned"?s.updated_at:void 0},{key:"picked_up",label:"Pedido recogido",icon:e.jsx(me,{className:"w-4 h-4"}),completed:["picked_up","in_transit","delivered","completed"].includes(s.status),current:s.status==="picked_up",timestamp:s.picked_up_at},{key:"in_transit",label:"En camino",icon:e.jsx(ue,{className:"w-4 h-4"}),completed:["in_transit","delivered","completed"].includes(s.status),current:s.status==="in_transit",timestamp:s.status==="in_transit"?s.updated_at:void 0}),r.push({key:"delivered",label:s.delivery_type==="pickup"?"Recogido":"Entregado",icon:e.jsx(oe,{className:"w-4 h-4"}),completed:["delivered","completed"].includes(s.status),current:s.status==="delivered",timestamp:s.delivered_at}),r}function $r(s){const r=s.filter(n=>n.completed).length;return Math.round(r/s.length*100)}function zr({order:s}){const r=Rr(s.status),n=Dr(s.delivery_type),x=Ws(s),d=$r(x);return e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:"flex items-center gap-2",children:[n.icon,"Estado del Pedido"]}),e.jsx(Z,{variant:r.color,children:r.label})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progreso"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[d,"%"]})]}),e.jsx(Fs,{value:d,className:"h-3"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.icon,e.jsx("span",{className:"font-medium",children:n.label})]}),e.jsx("p",{className:"text-sm text-gray-600",children:n.description}),s.estimated_time&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsxs("span",{children:["Tiempo estimado: ",Fr(s.delivery_type)]})]})]}),(s.status==="rejected"||s.status==="cancelled")&&s.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium text-red-800",children:s.status==="rejected"?"Raz√≥n del rechazo":"Raz√≥n de cancelaci√≥n"})]}),e.jsx("p",{className:"text-sm text-red-700",children:s.rejection_reason})]})]})]})}function Mr({order:s}){const r=Ws(s);return e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Seguimiento del Pedido"})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-4",children:r.map((n,x)=>e.jsxs("div",{className:"relative flex gap-4",children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full border-2 flex items-center justify-center ${n.completed?"bg-green-500 border-green-500 text-white":n.current?"bg-orange-500 border-orange-500 text-white animate-pulse":"border-gray-300 text-gray-400"}`,children:n.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${n.completed?"text-green-700":n.current?"text-orange-700":"text-gray-500"}`,children:n.label}),n.timestamp&&e.jsx("div",{className:"text-sm text-gray-600",children:Hs(n.timestamp)})]}),x<r.length-1&&e.jsx("div",{className:`absolute left-4 mt-8 w-0.5 h-4 ${n.completed?"bg-green-500":"bg-gray-300"}`,style:{marginLeft:"15px"}})]},n.key))})})]})}function Lr({orderId:s,type:r,onClose:n,onRatingSubmitted:x}){const{rateOrder:d}=ms(),[o,p]=m.useState(0),[u,g]=m.useState(0),[w,q]=m.useState(""),[h,R]=m.useState(!1),[C,D]=m.useState(null),[N,P]=m.useState(!1),M=async()=>{if(o===0){D("Por favor selecciona una calificaci√≥n");return}R(!0),D(null);try{const I=await d(s,o,r,w.trim()||void 0);I.success?(P(!0),setTimeout(()=>{x()},1500)):D(I.message)}catch(I){console.error("Error submitting rating:",I),D("Error inesperado al enviar la calificaci√≥n")}finally{R(!1)}},V=I=>{switch(I){case 1:return"Muy malo";case 2:return"Malo";case 3:return"Regular";case 4:return"Bueno";case 5:return"Excelente";default:return"Selecciona una calificaci√≥n"}},z=()=>r==="seller"?e.jsx(de,{className:"w-6 h-6"}):e.jsx(ue,{className:"w-6 h-6"}),f=()=>r==="seller"?"Calificar Vendedor":"Calificar Repartidor",j=()=>r==="seller"?"¬øC√≥mo fue tu experiencia con el vendedor y la calidad de los productos?":"¬øC√≥mo fue la experiencia con el servicio de entrega?";return N?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(Q,{className:"w-full max-w-md bg-white",children:e.jsxs(H,{className:"p-8 text-center bg-white",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-4",children:e.jsx(oe,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900",children:"¬°Gracias por tu calificaci√≥n!"}),e.jsx("p",{className:"text-gray-600",children:"Tu opini√≥n nos ayuda a mejorar el servicio"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(Q,{className:"w-full max-w-md bg-white border border-gray-200 shadow-xl",children:[e.jsxs(ee,{className:"text-center bg-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-100 to-green-100 p-3 rounded-full w-16 h-16 mx-auto mb-4",children:e.jsx("div",{className:"text-orange-600",children:z()})}),e.jsx(se,{className:"text-gray-900",children:f()}),e.jsx("p",{className:"text-sm text-gray-600 font-normal",children:j()})]}),e.jsxs(H,{className:"space-y-6 bg-white",children:[C&&e.jsx(Va,{variant:"destructive",children:e.jsx(Ua,{children:C})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(I=>e.jsx("button",{className:"transition-all duration-200 hover:scale-110",onMouseEnter:()=>g(I),onMouseLeave:()=>g(0),onClick:()=>p(I),disabled:h,children:e.jsx(le,{className:`w-8 h-8 ${I<=(u||o)?"text-yellow-400 fill-current":"text-gray-300"}`})},I))}),e.jsx("p",{className:"text-sm text-gray-600",children:V(u||o)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Comentarios (opcional)"}),e.jsx(We,{placeholder:r==="seller"?"Cu√©ntanos sobre la calidad de los productos, el servicio al cliente, etc.":"Cu√©ntanos sobre la puntualidad, el trato, el estado de los productos, etc.",value:w,onChange:I=>q(I.target.value),rows:3,maxLength:500,disabled:h,className:"bg-white border border-gray-300"}),e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[w.length,"/500"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{variant:"outline",onClick:n,disabled:h,className:"flex-1 bg-white border-gray-300 text-gray-700 hover:bg-gray-50",children:"Cancelar"}),e.jsx($,{onClick:M,disabled:h||o===0,className:"flex-1 bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Enviar Calificaci√≥n"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center bg-white",children:"Tu calificaci√≥n ser√° visible para otros usuarios y ayudar√° a mejorar la calidad del servicio"})]})]})})}function Br({order:s,onOrderUpdate:r}){var p;const[n,x]=m.useState(!1),[d,o]=m.useState("seller");return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{className:"sticky top-4",children:[e.jsx(ee,{children:e.jsx(se,{children:"Resumen del Pedido"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:(p=s.items)==null?void 0:p.map(u=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:e.jsx(ye,{src:Gs(u.product_image),alt:u.product_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:u.product_name}),e.jsxs("div",{className:"text-xs text-gray-600",children:[u.quantity," x Q",u.price.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm font-medium",children:["Q",(u.price*u.quantity).toFixed(2)]})]},u.id))}),e.jsx(fe,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{children:s.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tel√©fono:"}),e.jsx("span",{children:s.phone_number})]})]}),s.delivery_type==="delivery"&&s.delivery_address&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Direcci√≥n de Entrega"]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.delivery_address})]})]}),s.customer_notes&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Notas especiales:"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:s.customer_notes})]})]}),e.jsx(fe,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Q",s.subtotal.toFixed(2)]})]}),s.delivery_fee>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Env√≠o"}),e.jsxs("span",{children:["Q",s.delivery_fee.toFixed(2)]})]}),e.jsx(fe,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Q",s.total.toFixed(2)]})]})]}),Or(s)&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Calificar experiencia"}),e.jsxs("div",{className:"space-y-2",children:[!s.seller_rating&&e.jsxs($,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{o("seller"),x(!0)},children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Calificar Vendedor"]}),s.delivery_type==="delivery"&&s.driver_id&&!s.driver_rating&&e.jsxs($,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{o("driver"),x(!0)},children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Calificar Repartidor"]})]}),(s.seller_rating||s.driver_rating)&&e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[s.seller_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Vendedor:"}),e.jsx("div",{className:"flex",children:[...Array(5)].map((u,g)=>e.jsx(le,{className:`w-3 h-3 ${g<s.seller_rating?"text-yellow-400 fill-current":"text-gray-300"}`},g))})]}),s.driver_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Repartidor:"}),e.jsx("div",{className:"flex",children:[...Array(5)].map((u,g)=>e.jsx(le,{className:`w-3 h-3 ${g<s.driver_rating?"text-yellow-400 fill-current":"text-gray-300"}`},g))})]})]})]})]})]})]}),n&&e.jsx(Lr,{orderId:s.id,type:d,onClose:()=>x(!1),onRatingSubmitted:()=>{x(!1),r==null||r()}})]})}function Ks({orderId:s,onBack:r}){const{getOrderById:n,refreshOrders:x,loading:d}=ms(),[o,p]=m.useState(null),[u,g]=m.useState(!1);m.useEffect(()=>{w()},[s]);const w=async()=>{const h=await n(s);p(h)},q=async()=>{g(!0),await x(),await w(),g(!1)};return d&&!o?e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}):o?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx($,{variant:"outline",onClick:r,children:"‚Üê Volver"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Orden #",o.id.slice(-8).toUpperCase()]}),e.jsxs("p",{className:"text-gray-600",children:["Realizada el ",Ar(o.created_at)," a las ",Hs(o.created_at)]})]})]}),e.jsxs($,{variant:"outline",onClick:q,disabled:u,size:"sm",children:[e.jsx(De,{className:`w-4 h-4 mr-2 ${u?"animate-spin":""}`}),u?"Actualizando...":"Actualizar"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(zr,{order:o}),e.jsx(Mr,{order:o})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Br,{order:o,onOrderUpdate:w})})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-4 text-center",children:[e.jsx(Ee,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Orden no encontrada"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No se pudo cargar la informaci√≥n de la orden"}),e.jsx($,{onClick:r,children:"Volver a mis √≥rdenes"})]})}function Vr({order:s,isHistory:r=!1,onViewOrder:n,onDeleteOrder:x,onConfirmReceived:d,onReorderFn:o,deletingOrderId:p,confirmingOrderId:u}){var i;const g=t=>{const a={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",icon:he,description:"Esperando confirmaci√≥n del vendedor"},accepted:{label:"Aceptado",color:"bg-blue-100 text-blue-800",icon:oe,description:"El vendedor est√° preparando tu pedido"},ready:{label:"Listo",color:"bg-green-100 text-green-800",icon:me,description:"Tu pedido est√° listo"},assigned:{label:"Repartidor asignado",color:"bg-purple-100 text-purple-800",icon:ue,description:"Un repartidor fue asignado"},picked_up:{label:"En camino",color:"bg-orange-100 text-orange-800",icon:ue,description:"El repartidor est√° en camino"},"in-transit":{label:"En tr√°nsito",color:"bg-indigo-100 text-indigo-800",icon:ue,description:"Tu pedido est√° siendo entregado"},delivered:{label:"Entregado",color:"bg-green-100 text-green-800",icon:oe,description:"Tu pedido fue entregado"},completed:{label:"Completado",color:"bg-gray-100 text-gray-800",icon:vr,description:"Pedido completado exitosamente"},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800",icon:Ae,description:"El pedido fue cancelado"},rejected:{label:"Rechazado",color:"bg-red-100 text-red-800",icon:Ae,description:"El vendedor rechaz√≥ tu pedido"}};return a[t]||a.pending},w=t=>{const a={pickup:{label:"Recoger en tienda",icon:de,color:"text-blue-600"},"dine-in":{label:"Comer dentro",icon:Vs,color:"text-purple-600"},delivery:{label:"Servicio a domicilio",icon:ue,color:"text-green-600"}};return a[t]||a.pickup},q=t=>({pending:10,accepted:25,ready:50,assigned:60,picked_up:75,in_transit:85,delivered:95,completed:100,cancelled:0,rejected:0})[t]||0,h=t=>t==="pending",R=t=>t==="delivered",C=g(s.status),D=w(s.delivery_type),N=q(s.status),P=C.icon,M=D.icon,V=h(s.status),z=R(s.status),f=p===s.id,j=u===s.id,I=r?"border-gray-200 hover:shadow-md transition-shadow":"border-orange-200 shadow-lg hover:shadow-xl transition-shadow",c=r?"bg-gray-100":"bg-orange-100",b=r?"text-gray-600":"text-orange-600";return e.jsx(Q,{className:I,children:e.jsxs(H,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${c} p-2 rounded-lg`,children:e.jsx(P,{className:`w-5 h-5 ${b}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.seller_name||"Vendedor"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Pedido #",s.id.slice(-8).toUpperCase()]})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[e.jsx(Z,{className:C.color,children:C.label}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("es-GT")}),V&&x&&e.jsxs(Ga,{children:[e.jsx(Qa,{asChild:!0,children:e.jsx($,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 h-8 px-2",disabled:f,title:"Eliminar pedido no confirmado",children:f?e.jsx(De,{className:"w-3 h-3 animate-spin"}):e.jsx(Ke,{className:"w-3 h-3"})})}),e.jsxs(Ha,{children:[e.jsxs(Wa,{children:[e.jsxs(Ka,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-red-600"}),"¬øEliminar pedido no confirmado?"]}),e.jsxs(Xa,{children:["Est√°s a punto de eliminar tu pedido de ",e.jsx("strong",{children:s.seller_name})," por un total de ",e.jsxs("strong",{children:["Q",s.total.toFixed(2)]}),".",e.jsx("br",{}),e.jsx("br",{}),"Esta acci√≥n no se puede deshacer. El pedido ser√° eliminado permanentemente y no podr√°s recuperarlo.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-yellow-600 font-medium",children:"üí° Tip:"})," Tambi√©n puedes esperar a que el vendedor responda a tu pedido."]})]}),e.jsxs(Ya,{children:[e.jsx(Za,{children:"Mantener pedido"}),e.jsx(Ja,{onClick:()=>x(s.id,s.seller_name||"Vendedor"),className:"bg-red-600 hover:bg-red-700",disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mr-2 animate-spin"}),"Eliminando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"S√≠, eliminar pedido"]})})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[!r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:C.description}),e.jsxs("span",{className:"font-medium",children:[N,"%"]})]}),e.jsx(Fs,{value:N,className:"h-2"})]}),V&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsx("p",{className:"text-yellow-700 font-medium",children:"Pedido pendiente de confirmaci√≥n"}),e.jsx("p",{className:"text-yellow-600 text-xs mt-1",children:"Si el vendedor no acepta tu pedido o demora mucho en responder, puedes eliminarlo usando el bot√≥n üóëÔ∏è arriba."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:`w-4 h-4 ${D.color}`}),e.jsx("span",{className:"text-sm font-medium",children:D.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[((i=s.items)==null?void 0:i.length)||0," productos"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[s.estimated_time||30," min estimado"]})]})]}),s.items&&s.items.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[s.items.slice(0,r?4:3).map(t=>{var a;return e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 bg-white border rounded-lg p-2",children:[e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-gray-100",children:e.jsx(ye,{src:Gs(t.product_image)||"",alt:t.product_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium truncate w-24",children:t.product_name}),e.jsxs("div",{className:"text-gray-500",children:[t.quantity,"x Q",((a=t.price)==null?void 0:a.toFixed(2))||"0.00"]})]})]},t.id)}),s.items.length>(r?4:3)&&e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-lg w-16 h-16",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["+",s.items.length-(r?4:3)]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-600",children:["Q",s.total.toFixed(2)]}),r&&(s.seller_rating||s.driver_rating)&&e.jsxs("div",{className:"flex items-center gap-2",children:[s.seller_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm",children:s.seller_rating})]}),s.driver_rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4 text-blue-500"}),e.jsx(le,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm",children:s.driver_rating})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>n(s.id),children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Ver detalles"]}),z&&d&&e.jsx($,{variant:"default",size:"sm",onClick:()=>d(s.id,s.seller_name||"Vendedor"),disabled:j,className:"bg-green-600 hover:bg-green-700",children:j?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mr-2 animate-spin"}),"Confirmando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Confirmar recibido"]})}),r&&o&&e.jsxs($,{variant:"outline",size:"sm",onClick:()=>o(s.id),children:[e.jsx(Aa,{className:"w-4 h-4 mr-2"}),"Volver a pedir"]})]})]})]})]})})}function Is({orders:s,isHistory:r=!1,loading:n=!1,onViewOrder:x,onDeleteOrder:d,onConfirmReceived:o,onReorderFn:p,deletingOrderId:u,confirmingOrderId:g,emptyTitle:w,emptyDescription:q}){if(n)return e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((h,R)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gray-200 w-10 h-10 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-gray-200 h-5 w-32 rounded"}),e.jsx("div",{className:"bg-gray-200 h-4 w-24 rounded"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-gray-200 h-6 w-20 rounded-full"}),e.jsx("div",{className:"bg-gray-200 h-4 w-16 rounded"})]})]}),!r&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"bg-gray-200 h-4 w-full rounded"}),e.jsx("div",{className:"bg-gray-200 h-2 w-full rounded"})]}),e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gray-200 h-4 w-24 rounded"}),e.jsx("div",{className:"bg-gray-200 h-4 w-20 rounded"}),e.jsx("div",{className:"bg-gray-200 h-4 w-28 rounded"})]})}),e.jsx("div",{className:"flex gap-2 mb-4",children:[...Array(3)].map((C,D)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded-lg",children:[e.jsx("div",{className:"bg-gray-200 w-10 h-10 rounded"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-gray-200 h-3 w-20 rounded"}),e.jsx("div",{className:"bg-gray-200 h-3 w-12 rounded"})]})]},D))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsx("div",{className:"bg-gray-200 h-6 w-20 rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-gray-200 h-8 w-24 rounded"}),e.jsx("div",{className:"bg-gray-200 h-8 w-28 rounded"})]})]})]})},R))});if(s.length===0){const h=r?"No hay pedidos en el historial":"No tienes pedidos activos",R=r?"Tus pedidos completados, cancelados o rechazados aparecer√°n aqu√≠":"Tus pedidos en proceso aparecer√°n aqu√≠";return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"bg-gray-100 rounded-full p-6 mb-6",children:e.jsx(we,{className:"w-16 h-16 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2 text-center",children:w||h}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:q||R}),!r&&e.jsx("div",{className:"mt-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-orange-700 font-medium text-sm mb-2",children:"üí° ¬øQuieres hacer tu primer pedido?"}),e.jsx("p",{className:"text-orange-600 text-sm",children:"Explora los productos disponibles y agrega algunos al carrito"})]})})]})}return e.jsx("div",{className:"space-y-4",children:s.map(h=>e.jsx(Vr,{order:h,isHistory:r,onViewOrder:x,onDeleteOrder:d,onConfirmReceived:o,onReorderFn:p,deletingOrderId:u,confirmingOrderId:g},h.id))})}function Ur({stats:s,loading:r=!1}){if(r)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((o,p)=>e.jsx(Q,{className:"animate-pulse",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-gray-200 h-4 w-20 rounded"}),e.jsx("div",{className:"bg-gray-200 h-6 w-16 rounded"})]}),e.jsx("div",{className:"bg-gray-200 w-8 h-8 rounded"})]})})},p))});const n=[{title:"Total de Pedidos",value:s.totalOrders,icon:we,color:"text-blue-600",bgColor:"bg-blue-100",description:"Pedidos realizados"},{title:"Pedidos Activos",value:s.activeOrders,icon:he,color:"text-orange-600",bgColor:"bg-orange-100",description:"En proceso"},{title:"Completados",value:s.completedOrders,icon:oe,color:"text-green-600",bgColor:"bg-green-100",description:"Exitosos"},{title:"Total Gastado",value:`Q${s.totalSpent.toFixed(2)}`,icon:Ea,color:"text-purple-600",bgColor:"bg-purple-100",description:"Inversi√≥n total"}],x=[{label:"Promedio por pedido",value:`Q${s.averageOrderValue.toFixed(2)}`,icon:Qe,color:"text-green-600"},{label:"Calificaci√≥n promedio",value:s.averageRating>0?`${s.averageRating.toFixed(1)} ‚òÖ`:"Sin calificar",icon:le,color:"text-yellow-600"},{label:"Este mes",value:`${s.thisMonthOrders} pedidos`,icon:Me,color:"text-indigo-600"}],d=[{label:"A domicilio",value:s.deliveryOrders,icon:ue,color:"text-green-600",percentage:s.totalOrders>0?(s.deliveryOrders/s.totalOrders*100).toFixed(0):0},{label:"Recoger en tienda",value:s.pickupOrders,icon:me,color:"text-blue-600",percentage:s.totalOrders>0?(s.pickupOrders/s.totalOrders*100).toFixed(0):0},{label:"Comer en lugar",value:s.dineInOrders,icon:me,color:"text-purple-600",percentage:s.totalOrders>0?(s.dineInOrders/s.totalOrders*100).toFixed(0):0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:n.map((o,p)=>{const u=o.icon;return e.jsx(Q,{className:"border-orange-200 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:o.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.value}),e.jsx("p",{className:"text-xs text-gray-500",children:o.description})]}),e.jsx("div",{className:`${o.bgColor} p-3 rounded-lg`,children:e.jsx(u,{className:`w-6 h-6 ${o.color}`})})]})})},p)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(Q,{className:"border-orange-200 shadow-lg",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Qe,{className:"w-5 h-5 text-orange-500"}),"M√©tricas Adicionales"]})}),e.jsx(H,{className:"space-y-4",children:x.map((o,p)=>{const u=o.icon;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:`w-4 h-4 ${o.color}`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:o.label})]}),e.jsx(Z,{variant:"outline",className:"font-medium",children:o.value})]},p)})})]}),e.jsxs(Q,{className:"border-orange-200 shadow-lg",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ue,{className:"w-5 h-5 text-orange-500"}),"Tipos de Entrega"]})}),e.jsx(H,{className:"space-y-4",children:d.map((o,p)=>{const u=o.icon;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:`w-4 h-4 ${o.color}`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:o.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:o.value}),e.jsxs(Z,{variant:"secondary",className:"text-xs",children:[o.percentage,"%"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`${o.color.replace("text-","bg-")} h-2 rounded-full transition-all duration-300`,style:{width:`${o.percentage}%`}})})]},p)})})]})]}),s.totalOrders>0&&e.jsx(Q,{className:"border-green-200 bg-green-50",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-lg",children:e.jsx(Qe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-1",children:"Resumen de tu actividad"}),e.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("p",{children:["‚Ä¢ Has realizado ",e.jsx("strong",{children:s.totalOrders})," pedidos con un gasto total de ",e.jsxs("strong",{children:["Q",s.totalSpent.toFixed(2)]})]}),e.jsxs("p",{children:["‚Ä¢ Tu pedido promedio es de ",e.jsxs("strong",{children:["Q",s.averageOrderValue.toFixed(2)]})]}),s.cancelledOrders>0&&e.jsxs("p",{children:["‚Ä¢ Tasa de √©xito: ",e.jsxs("strong",{children:[(s.completedOrders/s.totalOrders*100).toFixed(0),"%"]}),"(",s.cancelledOrders," cancelados)"]}),s.averageRating>0&&e.jsxs("p",{children:["‚Ä¢ Calificaci√≥n promedio que das: ",e.jsxs("strong",{children:[s.averageRating.toFixed(1)," estrellas"]})]})]})]})]})})})]})}function qs({onViewOrder:s}){const{orders:r,loading:n,refreshOrders:x,deleteUnconfirmedOrder:d}=ms(),{user:o}=Se(),[p,u]=m.useState("orders"),[g,w]=m.useState(null),[q,h]=m.useState(!1),[R,C]=m.useState(null),[D,N]=m.useState(null),P=c=>{w(c),s&&s(c)},M=async(c,b)=>{C(c);try{const i=await d(c);i.success?(G.success("Pedido eliminado",{description:`El pedido de ${b} ha sido eliminado exitosamente.`,duration:4e3}),await x()):G.error("Error",{description:i.message||"No se pudo eliminar el pedido.",duration:5e3})}catch(i){console.error("Error deleting order:",i),G.error("Error",{description:"Error inesperado al eliminar el pedido.",duration:5e3})}finally{C(null)}},V=async(c,b)=>{var i;if(o!=null&&o.id){N(c);try{const{error:t}=await T.from("orders").update({status:"completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",c);if(t)throw t;const{error:a}=await T.from("notifications").insert([{recipient_id:(i=(await T.from("orders").select("seller_id").eq("id",c).single()).data)==null?void 0:i.seller_id,type:"order_completed_by_buyer",title:"‚úÖ Comprador confirm√≥ recepci√≥n",message:`El comprador confirm√≥ que recibi√≥ su pedido #${c.slice(0,8)}. ¬°Pedido completado exitosamente!`,data:{order_id:c,buyer_id:o.id},created_at:new Date().toISOString()}]);a&&console.error("Error enviando notificaci√≥n:",a),G.success("¬°Orden confirmada!",{description:`Has confirmado que recibiste tu pedido de ${b}.`,duration:4e3}),await x()}catch(t){console.error("Error confirming order received:",t),G.error("Error",{description:"No se pudo confirmar la recepci√≥n de la orden.",duration:5e3})}finally{N(null)}}},z=async c=>{G.info("Funci√≥n en desarrollo",{description:"La funcionalidad de volver a pedir estar√° disponible pronto.",duration:3e3})},f=r.filter(c=>!["delivered","completed","cancelled","rejected"].includes(c.status)),j=r.filter(c=>["delivered","completed","cancelled","rejected"].includes(c.status)),I=m.useMemo(()=>{const c=r.length,b=r.filter(S=>!["delivered","completed","cancelled","rejected"].includes(S.status)).length,i=r.filter(S=>["delivered","completed"].includes(S.status)).length,t=r.filter(S=>["cancelled","rejected"].includes(S.status)).length,a=r.filter(S=>["delivered","completed"].includes(S.status)).reduce((S,K)=>S+K.total,0),v=i>0?a/i:0,l=0,y=new Date;y.setDate(1);const O=r.filter(S=>new Date(S.created_at)>=y).length,L=r.filter(S=>S.delivery_type==="delivery").length,_=r.filter(S=>S.delivery_type==="pickup").length,E=r.filter(S=>S.delivery_type==="dine-in").length;return{totalOrders:c,activeOrders:b,completedOrders:i,cancelledOrders:t,totalSpent:a,averageOrderValue:v,averageRating:l,thisMonthOrders:O,deliveryOrders:L,pickupOrders:_,dineInOrders:E}},[r]);return g?e.jsx(Ks,{orderId:g,onBack:()=>w(null)}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Ze,{value:p,onValueChange:u,className:"space-y-6",children:[e.jsxs(Je,{className:"grid w-full grid-cols-3 lg:w-[400px] mx-auto bg-white border border-orange-200",children:[e.jsxs(_e,{value:"orders",className:"data-[state=active]:bg-orange-100 data-[state=active]:text-orange-700",children:["Pedidos (",f.length,")"]}),e.jsxs(_e,{value:"history",className:"data-[state=active]:bg-gray-100 data-[state=active]:text-gray-700",children:["Historial (",j.length,")"]}),e.jsx(_e,{value:"stats",className:"data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700",children:"Estad√≠sticas"})]}),e.jsx(je,{value:"orders",className:"space-y-4",children:e.jsx(Is,{orders:f,isHistory:!1,loading:n,onViewOrder:P,onDeleteOrder:M,onConfirmReceived:V,deletingOrderId:R,confirmingOrderId:D,emptyTitle:"No tienes pedidos activos",emptyDescription:"Tus pedidos en proceso aparecer√°n aqu√≠"})}),e.jsx(je,{value:"history",className:"space-y-4",children:e.jsx(Is,{orders:j,isHistory:!0,loading:n,onViewOrder:P,onReorderFn:z,emptyTitle:"No hay pedidos en el historial",emptyDescription:"Tus pedidos completados, cancelados o rechazados aparecer√°n aqu√≠"})}),e.jsx(je,{value:"stats",className:"space-y-6",children:e.jsx(Ur,{stats:I,loading:n})})]})})}var xs="Avatar",[Gr,Kt]=ds(xs),[Qr,Xs]=Gr(xs),Ys=m.forwardRef((s,r)=>{const{__scopeAvatar:n,...x}=s,[d,o]=m.useState("idle");return e.jsx(Qr,{scope:n,imageLoadingStatus:d,onImageLoadingStatusChange:o,children:e.jsx(Fe.span,{...x,ref:r})})});Ys.displayName=xs;var Zs="AvatarImage",Js=m.forwardRef((s,r)=>{const{__scopeAvatar:n,src:x,onLoadingStatusChange:d=()=>{},...o}=s,p=Xs(Zs,n),u=Hr(x,o.referrerPolicy),g=pa(w=>{d(w),p.onImageLoadingStatusChange(w)});return $s(()=>{u!=="idle"&&g(u)},[u,g]),u==="loaded"?e.jsx(Fe.img,{...o,ref:r,src:x}):null});Js.displayName=Zs;var ea="AvatarFallback",sa=m.forwardRef((s,r)=>{const{__scopeAvatar:n,delayMs:x,...d}=s,o=Xs(ea,n),[p,u]=m.useState(x===void 0);return m.useEffect(()=>{if(x!==void 0){const g=window.setTimeout(()=>u(!0),x);return()=>window.clearTimeout(g)}},[x]),p&&o.imageLoadingStatus!=="loaded"?e.jsx(Fe.span,{...d,ref:r}):null});sa.displayName=ea;function Hr(s,r){const[n,x]=m.useState("idle");return $s(()=>{if(!s){x("error");return}let d=!0;const o=new window.Image,p=u=>()=>{d&&x(u)};return x("loading"),o.onload=p("loaded"),o.onerror=p("error"),o.src=s,r&&(o.referrerPolicy=r),()=>{d=!1}},[s,r]),n}var Wr=Ys,Kr=Js,Xr=sa;function Yr({className:s,...r}){return e.jsx(Wr,{"data-slot":"avatar",className:Ue("relative flex size-10 shrink-0 overflow-hidden rounded-full",s),...r})}function Zr({className:s,...r}){return e.jsx(Kr,{"data-slot":"avatar-image",className:Ue("aspect-square size-full",s),...r})}function Jr({className:s,...r}){return e.jsx(Xr,{"data-slot":"avatar-fallback",className:Ue("bg-muted flex size-full items-center justify-center rounded-full",s),...r})}function Rs({onShowCart:s}){const{user:r,updateProfile:n}=Se(),{getCartItemCount:x}=Pe(),[d,o]=m.useState(null),[p,u]=m.useState(!1),[g,w]=m.useState(!1),[q,h]=m.useState(!1),[R,C]=m.useState(""),[D,N]=m.useState(""),P=m.useRef(null),[M,V]=m.useState({total_orders:0,completed_orders:0,total_spent:0,average_rating:0});m.useEffect(()=>{r&&(z(),I())},[r]);const z=async()=>{if(r)try{const{data:i,error:t}=await T.from("users").select("*").eq("id",r.id).single();if(t)throw t;o({...i,notification_preferences:i.notification_preferences||{order_updates:!0,promotions:!0,new_products:!1}})}catch(i){console.error("Error loading profile:",i)}},f=(i,t,a,v=.9)=>new Promise(l=>{const y=document.createElement("canvas"),O=y.getContext("2d"),L=new Image;L.onload=()=>{let{width:_,height:E}=L;_>E?_>t&&(E=E*t/_,_=t):E>a&&(_=_*a/E,E=a),y.width=_,y.height=E,O.drawImage(L,0,0,_,E),y.toBlob(l,"image/jpeg",v)},L.src=URL.createObjectURL(i)}),j=async i=>{var a;const t=(a=i.target.files)==null?void 0:a[0];if(!(!t||!r))try{h(!0),C(""),N("");const v=["image/jpeg","image/jpg","image/png","image/webp"],l=5*1024*1024;if(!v.includes(t.type.toLowerCase())){C("Solo se permiten im√°genes JPG, PNG o WebP");return}if(t.size>l){C("La imagen debe ser menor a 5MB");return}const y=await f(t,400,400,.85);if(!y){C("Error al procesar la imagen");return}const O=`${r.id}/avatar-${Date.now()}.jpg`,{error:L}=await T.storage.from("user-avatars").upload(O,y,{upsert:!0,contentType:"image/jpeg"});if(L){console.error("Upload error:",L),C(`Error subiendo imagen: ${L.message}`);return}const{data:_}=T.storage.from("user-avatars").getPublicUrl(O),{error:E}=await T.from("users").update({avatar_url:_.publicUrl,updated_at:new Date().toISOString()}).eq("id",r.id);if(E){C(`Error guardando en base de datos: ${E.message}`);return}o(S=>S?{...S,avatar_url:_.publicUrl}:null),await n({avatar_url:_.publicUrl}),N("‚úÖ Foto de perfil actualizada correctamente"),setTimeout(()=>N(""),3e3)}catch(v){console.error("Avatar upload error:",v),C(`Error: ${v.message||"Error desconocido"}`)}finally{h(!1),P.current&&(P.current.value="")}},I=async()=>{if(r)try{const{data:i,error:t}=await T.from("orders").select("total, status, seller_rating, created_at, delivery_type").eq("buyer_id",r.id);if(t){console.error("Error loading orders:",t);return}if(!i||i.length===0){V({total_orders:0,completed_orders:0,total_spent:0,average_rating:0});return}const a=i.reduce((l,y)=>{l.total_orders++;const O=Number(y.total)||0;return y.status==="completed"&&(l.completed_orders++,l.total_spent+=O),y.seller_rating&&y.seller_rating>0&&l.ratings.push(Number(y.seller_rating)),l},{total_orders:0,completed_orders:0,total_spent:0,ratings:[]}),v=a.ratings.length>0?a.ratings.reduce((l,y)=>l+y,0)/a.ratings.length:0;V({total_orders:a.total_orders,completed_orders:a.completed_orders,total_spent:a.total_spent,average_rating:Math.round(v*10)/10})}catch(i){console.error("Error loading order stats:",i),V({total_orders:0,completed_orders:0,total_spent:0,average_rating:0})}},c=async()=>{if(d){w(!0),C("");try{const{error:i}=await T.from("users").update({name:d.name,phone:d.phone,address:d.address,preferred_delivery_address:d.preferred_delivery_address}).eq("id",d.id);if(i)throw i;await n({name:d.name,phone:d.phone}),N("‚úÖ Perfil actualizado correctamente"),u(!1),setTimeout(()=>N(""),3e3)}catch(i){console.error("Error updating profile:",i),C("Error al actualizar perfil: "+i.message)}finally{w(!1)}}},b=(i,t)=>{d&&o({...d,notification_preferences:{...d.notification_preferences,[i]:t}})};return d?e.jsxs("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-0",children:[R&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"break-words",children:R})}),D&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"break-words",children:D})}),e.jsx(Q,{className:"border-orange-200 shadow-lg",children:e.jsx(H,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 sm:gap-6",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs(Yr,{className:"w-20 h-20 sm:w-24 sm:h-24 border-4 border-white shadow-lg",children:[e.jsx(Zr,{src:d.avatar_url,className:"object-cover"}),e.jsx(Jr,{className:"text-xl sm:text-2xl bg-gradient-to-r from-orange-500 to-green-500 text-white",children:d.name.charAt(0).toUpperCase()})]}),e.jsx("input",{ref:P,type:"file",accept:"image/*",className:"hidden",onChange:j}),e.jsx($,{size:"sm",variant:"outline",className:"absolute -bottom-2 -right-2 h-8 w-8 p-0 rounded-full bg-white shadow-lg hover:bg-orange-50 transition-colors",onClick:()=>{var i;return(i=P.current)==null?void 0:i.click()},disabled:q,children:q?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500"}):e.jsx(er,{className:"w-4 h-4 text-orange-600"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:d.name}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>u(!p),children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"}),p?"Cancelar":"Editar perfil"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 text-sm text-gray-600 mb-3 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-1 break-all",children:[e.jsx(ar,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:d.email})]}),d.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:d.phone})]}),e.jsxs(Z,{variant:"outline",className:"border-green-200 text-green-700 w-fit",children:[e.jsx(Ns,{className:"w-3 h-3 mr-1"}),"Comprador verificado"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg border border-orange-100",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-600",children:M.total_orders}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pedidos totales"}),M.completed_orders>0&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:[M.completed_orders," completados"]})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:["Q",M.total_spent.toFixed(0)]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total gastado"}),M.total_orders>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Promedio: Q",(M.total_spent/M.completed_orders||0).toFixed(0)]})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-100",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600 flex items-center justify-center gap-1",children:[M.average_rating>0?M.average_rating.toFixed(1):"0.0",e.jsx(le,{className:"w-4 h-4 fill-current"})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Tu calificaci√≥n"}),M.average_rating===0&&M.total_orders>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Sin calificar a√∫n"})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(Q,{className:"border-blue-200",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-500"}),"Informaci√≥n Personal"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(ge,{htmlFor:"name",children:"Nombre completo"}),e.jsx(be,{id:"name",value:d.name,onChange:i=>o({...d,name:i.target.value}),disabled:!p,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(ge,{htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx(be,{id:"email",type:"email",value:d.email,disabled:!0,className:"mt-1 bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"El correo no se puede cambiar"})]}),e.jsxs("div",{children:[e.jsx(ge,{htmlFor:"phone",children:"Tel√©fono"}),e.jsx(be,{id:"phone",value:d.phone||"",onChange:i=>o({...d,phone:i.target.value}),disabled:!p,placeholder:"Tu n√∫mero de tel√©fono",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(ge,{htmlFor:"date_of_birth",children:"Fecha de nacimiento"}),e.jsx(be,{id:"date_of_birth",type:"date",value:d.date_of_birth||"",onChange:i=>o({...d,date_of_birth:i.target.value}),disabled:!p,className:"mt-1"})]})]}),p&&e.jsxs($,{onClick:c,disabled:g,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),g?"Guardando...":"Guardar cambios"]}),R&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:R})}),D&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-700 text-sm",children:D})})]})]}),e.jsxs(Q,{className:"border-green-200",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-green-500"}),"Gesti√≥n de Direcciones"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ge,{htmlFor:"preferred_delivery_address",children:"Direcci√≥n principal de entrega"}),e.jsx(We,{id:"preferred_delivery_address",className:"mt-1",rows:3,placeholder:"Ingresa tu direcci√≥n completa (calle, n√∫mero, colonia, referencias)",value:d.preferred_delivery_address||"",onChange:i=>o({...d,preferred_delivery_address:i.target.value}),disabled:!p}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Incluye referencias importantes (edificio, color de casa, puntos de referencia)"})]}),e.jsx($,{variant:"outline",className:"w-full h-auto py-3",onClick:()=>{if(!navigator.geolocation){C("GPS no disponible en este dispositivo");return}if(w(!0),C(""),!r){C("Usuario no disponible"),w(!1);return}navigator.geolocation.getCurrentPosition(async i=>{try{const{latitude:t,longitude:a}=i.coords,{error:v}=await T.from("users").update({latitude:t,longitude:a,updated_at:new Date().toISOString()}).eq("id",r.id);if(v)throw v;N(`‚úÖ Ubicaci√≥n GPS actualizada: ${t.toFixed(6)}, ${a.toFixed(6)}`),setTimeout(()=>N(""),5e3)}catch{C("Error al guardar ubicaci√≥n GPS")}finally{w(!1)}},i=>{switch(w(!1),i.code){case i.PERMISSION_DENIED:C("Permiso de ubicaci√≥n denegado. Activa el GPS en configuraci√≥n.");break;case i.POSITION_UNAVAILABLE:C("Informaci√≥n de ubicaci√≥n no disponible.");break;case i.TIMEOUT:C("Tiempo de espera agotado para obtener ubicaci√≥n.");break;default:C("Error desconocido al obtener ubicaci√≥n.");break}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},disabled:g,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-center leading-tight",children:g?"Obteniendo ubicaci√≥n...":"Actualizar ubicaci√≥n GPS"})]})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 break-words",children:"La ubicaci√≥n GPS nos ayuda a mostrar vendedores cercanos y calcular costos de entrega"})})]})})]})]}),e.jsxs(Q,{className:"border-purple-200",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-purple-500"}),"Preferencias de Notificaciones"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ge,{htmlFor:"order_updates",className:"text-base",children:"Actualizaciones de pedidos"}),e.jsx("p",{className:"text-sm text-gray-500 break-words",children:"Recibe notificaciones sobre el estado de tus pedidos"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ts,{id:"order_updates",checked:d.notification_preferences.order_updates,onCheckedChange:i=>b("order_updates",i),disabled:!p})})]}),e.jsx(fe,{}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ge,{htmlFor:"promotions",className:"text-base",children:"Promociones y ofertas"}),e.jsx("p",{className:"text-sm text-gray-500 break-words",children:"Recibe ofertas especiales y promociones"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ts,{id:"promotions",checked:d.notification_preferences.promotions,onCheckedChange:i=>b("promotions",i),disabled:!p})})]}),e.jsx(fe,{}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ge,{htmlFor:"new_products",className:"text-base",children:"Nuevos productos"}),e.jsx("p",{className:"text-sm text-gray-500 break-words",children:"Notificaciones cuando hay nuevos productos disponibles"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ts,{id:"new_products",checked:d.notification_preferences.new_products,onCheckedChange:i=>b("new_products",i),disabled:!p})})]})]}),p&&e.jsxs($,{onClick:c,disabled:g,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),"Guardar preferencias"]})]})]}),e.jsxs(Q,{className:"border-gray-200",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(fa,{className:"w-5 h-5 text-gray-500"}),"Acciones R√°pidas"]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs($,{variant:"outline",className:"h-16 flex flex-col gap-2 text-center",children:[e.jsx(Xe,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm leading-tight",children:"Productos favoritos"})]}),e.jsxs($,{variant:"outline",className:"h-16 flex flex-col gap-2 text-center",children:[e.jsx(rr,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-sm leading-tight",children:"Historial de compras"})]}),e.jsxs($,{variant:"outline",className:"h-16 flex flex-col gap-2 text-center",children:[e.jsx(Be,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm leading-tight",children:"M√©todos de pago"})]})]})})]}),e.jsxs(Q,{className:"border-yellow-200",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(tr,{className:"w-5 h-5 text-yellow-500"}),"Seguridad de la Cuenta"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ns,{className:"w-8 h-8 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-yellow-800",children:"Cuenta protegida"}),e.jsx("p",{className:"text-sm text-yellow-700 break-words",children:"Tu cuenta est√° protegida por autenticaci√≥n segura de Supabase"})]})]})}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:e.jsx("p",{className:"break-words",children:"Para cambios de seguridad como contrase√±a, contacta al soporte t√©cnico"})})]})]}),e.jsx(us,{onCartClick:s||(()=>{alert(`Tienes ${x()} productos en tu carrito. Funcionalidad de carrito implementada.`)})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})})}function et({onContinueShopping:s,onProceedToCheckout:r}){const{user:n}=Se(),{items:x,updateCartItem:d,removeFromCart:o,clearCart:p,getCartTotal:u,getCartItemCount:g}=Pe(),[w,q]=m.useState(null),[h,R]=m.useState(null),[C,D]=m.useState(""),[N,P]=m.useState(null),M=u(),V=M,z=x.reduce((t,a)=>{var y,O,L;const v=((y=a.product)==null?void 0:y.seller_id)||"unknown",l=((L=(O=a.product)==null?void 0:O.seller)==null?void 0:L.business_name)||"Vendedor";return t[v]||(t[v]={sellerId:v,sellerName:l,items:[]}),t[v].items.push(a),t},{}),f=async(t,a)=>{if(!(a<0)){q(t);try{a===0?(await o(t),G.success("Eliminado")):await d(t,a)}catch(v){console.error("Error updating cart:",v),G.error("Error al actualizar el carrito")}finally{q(null)}}},j=(t,a)=>{R(t),D(a.toString())},I=t=>{const a=parseInt(C);!isNaN(a)&&a>=0&&f(t,a),R(null),D("")},c=(t,a)=>{t.key==="Enter"?I(a):t.key==="Escape"&&(R(null),D(""))},b=async t=>{try{await o(t),G.success("Eliminado")}catch(a){console.error("Error removing item:",a),G.error("Error al eliminar producto")}},i=async()=>{try{await p(),G.success("Carrito vac√≠o")}catch(t){console.error("Error clearing cart:",t),G.error("Error al vaciar carrito")}};return x.length===0?e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{className:"w-24 h-24 text-gray-300 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Tu carrito est√° vac√≠o"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Agrega algunos productos para comenzar tu pedido"}),e.jsxs($,{onClick:s,className:"bg-orange-500 hover:bg-orange-600 text-white px-8 py-3",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Explorar Productos"]})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-4 lg:p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(we,{className:"w-7 h-7 text-orange-500"}),"Mi Carrito"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[g()," ",g()===1?"producto":"productos"," en tu carrito"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs($,{variant:"outline",onClick:s,className:"border-orange-200 text-orange-600 hover:bg-orange-50",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Continuar Comprando"]}),x.length>0&&e.jsxs($,{variant:"outline",onClick:i,className:"border-red-200 text-red-600 hover:bg-red-50",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Vaciar Carrito"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:Object.values(z).map(t=>e.jsxs(Q,{className:"shadow-sm border border-gray-200",children:[e.jsx(ee,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx(se,{className:"text-lg font-semibold",children:t.sellerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.items.length," productos"]})]})]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-4",children:t.items.map(a=>{var v,l,y,O,L,_;return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx(ye,{src:((v=a.product)==null?void 0:v.image_url)||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300&h=200&fit=crop",alt:((l=a.product)==null?void 0:l.name)||"Producto",className:"w-16 h-16 object-cover rounded-lg flex-shrink-0 cursor-pointer",onClick:()=>{var E,S;return P({src:((E=a.product)==null?void 0:E.image_url)||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=800&h=600&fit=crop",alt:((S=a.product)==null?void 0:S.name)||"Producto"})}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:(y=a.product)==null?void 0:y.name}),e.jsxs("p",{className:"text-green-600 font-semibold text-lg",children:["Q",(O=a.product)==null?void 0:O.price]}),((L=a.product)==null?void 0:L.description)&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:a.product.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>f(a.id,a.quantity-1),disabled:w===a.id,className:"h-8 w-8 p-0",children:e.jsx(He,{className:"w-3 h-3"})}),h===a.id?e.jsx(be,{value:C,onChange:E=>D(E.target.value),onBlur:()=>I(a.id),onKeyDown:E=>c(E,a.id),className:"w-16 h-8 text-center text-sm font-medium p-1",autoFocus:!0}):e.jsx("span",{className:"px-3 py-1 bg-white border rounded font-medium cursor-pointer hover:bg-gray-50 min-w-[3rem] text-center",onClick:()=>j(a.id,a.quantity),title:"Haz clic para editar cantidad",children:w===a.id?"...":a.quantity}),e.jsx($,{size:"sm",variant:"outline",onClick:()=>f(a.id,a.quantity+1),disabled:w===a.id,className:"h-8 w-8 p-0",children:e.jsx(ke,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-lg",children:["Q",(((_=a.product)==null?void 0:_.price)*a.quantity).toFixed(2)]})}),e.jsx($,{size:"sm",variant:"outline",onClick:()=>b(a.id),className:"h-8 w-8 p-0 text-red-600 border-red-200 hover:bg-red-50",children:e.jsx(Ke,{className:"w-3 h-3"})})]})]})]},a.id)})})})]},t.sellerId))}),e.jsx("div",{className:"space-y-6",children:e.jsxs(Q,{className:"shadow-sm border border-gray-200",children:[e.jsx(ee,{children:e.jsx(se,{className:"text-lg",children:"Resumen del Pedido"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["Q",M.toFixed(2)]})]}),e.jsx(fe,{}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-orange-600",children:["Q",V.toFixed(2)]})]}),e.jsxs($,{onClick:r,className:"w-full bg-orange-500 hover:bg-orange-600 text-white py-3 text-lg font-medium",size:"lg",children:[e.jsx(Be,{className:"w-5 h-5 mr-2"}),"Proceder al Pago",e.jsx(Bs,{className:"w-5 h-5 ml-2"})]})]})]})})]}),e.jsx(ja,{open:!!N,onOpenChange:()=>P(null),children:e.jsxs(va,{className:"max-w-4xl max-h-[90vh] p-2",children:[e.jsx(ya,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ba,{className:"text-lg font-semibold",children:N==null?void 0:N.alt}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>P(null),className:"h-8 w-8 p-0",children:e.jsx(Le,{className:"h-4 w-4"})})]})}),N&&e.jsx("div",{className:"flex items-center justify-center max-h-[70vh]",children:e.jsx("img",{src:N.src,alt:N.alt,className:"max-w-full max-h-full object-contain rounded-lg shadow-lg",onError:t=>{const a=t.target;a.src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=800&h=600&fit=crop"}})})]})})]})}var gs="Radio",[st,aa]=ds(gs),[at,rt]=st(gs),ra=m.forwardRef((s,r)=>{const{__scopeRadio:n,name:x,checked:d=!1,required:o,disabled:p,value:u="on",onCheck:g,form:w,...q}=s,[h,R]=m.useState(null),C=zs(r,P=>R(P)),D=m.useRef(!1),N=h?w||!!h.closest("form"):!0;return e.jsxs(at,{scope:n,checked:d,disabled:p,children:[e.jsx(Fe.button,{type:"button",role:"radio","aria-checked":d,"data-state":na(d),"data-disabled":p?"":void 0,disabled:p,value:u,...q,ref:C,onClick:is(s.onClick,P=>{d||g==null||g(),N&&(D.current=P.isPropagationStopped(),D.current||P.stopPropagation())})}),N&&e.jsx(tt,{control:h,bubbles:!D.current,name:x,value:u,checked:d,required:o,disabled:p,form:w,style:{transform:"translateX(-100%)"}})]})});ra.displayName=gs;var ta="RadioIndicator",ia=m.forwardRef((s,r)=>{const{__scopeRadio:n,forceMount:x,...d}=s,o=rt(ta,n);return e.jsx(wa,{present:x||o.checked,children:e.jsx(Fe.span,{"data-state":na(o.checked),"data-disabled":o.disabled?"":void 0,...d,ref:r})})});ia.displayName=ta;var tt=s=>{const{control:r,checked:n,bubbles:x=!0,...d}=s,o=m.useRef(null),p=ka(n),u=Sa(r);return m.useEffect(()=>{const g=o.current,w=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(w,"checked").set;if(p!==n&&h){const R=new Event("click",{bubbles:x});h.call(g,n),g.dispatchEvent(R)}},[p,n,x]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:n,...d,tabIndex:-1,ref:o,style:{...s.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function na(s){return s?"checked":"unchecked"}var it=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],hs="RadioGroup",[nt,Xt]=ds(hs,[Ms,aa]),la=Ms(),oa=aa(),[lt,ot]=nt(hs),ca=m.forwardRef((s,r)=>{const{__scopeRadioGroup:n,name:x,defaultValue:d,value:o,required:p=!1,disabled:u=!1,orientation:g,dir:w,loop:q=!0,onValueChange:h,...R}=s,C=la(n),D=Na(w),[N,P]=_a({prop:o,defaultProp:d,onChange:h});return e.jsx(lt,{scope:n,name:x,required:p,disabled:u,value:N,onValueChange:P,children:e.jsx(Pa,{asChild:!0,...C,orientation:g,dir:D,loop:q,children:e.jsx(Fe.div,{role:"radiogroup","aria-required":p,"aria-orientation":g,"data-disabled":u?"":void 0,dir:D,...R,ref:r})})})});ca.displayName=hs;var da="RadioGroupItem",ma=m.forwardRef((s,r)=>{const{__scopeRadioGroup:n,disabled:x,...d}=s,o=ot(da,n),p=o.disabled||x,u=la(n),g=oa(n),w=m.useRef(null),q=zs(r,w),h=o.value===d.value,R=m.useRef(!1);return m.useEffect(()=>{const C=N=>{it.includes(N.key)&&(R.current=!0)},D=()=>R.current=!1;return document.addEventListener("keydown",C),document.addEventListener("keyup",D),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",D)}},[]),e.jsx(Ta,{asChild:!0,...u,focusable:!p,active:h,children:e.jsx(ra,{disabled:p,required:o.required,checked:h,...g,...d,name:o.name,ref:q,onCheck:()=>o.onValueChange(d.value),onKeyDown:is(C=>{C.key==="Enter"&&C.preventDefault()}),onFocus:is(d.onFocus,()=>{var C;R.current&&((C=w.current)==null||C.click())})})})});ma.displayName=da;var ct="RadioGroupIndicator",ua=m.forwardRef((s,r)=>{const{__scopeRadioGroup:n,...x}=s,d=oa(n);return e.jsx(ia,{...d,...x,ref:r})});ua.displayName=ct;var dt=ca,mt=ma,ut=ua;function Ds({className:s,...r}){return e.jsx(dt,{"data-slot":"radio-group",className:Ue("grid gap-3",s),...r})}function As({className:s,...r}){return e.jsx(mt,{"data-slot":"radio-group-item",className:Ue("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:e.jsx(ut,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(mr,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function xt({onBack:s,onComplete:r}){const{user:n}=Se(),{items:x,clearCart:d,getCartTotal:o}=Pe(),{notify:p}=Ia(),[u,g]=m.useState("complete-info"),[w,q]=m.useState("pickup"),[h,R]=m.useState(!1),[C,D]=m.useState(!1),[N,P]=m.useState({customer_name:"",phone_number:"",delivery_address:"",customer_notes:"",payment_method:"cash"});m.useEffect(()=>{n&&M()},[n]);const M=async()=>{try{const{data:_,error:E}=await T.from("users").select("name, phone, address, preferred_delivery_address").eq("id",n==null?void 0:n.id).single();if(E)throw E;P(_?S=>({...S,customer_name:_.name||(n==null?void 0:n.name)||"",phone_number:_.phone||(n==null?void 0:n.phone)||"",delivery_address:_.preferred_delivery_address||_.address||"",customer_notes:""}):S=>({...S,customer_name:(n==null?void 0:n.name)||"",phone_number:(n==null?void 0:n.phone)||"",delivery_address:"",customer_notes:""}))}catch(_){console.error("Error loading user profile:",_),P(E=>({...E,customer_name:(n==null?void 0:n.name)||"",phone_number:(n==null?void 0:n.phone)||"",delivery_address:"",customer_notes:""}))}},V=x.reduce((_,E)=>{var S;return _+(((S=E.product)==null?void 0:S.price)||0)*E.quantity},0),z=w==="delivery"?15:0,f=V+z,j=[{type:"pickup",title:"Recoger en tienda",description:"Recoge tu pedido directamente en la tienda",icon:de,fee:0},{type:"dine-in",title:"Comer en el lugar",description:"Disfruta tu comida en el restaurante",icon:br,fee:0},{type:"delivery",title:"Servicio a domicilio",description:"Te llevamos tu pedido a tu direcci√≥n",icon:ue,fee:15}],I=[{type:"cash",title:"Efectivo",description:"Paga al recibir tu pedido",icon:cr},{type:"card",title:"Tarjeta",description:"Tarjeta de d√©bito o cr√©dito",icon:Be},{type:"transfer",title:"Transferencia",description:"Transferencia bancaria",icon:wr}],c=_=>{switch(_){case"complete-info":return w==="delivery"&&!N.delivery_address.trim()?"Ingresa tu direcci√≥n de entrega":N.customer_name.trim()?N.phone_number.trim()?null:"Ingresa tu tel√©fono":"Ingresa tu nombre";case"payment":return N.payment_method?null:"Selecciona un m√©todo de pago";default:return null}},b=()=>{const _=c(u);if(_){G.error(_);return}const E=["complete-info","payment","review"],S=E.indexOf(u);S<E.length-1&&g(E[S+1])},i=()=>{const _=["complete-info","payment","review"],E=_.indexOf(u);E>0&&g(_[E-1])},t=async()=>{var E;if(!n){G.error("Debes iniciar sesi√≥n para crear un pedido");return}if(!N.customer_name.trim()||!N.phone_number.trim()){G.error("Por favor completa toda la informaci√≥n requerida"),g("complete-info");return}if(w==="delivery"&&!N.delivery_address.trim()){G.error("La direcci√≥n de entrega es requerida para servicio a domicilio"),g("complete-info");return}if(!x||x.length===0){G.error("Tu carrito est√° vac√≠o");return}if(x.filter(S=>!S.product_id||!S.quantity||S.quantity<=0).length>0){G.error("Hay productos inv√°lidos en tu carrito. Por favor actualiza tu carrito.");return}g("processing"),R(!0);try{console.log("Cart items:",x);let S=null;for(const A of x){if(A.seller_id){S=A.seller_id;break}if((E=A.product)!=null&&E.seller_id){S=A.product.seller_id;break}}if(console.log("Seller ID encontrado:",S),!S&&x.length>0){console.log("Intentando obtener seller_id del producto...");try{const{data:A,error:ae}=await T.from("products").select("seller_id").eq("id",x[0].product_id).single();!ae&&(A!=null&&A.seller_id)&&(S=A.seller_id,console.log("Seller ID obtenido del producto:",S))}catch(A){console.error("Error obteniendo seller_id del producto:",A)}}if(!S)throw new Error(`No se pudo identificar el vendedor. Por favor:
1. Vac√≠a tu carrito
2. Agrega los productos nuevamente
3. Si el problema persiste, contacta soporte`);const K={buyer_id:n.id,seller_id:S,subtotal:Number(V.toFixed(2)),delivery_fee:Number(z.toFixed(2)),total_amount:Number(f.toFixed(2)),total:Number(f.toFixed(2)),delivery_type:w,delivery_address:w==="delivery"?N.delivery_address.trim():w==="pickup"?"Recoger en tienda":"Comer en el lugar",customer_notes:N.customer_notes.trim()||null,phone_number:N.phone_number.trim(),customer_name:N.customer_name.trim(),payment_method:N.payment_method,status:"pending"};console.log("üîç Validando stock disponible...");const U=(await Promise.all(x.map(async A=>{var Ce;let ae=null,re="",pe=0;if(A.product_type==="daily"){const{data:ce}=await T.from("daily_products").select("stock_quantity, name, expires_at").eq("id",A.product_id).single();ce&&(ae=ce,re=ce.name,pe=new Date(ce.expires_at)<=new Date?0:ce.stock_quantity)}else{const{data:ce}=await T.from("products").select("stock_quantity, name").eq("id",A.product_id).single();ce&&(ae=ce,re=ce.name,pe=ce.stock_quantity)}return{productId:A.product_id,productName:re||((Ce=A.product)==null?void 0:Ce.name)||"Producto",requestedQuantity:A.quantity,availableStock:pe||0,isValid:(pe||0)>=A.quantity}}))).filter(A=>!A.isValid);if(U.length>0){const A=U.map(ae=>ae.availableStock===0?`‚ùå ${ae.productName}: AGOTADO`:`‚ö†Ô∏è ${ae.productName}: Solo ${ae.availableStock} disponibles (solicitaste ${ae.requestedQuantity})`).join(`
`);throw new Error(`‚ùå STOCK INSUFICIENTE:

${A}

üí° Actualiza las cantidades en tu carrito y vuelve a intentar.`)}console.log("‚úÖ Stock validado correctamente");const{data:Y,error:te}=await T.from("orders").insert(K).select().single();if(te)throw console.error("Error creating order:",te),new Error(`Error al crear la orden: ${te.message}`);if(!Y)throw new Error("No se pudo crear la orden");const ve=x.map(A=>{var ae,re,pe,Ce,ce;return{order_id:Y.id,product_id:A.product_id,product_name:((ae=A.product)==null?void 0:ae.name)||A.product_name||"Producto",product_image:((re=A.product)==null?void 0:re.image_url)||A.product_image||null,price:Number((((pe=A.product)==null?void 0:pe.price)||A.product_price||0).toFixed(2)),price_per_unit:Number((((Ce=A.product)==null?void 0:Ce.price)||A.product_price||0).toFixed(2)),quantity:Number(A.quantity),total_price:Number(((((ce=A.product)==null?void 0:ce.price)||A.product_price||0)*A.quantity).toFixed(2)),product_type:A.product_type||"regular",notes:null}}),{error:B}=await T.from("order_items").insert(ve);if(B)throw console.error("Error creating order items:",B),await T.from("orders").delete().eq("id",Y.id),new Error(`Error al agregar productos a la orden: ${B.message}`);try{await T.from("notifications").insert({recipient_id:S,type:"new_order",title:"üõí Nueva orden recibida",message:`${N.customer_name} ha realizado un pedido por Q${f.toFixed(2)} - ${w==="pickup"?"Recoger en tienda":w==="dine-in"?"Comer en el lugar":"Servicio a domicilio"}`,data:{order_id:Y.id,delivery_type:w,payment_method:N.payment_method,customer_name:N.customer_name,customer_phone:N.phone_number,total:f}})}catch(A){console.error("Error creating notification:",A)}try{await p("üõí Nueva Orden Recibida",{body:`${N.customer_name} realiz√≥ un pedido por Q${f.toFixed(2)}`,sound:"NEW_ORDER",push:!0,data:{orderId:Y.id,customerId:n==null?void 0:n.id,total:f}})}catch(A){console.error("Error sending sound notification:",A)}await d(),D(!0),G.success("¬°Pedido creado exitosamente!"),setTimeout(()=>{r()},2e3)}catch(S){console.error("Error creating order:",S);const K=S instanceof Error?S.message:"Error desconocido al crear el pedido";G.error(K),g("review")}finally{R(!1)}},a=()=>{const _=[{key:"complete-info",label:"Informaci√≥n",icon:Oe},{key:"payment",label:"Pago",icon:Be},{key:"review",label:"Revisar",icon:oe}],E=_.findIndex(S=>S.key===u);return e.jsx("div",{className:"flex items-center justify-between mb-8",children:_.map((S,K)=>{const ne=S.icon,U=S.key===u,Y=K<E;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${U?"bg-orange-500 text-white":Y?"bg-green-500 text-white":"bg-gray-200 text-gray-400"}`,children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("span",{className:`ml-2 text-sm ${U?"text-orange-600 font-medium":Y?"text-green-600":"text-gray-400"}`,children:S.label}),K<_.length-1&&e.jsx("div",{className:`w-8 h-0.5 mx-4 ${Y?"bg-green-500":"bg-gray-200"}`})]},S.key)})})},v=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"Opciones de entrega"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx(Ds,{value:w,onValueChange:_=>q(_),children:j.map(_=>{const E=_.icon;return e.jsxs("div",{className:"flex items-center space-x-2 p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx(As,{value:_.type,id:_.type}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ge,{htmlFor:_.type,className:"font-medium cursor-pointer",children:_.title}),e.jsx("p",{className:"text-sm text-gray-600",children:_.description})]}),e.jsx("div",{className:"text-right",children:_.fee>0?e.jsxs("span",{className:"font-medium",children:["Q",_.fee.toFixed(2)]}):e.jsx("span",{className:"text-green-600 font-medium",children:"Gratis"})})]})]},_.type)})}),w==="delivery"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"address",children:"Direcci√≥n de entrega *"}),e.jsx(We,{id:"address",placeholder:"Ingresa tu direcci√≥n completa con referencias...",value:N.delivery_address,onChange:_=>P(E=>({...E,delivery_address:_.target.value})),rows:3,className:!N.delivery_address&&w==="delivery"?"border-red-300":""}),N.delivery_address&&e.jsxs("p",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),"Direcci√≥n cargada desde tu perfil"]})]})]})]}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Confirmar informaci√≥n de contacto",N.customer_name&&N.phone_number&&e.jsx(oe,{className:"w-5 h-5 text-green-500 ml-auto"})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"name",children:"Nombre completo *"}),e.jsx(be,{id:"name",placeholder:"Tu nombre completo",value:N.customer_name,onChange:_=>P(E=>({...E,customer_name:_.target.value})),className:N.customer_name?"border-green-300 bg-green-50":""}),N.customer_name&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Cargado desde tu perfil"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"phone",children:"N√∫mero de tel√©fono *"}),e.jsx(be,{id:"phone",placeholder:"+502 1234-5678",value:N.phone_number,onChange:_=>P(E=>({...E,phone_number:_.target.value})),className:N.phone_number?"border-green-300 bg-green-50":""}),N.phone_number&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Cargado desde tu perfil"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"notes",children:"Instrucciones especiales (opcional)"}),e.jsx(We,{id:"notes",placeholder:"Alguna instrucci√≥n especial para tu pedido...",value:N.customer_notes,onChange:_=>P(E=>({...E,customer_notes:_.target.value})),rows:2})]})]})]}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Resumen del pedido"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:x.map((_,E)=>{var S,K;return e.jsxs("div",{className:"flex justify-between items-center py-1 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:((S=_.product)==null?void 0:S.name)||_.name}),e.jsxs("span",{className:"text-gray-600 ml-2",children:["x",_.quantity]})]}),e.jsxs("span",{className:"font-medium",children:["Q",((((K=_.product)==null?void 0:K.price)||0)*_.quantity).toFixed(2)]})]},E)})}),e.jsx(fe,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["Q",V.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Entrega:"}),e.jsx("span",{children:z>0?`Q${z.toFixed(2)}`:"Gratis"})]}),e.jsx(fe,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-orange-600",children:["Q",f.toFixed(2)]})]})]})]})]})]}),l=()=>e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"M√©todo de pago"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx(Ds,{value:N.payment_method,onValueChange:_=>P(E=>({...E,payment_method:_})),children:I.map(_=>{const E=_.icon;return e.jsxs("div",{className:"flex items-center space-x-2 p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx(As,{value:_.type,id:_.type}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx(ge,{htmlFor:_.type,className:"font-medium cursor-pointer",children:_.title}),e.jsx("p",{className:"text-sm text-gray-600",children:_.description})]})]})]},_.type)})}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Pago seguro"})]}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Todos los pagos son procesados de forma segura. Tu informaci√≥n est√° protegida."})]})]})]}),y=()=>{const _=j.find(S=>S.type===w),E=I.find(S=>S.type===N.payment_method);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Resumen del pedido"]})}),e.jsxs(H,{className:"space-y-4",children:[x.map((S,K)=>{var ne,U,Y,te,ve;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[((ne=S.product)==null?void 0:ne.image_url)&&e.jsx("img",{src:S.product.image_url,alt:S.product.name,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:(U=S.product)==null?void 0:U.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Q",(te=(Y=S.product)==null?void 0:Y.price)==null?void 0:te.toFixed(2)," x ",S.quantity]})]}),e.jsxs("span",{className:"font-medium",children:["Q",((((ve=S.product)==null?void 0:ve.price)||0)*S.quantity).toFixed(2)]})]},K)}),e.jsx(fe,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["Q",V.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Entrega:"}),e.jsx("span",{children:z>0?`Q${z.toFixed(2)}`:"Gratis"})]}),e.jsx(fe,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-orange-600",children:["Q",f.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsx(se,{className:"text-base",children:"Entrega"})}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[_&&e.jsx(_.icon,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:_==null?void 0:_.title}),w==="delivery"&&N.delivery_address&&e.jsx("p",{className:"text-sm text-gray-600",children:N.delivery_address})]})]})})]}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsx(se,{className:"text-base",children:"Pago"})}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[E&&e.jsx(E.icon,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:E==null?void 0:E.title}),e.jsx("p",{className:"text-sm text-gray-600",children:E==null?void 0:E.description})]})]})})]})]}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsx(se,{className:"text-base",children:"Contacto"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",N.customer_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",N.phone_number]}),N.customer_notes&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Notas:"})," ",N.customer_notes]})]})})]})]})},O=()=>e.jsx("div",{className:"text-center py-12",children:C?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(oe,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-green-600",children:"¬°Pedido creado exitosamente!"}),e.jsx("p",{className:"text-gray-600",children:"Tu pedido ha sido enviado al vendedor. Te notificaremos cuando sea confirmado."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(he,{className:"w-8 h-8 text-orange-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold",children:"Procesando tu pedido..."}),e.jsx("p",{className:"text-gray-600",children:"Por favor espera mientras creamos tu pedido."})]})}),L=()=>{switch(u){case"complete-info":return v();case"payment":return l();case"review":return y();case"processing":return O();default:return null}};return e.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:s,disabled:h,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Volver al carrito"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Checkout"})]}),u!=="processing"&&a(),L(),u!=="processing"&&e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsxs($,{variant:"outline",onClick:i,disabled:u==="complete-info"||h,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Anterior"]}),u==="review"?e.jsx($,{onClick:t,disabled:h,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:h?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:["Confirmar pedido Q",f.toFixed(2),e.jsx(oe,{className:"w-4 h-4 ml-2"})]})}):e.jsxs($,{onClick:b,className:"bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600",children:["Siguiente",e.jsx(Bs,{className:"w-4 h-4 ml-2"})]})]})]})}function gt({notification:s,onDismiss:r,index:n}){const[x,d]=m.useState(!1),[o,p]=m.useState(!1),[u,g]=m.useState(null),[w,q]=m.useState(null),[h,R]=m.useState(0),[C,D]=m.useState(!1),N=m.useRef(null),P=m.useRef(null);m.useEffect(()=>{const v=setTimeout(()=>d(!0),100+n*150);return()=>clearTimeout(v)},[n]),m.useEffect(()=>(P.current=setTimeout(()=>{M()},5*60*1e3),()=>{P.current&&clearTimeout(P.current)}),[]);const M=()=>{P.current&&clearTimeout(P.current),p(!0),setTimeout(()=>{r(s.id)},300)},V=v=>({new_order:we,order_accepted:oe,order_ready:me,order_assigned:Oe,order_picked_up:ue,order_in_transit:ue,order_delivered:oe,order_completed:le,order_cancelled:Ee,order_rejected:Ee,promotion:de,new_product:me,message:Ge,system:Ee,rating:le,general:Ge})[v]||Ge,z=v=>({new_order:"bg-blue-500",order_accepted:"bg-green-500",order_ready:"bg-orange-500",order_assigned:"bg-purple-500",order_picked_up:"bg-indigo-500",order_in_transit:"bg-indigo-500",order_delivered:"bg-green-500",order_completed:"bg-gray-500",order_cancelled:"bg-red-500",order_rejected:"bg-red-500",promotion:"bg-yellow-500",new_product:"bg-pink-500",message:"bg-blue-500",system:"bg-gray-500",rating:"bg-yellow-500",general:"bg-gray-500"})[v]||"bg-gray-500",f=v=>{g(v.targetTouches[0].clientX),D(!0)},j=v=>{if(!u||!C)return;const l=v.targetTouches[0].clientX,y=l-u;R(y),q(l)},I=()=>{if(!u||!w){D(!1),R(0);return}const v=u-w;Math.abs(v)>50?M():R(0),D(!1),g(null),q(null)},c=v=>{g(v.clientX),D(!0)},b=v=>{if(!u||!C)return;const l=v.clientX-u;R(l),q(v.clientX)},i=()=>{if(!u||!w){D(!1),R(0);return}const v=u-w;Math.abs(v)>50?M():R(0),D(!1),g(null),q(null)},t=V(s.type),a=z(s.type);return e.jsx("div",{ref:N,className:`
        fixed top-4 left-4 right-4 z-50 transform transition-all duration-300 ease-out
        ${x&&!o?"translate-y-0 opacity-100":"-translate-y-full opacity-0"}
        ${C?"transition-none":""}
      `,style:{transform:`translateY(${x&&!o?n*80:-100}px) translateX(${h}px)`,opacity:C?Math.max(.5,1-Math.abs(h)/200):x&&!o?1:0},onTouchStart:f,onTouchMove:j,onTouchEnd:I,onMouseDown:c,onMouseMove:C?b:void 0,onMouseUp:i,onMouseLeave:i,children:e.jsx(Q,{className:"bg-white shadow-lg border-l-4 border-orange-500 cursor-grab active:cursor-grabbing select-none",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${a} text-white flex-shrink-0`,children:e.jsx(t,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-gray-700 text-sm",children:s.message})]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),M()},className:"p-1 text-gray-400 hover:text-gray-600 flex-shrink-0",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Desliza para eliminar"}),e.jsx("span",{children:"Auto-eliminar en 5min"})]})]})})})}function ht(){const{user:s}=Se(),[r,n]=m.useState([]),[x,d]=m.useState(!1),o=async()=>{try{const{error:g}=await T.from("notifications").select("recipient_id, type, title, message, is_read, created_at").limit(1);return g?(console.warn("notifications table is not available:",g.code),!1):!0}catch(g){return console.warn("notifications table availability check failed:",g),!1}},p=async()=>{if(!(!s||!x))try{const g=new Date;g.setDate(g.getDate()-1);const{data:w,error:q}=await T.from("notifications").select("*").eq("recipient_id",s.id).eq("is_read",!1).gte("created_at",g.toISOString()).order("created_at",{ascending:!1}).limit(5);if(q){console.error("Error fetching notifications:",q);return}n(w||[])}catch(g){console.error("Unexpected error fetching notifications:",g)}},u=async g=>{if(n(w=>w.filter(q=>q.id!==g)),x)try{await T.from("notifications").update({is_read:!0}).eq("id",g)}catch(w){console.error("Error marking notification as read:",w)}};return m.useEffect(()=>{(async()=>{const w=await o();d(w),w&&await p()})()},[s==null?void 0:s.id]),m.useEffect(()=>{if(!x||!s)return;const g=T.channel("floating-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s.id}`},()=>{p()}).subscribe();return()=>{T.removeChannel(g)}},[s==null?void 0:s.id,x]),m.useEffect(()=>{const g=setInterval(()=>{x&&p()},6e4);return()=>clearInterval(g)},[x]),!x||r.length===0?null:e.jsx(e.Fragment,{children:r.map((g,w)=>e.jsx(gt,{notification:g,onDismiss:u,index:w},g.id))})}function pt({businessId:s,onBack:r,onShowCart:n}){var re,pe,Ce,ce,es,ps,fs;const{user:x}=Se(),{addToCart:d,items:o}=Pe(),{getBusinessProducts:p,getBusinessDailyProducts:u,getBusinessById:g,refreshProductStock:w}=Qs(),{openImageModal:q}=Os(),[h,R]=m.useState(null),[C,D]=m.useState([]),[N,P]=m.useState([]),[M,V]=m.useState(!0),[z,f]=m.useState("productos"),[j,I]=m.useState(null),[c,b]=m.useState(!1),[i,t]=m.useState(new Date),[a,v]=m.useState(null),[l,y]=m.useState("");m.useEffect(()=>{O()},[s]);const O=async()=>{var k,W,J;try{V(!0),console.log("üîç Cargando datos del negocio:",s);const[F,X,xe]=await Promise.all([g(s),p(s),u(s)]);console.log("üìä Datos cargados:",{business:F,products:X,dailyProducts:xe,productsWithImages:(X==null?void 0:X.filter(ie=>ie.image_url).length)||0,productsTotal:(X==null?void 0:X.length)||0,dailyWithImages:(xe==null?void 0:xe.filter(ie=>ie.image_url).length)||0,dailyTotal:(xe==null?void 0:xe.length)||0}),console.log("üî• DEBUG CONTACTO:",{business_phone:F==null?void 0:F.business_phone,phone:F==null?void 0:F.phone,email:F==null?void 0:F.email,address:F==null?void 0:F.address,business_address:F==null?void 0:F.business_address,user:F==null?void 0:F.user,user_phone:(k=F==null?void 0:F.user)==null?void 0:k.phone,user_email:(W=F==null?void 0:F.user)==null?void 0:W.email,user_address:(J=F==null?void 0:F.user)==null?void 0:J.address}),R(F),D(X||[]),P(xe||[]),t(new Date)}catch(F){console.error("‚ùå Error loading business data:",F),G.error("Error al cargar informaci√≥n del comercio")}finally{V(!1)}},L=async()=>{b(!0);try{await w();const[k,W]=await Promise.all([p(s),u(s)]);D(k||[]),P(W||[]),t(new Date),G.success("Productos actualizados correctamente")}catch{G.error("Error al actualizar productos")}finally{b(!1)}},_=async(k,W)=>{if(!x){G.error("Debes iniciar sesi√≥n para agregar productos");return}if(j!==k){I(k);try{const J=await d(k,1,"regular");J.success?G.success("Agregado al carrito"):G.error(J.message,{icon:e.jsx(Ee,{className:"w-4 h-4"}),duration:3e3})}catch(J){console.error("Error adding to cart:",J),G.error("Error al agregar al carrito",{icon:e.jsx(Ae,{className:"w-4 h-4"}),duration:3e3})}finally{I(null)}}},E=async(k,W)=>{if(!x){G.error("Debes iniciar sesi√≥n para agregar productos");return}if(j!==k){I(k);try{console.log("üç∫ Adding daily product to cart:",{productId:k,productName:W,productType:"daily"});const J=await d(k,1,"daily");console.log("üç∫ Daily cart result:",J),J.success?G.success("Agregado al carrito"):(console.error("üç∫ Daily cart failed:",J),G.error(J.message,{icon:e.jsx(Ee,{className:"w-4 h-4"}),duration:3e3}))}catch(J){console.error("Error adding daily to cart:",J),G.error("Error al agregar al carrito",{icon:e.jsx(Ae,{className:"w-4 h-4"}),duration:3e3})}finally{I(null)}}},S=(k,W)=>{v(k),y(W.toString())},K=k=>{const W=parseInt(k);(k===""||!isNaN(W)&&W>=0&&W<=999)&&y(k)},ne=async k=>{const W=parseInt(l);!isNaN(W)&&W>=0&&await Y(k,W),v(null),y("")},U=async(k,W)=>{k.key==="Enter"?await ne(W):k.key==="Escape"&&(v(null),y(""))},Y=async(k,W)=>{const J=o.find(F=>F.product_id===k);if(J){I(k);try{if(W<=0){const F=await d(k,-J.quantity,"daily");F.success?G.success("Producto removido del carrito"):G.error(F.message)}else{const F=W-J.quantity,X=await d(k,F,"daily");X.success?G.success(`Cantidad actualizada: ${W}`):G.error(X.message)}}catch(F){console.error("Error updating daily cart quantity:",F),G.error("Error al actualizar cantidad")}finally{I(null)}}},te=k=>{const W=o==null?void 0:o.find(F=>F.product_id===k),J=(W==null?void 0:W.quantity)||0;return console.log("üõí Cart check:",{productId:k,cartItems:(o==null?void 0:o.length)||0,foundItem:!!W,quantity:J}),J},ve=(h==null?void 0:h.logo_url)||((re=h==null?void 0:h.user)==null?void 0:re.avatar_url),B=h==null?void 0:h.cover_image_url,A=({product:k})=>{var Te;const W=Cs(k),J=te(k.id),F=j===k.id,X={isAvailable:k.is_available&&k.stock_quantity>0,hasStock:k.stock_quantity>0,isLowStock:k.stock_quantity<=5&&k.stock_quantity>0,isLastUnits:k.stock_quantity<=3&&k.stock_quantity>0,stockCount:k.stock_quantity||0,isDisabledByVendor:k.is_available===!1,isOutOfStock:k.stock_quantity===0};console.log("üõçÔ∏è ProductCard Availability:",{productName:k.name,productId:k.id,is_available:k.is_available,stock_quantity:k.stock_quantity,availabilityInfo:X,cartQuantity:J,isAdding:F});const ie=X.isOutOfStock?{text:"Agotado",className:"bg-red-100 text-red-700",icon:"‚ùå"}:X.isDisabledByVendor?{text:"No disponible",className:"bg-gray-100 text-gray-600",icon:"‚è∏Ô∏è"}:X.isLastUnits?{text:`¬°√öltimas ${X.stockCount}!`,className:"bg-red-100 text-red-700 animate-pulse",icon:"üî•"}:X.isLowStock?{text:`${X.stockCount} disponibles`,className:"bg-orange-100 text-orange-700",icon:"‚ö†Ô∏è"}:X.hasStock?{text:`${X.stockCount} disponibles`,className:"bg-green-100 text-green-700",icon:"‚úÖ"}:{text:"Sin stock",className:"bg-gray-100 text-gray-600",icon:"‚ùå"};return e.jsx(Q,{className:"bg-white shadow-sm border border-gray-100 rounded-xl overflow-hidden hover:shadow-md transition-all min-h-[100px]",children:e.jsx(H,{className:"p-0 h-full",style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"flex h-full relative",onClick:$e=>console.log("Card clicked",$e.target),style:{pointerEvents:"auto"},children:[e.jsxs("div",{className:"relative w-20 h-20 bg-gray-100 flex-shrink-0 cursor-pointer",onClick:$e=>{console.log("üñºÔ∏è Image area clicked"),$e.stopPropagation(),W&&q(W,k.name)},style:{pointerEvents:"auto"},children:[W?e.jsx(ye,{src:W,alt:k.name,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"w-5 h-5 text-orange-300 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-orange-400 font-medium",children:"Sin imagen"})]})}),e.jsxs("div",{className:"absolute top-1 left-1 space-y-1",children:[X.isOutOfStock&&e.jsx(Z,{className:"bg-red-500 text-white text-xs px-2 py-1 shadow-lg",children:"Agotado"}),X.isDisabledByVendor&&e.jsx(Z,{className:"bg-gray-500 text-white text-xs px-2 py-1 shadow-lg",children:"No disponible"}),X.isLastUnits&&e.jsxs(Z,{className:"bg-red-500 text-white text-xs px-2 py-1 shadow-lg animate-pulse",children:["üî• ¬°√öltimas ",X.stockCount,"!"]})]}),W&&e.jsx("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/20 transition-colors duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 hover:opacity-100 transition-opacity bg-black/70 rounded-lg px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-medium",children:[e.jsx(cs,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver"})]})})})]}),e.jsxs("div",{className:"flex-1 p-3 pl-4 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 pr-4 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900 mb-1 line-clamp-2 break-words",children:k.name}),k.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-3 mb-2 break-words",children:k.description})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-2",children:[e.jsxs("span",{className:"text-base font-bold text-gray-900 whitespace-nowrap",children:["Q",(Te=k.price)==null?void 0:Te.toFixed(2)]}),k.compare_at_price&&k.compare_at_price>k.price&&e.jsxs("div",{className:"text-xs text-gray-400 line-through whitespace-nowrap",children:["Q",k.compare_at_price.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[J>0&&e.jsxs(Z,{className:"bg-orange-100 text-orange-700 text-xs font-semibold w-fit",children:[J," en carrito"]}),e.jsxs(Z,{className:`text-xs font-medium w-fit ${ie.className}`,children:[e.jsx("span",{className:"mr-1",children:ie.icon}),ie.text]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{onClick:()=>{X.isAvailable&&_(k.id,k.name)},disabled:!X.isAvailable||F,className:`
                      h-8 px-3 text-xs font-medium rounded transition-all duration-200
                      ${X.isAvailable&&!F?"bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white cursor-pointer shadow-md hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"}
                    `,type:"button",children:F?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):J>0&&X.isAvailable?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),"+1"]}):X.isAvailable?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),"Agregar"]}):X.isOutOfStock?"Agotado":X.isDisabledByVendor?"No disponible":"Sin stock"})})]})]})]})})})},ae=({product:k})=>{var js;const[W,J]=m.useState(!1),[F,X]=m.useState({hours:0,minutes:0,isExpired:!0,formattedTime:"Expirado"}),xe=Cs(k),ie=te(k.id),Te=j===k.id;m.useEffect(()=>{if(!k.expires_at)return;const Re=()=>{const ha=new Date,ss=new Date(k.expires_at).getTime()-ha.getTime();if(ss<=0){X({hours:0,minutes:0,isExpired:!0,formattedTime:"Expirado"});return}const as=Math.floor(ss/(1e3*60*60)),rs=Math.floor(ss%(1e3*60*60)/(1e3*60));X({hours:as,minutes:rs,isExpired:!1,formattedTime:as>0?`${as}h ${rs}m restantes`:`${rs}m restantes`})};Re();const ga=setInterval(Re,1e3);return()=>clearInterval(ga)},[k.expires_at]);const $e=()=>k.stock_quantity===0?"bg-red-500 text-white":k.stock_quantity<=3?"bg-yellow-500 text-white":"bg-green-500 text-white",xa=()=>{xe&&q(xe,k.name)};return e.jsx(Q,{className:"hover:shadow-xl transition-all duration-300 border-orange-200 overflow-hidden",children:e.jsx(H,{className:"p-0",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 bg-gray-100 flex-shrink-0",children:[e.jsx("div",{className:"cursor-pointer w-full h-full",onClick:xa,children:xe?e.jsx(ye,{src:xe,alt:k.name,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200",onError:()=>J(!0)}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-orange-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Me,{className:"w-4 h-4 sm:w-5 sm:h-5 text-orange-400 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"Sin imagen"})]})})}),e.jsxs(Z,{className:"absolute -top-1 -left-1 bg-orange-500 text-white animate-pulse text-xs px-1 py-0.5",children:[e.jsx(Ie,{className:"w-2.5 h-2.5 mr-0.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Del D√≠a"}),e.jsx("span",{className:"sm:hidden",children:"Hoy"})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-red-500 text-white rounded-full px-1.5 py-0.5 text-xs font-bold",children:F.hours>0?`${F.hours}h`:`${F.minutes}m`})]}),e.jsxs("div",{className:"flex-1 p-3 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-gray-900 line-clamp-1 mb-1",children:k.name}),k.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1 mb-1",children:k.description}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-1",children:[e.jsx(de,{className:"w-2.5 h-2.5"}),e.jsxs("span",{className:"truncate",children:["por ",(h==null?void 0:h.business_name)||"Este negocio"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-orange-600",children:["Q",(js=k.price)==null?void 0:js.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-gray-500 justify-end",children:[e.jsx(le,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),e.jsx("span",{children:"4.5"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs",children:[!F.isExpired&&e.jsxs("div",{className:"flex items-center gap-1 text-orange-600 bg-orange-50 px-1.5 py-0.5 rounded",children:[e.jsx(he,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-medium",children:F.hours>0?`${F.hours}h ${F.minutes}m`:`${F.minutes}m`})]}),e.jsxs(Z,{className:`text-xs ${$e()} px-1.5 py-0.5`,children:[e.jsx(me,{className:"w-2.5 h-2.5 mr-0.5"}),e.jsx("span",{children:k.stock_quantity===0?"Agotado":k.stock_quantity<=3?`¬°${k.stock_quantity}!`:`${k.stock_quantity}`})]}),ie>0&&e.jsx(Z,{className:"bg-orange-100 text-orange-700 text-xs font-semibold px-1.5 py-0.5",children:ie}),!F.isExpired&&F.hours<2&&e.jsx(Z,{className:"bg-yellow-100 text-yellow-700 text-xs animate-pulse px-1.5 py-0.5",children:"¬°Urgente!"})]}),F.isExpired&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-1.5 mb-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"w-3 h-3 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs text-red-700 font-medium",children:"Oferta expirada"})]})}),ie>0?e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx($,{size:"sm",variant:"outline",onClick:()=>Y(k.id,ie-1),disabled:Te,className:"h-7 w-7 p-0",children:e.jsx(He,{className:"w-3 h-3"})}),a===k.id?e.jsx(be,{type:"number",value:l,onChange:Re=>K(Re.target.value),onBlur:()=>ne(k.id),onKeyDown:Re=>U(Re,k.id),className:"w-12 h-7 text-center text-xs p-1",autoFocus:!0}):e.jsx("button",{onClick:()=>S(k.id,ie),className:"w-12 h-7 text-xs font-medium bg-gray-100 rounded border hover:bg-gray-200 flex items-center justify-center",title:"Haz clic para editar cantidad",children:ie}),e.jsx($,{size:"sm",variant:"outline",onClick:()=>Y(k.id,ie+1),disabled:Te||k.stock_quantity<=ie,className:"h-7 w-7 p-0",children:e.jsx(ke,{className:"w-3 h-3"})})]}):null,e.jsx($,{onClick:()=>{ie>0?Y(k.id,ie+1):(console.log("üç∫ DailyProductCard button clicked - should call handleAddDailyToCart"),E(k.id,k.name))},disabled:!k.is_available||Te||k.stock_quantity<=0||F.isExpired,className:"w-full h-8 sm:h-9 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white text-sm font-medium",children:Te?e.jsxs(e.Fragment,{children:[e.jsx(Ca,{className:"w-3 h-3 mr-1 animate-spin"}),e.jsx("span",{className:"sm:hidden",children:"..."}),e.jsx("span",{className:"hidden sm:inline",children:"Agregando..."})]}):k.stock_quantity<=0?"Agotado":F.isExpired?"Expirado":ie>0?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"sm:hidden",children:"+1"}),e.jsx("span",{className:"hidden sm:inline",children:"+1 m√°s"})]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"sm:hidden",children:"Agregar"}),e.jsx("span",{className:"hidden sm:inline",children:"Agregar al carrito"})]})})]})]})})})};return M?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando perfil del comercio..."})]})}):h?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs($,{onClick:r,size:"sm",variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{onClick:L,disabled:c,size:"sm",variant:"ghost",className:"text-green-600 hover:text-green-900 hover:bg-green-50",children:e.jsx(De,{className:`w-4 h-4 ${c?"animate-spin":""}`})}),e.jsx($,{size:"sm",variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx($,{size:"sm",variant:"ghost",className:"text-gray-600 hover:text-gray-900",children:e.jsx(fr,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-4 bg-white",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[ve&&e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 shadow-md p-1 flex-shrink-0",children:e.jsx(ye,{src:ve,alt:`Logo de ${h.business_name}`,className:"w-full h-full object-cover rounded-xl"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 truncate",children:h.business_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Actualizado: ",i.toLocaleTimeString()]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-4 h-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:h.rating.toFixed(1)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",h.products_count," productos)"]})]}),e.jsx(Z,{className:`text-xs px-2 py-1 ${h.is_open_now?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200"}`,variant:"outline",children:h.is_open_now?"üü¢ Abierto":"üî¥ Cerrado"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-1 text-gray-400"}),e.jsx("span",{className:"truncate",children:h.address||h.business_address||"Direcci√≥n no disponible"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"w-4 h-4 mr-1 text-gray-400"}),e.jsx("span",{children:"25-35 min"})]})]})]}),h.is_verified&&e.jsx("div",{className:"ml-3",children:e.jsxs(Z,{className:"bg-blue-50 text-blue-700 border-blue-200",variant:"outline",children:[e.jsx(Ls,{className:"w-3 h-3 mr-1"}),"Verificado"]})})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center mx-auto mb-2",children:e.jsx(we,{className:"w-5 h-5 text-orange-600"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pedido m√≠nimo"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Q50"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-2",children:e.jsx(he,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Costo env√≠o"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Q15"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-2",children:e.jsx(Me,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Tiempo entrega"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"25-35 min"})]})]})})]}),B&&e.jsx("div",{className:"relative w-full h-40 mx-4 mb-4 rounded-xl overflow-hidden",children:e.jsx(ye,{src:B,alt:`Portada de ${h.business_name}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"bg-gray-50",children:e.jsx("div",{className:"px-4 mb-4",children:e.jsx(Q,{className:"bg-white shadow-lg border-0 rounded-2xl overflow-hidden",children:e.jsx(H,{className:"p-0",children:e.jsxs(Ze,{value:z,onValueChange:f,className:"w-full",children:[e.jsxs(Je,{className:"grid w-full grid-cols-3 bg-gray-50 p-1 m-2 rounded-xl",children:[e.jsxs(_e,{value:"productos",className:"rounded-lg text-sm font-medium data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Productos (",C.length,")"]}),e.jsxs(_e,{value:"dia",className:"rounded-lg text-sm font-medium data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Del D√≠a (",N.length,")"]}),e.jsxs(_e,{value:"info",className:"rounded-lg text-sm font-medium data-[state=active]:bg-white data-[state=active]:shadow-sm transition-all",children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Info"]})]}),e.jsxs("div",{className:"px-3 py-4",children:[e.jsx(je,{value:"productos",className:"mt-0",children:M?e.jsx("div",{className:"space-y-3",children:[...Array(6)].map((k,W)=>e.jsx("div",{className:"bg-gray-100 rounded-xl h-24 animate-pulse"},W))}):C&&C.length>0?e.jsx("div",{className:"space-y-3",children:C.map(k=>e.jsx(A,{product:k},k.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No hay productos disponibles"}),e.jsx("p",{className:"text-xs text-gray-400",children:C&&C.length>0?`Se encontraron ${C.length} productos pero no est√°n disponibles`:"No se pudieron cargar los productos"}),C&&C.length>0&&e.jsx("button",{onClick:()=>console.log("üîç Productos encontrados:",C),className:"mt-2 text-xs text-blue-500 hover:text-blue-700",children:"Ver detalles en consola"})]})}),e.jsx(je,{value:"dia",className:"mt-0",children:M?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((k,W)=>e.jsx("div",{className:"bg-gray-100 rounded-xl h-24 animate-pulse"},W))}):N&&N.length>0?e.jsx("div",{className:"space-y-3",children:N.map(k=>e.jsx(ae,{product:k},k.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No hay productos del d√≠a"}),e.jsx("p",{className:"text-xs text-gray-400",children:N&&N.length>0?`Se encontraron ${N.length} productos del d√≠a pero no est√°n disponibles`:"No se pudieron cargar los productos del d√≠a"}),N&&N.length>0&&e.jsx("button",{onClick:()=>console.log("üîç Productos del d√≠a encontrados:",N),className:"mt-2 text-xs text-blue-500 hover:text-blue-700",children:"Ver detalles en consola"})]})}),e.jsx(je,{value:"info",className:"mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(he,{className:"w-5 h-5 mr-2 text-blue-600"}),"Horarios de Atenci√≥n"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Lunes - Viernes:"}),e.jsx("span",{className:"font-medium",children:"8:00 AM - 9:00 PM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"S√°bados:"}),e.jsx("span",{className:"font-medium",children:"8:00 AM - 10:00 PM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Domingos:"}),e.jsx("span",{className:"font-medium",children:"9:00 AM - 8:00 PM"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ls,{className:"w-5 h-5 mr-2 text-green-600"}),"Contacto"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[console.log("üî• RENDER CONTACTO:",{phone_options:[h.phone,h.business_phone,(pe=h.user)==null?void 0:pe.phone],address_options:[h.address,h.business_address,(Ce=h.user)==null?void 0:Ce.address],final_phone:h.phone||h.business_phone||((ce=h.user)==null?void 0:ce.phone)||"No disponible",final_address:h.address||h.business_address||((es=h.user)==null?void 0:es.address)||"Direcci√≥n no disponible"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ls,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:h.phone||h.business_phone||((ps=h.user)==null?void 0:ps.phone)||"No disponible"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:h.address||h.business_address||((fs=h.user)==null?void 0:fs.address)||"Direcci√≥n no disponible"})]})]})]}),(h.description||h.business_description)&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ws,{className:"w-5 h-5 mr-2 text-purple-600"}),"Acerca de"]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:h.description||h.business_description})]})]})})]})]})})})})}),e.jsx(us,{onCartClick:()=>{console.log("üõí Carrito flotante clicked desde BusinessProfile!"),n?n():alert("üõí Carrito flotante funcional! Navegaci√≥n no configurada.")}})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ee,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No se pudo cargar el comercio"}),e.jsx($,{onClick:r,children:"Volver"})]})})}function Yt(){var V;const{user:s,signOut:r}=Se(),{getCartItemCount:n}=Pe(),[x,d]=m.useState("home"),[o,p]=m.useState("dashboard"),[u,g]=m.useState(""),[w,q]=m.useState(""),h=z=>{g(z),p("business-profile")},R=()=>{p("dashboard"),g("")},C=()=>{p("dashboard"),d("home")},D=z=>{q(z),p("order-tracking")},N=()=>{p("dashboard"),q("")},P=(z,f)=>{console.log(`üö® Alerta cr√≠tica para comprador: ${z} - ${f}`)},M=z=>{console.log(`‚è∞ Alerta de timeout: Orden ${z.orderId} - ${z.timeSinceStatus} min`)};return o==="business-profile"?e.jsx(pt,{businessId:u,onBack:R,onShowCart:()=>p("cart")}):o==="cart"?e.jsx(et,{onContinueShopping:()=>p("dashboard"),onProceedToCheckout:()=>p("checkout")}):o==="checkout"?e.jsx(xt,{onBack:C,onComplete:()=>{p("dashboard"),d("orders")}}):o==="order-tracking"?e.jsx(ks,{children:e.jsx(Ks,{orderId:w,onBack:N})}):e.jsx(ks,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx(qa,{showBanner:!0,enableAutoActivation:!1}),e.jsx("div",{className:"container mx-auto px-4",children:typeof window<"u"&&"Notification"in window&&Notification.permission!=="granted"&&e.jsx("div",{className:"flex justify-end mb-2"})}),e.jsx(sr,{onNotification:P}),e.jsx(Fa,{onAlert:M}),w&&e.jsx("div",{className:"container mx-auto px-4 mb-4",children:e.jsx(ir,{orderId:w})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(de,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"TRATO"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:["¬°Hola, ",((V=s==null?void 0:s.email)==null?void 0:V.split("@")[0])||"guichointeriano","!"]})]})]}),e.jsxs($,{variant:"outline",onClick:r,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(nr,{className:"w-4 h-4"}),e.jsx("span",{children:"Cerrar Sesi√≥n"})]})]})})}),e.jsx(ht,{}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-3 gap-1",children:[{id:"home",label:"Inicio",icon:ys},{id:"orders",label:"Pedidos",icon:me},{id:"profile",label:"Perfil",icon:Oe}].map(z=>{const f=z.icon,j=x===z.id;return e.jsxs("button",{onClick:()=>d(z.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:j?"#fef3c7":"transparent",color:j?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:z.label})]},z.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(Ze,{value:x,onValueChange:d,className:"space-y-6",children:[e.jsx(Je,{className:"grid w-full grid-cols-3 lg:w-2/3 mx-auto bg-white border border-gray-200",children:[{id:"home",label:"Inicio",icon:ys},{id:"orders",label:"Pedidos",icon:me},{id:"profile",label:"Perfil",icon:Oe}].map(z=>{const f=z.icon;return e.jsxs(_e,{value:z.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:z.label})]},z.id)})}),e.jsx(je,{value:"home",className:"space-y-6",children:e.jsx(Es,{onBusinessClick:h,onShowCart:()=>p("cart")})}),e.jsx(je,{value:"orders",className:"space-y-6",children:e.jsx(qs,{onViewOrder:D})}),e.jsx(je,{value:"profile",className:"space-y-6",children:e.jsx(Rs,{onShowCart:()=>p("cart")})})]})}),e.jsxs("div",{className:"block md:hidden",children:[x==="home"&&e.jsx(Es,{onBusinessClick:h,onShowCart:()=>p("cart")}),x==="orders"&&e.jsx(qs,{onViewOrder:D}),x==="profile"&&e.jsx(Rs,{onShowCart:()=>p("cart")})]})]}),o==="order-tracking"&&e.jsx("div",{className:"fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-auto z-50",children:e.jsx(Q,{className:"mobile-card border-green-200 bg-green-50",children:e.jsx(H,{className:"mobile-card-content",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"mobile-text font-medium text-green-800 mb-1",children:"¬°Orden creada exitosamente!"}),e.jsx("p",{className:"mobile-text-small text-green-600",children:"Puedes seguir el estado de tu pedido aqu√≠"})]})]})})})}),e.jsx($a,{})]})})}export{Yt as BuyerDashboard};
