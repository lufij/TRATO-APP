import{g as Re,j as e,o as M,r as m,C as E,c as T,B as v,a as R,b as L,f as k,P as se,s as p,t as h,v as ae,p as Le,u as ze,e as re,R as B,T as oe,E as Y}from"./index-u8vAgmjF.js";import{I as V}from"./input-DmLNYdwZ.js";import{D as xe,c as he,N as Oe,T as Pe,a as Fe,b as q,P as te,d as I}from"./NotificationSystem-DapRT9yU.js";import{S as z,a as O,b as P,c as F,d as n}from"./select-ERGZIR5W.js";import{A as me,a as ue,b as je,c as ve,d as ge,e as pe,f as fe,g as be,h as Ne}from"./alert-dialog-vtj2ql1Z.js";import{T as Ue,a as G}from"./colors-BLlkNVHy.js";import{T as X}from"./triangle-alert-Bdv5VT5P.js";import{U as J}from"./users-DFvmLCit.js";import{T as ye}from"./truck-ClKel8sK.js";import{S as K}from"./shopping-cart-CTfJLhck.js";import{A as ie}from"./activity-_I72D00f.js";import{C as we}from"./circle-x-DNasVzMJ.js";import{C as _e}from"./clock-vEA5kH2y.js";import{M as Ve,S as Z}from"./search-Dp53-kRV.js";import{S as W}from"./store-Bxx5et7U.js";import{S as Ce}from"./shield-BJup4OxB.js";import{C as de}from"./crown-BsV-rEJY.js";import{T as Se}from"./trash-2-CSi994Md.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],Ie=Re("trending-down",qe);function le({className:a,...u}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:M("w-full caption-bottom text-sm",a),...u})})}function ne({className:a,...u}){return e.jsx("thead",{"data-slot":"table-header",className:M("[&_tr]:border-b",a),...u})}function ce({className:a,...u}){return e.jsx("tbody",{"data-slot":"table-body",className:M("[&_tr:last-child]:border-0",a),...u})}function $({className:a,...u}){return e.jsx("tr",{"data-slot":"table-row",className:M("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...u})}function C({className:a,...u}){return e.jsx("th",{"data-slot":"table-head",className:M("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...u})}function S({className:a,...u}){return e.jsx("td",{"data-slot":"table-cell",className:M("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...u})}function Be(){const[a,u]=m.useState(null),[o,b]=m.useState(!0),[j,_]=m.useState(new Date),[c,A]=m.useState(!0),N=async()=>{try{const{data:r,error:s}=await p.rpc("get_admin_stats");if(s){console.error("Error fetching admin stats:",s),h.error("Error al cargar estadísticas");return}u(r),_(new Date)}catch(r){console.error("Error fetching stats:",r),h.error("Error de conexión")}finally{b(!1)}};m.useEffect(()=>{N()},[]),m.useEffect(()=>{if(!c)return;const r=setInterval(()=>{N()},3e4);return()=>clearInterval(r)},[c]);const D=(r,s="number")=>{switch(s){case"currency":return`Q${r.toFixed(2)}`;case"percentage":return`${r.toFixed(1)}%`;default:return r.toString()}},l=(r,s)=>r>s?e.jsx(he,{className:"w-4 h-4 text-green-500"}):r<s?e.jsx(Ie,{className:"w-4 h-4 text-red-500"}):e.jsx(Ve,{className:"w-4 h-4 text-gray-500"}),t=()=>{if(!a)return{status:"checking",color:"yellow",label:"Verificando..."};const r=a.pending_drivers>5||!a.active_drivers,s=a.pending_businesses>0||a.pending_drivers>0;return r?{status:"critical",color:"red",label:"Requiere Atención"}:s?{status:"warning",color:"yellow",label:"Advertencias"}:{status:"healthy",color:"green",label:"Sistema Saludable"}};if(o)return e.jsx(E,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),e.jsx("span",{className:"ml-2",children:"Cargando estadísticas..."})]})})});if(!a)return e.jsx(E,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:"Error al cargar estadísticas del sistema"}),e.jsx(v,{onClick:N,className:"mt-4",children:"Reintentar"})]})})});const x=t(),f=[{label:"Usuarios Activos",value:a.active_users,previousValue:a.total_users,icon:J,color:"blue"},{label:"Repartidores Activos",value:a.active_drivers,previousValue:a.total_drivers,icon:ye,color:"orange"},{label:"Órdenes Hoy",value:a.orders_today,previousValue:0,icon:K,color:"purple"},{label:"Ingresos Hoy",value:a.revenue_today,previousValue:0,icon:xe,color:"green",format:"currency"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:`border-l-4 ${x.color==="red"?"border-l-red-500 bg-red-50":x.color==="yellow"?"border-l-yellow-500 bg-yellow-50":"border-l-green-500 bg-green-50"}`,children:[e.jsx(R,{children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:`w-5 h-5 ${x.color==="red"?"text-red-600":x.color==="yellow"?"text-yellow-600":"text-green-600"}`}),e.jsx("span",{children:"Estado del Sistema TRATO"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{variant:x.status==="healthy"?"default":"destructive",className:`${x.color==="green"?"bg-green-100 text-green-800":x.color==="yellow"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:x.label}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>A(!c),className:c?"bg-green-50 border-green-300":"",children:c?"Auto-refresh ON":"Auto-refresh OFF"})]})]})}),e.jsxs(T,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:f.map((r,s)=>e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(r.icon,{className:`w-5 h-5 text-${r.color}-600`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r.label})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:D(r.value,r.format)}),e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[l(r.value,r.previousValue),e.jsxs("span",{className:"text-xs text-gray-500",children:["vs ",D(r.previousValue,r.format)]})]})]},s))}),e.jsxs("div",{className:"mt-6 space-y-2",children:[a.pending_drivers>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"text-sm font-medium text-orange-800",children:[a.pending_drivers," repartidor",a.pending_drivers>1?"es":""," pendiente",a.pending_drivers>1?"s":""," de aprobación"]})]}),e.jsx(v,{size:"sm",className:"bg-orange-500 hover:bg-orange-600",children:"Revisar"})]}),a.pending_businesses>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[a.pending_businesses," negocio",a.pending_businesses>1?"s":""," pendiente",a.pending_businesses>1?"s":""," de verificación"]})]}),e.jsx(v,{size:"sm",variant:"outline",className:"border-blue-300 text-blue-700",children:"Revisar"})]}),a.active_drivers===0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"¡No hay repartidores activos! Las entregas están pausadas."})]}),e.jsx(v,{size:"sm",variant:"destructive",children:"Activar Repartidores"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsxs("span",{children:["Última actualización: ",j.toLocaleTimeString()]})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:N,className:"text-gray-600 hover:text-gray-900",children:"Actualizar ahora"})]})]})]}),e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Salud del Sistema"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Repartidores Activos"}),e.jsxs("span",{children:[a.active_drivers,"/",a.total_drivers]})]}),e.jsx(se,{value:a.total_drivers>0?a.active_drivers/a.total_drivers*100:0,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Negocios Verificados"}),e.jsxs("span",{children:[a.total_businesses,"/",a.total_businesses+a.pending_businesses]})]}),e.jsx(se,{value:a.total_businesses+a.pending_businesses>0?a.total_businesses/(a.total_businesses+a.pending_businesses)*100:0,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Usuarios Activos"}),e.jsxs("span",{children:[a.active_users,"/",a.total_users]})]}),e.jsx(se,{value:a.total_users>0?a.active_users/a.total_users*100:0,className:"h-2"})]})]})})]})]})}function $e(){const[a,u]=m.useState("general"),[o,b]=m.useState({appName:"TRATO",maintenanceMode:!1,allowRegistrations:!0,deliveryFee:10,platformCommission:5}),j=[{id:"general",name:"General",icon:ae},{id:"delivery",name:"Entrega",icon:W},{id:"users",name:"Usuarios",icon:J},{id:"notifications",name:"Notificaciones",icon:Le},{id:"security",name:"Seguridad",icon:Ce}],_=()=>{h.success("Configuración guardada correctamente")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Configuración del Sistema"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra todos los aspectos de tu plataforma desde aquí."})]}),e.jsx("div",{className:"border-b",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:j.map(c=>{const A=c.icon;return e.jsxs("button",{onClick:()=>u(c.id),className:`flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm ${a===c.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-gray-300"}`,children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:c.name})]},c.id)})})}),e.jsxs("div",{className:"space-y-6",children:[a==="general"&&e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Configuración General"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nombre de la Aplicación"}),e.jsx(V,{value:o.appName,onChange:c=>b({...o,appName:c.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"maintenance",checked:o.maintenanceMode,onChange:c=>b({...o,maintenanceMode:c.target.checked})}),e.jsx("label",{htmlFor:"maintenance",className:"text-sm font-medium",children:"Modo Mantenimiento"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"registrations",checked:o.allowRegistrations,onChange:c=>b({...o,allowRegistrations:c.target.checked})}),e.jsx("label",{htmlFor:"registrations",className:"text-sm font-medium",children:"Permitir Nuevos Registros"})]})]})]}),a==="delivery"&&e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Configuración de Entrega"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tarifa de Entrega (Bs)"}),e.jsx(V,{type:"number",value:o.deliveryFee,onChange:c=>b({...o,deliveryFee:parseInt(c.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Comisión de Plataforma (%)"}),e.jsx(V,{type:"number",value:o.platformCommission,onChange:c=>b({...o,platformCommission:parseInt(c.target.value)})})]})]})]}),a==="users"&&e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Gestión de Usuarios"})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"25"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Compradores"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"8"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vendedores"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"5"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Repartidores"})]})]})})})]}),a==="notifications"&&e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Configuración de Notificaciones"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configurar las preferencias de notificación del sistema."}),e.jsx(k,{variant:"outline",children:"Próximamente"})]})})]}),a==="security"&&e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Configuración de Seguridad"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configurar las políticas de seguridad del sistema."}),e.jsx(k,{variant:"outline",children:"Próximamente"})]})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{variant:"outline",children:"Cancelar"}),e.jsx(v,{onClick:_,children:"Guardar Cambios"})]})]})}function H({title:a,value:u,icon:o,trend:b,color:j,subtitle:_}){return e.jsx(E,{className:"bg-white/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsxs(T,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:u}),_&&e.jsx("p",{className:"text-xs text-gray-500",children:_})]}),e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{backgroundColor:j},children:e.jsx(o,{className:"w-8 h-8 text-white"})})]}),b&&e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsx(he,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:b})]})]})})}function Me(){const[a,u]=m.useState([]),[o,b]=m.useState(!0),[j,_]=m.useState(""),[c,A]=m.useState("all"),[N,D]=m.useState("all"),l=async()=>{try{b(!0);const{data:s,error:i}=await p.from("users").select(`
          id,
          email,
          name,
          role,
          phone,
          avatar_url,
          is_active,
          is_verified,
          profile_completed,
          created_at,
          updated_at
        `).order("created_at",{ascending:!1});if(i)throw i;u(s||[])}catch(s){console.error("Error fetching users:",s),h.error("Error al cargar usuarios")}finally{b(!1)}};m.useEffect(()=>{l()},[]);const t=a.filter(s=>{var y,w;const i=((y=s.name)==null?void 0:y.toLowerCase().includes(j.toLowerCase()))||s.email.toLowerCase().includes(j.toLowerCase())||((w=s.phone)==null?void 0:w.toLowerCase().includes(j.toLowerCase())),d=c==="all"||s.role===c,g=N==="all"||(s.is_active!==void 0?s.is_active?"active":"inactive":"active")===N;return i&&d&&g}),x=async(s,i)=>{try{const{error:d}=await p.from("users").update({is_active:i==="active"}).eq("id",s);if(d)throw d;h.success("Estado de usuario actualizado"),l()}catch(d){console.error("Error updating user status:",d),h.error("Error al actualizar estado")}},f=async(s,i,d)=>{try{const{error:g}=await p.from("users").update({[i]:d,updated_at:new Date().toISOString()}).eq("id",s).eq("role","repartidor");if(g)throw g;const y=i==="is_verified"?"verificación":"activación",w=d?y:`des${y}`;h.success(`Repartidor ${w} actualizado exitosamente`),l()}catch(g){console.error("Error updating driver status:",g),h.error("Error al actualizar estado del repartidor")}},r=async s=>{try{const{error:i}=await p.from("users").delete().eq("id",s);if(i)throw i;h.success("Usuario eliminado"),l()}catch(i){console.error("Error deleting user:",i),h.error("No se pudo eliminar. Revisa relaciones o prueba suspenderlo.")}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Gestión de Usuarios"})}),e.jsxs(T,{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(V,{placeholder:"Buscar usuarios...",value:j,onChange:s=>_(s.target.value),className:"pl-10"})]})}),e.jsxs(z,{value:c,onValueChange:A,children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(P,{placeholder:"Filtrar por rol"})}),e.jsxs(F,{children:[e.jsx(n,{value:"all",children:"Todos los roles"}),e.jsx(n,{value:"comprador",children:"Compradores"}),e.jsx(n,{value:"vendedor",children:"Vendedores"}),e.jsx(n,{value:"repartidor",children:"Repartidores"})]})]}),e.jsxs(z,{value:N,onValueChange:s=>D(s),children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(P,{placeholder:"Filtrar por estado"})}),e.jsxs(F,{children:[e.jsx(n,{value:"all",children:"Todos los estados"}),e.jsx(n,{value:"active",children:"Activos"}),e.jsx(n,{value:"inactive",children:"Inactivos"}),e.jsx(n,{value:"suspended",children:"Suspendidos"})]})]}),e.jsxs(v,{onClick:l,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs($,{children:[e.jsx(C,{children:"Usuario"}),e.jsx(C,{children:"Rol"}),e.jsx(C,{children:"Estado"}),e.jsx(C,{children:"Registro"}),e.jsx(C,{children:"Acciones"})]})}),e.jsx(ce,{children:t.map(s=>e.jsxs($,{children:[e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name||"Sin nombre"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),s.phone&&e.jsx("div",{className:"text-sm text-gray-500",children:s.phone})]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(k,{variant:s.role==="vendedor"?"default":"secondary",className:`${s.role==="comprador"?"bg-orange-100 text-orange-800":s.role==="vendedor"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s.role}),s.role==="repartidor"&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(k,{variant:s.is_verified?"default":"destructive",className:`text-xs ${s.is_verified?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_verified?"✓ Verificado":"⏳ Pendiente"}),e.jsx(k,{variant:s.is_active?"default":"secondary",className:`text-xs ${s.is_active?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:s.is_active?"🟢 Activo":"⭕ Inactivo"})]})]})}),e.jsx(S,{children:e.jsx(k,{variant:(s.is_active!==void 0?s.is_active?"active":"inactive":"active")=="active"?"default":"destructive",className:`${(s.is_active!==void 0?s.is_active?"active":"inactive":"active")=="active"?"bg-green-100 text-green-800":(s.is_active!==void 0?s.is_active?"active":"inactive":"active")=="inactive"?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:s.is_active!==void 0?s.is_active?"active":"inactive":"active"})}),e.jsx(S,{children:e.jsx("div",{className:"text-sm",children:new Date(s.created_at).toLocaleDateString()})}),e.jsx(S,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(Y,{className:"w-4 h-4"})}),s.role==="repartidor"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:s.is_verified?"outline":"default",size:"sm",onClick:()=>f(s.id,"is_verified",!s.is_verified),className:s.is_verified?"border-red-300 text-red-600 hover:bg-red-50":"bg-green-500 hover:bg-green-600 text-white",title:s.is_verified?"Desverificar repartidor":"Verificar repartidor",children:s.is_verified?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),"Desverificar"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),"Verificar"]})}),e.jsx(v,{variant:s.is_active?"default":"outline",size:"sm",onClick:()=>f(s.id,"is_active",!s.is_active),className:s.is_active?"bg-orange-500 hover:bg-orange-600 text-white":"border-orange-300 text-orange-600 hover:bg-orange-50",title:s.is_active?"Desactivar repartidor":"Activar repartidor",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Activo"]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Activar"]})})]}),s.role!=="repartidor"&&e.jsxs(z,{value:s.is_active!==void 0?s.is_active?"active":"inactive":"active",onValueChange:i=>x(s.id,i),children:[e.jsx(O,{className:"w-24 h-8",children:e.jsx(P,{})}),e.jsxs(F,{children:[e.jsx(n,{value:"active",children:"Activo"}),e.jsx(n,{value:"inactive",children:"Inactivo"}),e.jsx(n,{value:"suspended",children:"Suspendido"})]})]}),e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",title:"Eliminar usuario",className:"text-red-600 border-red-300 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsx(ge,{children:"¿Eliminar usuario?"}),e.jsx(pe,{children:'Esta acción no se puede deshacer y puede fallar si el usuario tiene datos relacionados. Si falla, puedes cambiar su estado a "Suspendido".'})]}),e.jsxs(fe,{children:[e.jsx(be,{children:"Cancelar"}),e.jsx(Ne,{className:"bg-red-600 hover:bg-red-700",onClick:()=>r(s.id),children:"Eliminar"})]})]})]})]})})]},s.id))})]})}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No se encontraron usuarios que coincidan con los filtros"})]})]})})}function Ge(){const[a,u]=m.useState([]),[o,b]=m.useState(!0),[j,_]=m.useState(""),[c,A]=m.useState("all"),N=async()=>{try{b(!0);const{data:t,error:x}=await p.from("sellers").select(`
          *,
          users (
            name,
            email,
            phone,
            created_at
          )
        `).order("created_at",{ascending:!1});x?(console.error("Error fetching businesses:",x),h.error("Error al cargar negocios"),u([])):u(t||[])}catch(t){console.error("Error fetching businesses:",t),h.error("Error al cargar negocios"),u([])}finally{b(!1)}};m.useEffect(()=>{N()},[]);const D=async(t,x)=>{try{const{error:f}=await p.from("sellers").update({is_verified:x}).eq("id",t);if(f)throw f;h.success("Estado del negocio actualizado"),N()}catch(f){console.error("Error updating business status:",f),h.error("Error al actualizar estado")}},l=a.filter(t=>{var r,s,i,d,g;const x=((r=t.business_name)==null?void 0:r.toLowerCase().includes(j.toLowerCase()))||((i=(s=t.users)==null?void 0:s.name)==null?void 0:i.toLowerCase().includes(j.toLowerCase()))||((g=(d=t.users)==null?void 0:d.email)==null?void 0:g.toLowerCase().includes(j.toLowerCase())),f=c==="all"||c==="verified"&&t.is_verified||c==="pending"&&!t.is_verified;return x&&f});return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Gestión de Negocios"})}),e.jsxs(T,{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(V,{placeholder:"Buscar negocios...",value:j,onChange:t=>_(t.target.value),className:"pl-10"})]})}),e.jsxs(z,{value:c,onValueChange:A,children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(P,{placeholder:"Filtrar por estado"})}),e.jsxs(F,{children:[e.jsx(n,{value:"all",children:"Todos los estados"}),e.jsx(n,{value:"verified",children:"Verificados"}),e.jsx(n,{value:"pending",children:"Pendientes"})]})]}),e.jsxs(v,{onClick:N,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs($,{children:[e.jsx(C,{children:"Negocio"}),e.jsx(C,{children:"Propietario"}),e.jsx(C,{children:"Estado"}),e.jsx(C,{children:"Registro"}),e.jsx(C,{children:"Acciones"})]})}),e.jsx(ce,{children:l.map(t=>{var x,f,r;return e.jsxs($,{children:[e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.business_name||"Sin nombre"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.business_description||"Sin descripción"}),t.business_category&&e.jsx(k,{variant:"outline",className:"text-xs mt-1",children:t.business_category})]})}),e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((x=t.users)==null?void 0:x.name)||"Sin nombre"}),e.jsx("div",{className:"text-sm text-gray-500",children:(f=t.users)==null?void 0:f.email}),((r=t.users)==null?void 0:r.phone)&&e.jsx("div",{className:"text-sm text-gray-500",children:t.users.phone})]})}),e.jsx(S,{children:e.jsx(k,{variant:t.is_verified?"default":"destructive",className:`${t.is_verified?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.is_verified?"Verificado":"Pendiente"})}),e.jsx(S,{children:e.jsx("div",{className:"text-sm",children:new Date(t.created_at).toLocaleDateString()})}),e.jsx(S,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(v,{variant:t.is_verified?"destructive":"default",size:"sm",onClick:()=>D(t.id,!t.is_verified),children:t.is_verified?"Desverificar":"Verificar"})]})})]},t.id)})})]})}),l.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:a.length===0?e.jsxs("div",{children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay negocios registrados aún"})]}):e.jsx("p",{children:"No se encontraron negocios que coincidan con los filtros"})})]})]})})}function He(){const[a,u]=m.useState([]),[o,b]=m.useState(!0),[j,_]=m.useState(""),[c,A]=m.useState("all"),[N,D]=m.useState("today"),l=async()=>{try{b(!0);const r=new Date;let s="";switch(N){case"today":s=r.toISOString().split("T")[0];break;case"week":s=new Date(r.getTime()-7*24*60*60*1e3).toISOString().split("T")[0];break;case"month":s=new Date(r.getTime()-30*24*60*60*1e3).toISOString().split("T")[0];break}let i=p.from("orders").select(`
          *,
          buyer:users!buyer_id (name, email),
          seller:sellers!seller_id (business_name),
          driver:users!driver_id (name, email)
        `).order("created_at",{ascending:!1});N!=="all"&&(i=i.gte("created_at",s));const{data:d,error:g}=await i;g?(console.error("Error fetching orders:",g),u([])):u(d||[])}catch(r){console.error("Error fetching orders:",r),u([])}finally{b(!1)}};m.useEffect(()=>{l()},[N]);const t=async(r,s)=>{try{const{error:i}=await p.from("orders").update({status:s,updated_at:new Date().toISOString()}).eq("id",r);if(i)throw i;h.success("Estado de la orden actualizado"),l()}catch(i){console.error("Error updating order status:",i),h.error("Error al actualizar estado")}},x=r=>{const i={pending:{label:"Pendiente",class:"bg-yellow-100 text-yellow-800"},confirmed:{label:"Confirmado",class:"bg-blue-100 text-blue-800"},preparing:{label:"Preparando",class:"bg-orange-100 text-orange-800"},ready:{label:"Listo",class:"bg-purple-100 text-purple-800"},picked_up:{label:"Recogido",class:"bg-indigo-100 text-indigo-800"},delivered:{label:"Entregado",class:"bg-green-100 text-green-800"},cancelled:{label:"Cancelado",class:"bg-red-100 text-red-800"}}[r]||{label:r,class:"bg-gray-100 text-gray-800"};return e.jsx(k,{className:i.class,children:i.label})},f=a.filter(r=>{var d,g,y,w,U;const s=((d=r.id)==null?void 0:d.toLowerCase().includes(j.toLowerCase()))||((y=(g=r.buyer)==null?void 0:g.name)==null?void 0:y.toLowerCase().includes(j.toLowerCase()))||((U=(w=r.seller)==null?void 0:w.name)==null?void 0:U.toLowerCase().includes(j.toLowerCase())),i=c==="all"||r.status===c;return s&&i});return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Gestión de Órdenes"})}),e.jsxs(T,{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(V,{placeholder:"Buscar órdenes...",value:j,onChange:r=>_(r.target.value),className:"pl-10"})]})}),e.jsxs(z,{value:c,onValueChange:r=>A(r),children:[e.jsx(O,{className:"w-[150px]",children:e.jsx(P,{placeholder:"Estado"})}),e.jsxs(F,{children:[e.jsx(n,{value:"all",children:"Todos"}),e.jsx(n,{value:"pending",children:"Pendiente"}),e.jsx(n,{value:"confirmed",children:"Confirmado"}),e.jsx(n,{value:"preparing",children:"Preparando"}),e.jsx(n,{value:"ready",children:"Listo"}),e.jsx(n,{value:"picked_up",children:"Recogido"}),e.jsx(n,{value:"delivered",children:"Entregado"}),e.jsx(n,{value:"cancelled",children:"Cancelado"})]})]}),e.jsxs(z,{value:N,onValueChange:r=>D(r),children:[e.jsx(O,{className:"w-[150px]",children:e.jsx(P,{placeholder:"Período"})}),e.jsxs(F,{children:[e.jsx(n,{value:"today",children:"Hoy"}),e.jsx(n,{value:"week",children:"Esta semana"}),e.jsx(n,{value:"month",children:"Este mes"}),e.jsx(n,{value:"all",children:"Todo"})]})]}),e.jsxs(v,{onClick:l,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs($,{children:[e.jsx(C,{children:"Orden"}),e.jsx(C,{children:"Comprador"}),e.jsx(C,{children:"Vendedor"}),e.jsx(C,{children:"Total"}),e.jsx(C,{children:"Estado"}),e.jsx(C,{children:"Fecha"}),e.jsx(C,{children:"Acciones"})]})}),e.jsx(ce,{children:f.map(r=>{var s,i,d,g,y;return e.jsxs($,{children:[e.jsx(S,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["#",r.id.slice(0,8)]}),e.jsx("div",{className:"text-sm text-gray-500",children:r.delivery_type})]})}),e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((s=r.buyer)==null?void 0:s.name)||"Usuario"}),e.jsx("div",{className:"text-sm text-gray-500",children:(i=r.buyer)==null?void 0:i.email})]})}),e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((d=r.seller)==null?void 0:d.name)||"Vendedor"}),e.jsx("div",{className:"text-sm text-gray-500",children:(g=r.seller)==null?void 0:g.email})]})}),e.jsx(S,{children:e.jsxs("div",{className:"font-medium",children:["Q",((y=r.total)==null?void 0:y.toFixed(2))||"0.00"]})}),e.jsx(S,{children:x(r.status)}),e.jsx(S,{children:e.jsxs("div",{className:"text-sm",children:[new Date(r.created_at).toLocaleDateString(),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(r.created_at).toLocaleTimeString()})]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsxs(z,{value:r.status,onValueChange:w=>t(r.id,w),children:[e.jsx(O,{className:"w-32 h-8",children:e.jsx(P,{})}),e.jsxs(F,{children:[e.jsx(n,{value:"pending",children:"Pendiente"}),e.jsx(n,{value:"confirmed",children:"Confirmado"}),e.jsx(n,{value:"preparing",children:"Preparando"}),e.jsx(n,{value:"ready",children:"Listo"}),e.jsx(n,{value:"picked_up",children:"Recogido"}),e.jsx(n,{value:"delivered",children:"Entregado"}),e.jsx(n,{value:"cancelled",children:"Cancelado"})]})]})]})})]},r.id)})})]})}),f.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:a.length===0?e.jsxs("div",{children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay órdenes registradas aún"}),e.jsx("p",{className:"text-sm mt-2",children:"Las órdenes aparecerán aquí cuando los usuarios hagan pedidos"})]}):e.jsx("p",{children:"No se encontraron órdenes que coincidan con los filtros"})})]})]})})}function Qe(){const[a,u]=m.useState([]),[o,b]=m.useState(!0),[j,_]=m.useState(""),[c,A]=m.useState("all"),[N,D]=m.useState("all"),l=async()=>{try{b(!0);const{data:s,error:i}=await p.from("products").select(`
          *,
          seller:sellers (
            business_name,
            users (name, email)
          )
        `).order("created_at",{ascending:!1});i?(console.error("Error fetching products:",i),u([])):u(s||[])}catch(s){console.error("Error fetching products:",s),u([])}finally{b(!1)}};m.useEffect(()=>{l()},[]);const t=async(s,i)=>{try{const{error:d}=await p.from("products").update({status:i,updated_at:new Date().toISOString()}).eq("id",s);if(d)throw d;h.success("Estado del producto actualizado"),l()}catch(d){console.error("Error updating product status:",d),h.error("Error al actualizar producto")}},x=async s=>{try{const{error:i}=await p.from("products").delete().eq("id",s);if(i)throw i;h.success("Producto eliminado"),l()}catch(i){console.error("Error deleting product:",i),h.error("Error al eliminar producto")}},f=s=>{const d={active:{label:"Activo",class:"bg-green-100 text-green-800"},inactive:{label:"Inactivo",class:"bg-gray-100 text-gray-800"},pending:{label:"Pendiente",class:"bg-yellow-100 text-yellow-800"},rejected:{label:"Rechazado",class:"bg-red-100 text-red-800"}}[s]||{label:s,class:"bg-gray-100 text-gray-800"};return e.jsx(k,{className:d.class,children:d.label})},r=a.filter(s=>{var y,w,U,Q;const i=((y=s.name)==null?void 0:y.toLowerCase().includes(j.toLowerCase()))||((w=s.description)==null?void 0:w.toLowerCase().includes(j.toLowerCase()))||((Q=(U=s.seller)==null?void 0:U.business_name)==null?void 0:Q.toLowerCase().includes(j.toLowerCase())),d=c==="all"||s.category===c,g=N==="all"||(s.status||"active")===N;return i&&d&&g});return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(L,{children:"Gestión de Productos"})}),e.jsxs(T,{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(V,{placeholder:"Buscar productos...",value:j,onChange:s=>_(s.target.value),className:"pl-10"})]})}),e.jsxs(z,{value:c,onValueChange:s=>A(s),children:[e.jsx(O,{className:"w-[150px]",children:e.jsx(P,{placeholder:"Categoría"})}),e.jsxs(F,{children:[e.jsx(n,{value:"all",children:"Todas"}),e.jsx(n,{value:"comida",children:"Comida"}),e.jsx(n,{value:"bebidas",children:"Bebidas"}),e.jsx(n,{value:"postres",children:"Postres"}),e.jsx(n,{value:"otros",children:"Otros"})]})]}),e.jsxs(z,{value:N,onValueChange:s=>D(s),children:[e.jsx(O,{className:"w-[150px]",children:e.jsx(P,{placeholder:"Estado"})}),e.jsxs(F,{children:[e.jsx(n,{value:"all",children:"Todos"}),e.jsx(n,{value:"active",children:"Activos"}),e.jsx(n,{value:"inactive",children:"Inactivos"}),e.jsx(n,{value:"pending",children:"Pendientes"}),e.jsx(n,{value:"rejected",children:"Rechazados"})]})]}),e.jsxs(v,{onClick:l,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]}),r.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(s=>{var i,d,g,y;return e.jsxs(E,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-video bg-gray-100 relative",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover",onError:w=>{w.currentTarget.src="https://images.unsplash.com/photo-1546833999-b9f581a1996d?w=400&h=300&fit=crop"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(te,{className:"w-12 h-12 text-gray-400"})}),e.jsx("div",{className:"absolute top-2 right-2",children:f(s.status||"active")})]}),e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["Q",((i=s.price)==null?void 0:i.toFixed(2))||"0.00"]}),e.jsx(k,{variant:"outline",children:s.category})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsxs("p",{children:["Vendedor: ",((d=s.seller)==null?void 0:d.business_name)||"N/A"]}),e.jsxs("p",{children:["Email: ",((y=(g=s.seller)==null?void 0:g.users)==null?void 0:y.email)||"N/A"]})]}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Ver"]}),e.jsxs(z,{value:s.status||"active",onValueChange:w=>t(s.id,w),children:[e.jsx(O,{className:"w-20 h-8",children:e.jsx(P,{})}),e.jsxs(F,{children:[e.jsx(n,{value:"active",children:"Activo"}),e.jsx(n,{value:"inactive",children:"Inactivo"}),e.jsx(n,{value:"pending",children:"Pendiente"}),e.jsx(n,{value:"rejected",children:"Rechazado"})]})]}),e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(v,{variant:"destructive",size:"sm",children:e.jsx(Se,{className:"w-3 h-3"})})}),e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsx(ge,{children:"¿Eliminar producto?"}),e.jsx(pe,{children:"Esta acción no se puede deshacer. El producto será eliminado permanentemente."})]}),e.jsxs(fe,{children:[e.jsx(be,{children:"Cancelar"}),e.jsx(Ne,{onClick:()=>x(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]},s.id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:a.length===0?e.jsxs("div",{children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay productos registrados aún"}),e.jsx("p",{className:"text-sm mt-2",children:"Los productos aparecerán aquí cuando los vendedores los agreguen"})]}):e.jsx("p",{children:"No se encontraron productos que coincidan con los filtros"})})]})]})})}function hs(){const{user:a,signOut:u}=ze(),[o,b]=m.useState({totalUsers:0,activeUsers:0,totalBusinesses:0,totalOrders:0,todayRevenue:0,totalDrivers:0,activeDrivers:0,pendingDrivers:0}),[j,_]=m.useState(!0),c=async()=>{try{_(!0);const l=new Date().toISOString().split("T")[0],[t,x,f,r,s,i,d,g]=await Promise.all([p.from("users").select("*",{count:"exact",head:!0}),p.from("users").select("*",{count:"exact",head:!0}).eq("status","active"),p.from("sellers").select("*",{count:"exact",head:!0}),p.from("orders").select("*",{count:"exact",head:!0}).gte("created_at",l),p.from("orders").select("total,status,created_at").gte("created_at",l).eq("status","delivered"),p.from("users").select("*",{count:"exact",head:!0}).eq("role","repartidor"),p.from("users").select("*",{count:"exact",head:!0}).eq("role","repartidor").eq("is_active",!0),p.from("users").select("*",{count:"exact",head:!0}).eq("role","repartidor").eq("is_verified",!1)]),y=t.count??0,w=x.count??0,U=f.count??0,Q=r.count??0,Ee=(s.data||[]).reduce((ee,De)=>ee+(De.total||0),0),Te=i.count??0,Ae=d.count??0,ke=g.count??0;b(ee=>({...ee,totalUsers:y,activeUsers:w,totalBusinesses:U,totalOrders:Q,todayRevenue:Ee,totalDrivers:Te,activeDrivers:Ae,pendingDrivers:ke}))}catch(l){console.error("Error fetching admin stats:",l),h.error("Error al cargar estadísticas")}finally{_(!1)}};m.useEffect(()=>{c()},[]);const A=async()=>{try{await u(),h.success("Sesión cerrada")}catch(l){console.error("Error signing out:",l),h.error("Error al cerrar sesión")}},N=async l=>{try{h.loading("Preparando exportación...");let t=[],x="";switch(l){case"users":const{data:d}=await p.from("users").select("*");t=d||[],x="usuarios_trato.csv";break;case"businesses":const{data:g}=await p.from("sellers").select("*, users(name, email, phone)");t=g||[],x="negocios_trato.csv";break;case"orders":const{data:y}=await p.from("orders").select("*, buyer:users!buyer_id(name), seller:sellers!seller_id(business_name)");t=y||[],x="ordenes_trato.csv";break;case"all":t=[{tabla:"usuarios",total:o.totalUsers,activos:o.activeUsers},{tabla:"negocios",total:o.totalBusinesses},{tabla:"ordenes_hoy",total:o.totalOrders,ingresos:o.todayRevenue}],x="resumen_trato.csv";break}if(t.length===0){h.error("No hay datos para exportar");return}const f=D(t),r=new Blob([f],{type:"text/csv"}),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=x,i.click(),window.URL.revokeObjectURL(s),h.success("Datos exportados correctamente")}catch(t){console.error("Error exporting data:",t),h.error("Error al exportar datos")}},D=l=>{if(l.length===0)return"";const t=Object.keys(l[0]);return[t.join(","),...l.map(f=>t.map(r=>`"${f[r]||""}"`).join(","))].join(`
`)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-green-50",children:[e.jsx(Oe,{showBanner:!0,enableAutoActivation:!1,showTester:!1}),e.jsx("header",{className:"bg-white/90 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:Ue.primary},children:e.jsx(de,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-orange-600 to-green-600 bg-clip-text text-transparent",children:"TRATO Admin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Panel de Administración"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(k,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Administrador"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(a==null?void 0:a.name)||"Administrador"}),e.jsx("p",{className:"text-xs text-gray-500",children:a==null?void 0:a.email})]}),e.jsx(v,{variant:"outline",onClick:A,children:"Cerrar Sesión"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsx(H,{title:"Total Usuarios",value:j?"...":o.totalUsers,icon:J,color:G.orange[500],trend:"+12% esta semana",subtitle:`${o.activeUsers} activos`}),e.jsx(H,{title:"Negocios",value:j?"...":o.totalBusinesses,icon:W,color:G.green[500],trend:"+5% este mes"}),e.jsx(H,{title:"Repartidores",value:j?"...":o.totalDrivers,icon:ye,color:G.orange[400],trend:o.pendingDrivers>0?`${o.pendingDrivers} pendientes`:"Todos verificados",subtitle:`${o.activeDrivers} activos`}),e.jsx(H,{title:"Órdenes Hoy",value:j?"...":o.totalOrders,icon:K,color:G.orange[600],trend:"+18% vs ayer"}),e.jsx(H,{title:"Ingresos Hoy",value:j?"...":`Q${o.todayRevenue.toFixed(2)}`,icon:xe,color:G.green[600],trend:"+25% vs ayer"})]}),e.jsxs(E,{className:"mb-6 bg-gradient-to-r from-purple-50 to-blue-50 border-0",children:[e.jsx(R,{children:e.jsxs(L,{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{children:"Control Operacional TRATO"})]})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(v,{className:"h-20 flex-col space-y-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white",onClick:async()=>{try{const{data:l,error:t}=await p.from("users").update({is_verified:!0,is_active:!0,updated_at:new Date().toISOString()}).eq("role","repartidor").eq("is_verified",!1);if(t)throw t;h.success("Todos los repartidores han sido activados"),c()}catch(l){console.error("Error:",l),h.error("Error al activar repartidores")}},children:[e.jsx(re,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:"Activar Repartidores"})]}),e.jsxs(v,{variant:"outline",className:"h-20 flex-col space-y-2 border-2 border-orange-300 hover:bg-orange-50",onClick:async()=>{try{await c(),h.success("Estadísticas actualizadas")}catch(l){console.error("Error:",l),h.error("Error al actualizar")}},children:[e.jsx(B,{className:"w-6 h-6 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-700",children:"Actualizar Sistema"})]}),e.jsxs(v,{variant:"outline",className:"h-20 flex-col space-y-2 border-2 border-blue-300 hover:bg-blue-50",onClick:()=>N("all"),children:[e.jsx(oe,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Exportar Datos"})]}),e.jsxs(v,{variant:"outline",className:"h-20 flex-col space-y-2 border-2 border-purple-300 hover:bg-purple-50",onClick:()=>{h.info("Abriendo configuración del sistema...")},children:[e.jsx(ae,{className:"w-6 h-6 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Configurar Sistema"})]})]})})]}),o.pendingDrivers>0&&e.jsx(E,{className:"mb-6 border-orange-200 bg-orange-50",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(X,{className:"w-6 h-6 text-orange-500"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-orange-800",children:[o.pendingDrivers," Repartidor",o.pendingDrivers>1?"es":""," Pendiente",o.pendingDrivers>1?"s":""," de Aprobación"]}),e.jsx("p",{className:"text-sm text-orange-600",children:"Hay repartidores que necesitan tu aprobación para poder empezar a trabajar."})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(v,{variant:"outline",className:"border-orange-300 text-orange-700 hover:bg-orange-100",onClick:async()=>{try{const{data:l,error:t}=await p.from("users").select("id").eq("role","repartidor").eq("is_verified",!1);if(t)throw t;if(l&&l.length>0){const{error:x}=await p.from("users").update({is_verified:!0,is_active:!0,updated_at:new Date().toISOString()}).eq("role","repartidor").eq("is_verified",!1);if(x)throw x;h.success(`${l.length} repartidor${l.length>1?"es":""} activado${l.length>1?"s":""} exitosamente`),c()}}catch(l){console.error("Error activating drivers:",l),h.error("Error al activar repartidores")}},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Activar Todos"]}),e.jsx(v,{className:"bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>{const l=document.querySelector('[value="settings"]');l==null||l.click()},children:"Ver Repartidores"})]})]})})}),e.jsxs(Pe,{defaultValue:"monitor",className:"space-y-6",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-6 lg:w-auto lg:grid-cols-6",children:[e.jsxs(q,{value:"monitor",className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{children:"Monitor"})]}),e.jsxs(q,{value:"users",className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Usuarios"})]}),e.jsxs(q,{value:"businesses",className:"flex items-center space-x-2",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"Negocios"})]}),e.jsxs(q,{value:"products",className:"flex items-center space-x-2",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"Productos"})]}),e.jsxs(q,{value:"orders",className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Órdenes"})]}),e.jsxs(q,{value:"settings",className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Configuración"})]})]}),e.jsx(I,{value:"monitor",children:e.jsx(Be,{})}),e.jsx(I,{value:"users",children:e.jsx(Me,{})}),e.jsx(I,{value:"businesses",children:e.jsx(Ge,{})}),e.jsx(I,{value:"products",children:e.jsx(Qe,{})}),e.jsx(I,{value:"orders",children:e.jsx(He,{})}),e.jsx(I,{value:"settings",children:e.jsx($e,{})})]})]}),e.jsxs("div",{className:"fixed bottom-6 right-6 space-y-3",children:[e.jsx(v,{className:"w-14 h-14 rounded-full shadow-lg bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white",onClick:()=>N("all"),title:"Exportar todos los datos",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsx(v,{className:"w-14 h-14 rounded-full shadow-lg bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",onClick:c,title:"Actualizar estadísticas",children:e.jsx(B,{className:"w-6 h-6"})})]}),e.jsx("footer",{className:"border-t border-gray-200 bg-white/50 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"© 2025 TRATO - Panel de Administración"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsx("span",{children:"Gualán, Guatemala"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Sistema Administrativo"})]})]})})})]})}export{hs as AdminDashboard};
