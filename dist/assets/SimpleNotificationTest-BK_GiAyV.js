import{u as h,r as c,s as m,j as e}from"./index-BUZ7un_H.js";function j(){const{user:o}=h(),[l,u]=c.useState([]),[a,p]=c.useState(!1);c.useEffect(()=>{if(!(o!=null&&o.id))return;console.log("🔄 Iniciando sistema simple de notificaciones..."),p(!0);const i=m.channel("simple-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${o.id}`},n=>{console.log("🎯 Nueva orden simple:",n.new);const r=n.new,f={id:Date.now(),message:`Nueva orden: Q${r.total||"0.00"}`,timestamp:new Date().toISOString(),orderData:r};u(s=>[f,...s.slice(0,9)]),Notification.permission==="granted"&&new Notification("🛒 Nueva Orden TRATO",{body:`Pedido por Q${r.total||"0.00"}`,icon:"/favicon.ico",tag:"simple-order"});try{const s=new Audio;s.volume=.5;const d=new(window.AudioContext||window.webkitAudioContext),t=d.createOscillator(),x=d.createGain();t.connect(x),x.connect(d.destination),t.frequency.value=800,t.type="sine",x.gain.value=.3,t.start(),t.stop(d.currentTime+1),console.log("🔊 Sonido simple reproducido")}catch(s){console.log("⚠️ Error con sonido:",s)}}).subscribe(n=>{console.log("📡 Status simple:",n),n==="SUBSCRIBED"?console.log("✅ Escuchando órdenes (modo simple)"):(n==="CHANNEL_ERROR"||n==="TIMED_OUT")&&(console.log("❌ Error de conexión:",n),p(!1))});return()=>{console.log("🔄 Limpiando suscripción simple"),m.removeChannel(i),p(!1)}},[o==null?void 0:o.id]),c.useEffect(()=>{Notification.permission==="default"&&Notification.requestPermission().then(i=>{console.log("📱 Permiso notificaciones:",i)})},[]);const g=async()=>{if(o!=null&&o.id){console.log("🧪 Creando orden de prueba...");try{const i={buyer_id:"11111111-1111-1111-1111-111111111111",seller_id:o.id,total:Math.floor(Math.random()*100)+10,status:"pending",notes:`Orden de prueba - ${new Date().toLocaleTimeString()}`},{data:n,error:r}=await m.from("orders").insert(i).select();r?(console.error("❌ Error:",r),alert("Error: "+r.message)):(console.log("✅ Orden de prueba creada:",n[0]),alert("✅ Orden de prueba creada"))}catch(i){console.error("❌ Excepción:",i),alert("Error: "+i.message)}}};return e.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto"},children:[e.jsx("h2",{children:"🧪 Test Simple de Notificaciones"}),e.jsxs("div",{style:{padding:"15px",backgroundColor:a?"#d4edda":"#f8d7da",border:`1px solid ${a?"#c3e6cb":"#f5c6cb"}`,borderRadius:"5px",marginBottom:"20px"},children:[e.jsx("strong",{children:"Estado:"})," ",a?"✅ Escuchando":"❌ Desconectado",e.jsx("br",{}),e.jsx("strong",{children:"Usuario:"})," ",(o==null?void 0:o.email)||"No autenticado",e.jsx("br",{}),e.jsx("strong",{children:"Permisos:"})," ",Notification.permission]}),e.jsx("button",{onClick:g,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",marginBottom:"20px"},children:"🧪 Crear Orden de Prueba"}),e.jsxs("h3",{children:["📋 Notificaciones Recibidas (",l.length,")"]}),l.length===0?e.jsx("p",{style:{color:"#666",fontStyle:"italic"},children:"No hay notificaciones aún. Crea una orden de prueba para verificar."}):e.jsx("div",{children:l.map((i,n)=>{var r;return e.jsxs("div",{style:{padding:"10px",backgroundColor:n===0?"#fff3cd":"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"5px",marginBottom:"10px"},children:[e.jsx("strong",{children:i.message}),e.jsx("br",{}),e.jsx("small",{style:{color:"#666"},children:new Date(i.timestamp).toLocaleTimeString()}),((r=i.orderData)==null?void 0:r.notes)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("small",{children:i.orderData.notes})]})]},i.id)})}),e.jsxs("div",{style:{marginTop:"30px",padding:"15px",backgroundColor:"#e9ecef",borderRadius:"5px"},children:[e.jsx("h4",{children:"🔧 Debug Info"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Realtime conectado:"})," ",a?"Sí":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Audio Context:"})," ",typeof AudioContext<"u"?"Disponible":"No disponible"]})]})]})}export{j as SimpleNotificationTest};
