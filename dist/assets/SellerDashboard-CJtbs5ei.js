import{g as ge,r as c,j as e,o as Ie,X as ye,u as pe,B as C,C as G,a as re,b as X,c as W,L as ie,f as ee,d as we,s as N,i as cs,q as ds,e as te,v as ms,T as _e,t as q,R as ve,F as us,p as Ke,G as qs}from"./index-eGXwqV4X.js";import{A as ce,a as de}from"./alert-DcIGYT6S.js";import{P as ue,D as Xe,T as Qe,a as Ze,b as he,d as le,M as Rs,c as zs}from"./MobileToastNotifications-Cy_oDiVJ.js";import{R as Fs,P as Us,C as gs,i as Vs,T as xs,O as ps,D as hs,A as fs,a as bs,b as js,c as vs,d as Ns,e as ys,f as ws,g as _s,h as Ss}from"./alert-dialog-CDDrwnLD.js";import{I as H}from"./input-DAKM6quu.js";import{T as Ye}from"./textarea-D8ydHKDP.js";import{L as F}from"./label-Lq7Q1vIz.js";import{S as Gs,a as Bs,b as Ws,c as Hs,d as Js}from"./select-BOIONLOD.js";import{A as ks}from"./arrow-left-j8z_waTL.js";import{U as Cs}from"./upload-DjM2cceY.js";import{S as Re}from"./save-BVA7GMd5.js";import{C as ae}from"./clock-w3ln-a-W.js";import{T as Es,I as Le,F as Qs,g as Zs,f as Ks,S as Xs,B as Ys,R as ea,u as sa,H as aa,O as ra,P as He}from"./OnlineDriversIndicator-CtP50I7H.js";import{E as ta}from"./eye-B5SrVhHD.js";import{E as ia}from"./eye-off-K0_NfsOu.js";import{T as Ps}from"./trash-2-DgcKJTDo.js";import{C as na,a as fe,P as qe,M as oa,N as Me}from"./phone-D-0zoDBy.js";import{S as be}from"./store-Czc1Jy--.js";import{I as as}from"./info-CwITm8cn.js";import{M as ne}from"./map-pin-DbHcIUps.js";import{T as Te}from"./truck-C3ioTA6z.js";import{M as la}from"./mail-C6ok2GZO.js";import{G as rs}from"./globe-rLnCfd83.js";import{C as Ne}from"./circle-x-CW6L-Q99.js";import{E as ca}from"./external-link-NqFPsu18.js";import{U as es}from"./user-CE-aKB4o.js";import{L as da}from"./log-out-BQ1P6Uy-.js";import{S as ma}from"./shopping-bag-BNCGny1k.js";import{S as ua}from"./star-CGFcBkYq.js";import"./shopping-cart-BTErv8XZ.js";import"./users-CORqrcB7.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],xa=ge("bell-ring",ga);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ha=ge("chart-column",pa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ba=ge("clipboard-list",fa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],va=ge("facebook",ja);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ts=ge("hash",Na);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Is=ge("image",ya);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],_a=ge("instagram",wa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ka=ge("message-square",Sa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ss=ge("pen",Ca),Ea=Fs,Pa=Us,Ds=c.forwardRef(({className:s,...d},o)=>e.jsx(ps,{ref:o,className:Ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...d}));Ds.displayName=ps.displayName;const As=c.forwardRef(({className:s,children:d,description:o,...f},h)=>e.jsxs(Pa,{children:[e.jsx(Ds,{}),e.jsxs(gs,{ref:h,className:Ie("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),"aria-describedby":o?"dialog-description":void 0,...f,children:[d,o&&e.jsx("div",{id:"dialog-description",className:"sr-only",children:o}),e.jsxs(Vs,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));As.displayName=gs.displayName;const $s=({className:s,...d})=>e.jsx("div",{className:Ie("flex flex-col space-y-1.5 text-center sm:text-left",s),...d});$s.displayName="DialogHeader";const Os=c.forwardRef(({className:s,...d},o)=>e.jsx(xs,{ref:o,className:Ie("text-lg font-semibold leading-none tracking-tight",s),...d}));Os.displayName=xs.displayName;const Ta=c.forwardRef(({className:s,...d},o)=>e.jsx(hs,{ref:o,className:Ie("text-sm text-muted-foreground",s),...d}));Ta.displayName=hs.displayName;const Ia=["Alimentos","Bebidas","Ropa","ElectrÃ³nicos","Hogar","Belleza","Deportes","Libros","Juguetes","Mascotas","Salud","Herramientas","JardÃ­n","MÃºsica","Arte","Otros"];function ts({product:s,onSuccess:d,onCancel:o}){const{user:f}=pe(),[h,_]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.category)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||"",is_public:(s==null?void 0:s.is_public)!==!1}),[k,u]=c.useState(null),[g,D]=c.useState((s==null?void 0:s.image_url)||""),[O,E]=c.useState(!1),[i,j]=c.useState(!1),[S,P]=c.useState(""),b=c.useRef(null),T=a=>{var l;const m=(l=a.target.files)==null?void 0:l[0];if(m){if(!m.type.startsWith("image/")){P("Por favor selecciona una imagen vÃ¡lida");return}if(m.size>5*1024*1024){P("La imagen debe ser menor a 5MB");return}u(m),P("");const x=new FileReader;x.onload=n=>{var p;D((p=n.target)==null?void 0:p.result)},x.readAsDataURL(m)}},z=async a=>{var m;j(!0);try{const{data:{session:l}}=await N.auth.getSession();if(!((m=l==null?void 0:l.user)!=null&&m.id))throw new Error("No autorizado - sesiÃ³n invÃ¡lida");const x=a.name.split(".").pop(),p=`products/${`${l.user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${x}`}`;for(let y=0;y<3;y++)try{const{error:A}=await N.storage.from("products").upload(p,a,{cacheControl:"3600",upsert:!0});if(A){if(A.message.includes("JWT")||A.message.includes("token")){await N.auth.refreshSession();continue}throw A}const{data:R}=N.storage.from("products").getPublicUrl(p);if(!R.publicUrl)throw new Error("No se pudo obtener la URL pÃºblica");return R.publicUrl}catch(A){if(y===2)throw A;await new Promise(R=>setTimeout(R,1e3));continue}throw new Error("No se pudo subir la imagen despuÃ©s de 3 intentos")}catch(l){throw console.error("Error uploading image:",l),new Error("Error al subir la imagen: "+l.message)}finally{j(!1)}},J=async a=>{try{const m=a.split("/"),l=m[m.length-3],x=m[m.length-2],n=m[m.length-1],p=`${x}/${n}`;l==="products"&&await N.storage.from("products").remove([p])}catch(m){console.error("Error deleting old image:",m)}},U=async a=>{if(a.preventDefault(),P(""),!h.name.trim()){P("El nombre del producto es requerido");return}if(!h.price||parseFloat(h.price.toString())<=0){P("El precio debe ser mayor a 0");return}if(!h.category){P("Selecciona una categorÃ­a");return}if(!h.stock_quantity||parseInt(h.stock_quantity.toString())<0){P("La cantidad debe ser mayor a 0");return}if(!s&&!k&&!g){P("Selecciona una imagen para el producto");return}E(!0);try{let m=(s==null?void 0:s.image_url)||"";k&&(m=await z(k),s!=null&&s.image_url&&await J(s.image_url));const l={name:h.name.trim(),description:h.description.trim(),price:parseFloat(h.price.toString())||0,category:h.category,stock_quantity:parseInt(h.stock_quantity.toString())||1,is_public:h.is_public,image_url:m,seller_id:f==null?void 0:f.id};if(s){const{error:x}=await N.from("products").update(l).eq("id",s.id);if(x)throw x}else{const{error:x}=await N.from("products").insert([l]);if(x)throw x}d()}catch(m){console.error("Error saving product:",m),P(m.message||"Error al guardar el producto")}finally{E(!1)}},Q=()=>{u(null),D(""),b.current&&(b.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(C,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(ue,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto":"Agregar Producto"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica la informaciÃ³n de tu producto":"Crea un nuevo producto para tu tienda"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(G,{children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"InformaciÃ³n del Producto"]})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"Imagen del Producto *"}),g?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:g,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(C,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:Q,children:e.jsx(ye,{className:"w-4 h-4"})}),i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-500 transition-colors",onClick:()=>{var a;return(a=b.current)==null?void 0:a.click()},children:[e.jsx(Is,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, WEBP hasta 5MB"})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:T,className:"hidden"}),!g&&e.jsxs(C,{type:"button",variant:"outline",onClick:()=>{var a;return(a=b.current)==null?void 0:a.click()},className:"w-full",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:h.name,onChange:a=>_({...h,name:a.target.value}),placeholder:"Ej: Manzanas Rojas OrgÃ¡nicas",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"description",children:"DescripciÃ³n"}),e.jsx(Ye,{id:"description",value:h.description,onChange:a=>_({...h,description:a.target.value}),placeholder:"Describe las caracterÃ­sticas y beneficios de tu producto...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"price",children:"Precio (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:h.price,onChange:a=>_({...h,price:a.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:h.stock_quantity,onChange:a=>_({...h,stock_quantity:a.target.value}),placeholder:"1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"CategorÃ­a *"}),e.jsxs(Gs,{onValueChange:a=>_({...h,category:a}),children:[e.jsx(Bs,{children:e.jsx(Ws,{placeholder:h.category||"Selecciona una categorÃ­a"})}),e.jsx(Hs,{children:Ia.map(a=>e.jsx(Js,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(F,{children:"Visibilidad"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(C,{type:"button",variant:h.is_public?"default":"outline",onClick:()=>_({...h,is_public:!0}),className:"flex-1",children:["PÃºblico",h.is_public&&e.jsx(ee,{variant:"secondary",className:"ml-2",children:"Activo"})]}),e.jsxs(C,{type:"button",variant:h.is_public?"outline":"default",onClick:()=>_({...h,is_public:!1}),className:"flex-1",children:["Privado",!h.is_public&&e.jsx(ee,{variant:"secondary",className:"ml-2",children:"Activo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Los productos pÃºblicos aparecen en el catÃ¡logo general. Los privados solo los ves tÃº."})]}),S&&e.jsxs(ce,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(de,{children:S})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:o,className:"flex-1",disabled:O||i,children:"Cancelar"}),e.jsx(C,{type:"submit",disabled:O||i,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:O?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Producto"]})})]})]})})]})})]})}function is({dailyProduct:s,onSuccess:d,onCancel:o}){const{user:f}=pe(),[h,_]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:s!=null&&s.price?String(s.price):"",stock_quantity:s!=null&&s.stock_quantity?String(s.stock_quantity):""}),[k,u]=c.useState(null),[g,D]=c.useState((s==null?void 0:s.image_url)||""),[O,E]=c.useState(!1),[i,j]=c.useState(!1),[S,P]=c.useState(""),b=c.useRef(null),T=()=>{const l=new Date;return new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59,59,999).toISOString()},z=()=>{const l=new Date,x=new Date;x.setHours(23,59,59,999);const n=x.getTime()-l.getTime(),p=Math.floor(n/(1e3*60*60)),y=Math.floor(n%(1e3*60*60)/(1e3*60));return`${p}h ${y}m`},J=l=>{var n;const x=(n=l.target.files)==null?void 0:n[0];if(x){if(!x.type.startsWith("image/")){P("Por favor selecciona una imagen vÃ¡lida");return}if(x.size>5*1024*1024){P("La imagen debe ser menor a 5MB");return}u(x),P("");const p=new FileReader;p.onload=y=>{var A;D((A=y.target)==null?void 0:A.result)},p.readAsDataURL(x)}},U=async l=>{j(!0);try{const x=new Date().toISOString().split("T")[0],n=l.name.split(".").pop(),y=`daily-products/${`${f==null?void 0:f.id}/${x}/${Date.now()}.${n}`}`,{error:A}=await N.storage.from("products").upload(y,l,{cacheControl:"3600",upsert:!1});if(A)throw A;const{data:R}=N.storage.from("products").getPublicUrl(y);return R.publicUrl}catch(x){throw console.error("Error uploading image:",x),new Error("Error al subir la imagen: "+x.message)}finally{j(!1)}},Q=async l=>{try{const x=l.split("/"),n=x.findIndex(p=>p==="products");if(n!==-1){const y=x.slice(n+1).join("/");await N.storage.from("products").remove([y])}}catch(x){console.error("Error deleting old image:",x)}},a=async l=>{if(l.preventDefault(),P(""),!h.name.trim()){P("El nombre del producto es requerido");return}if(parseFloat(h.price)<=0){P("El precio debe ser mayor a 0");return}if(parseInt(h.stock_quantity)<0){P("La cantidad no puede ser negativa");return}if(!s&&!k&&!g){P("Selecciona una imagen para el producto");return}if(new Date().getHours()>=23){P("Es muy tarde para crear productos del dÃ­a. IntÃ©ntalo maÃ±ana temprano.");return}E(!0);try{let p=(s==null?void 0:s.image_url)||"";k&&(p=await U(k),s!=null&&s.image_url&&await Q(s.image_url));const y={name:h.name.trim(),description:h.description.trim(),price:parseFloat(h.price)||0,stock_quantity:parseInt(h.stock_quantity)||0,image_url:p,seller_id:f==null?void 0:f.id,expires_at:T()};if(s){const{error:A}=await N.from("daily_products").update(y).eq("id",s.id);if(A)throw A}else{const{error:A}=await N.from("daily_products").insert([y]);if(A)throw A}d()}catch(p){console.error("Error saving daily product:",p),P(p.message||"Error al guardar el producto del dÃ­a")}finally{E(!1)}},m=()=>{u(null),D(""),b.current&&(b.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(C,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto del DÃ­a":"Tu Venta del DÃ­a"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica tu oferta especial":"Crea una oferta especial que dura hasta medianoche"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Es,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800",children:["Tiempo restante: ",z()]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Este producto se eliminarÃ¡ automÃ¡ticamente a las 23:59:59 de hoy. Las imÃ¡genes tambiÃ©n se eliminarÃ¡n del servidor."})]}),e.jsxs(G,{children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"InformaciÃ³n del Producto del DÃ­a"]})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"Imagen del Producto *"}),g?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:g,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(C,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:m,children:e.jsx(ye,{className:"w-4 h-4"})}),i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})}),e.jsxs(ee,{variant:"destructive",className:"absolute bottom-2 left-2",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Expira a medianoche"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-orange-300 rounded-lg p-8 text-center cursor-pointer hover:border-orange-500 transition-colors bg-orange-50",onClick:()=>{var l;return(l=b.current)==null?void 0:l.click()},children:[e.jsx(Is,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-orange-600",children:"PNG, JPG, WEBP hasta 5MB"}),e.jsx(ee,{variant:"outline",className:"mt-2 border-orange-300 text-orange-700",children:"Se elimina automÃ¡ticamente"})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:J,className:"hidden"}),!g&&e.jsxs(C,{type:"button",variant:"outline",onClick:()=>{var l;return(l=b.current)==null?void 0:l.click()},className:"w-full border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:h.name,onChange:l=>_({...h,name:l.target.value}),placeholder:"Ej: Combo Especial del DÃ­a",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"description",children:"DescripciÃ³n"}),e.jsx(Ye,{id:"description",value:h.description,onChange:l=>_({...h,description:l.target.value}),placeholder:"Describe tu oferta especial del dÃ­a...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"price",children:"Precio Especial (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:h.price,onChange:l=>_({...h,price:l.target.value}),placeholder:"0.00",required:!0}),e.jsx("p",{className:"text-xs text-orange-600",children:"Precio especial vÃ¡lido solo hoy"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:h.stock_quantity,onChange:l=>_({...h,stock_quantity:l.target.value}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-orange-600",children:"Â¡Solo por hoy!"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"CaracterÃ­sticas de Productos del DÃ­a"]}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Se elimina automÃ¡ticamente a las 23:59:59"}),e.jsx("li",{children:'â€¢ Aparece marcado como "Oferta del DÃ­a" en el catÃ¡logo'}),e.jsx("li",{children:"â€¢ Las imÃ¡genes se almacenan en carpeta temporal"}),e.jsx("li",{children:"â€¢ Ideal para ofertas especiales y productos perecederos"})]})]}),S&&e.jsxs(ce,{variant:"destructive",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(de,{children:S})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:o,className:"flex-1",disabled:O||i,children:"Cancelar"}),e.jsx(C,{type:"submit",disabled:O||i,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:O?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Venta del DÃ­a"]})})]})]})})]})]})]})}function Da({product:s,onEdit:d,onDelete:o}){const[f,h]=c.useState(!1),{openImageModal:_}=cs(),k=g=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(g),u=g=>new Date(g).toLocaleDateString("es-GT",{day:"numeric",month:"short",year:"numeric"});return e.jsxs(G,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border border-gray-200",style:{backgroundColor:"white"},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-gray-100",children:f?e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sin imagen"})]})}):e.jsx(Le,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>h(!0),expandable:!0,onExpand:_})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(ee,{variant:s.is_public?"default":"secondary",className:"text-xs font-medium",style:{backgroundColor:s.is_public?"#22c55e":"#6b7280",color:"white",border:"none"},children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(ta,{className:"w-3 h-3 mr-1"}),"PÃºblico"]}):e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"w-3 h-3 mr-1"}),"Privado"]})})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(ee,{variant:"destructive",className:"text-xs font-medium",style:{backgroundColor:"#ef4444",color:"white",border:"none"},children:"Sin stock"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(ee,{variant:"outline",className:"text-xs font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",color:"#374151",border:"1px solid #d1d5db"},children:s.category})})]}),e.jsx(W,{className:"p-3 md:p-4",style:{backgroundColor:"white"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1 text-sm md:text-base",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm md:text-lg text-green-600",children:k(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ts,{className:"w-3 h-3 md:w-4 md:h-4 text-gray-500 flex-shrink-0"}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Creado el ",u(s.created_at)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>d(s),className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#d1d5db",color:"#374151"},children:[e.jsx(ss,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(fs,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#fecaca",color:"#dc2626",backgroundColor:"white"},children:[e.jsx(Ps,{className:"w-3 h-3 mr-1"}),"Eliminar"]})}),e.jsxs(js,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Â¿Eliminar producto?"}),e.jsxs(ys,{children:['Esta acciÃ³n no se puede deshacer. El producto "',s.name,'" se eliminarÃ¡ permanentemente de tu tienda.']})]}),e.jsxs(ws,{children:[e.jsx(_s,{children:"Cancelar"}),e.jsx(Ss,{onClick:()=>o(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]})}function Aa({dailyProduct:s,onEdit:d,onDelete:o}){const[f,h]=c.useState(!1),[_,k]=c.useState(""),[u,g]=c.useState(!1),{openImageModal:D}=cs();c.useEffect(()=>{const i=()=>{const S=Zs(s.expires_at);k(S.formattedTime),g(S.isExpired)};i();const j=setInterval(i,1e3);return()=>clearInterval(j)},[s.expires_at]);const O=i=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(i),E=i=>Ks(i);return e.jsxs(G,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:f?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-12 h-12 text-orange-400"})}):e.jsx(Le,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>h(!0),expandable:!0,onExpand:D})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(ee,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs",children:[e.jsx(Qs,{className:"w-3 h-3 mr-1"}),"Oferta del DÃ­a"]})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(ee,{variant:"destructive",className:"text-xs",children:"Agotado"})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(ee,{variant:u?"destructive":"secondary",className:`text-xs ${u?"bg-red-500 text-white":"bg-white/90 backdrop-blur-sm text-orange-700"}`,children:[e.jsx(Es,{className:"w-3 h-3 mr-1"}),_]})})]}),e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:O(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ts,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-orange-700",children:["Creado a las ",E(s.created_at)]}),e.jsxs("span",{className:"text-orange-700 font-medium",children:["Expira: ",E(s.expires_at)]})]})}),!u&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:["â° Se elimina automÃ¡ticamente en ",_]})}),u&&e.jsx("div",{className:"text-center bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"âŒ Este producto ha expirado y serÃ¡ eliminado pronto"})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>d(s),className:"flex-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:u,children:[e.jsx(ss,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(fs,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(Ps,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(js,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Â¿Eliminar producto del dÃ­a?"}),e.jsxs(ys,{children:['Esta acciÃ³n no se puede deshacer. El producto "',s.name,'" se eliminarÃ¡ permanentemente de tu tienda y su imagen del servidor.',!u&&e.jsxs("span",{className:"block mt-2 text-orange-600 font-medium",children:["Nota: Este producto se eliminarÃ¡ automÃ¡ticamente en ",_," de todas formas."]})]})]}),e.jsxs(ws,{children:[e.jsx(_s,{children:"Cancelar"}),e.jsx(Ss,{onClick:()=>o(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar Ahora"})]})]})]})]})]})})]})}const Oe={north:15.2,south:15,east:-89.3,west:-89.5};function $a(){var s,d;try{return(d=(s=import.meta)==null?void 0:s.env)==null?void 0:d.VITE_GOOGLE_MAPS_API_KEY}catch{return}}function Oa(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")?"Safari":s.includes("edge")?"Edge":"tu navegador"}function Ma(){const[s,d]=c.useState(!1),[o,f]=c.useState(null),[h,_]=c.useState(null),k=c.useCallback(()=>{f(null)},[]),u=c.useCallback((i,j)=>i>=Oe.south&&i<=Oe.north&&j>=Oe.west&&j<=Oe.east,[]),g=c.useCallback(async()=>{try{if("permissions"in navigator&&"query"in navigator.permissions){const i=await navigator.permissions.query({name:"geolocation"});return _(i.state),i.state}return _("prompt"),"prompt"}catch(i){return console.warn("Could not check geolocation permissions:",i),_("prompt"),"prompt"}},[]),D=c.useCallback(async()=>{try{const i=await new Promise(j=>{navigator.geolocation.getCurrentPosition(()=>j(!0),S=>{console.log("Permission request result:",S.code,S.message),j(S.code!==S.PERMISSION_DENIED)},{timeout:1e3,maximumAge:0})});return i&&await g(),i}catch(i){return console.error("Error requesting permissions:",i),!1}},[g]),O=c.useCallback(async(i,j)=>{try{f(null);const S=$a();if(S&&typeof fetch<"u")try{const P=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${i},${j}&key=${S}&language=es&region=GT`);if(P.ok){const b=await P.json();if(b.status==="OK"&&b.results&&b.results.length>0){const T=b.results[0],z=T.address_components||[];let J="",U="",Q="",a="";return z.forEach(m=>{const l=m.types||[];l.includes("locality")||l.includes("administrative_area_level_2")?J=m.long_name||"":l.includes("administrative_area_level_1")?U=m.long_name||"":l.includes("country")?Q=m.long_name||"":l.includes("postal_code")&&(a=m.long_name||"")}),{latitude:i,longitude:j,address:T.formatted_address||`UbicaciÃ³n GPS: ${i.toFixed(6)}, ${j.toFixed(6)}`,formatted_address:T.formatted_address||`Coordenadas: ${i.toFixed(6)}, ${j.toFixed(6)}`,city:J||"GualÃ¡n",state:U||"Zacapa",country:Q||"Guatemala",postal_code:a,place_id:T.place_id}}}}catch(P){console.warn("Google Maps API request failed, using fallback:",P)}return{latitude:i,longitude:j,address:`GualÃ¡n, Zacapa, Guatemala (${i.toFixed(6)}, ${j.toFixed(6)})`,formatted_address:`UbicaciÃ³n GPS verificada en GualÃ¡n: ${i.toFixed(6)}, ${j.toFixed(6)}`,city:"GualÃ¡n",state:"Zacapa",country:"Guatemala"}}catch(S){return console.error("Error in reverse geocoding:",S),{latitude:i,longitude:j,address:`GualÃ¡n, Zacapa, Guatemala (${i.toFixed(6)}, ${j.toFixed(6)})`,formatted_address:`UbicaciÃ³n GPS: ${i.toFixed(6)}, ${j.toFixed(6)}`,city:"GualÃ¡n",state:"Zacapa",country:"Guatemala"}}},[]),E=c.useCallback(async()=>new Promise((i,j)=>{if(d(!0),f(null),!(navigator!=null&&navigator.geolocation)){const b=`âŒ GeolocalizaciÃ³n no disponible

Tu navegador no soporta geolocalizaciÃ³n GPS. 

âœ… Soluciones:
â€¢ Usa un navegador moderno (Chrome, Firefox, Safari, Edge)
â€¢ Verifica que estÃ©s usando HTTPS (no HTTP)
â€¢ Intenta desde un dispositivo mÃ³vil
â€¢ Actualiza tu navegador a la versiÃ³n mÃ¡s reciente`;console.error("Geolocation not supported"),f(b),d(!1),j(new Error(b));return}const S={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5},P=Oa();navigator.geolocation.getCurrentPosition(async b=>{try{const{latitude:T,longitude:z}=b.coords,J=b.coords.accuracy;if(console.log(`ðŸ“ GPS Location obtained: ${T.toFixed(6)}, ${z.toFixed(6)} (accuracy: ${J}m)`),!u(T,z)){const Q=`ðŸ—ºï¸ UbicaciÃ³n fuera del Ã¡rea de servicio

ðŸ“ Coordenadas detectadas: ${T.toFixed(4)}, ${z.toFixed(4)}
ðŸ¢ Ãrea de servicio: GualÃ¡n, Zacapa

âš ï¸ Posibles causas:
â€¢ Tu negocio no estÃ¡ en GualÃ¡n, Zacapa
â€¢ El GPS no es preciso (intenta ir al aire libre)
â€¢ EstÃ¡s usando VPN que cambia tu ubicaciÃ³n

âœ… Si tu negocio SÃ estÃ¡ en GualÃ¡n:
â€¢ Ve al exterior para mejor seÃ±al GPS
â€¢ Desactiva VPN si usas una
â€¢ Espera unos segundos y vuelve a intentar
â€¢ La ubicaciÃ³n se guardarÃ¡ aunque estÃ© fuera del Ã¡rea estimada`;console.warn(`Location validation failed: lat=${T}, lng=${z}, accuracy=${J}m`),f(Q),d(!1),j(new Error(Q));return}const U=await O(T,z);console.log("âœ… Location successfully processed:",U),d(!1),i(U)}catch(T){console.error("Error processing location:",T);const z=T instanceof Error?T.message:"Error al procesar la ubicaciÃ³n detectada";f(z),d(!1),j(T)}},b=>{console.error("Geolocation error details:",{code:b.code,message:b.message,PERMISSION_DENIED:b.PERMISSION_DENIED,POSITION_UNAVAILABLE:b.POSITION_UNAVAILABLE,TIMEOUT:b.TIMEOUT});let T="Error al detectar la ubicaciÃ³n";switch(b.code){case b.PERMISSION_DENIED:T=`ðŸš« Permiso de ubicaciÃ³n denegado

ðŸ“± SOLUCIÃ“N RÃPIDA para ${P}:

ðŸ”’ **MÃ©todo 1 - Ãcono de ubicaciÃ³n:**
1. Busca el Ã­cono ðŸ”’ o ðŸŒ en la barra de direcciones
2. Haz clic en Ã©l
3. Cambia "UbicaciÃ³n" de "Bloqueado" a "Permitir"
4. Recarga la pÃ¡gina

âš™ï¸ **MÃ©todo 2 - ConfiguraciÃ³n del navegador:**
â€¢ Chrome: ConfiguraciÃ³n â†’ Privacidad â†’ ConfiguraciÃ³n del sitio â†’ UbicaciÃ³n
â€¢ Firefox: Preferencias â†’ Privacidad â†’ Permisos â†’ UbicaciÃ³n  
â€¢ Safari: Preferencias â†’ Sitios web â†’ UbicaciÃ³n
â€¢ Edge: ConfiguraciÃ³n â†’ Permisos del sitio â†’ UbicaciÃ³n

ðŸ“ **Â¿Por quÃ© necesitamos tu ubicaciÃ³n?**
Los repartidores necesitan las coordenadas GPS exactas de tu negocio para hacer entregas correctas.

ðŸ”„ DespuÃ©s de cambiar los permisos, recarga esta pÃ¡gina y vuelve a intentar.`;break;case b.POSITION_UNAVAILABLE:T=`ðŸ“¡ SeÃ±al GPS no disponible

ðŸ›°ï¸ **Posibles causas:**
â€¢ EstÃ¡s en un lugar cerrado (edificio, sÃ³tano)
â€¢ SeÃ±al GPS dÃ©bil en tu Ã¡rea
â€¢ Interferencia de otros dispositivos
â€¢ GPS desactivado en el dispositivo

âœ… **Soluciones:**
â€¢ Ve cerca de una ventana o al aire libre
â€¢ Verifica que el GPS estÃ© activado en tu dispositivo
â€¢ Espera 1-2 minutos para que mejore la seÃ±al
â€¢ Intenta desde otro lugar o dispositivo
â€¢ AsegÃºrate de tener conexiÃ³n a internet estable

ðŸ“± En mÃ³viles: ConfiguraciÃ³n â†’ UbicaciÃ³n â†’ Activar GPS de alta precisiÃ³n`;break;case b.TIMEOUT:T=`â° Tiempo de espera agotado (15 segundos)

ðŸ”„ **La detecciÃ³n GPS tardÃ³ demasiado:**

ðŸ“¶ **Soluciones rÃ¡pidas:**
â€¢ Ve a un lugar con mejor seÃ±al (ventana o exterior)
â€¢ Verifica tu conexiÃ³n a internet
â€¢ Reinicia el GPS en tu dispositivo si es mÃ³vil
â€¢ Cierra otras apps que usen ubicaciÃ³n

ðŸš€ **IntÃ©ntalo de nuevo:**
La detecciÃ³n puede ser mÃ¡s rÃ¡pida en el segundo intento.

ðŸ’¡ **Tip:** En dispositivos mÃ³viles, el GPS suele ser mÃ¡s rÃ¡pido y preciso que en computadoras.`;break;default:T=`âŒ Error GPS desconocido

ðŸ”§ **InformaciÃ³n tÃ©cnica:**
â€¢ CÃ³digo de error: ${b.code}
â€¢ Mensaje: ${b.message}

ðŸ› ï¸ **Soluciones generales:**
â€¢ Recarga la pÃ¡gina e intenta de nuevo
â€¢ Verifica los permisos de ubicaciÃ³n
â€¢ Intenta desde otro navegador o dispositivo
â€¢ AsegÃºrate de usar HTTPS (no HTTP)

ðŸ“§ Si el problema persiste, contacta soporte tÃ©cnico con esta informaciÃ³n.`}console.error("Geolocation error processed:",T),f(T),d(!1),j(new Error(T))},S)}),[u,O]);return c.useEffect(()=>{g()},[g]),{getCurrentLocation:E,reverseGeocode:O,validateLocation:u,checkPermissions:g,requestPermissions:D,loading:s,error:o,permissionState:h,clearError:k}}const La={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWRkenlsb3RxZGNrdWJsZmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTU4NjEsImV4cCI6MjA3MTM3MTg2MX0.ktxZ0H7mI9NVdxu48sPd90kqPerSP-vkysQlIM1JpG8",VITE_SUPABASE_URL:"https://deaddzylotqdckublfed.supabase.co"},Ms=[{key:"monday",label:"Lunes",short:"Lun"},{key:"tuesday",label:"Martes",short:"Mar"},{key:"wednesday",label:"MiÃ©rcoles",short:"MiÃ©"},{key:"thursday",label:"Jueves",short:"Jue"},{key:"friday",label:"Viernes",short:"Vie"},{key:"saturday",label:"SÃ¡bado",short:"SÃ¡b"},{key:"sunday",label:"Domingo",short:"Dom"}],qa={monday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},saturday:{isOpen:!0,openTime:"09:00",closeTime:"17:00"},sunday:{isOpen:!1,openTime:"09:00",closeTime:"15:00"}};function Ra(){try{return!!(import.meta&&La&&!1)}catch{return!1}}function za(s){const[d,o]=c.useState(()=>{if(s)try{return JSON.parse(s)}catch{console.log("Using default weekly hours")}return qa});return{weeklyHours:d,setWeeklyHours:o,updateWeeklyHours:(k,u,g)=>{o(D=>({...D,[k]:{...D[k],[u]:g}}))},generateWeeklyHoursText:()=>{const k=Ms.filter(u=>d[u.key].isOpen);return k.length===0?"Cerrado toda la semana":k.map(u=>{const g=d[u.key];return`${u.short}: ${g.openTime}-${g.closeTime}`}).join(", ")},getHoursAsJSON:()=>JSON.stringify(d)}}function Fa({weeklyHours:s,updateWeeklyHours:d,generateWeeklyHoursText:o}){const[f,h]=c.useState(!1),_=()=>{h(!1)},k=()=>{h(!1)};return e.jsxs(G,{className:"seller-profile",children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"w-5 h-5 text-purple-500"}),"Horarios de AtenciÃ³n"]}),!f&&e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>h(!0),className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),"Editar Horarios"]})]})}),e.jsx(W,{className:"space-y-4",children:f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configurar Horarios"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:k,className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Cancelar"]}),e.jsxs(C,{size:"sm",onClick:_,className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Guardar"]})]})]}),e.jsx("div",{className:"space-y-3",children:Ms.map(u=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 min-w-[80px]",children:u.label}),e.jsx(ds,{checked:s[u.key].isOpen,onCheckedChange:g=>d(u.key,"isOpen",g)}),e.jsx("span",{className:`text-sm font-medium ${s[u.key].isOpen?"text-green-600":"text-red-600"}`,children:s[u.key].isOpen?"Abierto":"Cerrado"})]})}),s[u.key].isOpen&&e.jsxs("div",{className:"flex items-center gap-4 ml-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"text-sm whitespace-nowrap",children:"Apertura:"}),e.jsx(H,{type:"time",value:s[u.key].openTime,onChange:g=>d(u.key,"openTime",g.target.value),className:"w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"text-sm whitespace-nowrap",children:"Cierre:"}),e.jsx(H,{type:"time",value:s[u.key].closeTime,onChange:g=>d(u.key,"closeTime",g.target.value),className:"w-32"})]})]})]},u.key))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Vista previa:"}),e.jsx("p",{className:"text-sm text-blue-800",children:o()})]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-center",children:"Vista previa de horarios:"}),e.jsx("div",{className:"text-sm text-blue-800 leading-relaxed",children:o()})]})})]})}function Ua(s,d){if(s&&d){const o=`https://www.google.com/maps/@${s},${d},18z`;window.open(o,"_blank")}}function Va(s){return s.business_name.trim()?null:"El nombre del negocio es requerido"}const Je=({active:s,onClick:d,children:o,icon:f})=>e.jsxs("button",{onClick:d,className:`flex flex-col sm:flex-row items-center gap-2 px-4 py-3 sm:px-6 sm:py-4 text-sm font-bold rounded-lg transition-all duration-200 transform hover:scale-105 ${s?"bg-blue-600 text-white shadow-lg":"bg-white text-gray-700 hover:bg-blue-50 border border-gray-200 hover:border-blue-300"}`,children:[e.jsx(f,{className:"w-6 h-6 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-xs sm:text-sm font-bold",children:o})]});function ns(){const{user:s}=pe(),{getCurrentLocation:d,loading:o,error:f,permissionState:h,clearError:_}=Ma(),[k,u]=c.useState(null),[g,D]=c.useState(!0),[O,E]=c.useState(!1),[i,j]=c.useState(""),[S,P]=c.useState(""),[b,T]=c.useState(!1),[z,J]=c.useState(!1),[U,Q]=c.useState(!1),[a,m]=c.useState(!1),[l,x]=c.useState(""),[n,p]=c.useState(!1),[y,A]=c.useState(!1),[R,K]=c.useState(!1),[Z,oe]=c.useState("info"),me=c.useRef(null),xe=c.useRef(null),{weeklyHours:ze,setWeeklyHours:Fe,updateWeeklyHours:Ue,generateWeeklyHoursText:Ve,getHoursAsJSON:De}=za(k==null?void 0:k.business_hours),[v,Y]=c.useState({business_name:"",business_description:"",business_logo:"",cover_image_url:"",business_category:"",phone:"",email:"",address:"",latitude:0,longitude:0,delivery_time:30,delivery_radius:5,minimum_order:50,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:{facebook:"",instagram:"",whatsapp:"",website:""}});c.useEffect(()=>{s?Se():(u(null),K(!1),D(!1)),p(Ra())},[s]),c.useEffect(()=>{if(!s||!g)return;const r=setTimeout(()=>{D(!1),K(!0)},8e3);return()=>clearTimeout(r)},[s,g]),c.useEffect(()=>{f&&(A(!0),j(""))},[f]);const Se=async()=>{var r;try{D(!0);const{data:t,error:w}=await N.from("sellers").select("*").eq("id",s==null?void 0:s.id).single();if(w){const I=w.code,L=((r=w.message)==null?void 0:r.toString().toLowerCase())||"";if(I==="PGRST116"||I==="PGRST403"||I==="42501"||I==="PGRST114"||L.includes("permission")||L.includes("rls")||L.includes("forbidden")||L.includes("not authorized"))K(!0);else throw w}if(t){if(u(t),Y({business_name:t.business_name||"",business_description:t.business_description||"",business_logo:t.business_logo||"",cover_image_url:t.cover_image_url||"",business_category:t.business_category||"",phone:t.phone||"",email:t.email||"",address:t.address||"",latitude:t.latitude||0,longitude:t.longitude||0,delivery_time:t.delivery_time||30,delivery_radius:t.delivery_radius||5,minimum_order:t.minimum_order||50,is_active:t.is_active!==!1,is_open_now:t.is_open_now||!1,is_accepting_orders:t.is_accepting_orders!==!1,location_verified:t.location_verified||!1,social_media:t.social_media||{facebook:"",instagram:"",whatsapp:"",website:""}}),t.business_hours)try{Fe(JSON.parse(t.business_hours))}catch{console.log("Using default weekly hours")}const I=t.latitude&&t.longitude&&Math.abs(t.latitude)>.001&&Math.abs(t.longitude)>.001;m(I),I&&x(`${t.latitude.toFixed(6)}, ${t.longitude.toFixed(6)}`)}}catch(t){console.error("Error loading profile:",t),j("Error al cargar el perfil del negocio")}finally{D(!1)}},Ge=async()=>{var r,t,w,I,L;if(s)try{E(!0),j("");const $={business_name:((r=v.business_name)==null?void 0:r.trim())||"Mi Negocio",business_description:((t=v.business_description)==null?void 0:t.trim())||"",business_logo:"",cover_image_url:"",business_category:v.business_category||"",phone:((w=v.phone)==null?void 0:w.trim())||"",email:((I=v.email)==null?void 0:I.trim())||"",address:((L=v.address)==null?void 0:L.trim())||"",latitude:v.latitude||0,longitude:v.longitude||0,business_hours:De(),delivery_time:v.delivery_time||30,delivery_radius:v.delivery_radius||5,minimum_order:v.minimum_order||0,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:v.social_media,is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:M}=await N.from("sellers").upsert({id:s.id,...$});if(M)throw M;P("âœ… Perfil de vendedor creado. Completa la informaciÃ³n y guarda los cambios."),K(!1),T(!0),await Se(),setTimeout(()=>P(""),4e3)}catch($){console.error("Error creating minimal seller profile:",$),j("No se pudo crear el perfil de vendedor. Intenta de nuevo.")}finally{E(!1)}},Be=async()=>{var r,t,w,I,L,$;try{E(!0),j("");const M=Va(v);if(M){j(M);return}console.log("ðŸ’¾ Guardando perfil con datos:",{business_name:v.business_name,address:v.address,latitude:v.latitude,longitude:v.longitude,business_logo:((r=v.business_logo)==null?void 0:r.substring(0,50))+"...",cover_image_url:((t=v.cover_image_url)==null?void 0:t.substring(0,50))+"..."});const V={business_name:v.business_name.trim(),business_description:((w=v.business_description)==null?void 0:w.trim())||null,business_category:v.business_category||null,phone:((I=v.phone)==null?void 0:I.trim())||null,email:((L=v.email)==null?void 0:L.trim())||null,address:(($=v.address)==null?void 0:$.trim())||null,latitude:v.latitude||null,longitude:v.longitude||null,business_hours:De(),delivery_time:v.delivery_time||30,delivery_radius:v.delivery_radius||5,minimum_order:v.minimum_order||0,is_active:v.is_active,is_open_now:v.is_open_now,location_verified:v.location_verified||!1,social_media:v.social_media||{},business_logo:v.business_logo||null,cover_image_url:v.cover_image_url||null,updated_at:new Date().toISOString()},{error:B}=await N.from("sellers").upsert({id:s==null?void 0:s.id,...V});if(B)throw console.error("ðŸ’¥ Error al guardar:",B),B;console.log("âœ… Perfil guardado exitosamente"),P("âœ… Perfil guardado exitosamente"),T(!1),await Se(),setTimeout(()=>P(""),4e3)}catch(M){console.error("ðŸ’¥ Error saving profile:",M),j(`Error al guardar el perfil: ${M.message||"Error desconocido"}`)}finally{E(!1)}},ke=(r,t,w,I=.8)=>new Promise(L=>{const $=document.createElement("canvas"),M=$.getContext("2d"),V=new Image;V.onload=()=>{let{width:B,height:se}=V;B>se?B>t&&(se=se*t/B,B=t):se>w&&(B=B*w/se,se=w),$.width=B,$.height=se,M.drawImage(V,0,0,B,se),$.toBlob(je=>{je&&L(je)},"image/jpeg",I)},V.src=URL.createObjectURL(r)}),Ce=async r=>{var w;const t=(w=r.target.files)==null?void 0:w[0];if(!(!t||!s))try{if(J(!0),j(""),console.log("ï¿½ SUBIENDO LOGO:",t.name),!t.type.startsWith("image/")){j("Solo imÃ¡genes permitidas");return}const I=await ke(t,400,400,.9),L=`${s.id}/logo-${Date.now()}.jpg`;console.log("ðŸ“¤ Subiendo a business-logos...");const{error:$}=await N.storage.from("business-logos").upload(L,I,{upsert:!0});if($){console.error("âŒ Error upload:",$),j(`Error subiendo: ${$.message}`);return}const{data:M}=N.storage.from("business-logos").getPublicUrl(L);console.log("ðŸ”— URL generada:",M.publicUrl);const{error:V}=await N.from("sellers").upsert({id:s.id,business_logo:M.publicUrl,business_name:v.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(V){console.error("âŒ Error BD:",V),j(`Error guardando: ${V.message}`);return}console.log("âœ… LOGO GUARDADO EXITOSAMENTE"),Y(B=>({...B,business_logo:M.publicUrl})),P("âœ… Logo guardado correctamente"),setTimeout(()=>P(""),3e3)}catch(I){console.error("ðŸ’¥ ERROR COMPLETO:",I),j(`Error: ${I.message}`)}finally{J(!1)}},We=async r=>{var w;const t=(w=r.target.files)==null?void 0:w[0];if(!(!t||!s))try{if(J(!0),j(""),console.log("ï¿½ SUBIENDO PORTADA:",t.name),!t.type.startsWith("image/")){j("Solo imÃ¡genes permitidas");return}const I=await ke(t,1200,400,.9),L=`${s.id}/cover-${Date.now()}.jpg`;console.log("ðŸ“¤ Subiendo a business-covers...");const{error:$}=await N.storage.from("business-covers").upload(L,I,{upsert:!0});if($){console.error("âŒ Error upload:",$),j(`Error subiendo: ${$.message}`);return}const{data:M}=N.storage.from("business-covers").getPublicUrl(L);console.log("ðŸ”— URL generada:",M.publicUrl);const{error:V}=await N.from("sellers").upsert({id:s.id,cover_image_url:M.publicUrl,business_name:v.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(V){console.error("âŒ Error BD:",V),j(`Error guardando: ${V.message}`);return}console.log("âœ… PORTADA GUARDADA EXITOSAMENTE"),Y(B=>({...B,cover_image_url:M.publicUrl})),P("âœ… Portada guardada correctamente"),setTimeout(()=>P(""),3e3)}catch(I){console.error("ðŸ’¥ ERROR COMPLETO:",I),j(`Error: ${I.message}`)}finally{J(!1)}},Ee=async()=>{try{j(""),A(!1),_();const r=await d();Y(t=>({...t,latitude:r.latitude,longitude:r.longitude})),m(!0),x(`${r.latitude.toFixed(6)}, ${r.longitude.toFixed(6)}`),P(`ðŸŽ¯ Â¡UbicaciÃ³n GPS verificada exitosamente!
      
ï¸ Ciudad: ${r.city}, ${r.state}
ðŸ“Š Coordenadas: ${r.latitude.toFixed(6)}, ${r.longitude.toFixed(6)}
      
âœ… Los repartidores podrÃ¡n encontrar tu negocio fÃ¡cilmente.
ðŸ“ Ahora escribe la direcciÃ³n de tu negocio en el campo correspondiente.

ðŸ”” No olvides guardar el perfil para mantener estos cambios.`)}catch(r){console.error("Error detecting location:",r),A(!0)}},Ae=()=>{A(!1),_(),Ee()},$e=()=>{A(!1),_()},Pe=async()=>{const r=!v.is_open_now;try{const{error:t}=await N.from("sellers").update({is_open_now:r,updated_at:new Date().toISOString()}).eq("id",s==null?void 0:s.id);if(t)throw t;Y(w=>({...w,is_open_now:r})),P(r?"ðŸŸ¢ Â¡Negocio ABIERTO! Ahora apareces en el listado de compradores":"ðŸ”´ Negocio CERRADO. No aparecerÃ¡s en el listado hasta que abras"),setTimeout(()=>P(""),4e3)}catch(t){console.error("Error updating business status:",t),j("Error al actualizar el estado del negocio")}};return g?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"w-10 h-10 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Cargando tu perfil de negocio..."})]})}):!g&&R?e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:e.jsxs(G,{className:"text-center shadow-lg border-none",children:[e.jsxs(re,{children:[e.jsx(X,{children:"Â¡Bienvenido, Vendedor!"}),e.jsx("p",{className:"text-gray-600",children:"Parece que aÃºn no has configurado tu perfil. Â¡Es el primer paso para empezar a vender!"})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Crearemos un perfil bÃ¡sico para ti. PodrÃ¡s editar y completar toda la informaciÃ³n mÃ¡s adelante."}),e.jsxs(C,{onClick:Ge,disabled:O,size:"lg",className:"w-full sm:w-auto",children:[O?e.jsx(ie,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(be,{className:"w-5 h-5 mr-2"}),"Crear Mi Perfil Ahora"]})]})]})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil de Negocio"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestiona la informaciÃ³n que ven tus clientes."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",onClick:()=>T(!b),children:b?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"})," Editar"]})}),b&&e.jsxs(C,{onClick:Be,disabled:O,children:[O?e.jsx(ie,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})]})]})}),i&&e.jsxs(ce,{variant:"destructive",className:"mb-6 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(de,{className:"whitespace-pre-line",children:i})]}),S&&e.jsxs(ce,{className:"mb-6 border-green-200 bg-green-50 text-green-800 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(de,{className:"text-green-800 whitespace-pre-line",children:S})]}),!n&&e.jsxs(ce,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(ms,{className:"h-4 w-4 text-blue-600"}),e.jsxs(de,{className:"text-blue-800",children:[e.jsx("strong",{children:"Sistema GPS:"})," Funcionando con detecciÃ³n bÃ¡sica. Para direcciones mÃ¡s detalladas, puedes configurar Google Maps API (opcional).",e.jsx("br",{}),e.jsx("small",{children:"Ver: /GOOGLE_MAPS_SETUP_OPCIONAL.md"})]})]}),e.jsxs(G,{className:"w-full overflow-hidden shadow-lg border-none bg-white",children:[e.jsxs("div",{className:"relative h-32 sm:h-48 md:h-56 bg-gradient-to-r from-blue-500 to-purple-600",children:[v.cover_image_url?e.jsx(Le,{src:v.cover_image_url,alt:"Portada del negocio",className:"w-full h-full object-cover",width:800,height:200}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-2 opacity-70"}),e.jsx("p",{className:"text-sm opacity-90",children:"Imagen de portada"}),b&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Cualquier imagen se optimizarÃ¡ automÃ¡ticamente"})]})}),b&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var r;return(r=xe.current)==null?void 0:r.click()},children:[e.jsxs(C,{variant:"secondary",disabled:z,children:[z?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):e.jsx(fe,{className:"w-4 h-4 mr-2"}),v.cover_image_url?"Cambiar Portada":"Agregar Portada"]}),e.jsx("input",{ref:xe,type:"file",accept:"image/*",className:"hidden",onChange:We})]})]}),e.jsx("div",{className:"relative px-4 sm:px-6 pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-12 sm:-mt-16 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"relative h-24 w-24 sm:h-32 sm:w-32 rounded-full border-4 border-white bg-gradient-to-br from-green-400 to-blue-500 shadow-lg flex items-center justify-center",children:[v.business_logo?e.jsx(Le,{src:v.business_logo,alt:"Logo del negocio",className:"w-full h-full object-cover rounded-full"}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-1"}),b&&e.jsx("p",{className:"text-xs opacity-80",children:"Logo - Auto-optimizado"})]}),b&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var r;return(r=me.current)==null?void 0:r.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white/90 rounded-full flex items-center justify-center",children:z?e.jsx(ie,{className:"w-5 h-5 animate-spin text-slate-800"}):e.jsx(fe,{className:"w-5 h-5 text-slate-800"})}),e.jsx("input",{ref:me,type:"file",accept:"image/*",className:"hidden",onChange:Ce})]})]}),e.jsx("div",{className:"flex-1 text-center sm:text-left sm:ml-6 mt-4 sm:mt-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:v.business_name}),(k==null?void 0:k.is_verified)&&e.jsx(Ys,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-500"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:v.business_category})]}),e.jsx("div",{className:"flex justify-center sm:justify-end mt-3 sm:mt-0",children:e.jsxs("div",{onClick:Pe,className:`flex items-center gap-3 px-4 py-2 rounded-full text-sm font-bold cursor-pointer transform transition-all duration-200 hover:scale-105 shadow-lg ${v.is_open_now?"bg-green-500 text-white hover:bg-green-600":"bg-red-500 text-white hover:bg-red-600"}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full animate-pulse ${v.is_open_now?"bg-green-200":"bg-red-200"}`}),e.jsx("span",{className:"font-bold",children:v.is_open_now?"ABIERTO":"CERRADO"}),e.jsx(ds,{checked:v.is_open_now,onCheckedChange:Pe,className:"h-5 w-9"})]})})]})})]})}),e.jsx("div",{className:"px-4 sm:px-6 mt-6 bg-gray-50 py-4 rounded-t-lg",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:flex sm:flex-wrap sm:items-center sm:justify-center sm:gap-4",children:[e.jsxs(Je,{active:Z==="info",onClick:()=>oe("info"),icon:as,children:[e.jsx("span",{className:"hidden sm:inline",children:"InformaciÃ³n"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]}),e.jsxs(Je,{active:Z==="location",onClick:()=>oe("location"),icon:ne,children:[e.jsx("span",{className:"hidden sm:inline",children:"UbicaciÃ³n"}),e.jsx("span",{className:"sm:hidden",children:"Lugar"})]}),e.jsxs(Je,{active:Z==="delivery",onClick:()=>oe("delivery"),icon:Te,children:[e.jsx("span",{className:"hidden sm:inline",children:"Delivery"}),e.jsx("span",{className:"sm:hidden",children:"EnvÃ­o"})]})]})}),e.jsxs(W,{className:"p-6",children:[Z==="info"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-green-500"})," InformaciÃ³n BÃ¡sica"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"business_name",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(be,{className:"w-4 h-4 text-green-500"}),"Nombre del Negocio"]}),e.jsx(H,{id:"business_name",value:v.business_name,onChange:r=>Y(t=>({...t,business_name:r.target.value})),disabled:!b,placeholder:"Mi Negocio",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs(F,{htmlFor:"business_description",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(as,{className:"w-4 h-4 text-purple-500"}),"DescripciÃ³n (opcional)"]}),e.jsx(Ye,{id:"business_description",value:v.business_description,onChange:r=>Y(t=>({...t,business_description:r.target.value})),disabled:!b,rows:3,placeholder:"CuÃ©ntales a tus clientes sobre tu negocio...",className:"border-gray-200 focus:border-purple-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-500"})," Contacto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(qe,{className:"w-4 h-4 text-green-500"}),"TelÃ©fono"]}),e.jsx(H,{id:"phone",value:v.phone,onChange:r=>Y(t=>({...t,phone:r.target.value})),disabled:!b,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(la,{className:"w-4 h-4 text-blue-500"}),"Email (opcional)"]}),e.jsx(H,{id:"email",type:"email",value:v.email,onChange:r=>Y(t=>({...t,email:r.target.value})),disabled:!b,placeholder:"contacto@negocio.com",className:"border-gray-200 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2 mb-4",children:[e.jsx(rs,{className:"w-5 h-5 text-purple-500"})," Redes Sociales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"whatsapp",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(oa,{className:"w-4 h-4 text-green-500"})," WhatsApp"]}),e.jsx(H,{id:"whatsapp",value:v.social_media.whatsapp,onChange:r=>Y(t=>({...t,social_media:{...t.social_media,whatsapp:r.target.value}})),disabled:!b,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"facebook",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(va,{className:"w-4 h-4 text-blue-600"})," Facebook"]}),e.jsx(H,{id:"facebook",value:v.social_media.facebook,onChange:r=>Y(t=>({...t,social_media:{...t.social_media,facebook:r.target.value}})),disabled:!b,placeholder:"@mi_negocio",className:"border-gray-200 focus:border-blue-500"})]})]}),b&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"+ MÃ¡s redes sociales (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"instagram",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(_a,{className:"w-4 h-4 text-pink-500"})," Instagram"]}),e.jsx(H,{id:"instagram",value:v.social_media.instagram,onChange:r=>Y(t=>({...t,social_media:{...t.social_media,instagram:r.target.value}})),placeholder:"@mi_negocio",className:"border-gray-200 focus:border-pink-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"website",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(rs,{className:"w-4 h-4 text-gray-500"})," Sitio Web"]}),e.jsx(H,{id:"website",value:v.social_media.website,onChange:r=>Y(t=>({...t,social_media:{...t.social_media,website:r.target.value}})),placeholder:"www.mi-negocio.com",className:"border-gray-200 focus:border-gray-500"})]})]})]})]})]}),Z==="location"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"UbicaciÃ³n del Negocio"}),a&&e.jsx(te,{className:"w-5 h-5 text-green-500"})]}),y&&f&&e.jsxs(ce,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsxs(de,{className:"flex flex-col gap-3",children:[e.jsx("span",{children:f}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{size:"sm",variant:"outline",onClick:Ae,className:"bg-white hover:bg-gray-50",children:[e.jsx(ea,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),e.jsxs(C,{size:"sm",variant:"ghost",onClick:$e,className:"text-red-800 hover:bg-red-50",children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"Cerrar"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{htmlFor:"address",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500"}),"DirecciÃ³n"]}),e.jsx(H,{id:"address",value:v.address,onChange:r=>Y(t=>({...t,address:r.target.value})),disabled:!b,placeholder:"DirecciÃ³n de tu negocio",className:"border-gray-200 focus:border-red-500"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"GPS AutomÃ¡tico"})]}),a&&e.jsx(te,{className:"w-5 h-5 text-green-500"})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-green-700 bg-green-100 p-3 rounded-md",children:["âœ… ",e.jsx("strong",{children:"UbicaciÃ³n verificada"}),e.jsx("br",{}),"ðŸ“ ",l]}),b&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:Ee,disabled:o,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[o?e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(C,{onClick:()=>Ua(v.latitude,v.longitude),variant:"outline",size:"sm",disabled:!v.latitude||!v.longitude,children:[e.jsx(ca,{className:"w-4 h-4 mr-2"}),"Ver Mapa"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Detecta tu ubicaciÃ³n para que los repartidores te encuentren fÃ¡cilmente"}),b&&e.jsxs(C,{onClick:Ee,disabled:o,className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:[o?e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Me,{className:"w-4 h-4 mr-2"}),o?"Detectando...":"Detectar Mi UbicaciÃ³n"]}),h==="denied"&&e.jsxs(ce,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(_e,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(de,{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"GPS bloqueado."})," Haz clic en ðŸ”’ en la barra del navegador para permitir ubicaciÃ³n."]})]})]})]})]})]}),e.jsx("div",{children:e.jsx(Fa,{weeklyHours:ze,updateWeeklyHours:Ue,generateWeeklyHoursText:Ve})})]}),Z==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-orange-500"})," ConfiguraciÃ³n de Delivery"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-500"}),e.jsx(F,{htmlFor:"delivery_time",className:"text-sm font-medium",children:"Tiempo de PreparaciÃ³n"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_time",type:"number",value:v.delivery_time,onChange:r=>Y(t=>({...t,delivery_time:parseInt(r.target.value)||0})),disabled:!b,min:"5",max:"120",className:"border-gray-200 focus:border-orange-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-500"}),e.jsx(F,{htmlFor:"delivery_radius",className:"text-sm font-medium",children:"Radio de Entrega"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_radius",type:"number",value:v.delivery_radius,onChange:r=>Y(t=>({...t,delivery_radius:parseInt(r.target.value)||0})),disabled:!b,min:"1",max:"20",className:"border-gray-200 focus:border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"km"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-5 h-5 text-green-500"}),e.jsx(F,{htmlFor:"minimum_order",className:"text-sm font-medium",children:"Pedido MÃ­nimo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Q"}),e.jsx(H,{id:"minimum_order",type:"number",value:v.minimum_order,onChange:r=>Y(t=>({...t,minimum_order:parseInt(r.target.value)||0})),disabled:!b,min:"0",className:"border-gray-200 focus:border-green-500"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-lg",children:"ðŸ’¡ Estos valores ayudan a los clientes a saber quÃ© esperar de tu servicio"})]})]})]})]})})}async function Ga(s){try{const{data:{user:d}}=await N.auth.getUser();if(!d)throw new Error("Usuario no autenticado");console.log(`ðŸš€ Intentando aceptar orden ${s}...`);const{data:o,error:f}=await N.rpc("seller_accept_order",{p_order_id:s,p_seller_id:d.id});return f?(console.error("âŒ Error:",f),{success:!1,error:f.message}):(console.log("âœ… Resultado:",o),{success:!0,data:o})}catch(d){return console.error("ðŸ’¥ Error:",d),{success:!1,error:d instanceof Error?d.message:"Error desconocido"}}}const Ba={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-purple-100 text-purple-800",assigned:"bg-indigo-100 text-indigo-800",picked_up:"bg-green-100 text-green-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},os={pending:"Pendiente",accepted:"Aceptado",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",assigned:"Asignado",picked_up:"Recogido",in_transit:"En camino",delivered:"Entregado",completed:"Completado",cancelled:"Cancelado",rejected:"Rechazado"};function ls(){const{user:s}=pe(),[d,o]=c.useState([]),[f,h]=c.useState(!0),[_,k]=c.useState(!1),[u,g]=c.useState(new Set),[D,O]=c.useState("pending");c.useEffect(()=>{s!=null&&s.id&&(i(),E())},[s==null?void 0:s.id]);const E=()=>{if(!(s!=null&&s.id))return;const a=N.channel("seller-orders-management").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},()=>{i()}).subscribe();return()=>{a.unsubscribe()}},i=async()=>{o([]);try{const{data:a,error:m}=await N.from("orders").select(`
          *,
          order_items (
            id,
            product_name,
            quantity,
            unit_price,
            product_image,
            notes
          ),
          users!orders_buyer_id_fkey (
            name,
            phone
          ),
          drivers:users!orders_driver_id_fkey (
            name
          )
        `).eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(m)throw m;console.log("ðŸ“Š Ã“rdenes cargadas:",(a==null?void 0:a.length)||0),console.log("ðŸ“‹ Datos de Ã³rdenes:",a);const l=(a==null?void 0:a.map(x=>{var n,p,y;return console.log(`ðŸ” Orden ${x.order_number}:`,{id:x.id,status:x.status,delivery_type:x.delivery_type,buyer_id:x.buyer_id}),{...x,buyer_id:x.buyer_id,buyer_name:((n=x.users)==null?void 0:n.name)||"Cliente",buyer_phone:(p=x.users)==null?void 0:p.phone,driver_name:(y=x.drivers)==null?void 0:y.name,items:x.order_items||[]}}))||[];o(l)}catch(a){console.error("Error loading orders:",a),q.error("Error al cargar las Ã³rdenes")}finally{h(!1),k(!1)}},j=()=>{k(!0),i()},S=async a=>{console.log(`ðŸ§ª Probando aceptar orden directa: ${a}`);const m=await Ga(a);console.log("ðŸ“Š Resultado:",m),m.success?(q.success("Orden aceptada exitosamente!"),i()):q.error(`Error: ${m.error}`)},P=async a=>{if(!u.has(a)){g(m=>new Set([...m,a]));try{console.log(`ðŸŽ¯ Marcando orden como lista: ${a}`);let m,l;try{console.log("ðŸ”„ Intento 1: seller_mark_ready_improved");const x=await N.rpc("seller_mark_ready_improved",{p_order_id:a,p_seller_id:s==null?void 0:s.id});m=x.data,l=x.error,!l&&m&&console.log("âœ… Ã‰xito con funciÃ³n mejorada")}catch{console.log("âš ï¸ FunciÃ³n mejorada fallÃ³, probando segura...");try{console.log("ðŸ”„ Intento 2: seller_mark_ready_safe");const n=await N.rpc("seller_mark_ready_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});m=n.data,l=n.error,!l&&m&&console.log("âœ… Ã‰xito con funciÃ³n segura")}catch{console.log("âš ï¸ FunciÃ³n segura fallÃ³, probando bÃ¡sica...");try{console.log("ðŸ”„ Intento 3: seller_mark_ready_basic");const p=await N.rpc("seller_mark_ready_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});m=p.data,l=p.error,!l&&m&&console.log("âœ… Ã‰xito con funciÃ³n bÃ¡sica")}catch(p){throw console.error("ðŸ’¥ Todos los mÃ©todos fallaron:",p),new Error("No se pudo marcar la orden como lista")}}}if(l){console.error("âŒ Error RPC:",l),q.error(`Error: ${l.message}`);return}if(console.log("âœ… Resultado final:",m),m&&m.length>0){const x=m[0];x.success?(q.success(x.message),i()):q.error(x.message)}else q.success("Orden marcada como lista"),i()}catch(m){console.error("ðŸ’¥ Error en handleMarcarListo:",m),q.error("Error al marcar orden como lista")}finally{g(m=>{const l=new Set(m);return l.delete(a),l})}}},b=async a=>{if(!u.has(a)){g(m=>new Set([...m,a]));try{console.log(`ðŸ“¦ Completando orden pickup/dine-in: ${a}`);let m,l;try{console.log("ðŸ”„ Intento 1: seller_mark_completed_pickup");const x=await N.rpc("seller_mark_completed_pickup",{p_order_id:a,p_seller_id:s==null?void 0:s.id});m=x.data,l=x.error,!l&&m&&console.log("âœ… Ã‰xito con funciÃ³n completa")}catch{console.log("âš ï¸ FunciÃ³n completa fallÃ³, probando segura...");try{console.log("ðŸ”„ Intento 2: seller_mark_completed_pickup_safe");const n=await N.rpc("seller_mark_completed_pickup_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});m=n.data,l=n.error,!l&&m&&console.log("âœ… Ã‰xito con funciÃ³n segura")}catch{console.log("âš ï¸ FunciÃ³n segura fallÃ³, probando bÃ¡sica...");try{console.log("ðŸ”„ Intento 3: seller_mark_completed_pickup_basic");const p=await N.rpc("seller_mark_completed_pickup_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});m=p.data,l=p.error,!l&&m&&console.log("âœ… Ã‰xito con funciÃ³n bÃ¡sica")}catch(p){throw console.error("ðŸ’¥ Todos los mÃ©todos fallaron:",p),new Error("No se pudo completar la orden pickup/dine-in")}}}if(l){console.error("âŒ Error RPC:",l),q.error(`Error: ${l.message}`);return}if(console.log("âœ… Resultado final:",m),m&&m.length>0){const x=m[0];x.success?(q.success(x.message),i()):q.error(x.message)}else q.success("Orden completada exitosamente"),i()}catch(m){console.error("ðŸ’¥ Error en handleCompletarPickup:",m),q.error("Error al completar la orden")}finally{g(m=>{const l=new Set(m);return l.delete(a),l})}}},T=async(a,m)=>{var n,p;if(u.has(a))return;const x={confirmed:"accepted",preparing:"ready",ready:"ready",delivered:"delivered",cancelled:"cancelled"}[m];g(y=>new Set([...y,a]));try{let y;if(x==="accepted"&&(y=await N.rpc("seller_accept_order",{p_order_id:a,p_seller_id:s==null?void 0:s.id})),y&&(y.error||y.data&&y.data[0]&&!y.data[0].success)){const R=((n=y.error)==null?void 0:n.message)||((p=y.data[0])==null?void 0:p.message)||"Error al actualizar el estado";console.error("RPC error:",R),q.error(R),g(K=>{const Z=new Set(K);return Z.delete(a),Z});return}const A=d.find(R=>R.id===a);if(A&&x==="accepted"){await N.from("notifications").insert({user_id:A.buyer_id,order_id:A.id,message:`Tu orden #${A.order_number} ha sido aceptada.`,type:"order_accepted"}),console.log("ðŸ”„ Orden aceptada, actualizando stock...");const{data:R,error:K}=await N.from("order_items").select("product_id, daily_product_id, quantity, product_name, product_type").eq("order_id",a);if(K)console.error("âŒ Error obteniendo items de la orden:",K),q.error("Orden aceptada pero error al actualizar stock");else if(R&&R.length>0){console.log("ðŸ“¦ Items encontrados:",R.length),R.forEach((oe,me)=>{console.log(`   ${me+1}. ${oe.product_name} - Cantidad: ${oe.quantity} - Tipo: ${oe.product_type}`)}),console.log("ðŸš€ Llamando updateProductStock...");const Z=await sa(R,a);console.log("ðŸ“Š Resultado del stock manager:",Z),Z.success?(console.log("âœ… Stock actualizado exitosamente:",Z.updatedProducts),q.success("Orden aceptada y stock actualizado")):(console.error("âŒ Error actualizando stock:",Z.message),q.error(`Orden aceptada pero ${Z.message}`))}else console.log("âš ï¸ No se encontraron items en la orden"),q.success("Orden aceptada (sin items para actualizar stock)")}q.success(`Orden actualizada a ${os[x]||x}.`),i(),g(R=>{const K=new Set(R);return K.delete(a),K})}catch(y){console.error("Error updating order status:",y),q.error("Error al actualizar el estado de la orden")}finally{g(y=>{const A=new Set(y);return A.delete(a),A})}},z=async(a,m)=>{if(!u.has(a)){g(l=>new Set([...l,a]));try{const{error:l}=await N.from("orders").update({status:"rejected",rejection_reason:m,updated_at:new Date().toISOString()}).eq("id",a);if(l)throw l;const x=d.find(n=>n.id===a);x&&await N.from("notifications").insert({user_id:x.buyer_id,order_id:x.id,message:`Tu orden #${x.order_number} fue rechazada.`,type:"order_rejected"}),q.success("Orden rechazada"),i()}catch(l){console.error("Error rejecting order:",l),q.error("Error al rechazar la orden")}finally{g(l=>{const x=new Set(l);return x.delete(a),x})}}},J=a=>{try{return new Date(a).toLocaleString("es-GT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha invÃ¡lida"}},U=a=>a==="active"?d.filter(m=>["accepted","ready","assigned","picked_up","in_transit"].includes(m.status)):a==="completed"?d.filter(m=>["delivered","completed"].includes(m.status)):a==="cancelled"?d.filter(m=>["cancelled","rejected"].includes(m.status)):d.filter(m=>m.status===a),Q=a=>{const m=u.has(a.id);return console.log(`ðŸŽ¨ Renderizando orden ${a.order_number}:`,{id:a.id,status:a.status,delivery_type:a.delivery_type,buyer_id:a.buyer_id,isProcessing:m,orderObject:a}),console.log(`â“ Status actual: "${a.status}" (tipo: ${typeof a.status})`),console.log(`â“ Delivery type actual: "${a.delivery_type}" (tipo: ${typeof a.delivery_type})`),console.log(`â“ Â¿Status === 'pending'? ${a.status==="pending"}`),console.log(`â“ Â¿Delivery type === 'delivery'? ${a.delivery_type==="delivery"}`),console.log(`â“ Â¿Status incluye pending? ${String(a.status).includes("pending")}`),console.log(`â“ Â¿Delivery incluye delivery? ${String(a.delivery_type).includes("delivery")}`),e.jsxs(G,{className:"border-l-4 border-l-orange-500",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"text-lg",children:["Orden #",a.order_number]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:J(a.created_at)})]}),e.jsx(ee,{className:Ba[a.status],children:os[a.status]})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.buyer_name}),a.buyer_phone&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 text-gray-500 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.buyer_phone})]})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"?"bg-blue-50 border-blue-300":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"bg-green-50 border-green-300":"bg-blue-50 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?e.jsx(Te,{className:"w-8 h-8 text-blue-600"}):String(a.delivery_type||"").trim().toLowerCase()==="pickup"?e.jsx(ue,{className:"w-8 h-8 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-xl font-bold ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"text-blue-800":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"text-green-800":"text-orange-800"}`,children:String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"SERVICIO A DOMICILIO":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"RECOGER EN TIENDA":"COMER EN EL LUGAR"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["MÃ©todo de entrega: ",a.delivery_type||"No especificado"]})]})]})}),a.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.delivery_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Productos:"}),a.items.map((l,x)=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsxs("span",{children:[l.quantity,"x ",l.product_name]}),e.jsxs("span",{className:"font-medium",children:["Q",(l.quantity*l.unit_price).toFixed(2)]})]},x))]}),a.notes&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ka,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Notas:"}),e.jsx("p",{className:"text-sm text-blue-700",children:a.notes})]})]})}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["Q",a.total.toFixed(2)]})]}),a.delivery_fee>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Incluye Q",a.delivery_fee.toFixed(2)," de entrega"]})]}),a.driver_name&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Repartidor: ",a.driver_name]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[String(a.status).trim().toLowerCase()==="pending"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:()=>S(a.id),disabled:u.has(a.id),className:"flex-1 bg-green-600 hover:bg-green-700",children:[u.has(a.id)?e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Aceptar Orden"]}),e.jsxs(C,{onClick:()=>z(a.id,"No disponible"),disabled:u.has(a.id),variant:"destructive",size:"lg",className:"px-6 bg-red-600 hover:bg-red-700 text-white border-red-600",style:{backgroundColor:"#dc2626",borderColor:"#dc2626"},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})}),a.status==="accepted"&&e.jsxs(C,{onClick:()=>P(a.id),disabled:u.has(a.id),className:"w-full bg-purple-600 hover:bg-purple-700",children:[u.has(a.id)?e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Marcar Orden Lista"]}),a.status==="ready"&&e.jsxs("div",{className:"space-y-3",children:[(a.delivery_type==="delivery"||!a.delivery_type)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Orden lista para recoger"}),e.jsx("p",{className:"text-sm text-blue-600",children:"El repartidor recogerÃ¡ y entregarÃ¡ esta orden"})]})]})}),(a.delivery_type==="pickup"||a.delivery_type==="dine-in")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${a.delivery_type==="pickup"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.delivery_type==="pickup"?e.jsx(ue,{className:"w-6 h-6 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.delivery_type==="pickup"?"text-green-800":"text-orange-800"}`,children:a.delivery_type==="pickup"?"Cliente debe recoger en tienda":"Cliente consume en el lugar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Marcar como entregado cuando el cliente complete la orden"})]})]})}),e.jsxs(C,{onClick:()=>b(a.id),disabled:u.has(a.id),className:"w-full bg-green-600 hover:bg-green-700",children:[u.has(a.id)?e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),a.delivery_type==="pickup"?"Marcar como Recogido":"Marcar como Servido"]})]})]}),a.status==="delivered"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:()=>T(a.id,"confirmed"),disabled:m,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[m?e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Re-procesar"]}),e.jsxs(C,{onClick:()=>z(a.id,"Orden rechazada"),disabled:m,variant:"destructive",size:"lg",className:"px-6",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})]})]})]},a.id)};return f?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{className:"border-orange-200 shadow-lg",children:e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-orange-500"}),"GestiÃ³n de Ã“rdenes"]}),e.jsxs(C,{variant:"outline",onClick:j,disabled:_,size:"sm",children:[_?e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})})}),e.jsxs(Qe,{value:D,onValueChange:O,children:[e.jsxs(Ze,{className:"grid w-full grid-cols-4",children:[e.jsxs(he,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Pendientes",U("pending").length>0&&e.jsx(ee,{variant:"destructive",className:"ml-1 px-1.5 py-0.5 text-xs",children:U("pending").length})]}),e.jsxs(he,{value:"active",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Activas",U("active").length>0&&e.jsx(ee,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:U("active").length})]}),e.jsxs(he,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Completadas"]}),e.jsxs(he,{value:"cancelled",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Canceladas"]})]}),e.jsx(le,{value:"pending",className:"space-y-4",children:U("pending").length===0?e.jsx(G,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay Ã³rdenes pendientes"})]})}):U("pending").map(Q)}),e.jsx(le,{value:"active",className:"space-y-4",children:U("active").length===0?e.jsx(G,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay Ã³rdenes activas"})]})}):U("active").map(Q)}),e.jsx(le,{value:"completed",className:"space-y-4",children:U("completed").length===0?e.jsx(G,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay Ã³rdenes completadas"})]})}):U("completed").map(Q)}),e.jsx(le,{value:"cancelled",className:"space-y-4",children:U("cancelled").length===0?e.jsx(G,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(Ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay Ã³rdenes canceladas"})]})}):U("cancelled").map(Q)})]})]})}function Wa({userRole:s,onVerificationComplete:d}){const{user:o}=pe(),[f,h]=c.useState({latitude:null,longitude:null,address:""}),[_,k]=c.useState({latitude:null,longitude:null,address:""}),[u,g]=c.useState({phone:"",profileImage:"",coverImage:"",vehicleType:"",licenseNumber:""}),[D,O]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1}),[E,i]=c.useState(!1),[j,S]=c.useState(!1);c.useEffect(()=>{o&&P()},[o]);const P=async()=>{if(o)try{const{data:n,error:p}=await N.from("users").select("*").eq("id",o.id).single();if(p)throw p;if(n&&(h({latitude:n.latitude,longitude:n.longitude,address:n.address||""}),g({phone:n.phone||"",profileImage:n.profile_image_url||"",coverImage:n.cover_image_url||"",vehicleType:n.vehicle_type||"",licenseNumber:n.license_number||""}),O(y=>({...y,locationVerified:n.location_verified||!1,profileCompleted:n.profile_completed||!1}))),s==="vendedor"){const{data:y,error:A}=await N.from("sellers").select("*").eq("user_id",o.id).single();y&&(k({latitude:y.business_latitude,longitude:y.business_longitude,address:y.business_address||""}),g(R=>({...R,coverImage:y.cover_image_url||""})),O(R=>({...R,businessLocationVerified:y.business_location_verified||!1,canPublish:y.can_publish_products||!1})))}}catch(n){console.error("Error loading user data:",n),q.error("Error al cargar datos del usuario")}},b=async()=>{if(!navigator.geolocation){q.error("Tu navegador no soporta geolocalizaciÃ³n");return}S(!0),navigator.geolocation.getCurrentPosition(async n=>{const{latitude:p,longitude:y}=n.coords;try{const A=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${y},${p}.json?access_token=`);if(A.ok){const R=await A.json();R.features&&R.features.length>0&&h(K=>({...K,latitude:p,longitude:y}))}else h(R=>({...R,latitude:p,longitude:y}));q.success("UbicaciÃ³n obtenida correctamente")}catch(A){console.error("Error getting address:",A),h(R=>({...R,latitude:p,longitude:y})),q.success("UbicaciÃ³n obtenida (sin direcciÃ³n)")}finally{S(!1)}},n=>{console.error("Geolocation error:",n),S(!1),q.error("No se pudo obtener tu ubicaciÃ³n. Verifica los permisos del navegador.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},T=async()=>{if(!o||!f.latitude||!f.longitude){q.error("Primero obtÃ©n tu ubicaciÃ³n");return}i(!0);try{const{error:n}=await N.rpc("update_user_location",{user_id:o.id,lat:f.latitude,lng:f.longitude,user_address:f.address});if(n)throw n;O(p=>({...p,locationVerified:!0})),q.success("UbicaciÃ³n personal verificada"),await U()}catch(n){console.error("Error saving location:",n),q.error("Error al guardar ubicaciÃ³n")}finally{i(!1)}},z=async()=>{if(!o||!_.latitude||!_.longitude){q.error("Primero obtÃ©n la ubicaciÃ³n del negocio");return}i(!0);try{const{error:n}=await N.rpc("update_business_location",{seller_user_id:o.id,lat:_.latitude,lng:_.longitude,business_addr:_.address});if(n)throw n;O(p=>({...p,businessLocationVerified:!0})),q.success("UbicaciÃ³n del negocio verificada"),await U()}catch(n){console.error("Error saving business location:",n),q.error("Error al guardar ubicaciÃ³n del negocio")}finally{i(!1)}},J=async()=>{if(o){i(!0);try{const n={phone:u.phone,profile_image_url:u.profileImage,updated_at:new Date().toISOString()};s==="repartidor"&&(n.vehicle_type=u.vehicleType,n.license_number=u.licenseNumber);const{error:p}=await N.from("users").update(n).eq("id",o.id);if(p)throw p;if(s==="vendedor"&&u.coverImage){const{error:y}=await N.from("sellers").update({cover_image_url:u.coverImage}).eq("user_id",o.id);if(y)throw y}q.success("Perfil actualizado"),await U()}catch(n){console.error("Error updating profile:",n),q.error("Error al actualizar perfil")}finally{i(!1)}}},U=async()=>{if(o)try{let n=!1;if(s==="vendedor"){const{data:p,error:y}=await N.rpc("check_seller_can_publish",{seller_user_id:o.id});y||(n=p)}else if(s==="comprador"){const{data:p,error:y}=await N.rpc("check_buyer_can_purchase",{buyer_user_id:o.id});y||(n=p)}else if(s==="repartidor"){const{data:p,error:y}=await N.rpc("check_driver_can_work",{driver_user_id:o.id});y||(n=p)}O(p=>({...p,canPublish:s==="vendedor"?n:p.canPublish,canPurchase:s==="comprador"?n:p.canPurchase,canWork:s==="repartidor"?n:p.canWork})),n&&d&&d()}catch(n){console.error("Error checking verification status:",n)}},Q=()=>{const n=[{name:"TelÃ©fono",completed:!!u.phone,icon:qe},{name:"UbicaciÃ³n verificada",completed:D.locationVerified,icon:ne}];return s==="vendedor"?[...n,{name:"Foto de perfil",completed:!!u.profileImage,icon:fe},{name:"Foto de portada",completed:!!u.coverImage,icon:fe},{name:"UbicaciÃ³n del negocio",completed:D.businessLocationVerified,icon:ne}]:s==="repartidor"?[...n,{name:"Tipo de vehÃ­culo",completed:!!u.vehicleType&&u.vehicleType!=="No especificado",icon:Me},{name:"NÃºmero de licencia",completed:!!u.licenseNumber&&u.licenseNumber!=="No especificado",icon:fe}]:n},a=()=>s==="vendedor"&&D.canPublish?{message:"Â¡Puedes publicar productos!",type:"success"}:s==="comprador"&&D.canPurchase?{message:"Â¡Puedes realizar compras!",type:"success"}:s==="repartidor"&&D.canWork?{message:"Â¡Puedes tomar Ã³rdenes!",type:"success"}:{message:"Completa todos los requisitos",type:"warning"},m=Q(),l=m.filter(n=>n.completed).length,x=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[x.type==="success"?e.jsx(te,{className:"w-5 h-5 text-green-500"}):e.jsx(_e,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{children:"Estado de VerificaciÃ³n"})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${x.type==="success"?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:[e.jsx("p",{className:`font-medium ${x.type==="success"?"text-green-800":"text-orange-800"}`,children:x.message}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[l," de ",m.length," requisitos completados"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:m.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border",children:[e.jsx(n.icon,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:n.name}),n.completed?e.jsx(te,{className:"w-4 h-4 text-green-500 ml-auto"}):e.jsx(Ne,{className:"w-4 h-4 text-red-500 ml-auto"})]},n.name))})]})})]}),e.jsxs(G,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{children:"UbicaciÃ³n Personal"}),D.locationVerified&&e.jsx(ee,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"DirecciÃ³n"}),e.jsx(H,{value:f.address,onChange:n=>h(p=>({...p,address:n.target.value})),placeholder:"Tu direcciÃ³n",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(C,{onClick:b,disabled:j,className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50",variant:"outline",style:{borderColor:"#2563eb",color:"#2563eb",backgroundColor:"white",fontWeight:"600"},children:j?"Obteniendo...":"Obtener UbicaciÃ³n Actual"})})]}),f.latitude&&f.longitude&&e.jsx("div",{className:"p-3 bg-gray-50 rounded border",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas: ",f.latitude,", ",f.longitude]})}),e.jsx(C,{onClick:T,disabled:E||!f.latitude||!f.longitude,className:"w-full",children:E?"Guardando...":"Verificar UbicaciÃ³n Personal"})]})]}),s==="vendedor"&&e.jsxs(G,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"UbicaciÃ³n del Negocio"}),D.businessLocationVerified&&e.jsx(ee,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"DirecciÃ³n del Negocio"}),e.jsx(H,{value:_.address,onChange:n=>k(p=>({...p,address:n.target.value})),placeholder:"DirecciÃ³n de tu negocio",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(C,{onClick:()=>{b(),f.latitude&&f.longitude&&k(n=>({...n,latitude:f.latitude,longitude:f.longitude}))},disabled:j,className:"w-full",variant:"outline",children:"Usar UbicaciÃ³n Actual"})})]}),e.jsx(C,{onClick:z,disabled:E||!_.latitude||!_.longitude,className:"w-full",children:E?"Guardando...":"Verificar UbicaciÃ³n del Negocio"})]})]}),e.jsxs(G,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{children:"InformaciÃ³n del Perfil"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"TelÃ©fono"}),e.jsx(H,{value:u.phone,onChange:n=>g(p=>({...p,phone:n.target.value})),placeholder:"+502 1234-5678",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Perfil"}),e.jsx(H,{value:u.profileImage,onChange:n=>g(p=>({...p,profileImage:n.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="vendedor"&&e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Portada"}),e.jsx(H,{value:u.coverImage,onChange:n=>g(p=>({...p,coverImage:n.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="repartidor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tipo de VehÃ­culo"}),e.jsx(H,{value:u.vehicleType,onChange:n=>g(p=>({...p,vehicleType:n.target.value})),placeholder:"Motocicleta, AutomÃ³vil, Bicicleta...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(F,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"NÃºmero de Licencia"}),e.jsx(H,{value:u.licenseNumber,onChange:n=>g(p=>({...p,licenseNumber:n.target.value})),placeholder:"M-123456",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]})]})]}),e.jsx(C,{onClick:J,disabled:E,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold",style:{backgroundColor:"#2563eb",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"600"},children:E?"Actualizando...":"Actualizar Perfil"})]})]})]})}function Ls(s){const{user:d}=pe(),[o,f]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1,requirements:{phone:!1,profileImage:!1,coverImage:!1,location:!1,businessLocation:!1,vehicleType:!1,licenseNumber:!1,adminApproval:!1}}),[h,_]=c.useState(!0);c.useEffect(()=>{d&&k()},[d,s]);const k=async()=>{if(d)try{_(!0);const{data:i,error:j}=await N.from("users").select("*").eq("id",d.id).single();if(j)throw j;let S=null;if(s==="vendedor"){const{data:T,error:z}=await N.from("sellers").select("*").eq("user_id",d.id).single();z||(S=T)}const P={phone:!!(i.phone&&i.phone.trim()!==""),profileImage:!!(i.profile_image_url&&i.profile_image_url.trim()!==""),coverImage:s==="vendedor"?!!(S!=null&&S.cover_image_url&&S.cover_image_url.trim()!==""):!0,location:!!(i.location_verified&&i.latitude&&i.longitude&&i.address),businessLocation:s==="vendedor"?!!(S!=null&&S.business_location_verified&&S.business_latitude&&S.business_longitude&&S.business_address):!0,vehicleType:s==="repartidor"?!!(i.vehicle_type&&i.vehicle_type!=="No especificado"):!0,licenseNumber:s==="repartidor"?!!(i.license_number&&i.license_number!=="No especificado"):!0,adminApproval:s==="repartidor"?!!(i.is_verified&&i.is_active):!0};let b=!1;if(s==="vendedor"){const{data:T,error:z}=await N.rpc("check_seller_can_publish",{seller_user_id:d.id});z||(b=T)}else if(s==="comprador"){const{data:T,error:z}=await N.rpc("check_buyer_can_purchase",{buyer_user_id:d.id});z||(b=T)}else if(s==="repartidor"){const{data:T,error:z}=await N.rpc("check_driver_can_work",{driver_user_id:d.id});z||(b=T)}f({locationVerified:i.location_verified||!1,businessLocationVerified:(S==null?void 0:S.business_location_verified)||!1,profileCompleted:i.profile_completed||!1,canPublish:s==="vendedor"?b:!1,canPurchase:s==="comprador"?b:!1,canWork:s==="repartidor"?b:!1,requirements:P})}catch(i){console.error("Error checking verification status:",i)}finally{_(!1)}};return{status:o,loading:h,refreshStatus:()=>{k()},getCompletionPercentage:()=>{const i=Object.values(o.requirements).length,j=Object.values(o.requirements).filter(Boolean).length;return Math.round(j/i*100)},getMissingRequirements:()=>{const i=[];return o.requirements.phone||i.push("TelÃ©fono"),o.requirements.profileImage||i.push("Foto de perfil"),o.requirements.location||i.push("UbicaciÃ³n verificada"),s==="vendedor"&&(o.requirements.coverImage||i.push("Foto de portada"),o.requirements.businessLocation||i.push("UbicaciÃ³n del negocio")),s==="repartidor"&&(o.requirements.vehicleType||i.push("Tipo de vehÃ­culo"),o.requirements.licenseNumber||i.push("NÃºmero de licencia"),o.requirements.adminApproval||i.push("AprobaciÃ³n del administrador")),i},canPerformMainAction:()=>{switch(s){case"vendedor":return o.canPublish;case"comprador":return o.canPurchase;case"repartidor":return o.canWork;default:return!1}},getMainActionText:()=>{switch(s){case"vendedor":return o.canPublish?"Puedes publicar productos":"No puedes publicar productos aÃºn";case"comprador":return o.canPurchase?"Puedes realizar compras":"No puedes comprar aÃºn";case"repartidor":return o.canWork?"Puedes tomar Ã³rdenes":"No puedes trabajar aÃºn";default:return""}}}}function Ha({userRole:s,onOpenVerification:d,showIfComplete:o=!1}){const{loading:f,canPerformMainAction:h,getMissingRequirements:_,getCompletionPercentage:k}=Ls(s);if(f)return null;const u=h(),g=_(),D=k();if(s==="vendedor"||u&&!o)return null;const O=()=>{switch(s){case"vendedor":return es;case"comprador":return ne;case"repartidor":return Te;default:return _e}},E=()=>{if(u)switch(s){case"vendedor":return"Â¡Perfil completo! Puedes publicar productos";case"comprador":return"Â¡Perfil completo! Puedes realizar compras";case"repartidor":return"Â¡Perfil completo! Puedes tomar Ã³rdenes";default:return"Â¡Perfil completo!"}switch(s){case"vendedor":return"Completa tu perfil para publicar productos";case"comprador":return"Completa tu perfil para realizar compras";case"repartidor":return"Completa tu perfil para trabajar como repartidor";default:return"Completa tu perfil"}},i=()=>u?"Tu perfil estÃ¡ completamente verificado y puedes usar todas las funciones de TRATO.":g.length===0?"Casi listo, solo faltan algunos detalles por verificar.":g.length===1?`Te falta 1 requisito: ${g[0]}.`:`Te faltan ${g.length} requisitos: ${g.slice(0,2).join(", ")}${g.length>2?" y mÃ¡s...":""}.`,j=O();return e.jsx(ce,{className:`verification-alert mb-6 ${u?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 w-full",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(j,{className:`w-6 h-6 flex-shrink-0 mt-1 ${u?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-lg leading-tight ${u?"text-green-800":"text-orange-800"}`,children:E()}),e.jsx(de,{className:`alert-description mt-1 text-sm ${u?"text-green-700":"text-orange-700"}`,children:i()}),!u&&e.jsxs("div",{className:"verification-progress mt-3 space-y-2",children:[e.jsxs("div",{className:"verification-progress-label flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-orange-800",children:"Progreso del perfil"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[D,"%"]})]}),e.jsx("div",{className:"verification-progress-bar w-full bg-orange-200 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${D}%`}})})]})]})]}),e.jsx("div",{className:"flex justify-center md:justify-end mt-4 md:mt-0 md:ml-4",children:e.jsx(C,{onClick:d,className:`verification-button px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 ${u?"bg-green-500 hover:bg-green-600 hover:shadow-green-200":"bg-orange-500 hover:bg-orange-600 hover:shadow-orange-200"}`,style:{minWidth:"160px",borderRadius:"8px",fontSize:"14px",fontWeight:"600"},children:u?"Ver Estado":"Completar Perfil"})})]})})}function Ja({onDismiss:s}){const{user:d}=pe(),{permission:o,requestPermission:f,supported:h}=us(),[_,k]=c.useState(!1),[u,g]=c.useState(!1);c.useEffect(()=>{const j=h&&o!=="granted"&&o!=="denied"&&((d==null?void 0:d.role)==="vendedor"||(d==null?void 0:d.role)==="repartidor");g(j)},[h,o,d==null?void 0:d.role]);const D=async()=>{k(!0);try{await f()&&(g(!1),s==null||s())}catch(j){console.error("Error al solicitar permisos:",j)}finally{k(!1)}},O=()=>{g(!1),s==null||s()};if(!u)return null;const i=(()=>{switch(d==null?void 0:d.role){case"vendedor":return{title:"Notificaciones de Nuevas Ã“rdenes",description:"Recibe alertas inmediatas cuando lleguen nuevos pedidos, incluso con la pantalla apagada.",benefits:["ðŸ“± Notificaciones incluso con pantalla apagada","ðŸ”” Alertas sonoras para nuevos pedidos","âš¡ Respuesta mÃ¡s rÃ¡pida a clientes"]};case"repartidor":return{title:"Notificaciones de Entregas",description:"Mantente informado sobre nuevas entregas disponibles y asignaciones.",benefits:["ðŸš› Alertas de nuevas entregas","ðŸ“ Notificaciones de asignaciones","ðŸ’° No pierdas oportunidades de entrega"]};default:return{title:"Notificaciones Push",description:"Recibe notificaciones importantes de la aplicaciÃ³n.",benefits:["ðŸ”” Alertas importantes","ðŸ“± Notificaciones push","âš¡ InformaciÃ³n en tiempo real"]}}})();return e.jsxs(G,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-lg",children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(xa,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx(X,{className:"text-lg text-orange-900",children:i.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:i.description})]})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:O,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:e.jsx(ye,{className:"w-4 h-4"})})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:i.benefits.map((j,S)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-800",children:[e.jsx(te,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),j]},S))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:o==="granted"?"default":o==="denied"?"destructive":"secondary",className:"flex items-center gap-1",children:o==="granted"?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-3 h-3"}),"Activadas"]}):o==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-3 h-3"}),"Denegadas"]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-3 h-3"}),"Pendientes"]})}),!h&&e.jsx(ee,{variant:"outline",className:"text-gray-600",children:"No soportadas en este navegador"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(C,{onClick:D,disabled:_||!h||o==="granted",className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-4 h-4 mr-2 animate-spin"}),"Solicitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Activar Notificaciones"]})}),e.jsx(C,{variant:"outline",onClick:O,className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:"Ahora no"})]}),o==="denied"&&e.jsxs(ce,{className:"border-red-200 bg-red-50",children:[e.jsx(_e,{className:"w-4 h-4 text-red-600"}),e.jsx(de,{className:"text-red-800 text-sm",children:"Las notificaciones fueron denegadas. Para activarlas, ve a configuraciÃ³n del navegador â†’ Notificaciones â†’ Permitir para este sitio."})]})]})]})}function Qa({onPermissionChange:s,userRole:d="buyer",className:o=""}){const[f,h]=c.useState("default"),[_,k]=c.useState(!1);c.useEffect(()=>{"Notification"in window&&h(Notification.permission)},[]);const u=async()=>{if(!("Notification"in window)){alert("Tu navegador no soporta notificaciones");return}if(f!=="granted"){k(!0);try{const g=await Notification.requestPermission();h(g),g==="granted"?(s==null||s(!0),new Notification("Â¡TRATO Notificaciones Activas!",{body:"Las notificaciones estÃ¡n funcionando correctamente",icon:"/favicon.ico"})):s==null||s(!1)}catch(g){console.error("Error requesting notification permission:",g)}finally{k(!1)}}};return f==="granted"?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-green-700 ${o}`,children:[e.jsx(te,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Notificaciones activas"})]}):e.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${o}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Configurar Notificaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:f==="denied"?"Notificaciones bloqueadas":"Activa las notificaciones para recibir alertas"})]})]}),f!=="denied"&&e.jsx("button",{onClick:u,disabled:_,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:_?"Activando...":"Activar"})]}),f==="denied"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("p",{className:"text-sm text-red-700",children:'Las notificaciones estÃ¡n bloqueadas. Para activarlas, haz clic en el Ã­cono del candado en la barra de direcciones y selecciona "Permitir".'})})]})}function Za(){const{permission:s,supported:d,pushSubscription:o,serviceWorkerReady:f,subscribeToPush:h,sendTestNotification:_}=us(),[k,u]=c.useState(!1),[g,D]=c.useState("idle"),[O,E]=c.useState(""),[i,j]=c.useState(!1),S=async()=>{u(!0),D("idle"),E("");try{await h(),D("success"),E("Â¡Notificaciones activadas correctamente! Ahora recibirÃ¡s todas las notificaciones importantes incluso si la app estÃ¡ cerrada."),setTimeout(()=>{j(!0)},3e3),setTimeout(()=>{_()},1500)}catch(T){D("error"),E(T instanceof Error?T.message:"Error activando notificaciones Push"),console.error("Error activando Push:",T)}finally{u(!1)}},b=d?f?s==="denied"?{bg:"bg-red-100",text:"text-red-800",icon:"ðŸš«"}:o?{bg:"bg-green-100",text:"text-green-800",icon:"âœ…"}:{bg:"bg-blue-100",text:"text-blue-800",icon:"ðŸ””"}:{bg:"bg-yellow-100",text:"text-yellow-800",icon:"â³"}:{bg:"bg-gray-100",text:"text-gray-600",icon:"âš ï¸"};return o&&!O||i||o?null:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ””"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notificaciones Push"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Recibe notificaciones incluso con la app cerrada"})]})]}),e.jsx("div",{className:`${b.bg} ${b.text} rounded-lg p-4 mb-6`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:b.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[!d&&"No soportado en este navegador",d&&!f&&"Cargando sistema...",d&&f&&s==="denied"&&"Permisos denegados",d&&f&&s==="default"&&"Permisos pendientes",o&&"Notificaciones Push activas"]}),e.jsxs("div",{className:"text-sm opacity-90",children:[!d&&"Usa Chrome, Firefox o Edge para recibir notificaciones Push",d&&!f&&"Inicializando Service Worker...",d&&f&&s==="denied"&&"Permite las notificaciones en la configuraciÃ³n del navegador",d&&f&&s==="default"&&'Haz clic en "Activar" para recibir notificaciones',o&&"RecibirÃ¡s notificaciones incluso con la pantalla apagada o la app cerrada"]})]})]})}),O&&e.jsx("div",{className:`rounded-lg p-4 mb-4 ${g==="success"?"bg-green-50 text-green-800":g==="error"?"bg-red-50 text-red-800":"bg-blue-50 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:g==="success"?"âœ…":g==="error"?"âŒ":"â„¹ï¸"}),e.jsx("span",{className:"text-sm",children:O})]})}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:d&&f&&e.jsxs("button",{onClick:S,disabled:k||s==="denied",className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[k?"â³":"ðŸš€",k?"Activando...":"Activar Notificaciones Push"]})}),e.jsxs("div",{className:"mt-6 text-sm text-gray-600",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Beneficios de las Notificaciones Push:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Recibe notificaciones importantes incluso con la app cerrada"}),e.jsx("li",{children:"No te pierdas informaciÃ³n crÃ­tica del negocio"}),e.jsx("li",{children:"Funciona en segundo plano y con otras aplicaciones abiertas"}),e.jsx("li",{children:"Sistema de alertas optimizado para vendedores"})]})]})]})}function Er(){const{user:s,signOut:d}=pe(),{canPerformMainAction:o,refreshStatus:f}=Ls("vendedor"),{notifications:h,unreadCount:_,showNotifications:k,setShowNotifications:u}=qs(),[g,D]=c.useState("dashboard"),[O,E]=c.useState("list"),[i,j]=c.useState([]),[S,P]=c.useState([]),[b,T]=c.useState(!0),[z,J]=c.useState(""),[U,Q]=c.useState(0),[a,m]=c.useState(""),[l,x]=c.useState([]),[n,p]=c.useState(null),[y,A]=c.useState(null),[R,K]=c.useState(!1),[Z,oe]=c.useState({totalProducts:0,dailyProducts:0,totalViews:0,totalSales:0,revenue:0,avgRating:0});c.useEffect(()=>{s&&(me(),xe(),ze(),Ce(),Be(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(r=>{console.log(`ðŸ”” Permisos de notificaciÃ³n: ${r}`),r==="granted"?console.log("âœ… Notificaciones habilitadas para nuevos pedidos"):console.warn("âš ï¸ Notificaciones bloqueadas - solo sonido y alertas visuales")}))},[s]),c.useEffect(()=>{const r=setInterval(()=>{(g==="dashboard"||g==="products")&&xe()},6e4);return()=>clearInterval(r)},[g]);const me=async()=>{try{const{data:r,error:t}=await N.from("products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(t)throw t;j(r||[])}catch(r){console.error("Error loading products:",r),J("Error al cargar productos")}},xe=async()=>{try{const{data:r,error:t}=await N.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(t)throw t;P(r||[])}catch(r){console.error("Error loading daily products:",r),J("Error al cargar productos del dÃ­a")}finally{T(!1)}},ze=async()=>{try{const r=i.length,t=S.length;let w=0,I=0,L=0;try{const{data:$,error:M}=await N.from("orders").select("id").limit(1);if(M)console.log("Orders table not available yet, using default stats");else{const{data:V,error:B}=await N.from("orders").select("id, total, status, created_at").eq("seller_id",s==null?void 0:s.id);!B&&V&&(w=V.length,I=V.filter(se=>se.status==="delivered").reduce((se,je)=>se+(je.total||0),0),console.log(`Loaded ${w} orders, revenue: Q${I}`));try{const{data:se,error:je}=await N.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s==null?void 0:s.id).single();!je&&se?(L=se.average_rating||0,console.log(`ðŸŒŸ Seller rating: ${L} from ${se.total_reviews} reviews`)):console.log("No ratings found for seller, showing 0.0")}catch{console.log("Rating system not available, using 0.0")}}}catch{console.log("Orders system not configured yet, using default stats")}oe({totalProducts:r,dailyProducts:t,totalViews:Math.floor(Math.random()*1e3)+500,totalSales:w,revenue:I,avgRating:L})}catch(r){console.error("Error loading stats:",r),oe({totalProducts:i.length,dailyProducts:S.length,totalViews:0,totalSales:0,revenue:0,avgRating:0})}},Fe=()=>{me(),Ce(),E("list")},Ue=()=>{xe(),Ce(),E("list")},Ve=r=>{p(r),E("edit-product")},De=r=>{A(r),E("edit-daily")},v=()=>{me(),p(null),E("list")},Y=()=>{xe(),A(null),E("list")},Se=async r=>{try{const{error:t}=await N.from("products").delete().eq("id",r);if(t)throw t;me()}catch(t){console.error("Error deleting product:",t),J("Error al eliminar producto")}},Ge=async r=>{try{const{error:t}=await N.from("daily_products").delete().eq("id",r);if(t)throw t;xe()}catch(t){console.error("Error deleting daily product:",t),J("Error al eliminar producto del dÃ­a")}},Be=c.useCallback(async()=>{if(s!=null&&s.id)try{const r=N.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},t=>{console.log("ðŸ”” Nueva orden recibida:",t),Q($=>$+1);const w=t.new,I=new CustomEvent("criticalNotification",{detail:{type:"new_order",message:`ðŸŽ¯ NUEVA ORDEN: Q${w.total||"0.00"} - ${w.notes||"Sin notas"}`,urgency:"high",sound:!0,persist:!0,metadata:{order_id:w.id,total:w.total,buyer_name:w.buyer_name,created_at:w.created_at}}});window.dispatchEvent(I),Notification.permission==="granted"&&new Notification("Â¡Nueva orden en TRATO!",{body:`Tienes un nuevo pedido por Q${w.total||"0.00"}`,icon:"/favicon.ico",tag:"new-order",requireInteraction:!0}),(async()=>{try{await N.from("critical_alerts").insert({alert_type:"new_order",order_id:w.id,user_id:s==null?void 0:s.id,message:`Nueva orden recibida: Q${w.total||"0.00"}`,urgency_level:"high",metadata:{total:w.total,buyer_name:w.buyer_name,notification_sent:!0}})}catch($){console.error("Error logging critical alert:",$)}})(),m(new Date().toISOString())}).subscribe();if(Notification.permission==="default"){const t=await Notification.requestPermission();console.log("Notification permission:",t)}return()=>{r.unsubscribe()}}catch(r){console.error("Error setting up order notifications:",r)}},[s==null?void 0:s.id]),ke=c.useCallback(async()=>{if(s!=null&&s.id)try{const{data:r,error:t}=await N.from("orders").select("id").limit(1);if(!t){const w=new Date().toISOString(),I=`seller_last_notification_${s.id}`,L=localStorage.getItem(I);if(L){const{data:$,error:M}=await N.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).gt("created_at",L).order("created_at",{ascending:!1});!M&&$&&$.length>0&&(Q(V=>V+$.length),localStorage.setItem(I,w),console.log(`ðŸ“¦ Found ${$.length} new orders since ${L}`))}else{const{data:$,error:M}=await N.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).eq("status","pending").order("created_at",{ascending:!1});!M&&$&&$.length>0&&(Q($.length),console.log(`ðŸ“¦ Found ${$.length} pending orders (first check)`)),localStorage.setItem(I,w)}}}catch(r){console.log("ðŸ“¦ Orders table not available for notifications:",r)}},[s==null?void 0:s.id]);c.useEffect(()=>{if(!(s!=null&&s.id))return;ke();const r=setInterval(()=>{ke()},3e4);return()=>clearInterval(r)},[s==null?void 0:s.id]);const Ce=async()=>{try{const r=[];if(i.length>0){const w=i[0];r.push({id:`product-${w.id}`,type:"product",message:`Producto agregado: "${w.name}"`,timestamp:w.created_at,color:"green"})}if(S.length>0){const w=S[0];r.push({id:`daily-${w.id}`,type:"daily_product",message:`Venta del dÃ­a creada: "${w.name}"`,timestamp:w.created_at,color:"orange"})}try{const{data:w,error:I}=await N.from("orders").select("id").limit(1);if(!I){const{data:L,error:$}=await N.from("orders").select("id, status, created_at, total").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1}).limit(3);!$&&L&&L.length>0&&L.forEach(M=>{let V="",B="blue";switch(M.status){case"pending":V=`Nueva orden recibida (Q${M.total})`,B="yellow";break;case"confirmed":V=`Orden confirmada (Q${M.total})`,B="blue";break;case"preparing":V=`Orden en preparaciÃ³n (Q${M.total})`,B="orange";break;case"ready":V=`Orden lista (Q${M.total})`,B="purple";break;case"delivered":V=`Orden entregada (Q${M.total})`,B="green";break;case"cancelled":V=`Orden cancelada (Q${M.total})`,B="red";break;default:V=`Orden ${M.status} (Q${M.total})`,B="blue"}r.push({id:`order-${M.id}`,type:"order",message:V,timestamp:M.created_at,color:B})})}}catch{console.log("Orders table not available for activity")}const t=r.sort((w,I)=>new Date(I.timestamp).getTime()-new Date(w.timestamp).getTime()).slice(0,5);x(t)}catch(r){console.error("Error loading recent activity:",r)}},We=r=>{const t=new Date().getTime(),w=new Date(r).getTime(),I=t-w,L=Math.floor(I/(1e3*60)),$=Math.floor(I/(1e3*60*60)),M=Math.floor(I/(1e3*60*60*24));return L<60?L<=1?"Hace un momento":`Hace ${L} minutos`:$<24?$===1?"Hace 1 hora":`Hace ${$} horas`:M===1?"Ayer":`Hace ${M} dÃ­as`},Ee=()=>{const r=new Date,t=new Date;t.setHours(23,59,59,999);const w=t.getTime()-r.getTime(),I=Math.floor(w/(1e3*60*60)),L=Math.floor(w%(1e3*60*60)/(1e3*60));return`${I}h ${L}m`},Ae=[{id:"dashboard",label:"Inicio",icon:aa,description:"Resumen y estadÃ­sticas"},{id:"products",label:"Productos",icon:ma,description:"Gestiona tu menÃº"},{id:"orders",label:"Pedidos",icon:ba,description:"Ã“rdenes y analytics",hasNotification:U>0,notificationCount:U},{id:"profile",label:"Perfil",icon:es,description:"ConfiguraciÃ³n del negocio"}],$e=()=>e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(G,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dashboard-welcome",style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",color:"white",padding:"24px",borderRadius:"16px",marginBottom:"16px"},children:e.jsx(re,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-2 md:p-3 rounded-xl",children:e.jsx(be,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(X,{className:"text-lg md:text-2xl text-white leading-tight",style:{color:"white",fontSize:"20px"},children:"Â¡Bienvenido, Interlano Fernando Interiano! ðŸ‘‹"}),e.jsx("p",{className:"text-sm md:text-base text-white mt-1",style:{color:"white",fontSize:"16px"},children:"Gestiona tu negocio y conecta con mÃ¡s clientes en GualÃ¡n"})]})]})})}),e.jsxs("div",{className:"dashboard-stats",style:{display:"grid",gridTemplateColumns:window.innerWidth<=768?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:"12px",marginBottom:"16px"},children:[e.jsx(G,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Productos"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Z.totalProducts})]}),e.jsx(ue,{className:"w-6 h-6 md:w-8 md:h-8 text-blue-500"})]})})}),e.jsx(G,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas del DÃ­a"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Z.dailyProducts})]}),e.jsx(ae,{className:"w-6 h-6 md:w-8 md:h-8 text-orange-500"})]})})}),e.jsx(G,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Z.totalSales})]}),e.jsx(zs,{className:"w-6 h-6 md:w-8 md:h-8 text-green-500"})]})})}),e.jsx(G,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"CalificaciÃ³n"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:Z.avgRating.toFixed(1)})]}),e.jsx(ua,{className:"w-6 h-6 md:w-8 md:h-8 text-yellow-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(G,{children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-500"}),"Ingresos del Mes"]})}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["Q",Z.revenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"+12% comparado al mes pasado"})]})]}),e.jsxs(G,{children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ha,{className:"w-5 h-5 text-blue-500"}),"Vistas del Perfil"]})}),e.jsxs(W,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:Z.totalViews.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vistas esta semana"})]})]})]}),e.jsxs(G,{children:[e.jsx(re,{children:e.jsx(X,{children:"Acciones RÃ¡pidas"})}),e.jsx(W,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{onClick:()=>{if(!o()){K(!0);return}D("products"),E("add-product")},className:"h-20 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx(He,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Nuevo Producto"})]})}),e.jsx(C,{onClick:()=>{if(!o()){K(!0);return}D("products"),E("add-daily")},variant:"outline",className:"h-20 border-orange-500 text-orange-600 hover:bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Venta del DÃ­a"})]})}),e.jsx(C,{onClick:()=>D("profile"),variant:"outline",className:"h-20 border-blue-500 text-blue-600 hover:bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Editar Perfil"})]})})]})})]}),e.jsxs(G,{children:[e.jsx(re,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Actividad Reciente"]})}),e.jsx(W,{children:e.jsx("div",{className:"space-y-3",children:l.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay actividad reciente"})]}):l.map(r=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-${r.color}-50 rounded-lg`,children:[e.jsx("div",{className:`w-2 h-2 bg-${r.color}-500 rounded-full`}),e.jsx("p",{className:"text-sm flex-1",children:r.message}),e.jsx("span",{className:"text-xs text-gray-500",children:We(r.timestamp)})]},r.id))})})]})]}),Pe=()=>O==="add-product"?e.jsx(ts,{onSuccess:Fe,onCancel:()=>E("list")}):O==="add-daily"?e.jsx(is,{onSuccess:Ue,onCancel:()=>E("list")}):O==="edit-product"&&n?e.jsx(ts,{product:n,onSuccess:v,onCancel:()=>{p(null),E("list")}}):O==="edit-daily"&&y?e.jsx(is,{dailyProduct:y,onSuccess:Y,onCancel:()=>{A(null),E("list")}}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 leading-tight",children:"GestiÃ³n de Productos"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Administra tu menÃº y ofertas especiales"})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[e.jsxs(C,{onClick:()=>E("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),e.jsxs(C,{onClick:()=>E("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Venta del DÃ­a"]})]})]}),e.jsxs(Qe,{defaultValue:"products",className:"space-y-6",children:[e.jsxs(Ze,{className:"grid w-full grid-cols-2 h-auto p-1 bg-gray-100 rounded-lg",children:[e.jsxs(he,{value:"products",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ue,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos Normales"}),e.jsx("span",{className:"sm:hidden",children:"Normales"}),e.jsxs("span",{className:"ml-1",children:["(",i.length,")"]})]}),e.jsxs(he,{value:"daily",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos del DÃ­a"}),e.jsx("span",{className:"sm:hidden",children:"Del DÃ­a"}),e.jsxs("span",{className:"ml-1",children:["(",S.length,")"]})]})]}),e.jsx(le,{value:"products",className:"space-y-4",children:b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{className:"w-8 h-8 animate-spin text-gray-400"})}):i.length===0?e.jsx(G,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(W,{className:"p-8 md:p-12 text-center",children:[e.jsx(ue,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos aÃºn"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Comienza agregando tu primer producto para empezar a vender"}),e.jsxs(C,{onClick:()=>E("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Agregar Primer Producto"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:i.map(r=>e.jsx(Da,{product:r,onEdit:Ve,onDelete:Se},r.id))})}),e.jsxs(le,{value:"daily",className:"space-y-4",children:[S.length>0&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-orange-800 text-sm sm:text-base",children:"Tiempo restante:"})]}),e.jsx("span",{className:"font-bold text-orange-800 text-sm sm:text-base",children:Ee()})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Los productos del dÃ­a se eliminan automÃ¡ticamente a las 23:59:59"})]}),b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{className:"w-8 h-8 animate-spin text-gray-400"})}):S.length===0?e.jsx(G,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(W,{className:"p-8 md:p-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos del dÃ­a"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Crea ofertas especiales que duran solo hasta medianoche"}),e.jsxs(C,{onClick:()=>E("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Crear Venta del DÃ­a"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:S.map(r=>e.jsx(Aa,{dailyProduct:r,onEdit:De,onDelete:Ge},r.id))})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx(Qa,{onPermissionChange:r=>{console.log("ðŸ”” Permisos de notificaciÃ³n cambiados:",r)}})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"TRATO Vendedor"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Panel de control empresarial"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"outline",onClick:()=>u(!k),className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px] relative",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Notificaciones"}),_>0&&e.jsx(ee,{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs px-1 min-w-[16px] h-4 flex items-center justify-center",children:_>9?"9+":_})]}),e.jsxs(C,{variant:"outline",onClick:d,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(da,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar SesiÃ³n"}),e.jsx("span",{className:"sm:hidden",children:"Salir"})]})]})]})})}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[z&&e.jsxs(ce,{variant:"destructive",className:"mb-4 md:mb-6",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(de,{className:"text-sm md:text-base",children:z})]}),e.jsx(Ha,{userRole:"vendedor",onOpenVerification:()=>K(!0)}),e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(Ja,{})}),(s==null?void 0:s.role)==="vendedor"&&e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(Za,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-4 gap-1",children:Ae.map(r=>{const t=r.icon,w=g===r.id;return e.jsxs("button",{onClick:()=>{D(r.id),r.id==="orders"&&Q(0)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:w?"#fef3c7":"transparent",color:w?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"w-5 h-5"}),r.hasNotification&&r.notificationCount&&r.notificationCount>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#ef4444",color:"white",fontSize:"10px",borderRadius:"50%",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 2s infinite"},children:r.notificationCount>9?"9+":r.notificationCount})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:r.label})]},r.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(Qe,{value:g,onValueChange:r=>D(r),className:"space-y-6",children:[e.jsx(Ze,{className:"grid w-full grid-cols-4 lg:w-2/3 mx-auto bg-white border border-gray-200",children:Ae.map(r=>{const t=r.icon;return e.jsxs(he,{value:r.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",onClick:()=>{r.id==="orders"&&Q(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"w-5 h-5"}),r.hasNotification&&r.notificationCount&&r.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:r.notificationCount>9?"9+":r.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:r.label})]},r.id)})}),e.jsx(le,{value:"dashboard",className:"space-y-6",children:$e()}),e.jsx(le,{value:"products",className:"space-y-6",children:Pe()}),e.jsx(le,{value:"orders",className:"space-y-6",children:e.jsx(ls,{})}),e.jsx(le,{value:"profile",className:"space-y-6",children:e.jsx(ns,{})})]})}),e.jsxs("div",{className:"block md:hidden mt-4",children:[g==="dashboard"&&$e(),g==="products"&&Pe(),g==="orders"&&e.jsx(ls,{}),g==="profile"&&e.jsx(ns,{})]})]}),e.jsx(Ea,{open:R,onOpenChange:K,children:e.jsxs(As,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx($s,{children:e.jsxs(Os,{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"VerificaciÃ³n de Perfil y UbicaciÃ³n"})]})}),e.jsx(Wa,{userRole:"vendedor",onVerificationComplete:()=>{K(!1),f()}})]})}),e.jsx(Rs,{onNewOrder:()=>{g==="orders"&&window.location.reload()}}),e.jsx(ra,{})]})}export{Er as SellerDashboard};
