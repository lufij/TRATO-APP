import{g as pe,u as fe,r as c,j as e,B as k,C as B,a as ie,b as Y,c as W,X as Ee,L as le,f as se,d as Se,s as w,i as os,I as Me,E as Es,q as ls,e as ne,v as cs,t as q,R as we,N as Ps,p as ds,w as Ts,x as Is,y as As,z as Ds}from"./index-CMQSa8yz.js";import{A as me,a as ue}from"./alert-ADXcdOtS.js";import{P as xe,D as Qe,T as He,a as Je,b as je,d as de,M as $s,c as Os}from"./MobileToastNotifications-5jTh_0M5.js";import{I as H}from"./input-9jmcj1iX.js";import{T as Ze}from"./textarea-loyysrbF.js";import{L as z}from"./label-Comn-FNu.js";import{S as Ms,a as Ls,b as qs,c as zs,d as Rs}from"./select-B8eZWN4T.js";import{A as ms}from"./arrow-left-CfkH9j52.js";import{U as us}from"./upload-BdJoGr9f.js";import{S as qe}from"./save-CTK6nBIg.js";import{C as re}from"./clock-JVAcdKFo.js";import{T as gs,F as Fs,g as Us,f as Vs,S as Gs,B as Bs,R as Ws,u as Hs,H as Js,O as Qs,P as Be}from"./OnlineDriversIndicator-BeYu1RRz.js";import{A as xs,a as ps,b as hs,c as fs,d as bs,e as js,f as vs,g as Ns,h as ys}from"./alert-dialog-DBg4b1Mm.js";import{E as Zs}from"./eye-off-BGh2hrw7.js";import{T as ws}from"./trash-2-CsraTkE0.js";import{C as Ks,a as ve,P as Le,M as Xs,N as Oe}from"./phone-lrdNLNaV.js";import{S as Ne}from"./store-DiExwC23.js";import{I as es}from"./info-DK4hgP_q.js";import{M as ce}from"./map-pin-CHt0jj9s.js";import{T as Pe}from"./truck-DByps556.js";import{M as Ys}from"./mail-9ww5O7L3.js";import{G as ss}from"./globe-BpCY_ELD.js";import{T as ke}from"./triangle-alert-ClJTYrz6.js";import{C as _e}from"./circle-x-yd-geWeE.js";import{E as ea}from"./external-link-DUgtHFKg.js";import{U as Ke}from"./user-CCa_ntek.js";import{L as sa}from"./log-out-D-pXRxSU.js";import{S as aa}from"./shopping-bag-BrrDSi30.js";import{S as ra}from"./star-O2LQ7rwY.js";import"./shopping-cart-CPYsUIKv.js";import"./users-Be9MetxZ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],ia=pe("bell-ring",ta);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],oa=pe("chart-column",na);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ca=pe("clipboard-list",la);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],ma=pe("facebook",da);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],_s=pe("hash",ua);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ss=pe("image",ga);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],pa=pe("instagram",xa);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],fa=pe("message-square",ha);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Xe=pe("pen",ba),ja=["Alimentos","Bebidas","Ropa","Electrónicos","Hogar","Belleza","Deportes","Libros","Juguetes","Mascotas","Salud","Herramientas","Jardín","Música","Arte","Otros"];function as({product:s,onSuccess:f,onCancel:u}){const{user:j}=fe(),[d,_]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.category)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||"",is_public:(s==null?void 0:s.is_public)!==!1}),[S,i]=c.useState(null),[p,L]=c.useState((s==null?void 0:s.image_url)||""),[I,F]=c.useState(!1),[n,b]=c.useState(!1),[E,C]=c.useState(""),v=c.useRef(null),P=a=>{var l;const o=(l=a.target.files)==null?void 0:l[0];if(o){if(!o.type.startsWith("image/")){C("Por favor selecciona una imagen válida");return}if(o.size>5*1024*1024){C("La imagen debe ser menor a 5MB");return}i(o),C("");const m=new FileReader;m.onload=r=>{var x;L((x=r.target)==null?void 0:x.result)},m.readAsDataURL(o)}},R=async a=>{var o;b(!0);try{const{data:{session:l}}=await w.auth.getSession();if(!((o=l==null?void 0:l.user)!=null&&o.id))throw new Error("No autorizado - sesión inválida");const m=a.name.split(".").pop(),x=`products/${`${l.user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${m}`}`;for(let y=0;y<3;y++)try{const{error:A}=await w.storage.from("products").upload(x,a,{cacheControl:"3600",upsert:!0});if(A){if(A.message.includes("JWT")||A.message.includes("token")){await w.auth.refreshSession();continue}throw A}const{data:O}=w.storage.from("products").getPublicUrl(x);if(!O.publicUrl)throw new Error("No se pudo obtener la URL pública");return O.publicUrl}catch(A){if(y===2)throw A;await new Promise(O=>setTimeout(O,1e3));continue}throw new Error("No se pudo subir la imagen después de 3 intentos")}catch(l){throw console.error("Error uploading image:",l),new Error("Error al subir la imagen: "+l.message)}finally{b(!1)}},Z=async a=>{try{const o=a.split("/"),l=o[o.length-3],m=o[o.length-2],r=o[o.length-1],x=`${m}/${r}`;l==="products"&&await w.storage.from("products").remove([x])}catch(o){console.error("Error deleting old image:",o)}},U=async a=>{if(a.preventDefault(),C(""),!d.name.trim()){C("El nombre del producto es requerido");return}if(!d.price||parseFloat(d.price.toString())<=0){C("El precio debe ser mayor a 0");return}if(!d.category){C("Selecciona una categoría");return}if(!d.stock_quantity||parseInt(d.stock_quantity.toString())<0){C("La cantidad debe ser mayor a 0");return}if(!s&&!S&&!p){C("Selecciona una imagen para el producto");return}F(!0);try{let o=(s==null?void 0:s.image_url)||"";S&&(o=await R(S),s!=null&&s.image_url&&await Z(s.image_url));const l={name:d.name.trim(),description:d.description.trim(),price:parseFloat(d.price.toString())||0,category:d.category,stock_quantity:parseInt(d.stock_quantity.toString())||1,is_public:d.is_public,image_url:o,seller_id:j==null?void 0:j.id};if(s){const{error:m}=await w.from("products").update(l).eq("id",s.id);if(m)throw m}else{const{error:m}=await w.from("products").insert([l]);if(m)throw m}f()}catch(o){console.error("Error saving product:",o),C(o.message||"Error al guardar el producto")}finally{F(!1)}},ee=()=>{i(null),L(""),v.current&&(v.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:u,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto":"Agregar Producto"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica la información de tu producto":"Crea un nuevo producto para tu tienda"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Información del Producto"]})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{children:"Imagen del Producto *"}),p?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:p,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:ee,children:e.jsx(Ee,{className:"w-4 h-4"})}),n&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-500 transition-colors",onClick:()=>{var a;return(a=v.current)==null?void 0:a.click()},children:[e.jsx(Ss,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, WEBP hasta 5MB"})]}),e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:P,className:"hidden"}),!p&&e.jsxs(k,{type:"button",variant:"outline",onClick:()=>{var a;return(a=v.current)==null?void 0:a.click()},className:"w-full",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:d.name,onChange:a=>_({...d,name:a.target.value}),placeholder:"Ej: Manzanas Rojas Orgánicas",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"description",children:"Descripción"}),e.jsx(Ze,{id:"description",value:d.description,onChange:a=>_({...d,description:a.target.value}),placeholder:"Describe las características y beneficios de tu producto...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"price",children:"Precio (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:d.price,onChange:a=>_({...d,price:a.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:d.stock_quantity,onChange:a=>_({...d,stock_quantity:a.target.value}),placeholder:"1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Categoría *"}),e.jsxs(Ms,{onValueChange:a=>_({...d,category:a}),children:[e.jsx(Ls,{children:e.jsx(qs,{placeholder:d.category||"Selecciona una categoría"})}),e.jsx(zs,{children:ja.map(a=>e.jsx(Rs,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{children:"Visibilidad"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(k,{type:"button",variant:d.is_public?"default":"outline",onClick:()=>_({...d,is_public:!0}),className:"flex-1",children:["Público",d.is_public&&e.jsx(se,{variant:"secondary",className:"ml-2",children:"Activo"})]}),e.jsxs(k,{type:"button",variant:d.is_public?"outline":"default",onClick:()=>_({...d,is_public:!1}),className:"flex-1",children:["Privado",!d.is_public&&e.jsx(se,{variant:"secondary",className:"ml-2",children:"Activo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Los productos públicos aparecen en el catálogo general. Los privados solo los ves tú."})]}),E&&e.jsxs(me,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{children:E})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:u,className:"flex-1",disabled:I||n,children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:I||n,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:I?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Producto"]})})]})]})})]})})]})}function rs({dailyProduct:s,onSuccess:f,onCancel:u}){const{user:j}=fe(),[d,_]=c.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:s!=null&&s.price?String(s.price):"",stock_quantity:s!=null&&s.stock_quantity?String(s.stock_quantity):""}),[S,i]=c.useState(null),[p,L]=c.useState((s==null?void 0:s.image_url)||""),[I,F]=c.useState(!1),[n,b]=c.useState(!1),[E,C]=c.useState(""),v=c.useRef(null),P=()=>{const l=new Date;return new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59,59,999).toISOString()},R=()=>{const l=new Date,m=new Date;m.setHours(23,59,59,999);const r=m.getTime()-l.getTime(),x=Math.floor(r/(1e3*60*60)),y=Math.floor(r%(1e3*60*60)/(1e3*60));return`${x}h ${y}m`},Z=l=>{var r;const m=(r=l.target.files)==null?void 0:r[0];if(m){if(!m.type.startsWith("image/")){C("Por favor selecciona una imagen válida");return}if(m.size>5*1024*1024){C("La imagen debe ser menor a 5MB");return}i(m),C("");const x=new FileReader;x.onload=y=>{var A;L((A=y.target)==null?void 0:A.result)},x.readAsDataURL(m)}},U=async l=>{b(!0);try{const m=new Date().toISOString().split("T")[0],r=l.name.split(".").pop(),y=`daily-products/${`${j==null?void 0:j.id}/${m}/${Date.now()}.${r}`}`,{error:A}=await w.storage.from("products").upload(y,l,{cacheControl:"3600",upsert:!1});if(A)throw A;const{data:O}=w.storage.from("products").getPublicUrl(y);return O.publicUrl}catch(m){throw console.error("Error uploading image:",m),new Error("Error al subir la imagen: "+m.message)}finally{b(!1)}},ee=async l=>{try{const m=l.split("/"),r=m.findIndex(x=>x==="products");if(r!==-1){const y=m.slice(r+1).join("/");await w.storage.from("products").remove([y])}}catch(m){console.error("Error deleting old image:",m)}},a=async l=>{if(l.preventDefault(),C(""),!d.name.trim()){C("El nombre del producto es requerido");return}if(parseFloat(d.price)<=0){C("El precio debe ser mayor a 0");return}if(parseInt(d.stock_quantity)<0){C("La cantidad no puede ser negativa");return}if(!s&&!S&&!p){C("Selecciona una imagen para el producto");return}if(new Date().getHours()>=23){C("Es muy tarde para crear productos del día. Inténtalo mañana temprano.");return}F(!0);try{let x=(s==null?void 0:s.image_url)||"";S&&(x=await U(S),s!=null&&s.image_url&&await ee(s.image_url));const y={name:d.name.trim(),description:d.description.trim(),price:parseFloat(d.price)||0,stock_quantity:parseInt(d.stock_quantity)||0,image_url:x,seller_id:j==null?void 0:j.id,expires_at:P()};if(s){const{error:A}=await w.from("daily_products").update(y).eq("id",s.id);if(A)throw A}else{const{error:A}=await w.from("daily_products").insert([y]);if(A)throw A}f()}catch(x){console.error("Error saving daily product:",x),C(x.message||"Error al guardar el producto del día")}finally{F(!1)}},o=()=>{i(null),L(""),v.current&&(v.current.value="")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:u,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-2 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s?"Editar Producto del Día":"Tu Venta del Día"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Modifica tu oferta especial":"Crea una oferta especial que dura hasta medianoche"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-800",children:["Tiempo restante: ",R()]})]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Este producto se eliminará automáticamente a las 23:59:59 de hoy. Las imágenes también se eliminarán del servidor."})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Información del Producto del Día"]})}),e.jsx(W,{children:e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{children:"Imagen del Producto *"}),p?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:p,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:o,children:e.jsx(Ee,{className:"w-4 h-4"})}),n&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Subiendo imagen..."})]})}),e.jsxs(se,{variant:"destructive",className:"absolute bottom-2 left-2",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Expira a medianoche"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-orange-300 rounded-lg p-8 text-center cursor-pointer hover:border-orange-500 transition-colors bg-orange-50",onClick:()=>{var l;return(l=v.current)==null?void 0:l.click()},children:[e.jsx(Ss,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-sm text-orange-600",children:"PNG, JPG, WEBP hasta 5MB"}),e.jsx(se,{variant:"outline",className:"mt-2 border-orange-300 text-orange-700",children:"Se elimina automáticamente"})]}),e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:Z,className:"hidden"}),!p&&e.jsxs(k,{type:"button",variant:"outline",onClick:()=>{var l;return(l=v.current)==null?void 0:l.click()},className:"w-full border-orange-300 text-orange-600 hover:bg-orange-50",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Seleccionar Imagen"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"name",children:"Nombre del Producto *"}),e.jsx(H,{id:"name",value:d.name,onChange:l=>_({...d,name:l.target.value}),placeholder:"Ej: Combo Especial del Día",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"description",children:"Descripción"}),e.jsx(Ze,{id:"description",value:d.description,onChange:l=>_({...d,description:l.target.value}),placeholder:"Describe tu oferta especial del día...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"price",children:"Precio Especial (Q) *"}),e.jsx(H,{id:"price",type:"number",step:"0.01",min:"0",value:d.price,onChange:l=>_({...d,price:l.target.value}),placeholder:"0.00",required:!0}),e.jsx("p",{className:"text-xs text-orange-600",children:"Precio especial válido solo hoy"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"stock",children:"Cantidad Disponible"}),e.jsx(H,{id:"stock",type:"number",min:"0",value:d.stock_quantity,onChange:l=>_({...d,stock_quantity:l.target.value}),placeholder:"0"}),e.jsx("p",{className:"text-xs text-orange-600",children:"¡Solo por hoy!"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-orange-800 mb-2 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Características de Productos del Día"]}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Se elimina automáticamente a las 23:59:59"}),e.jsx("li",{children:'• Aparece marcado como "Oferta del Día" en el catálogo'}),e.jsx("li",{children:"• Las imágenes se almacenan en carpeta temporal"}),e.jsx("li",{children:"• Ideal para ofertas especiales y productos perecederos"})]})]}),E&&e.jsxs(me,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{children:E})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:u,className:"flex-1",disabled:I||n,children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:I||n,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:I?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),s?"Actualizar":"Crear"," Venta del Día"]})})]})]})})]})]})]})}function va({product:s,onEdit:f,onDelete:u}){const[j,d]=c.useState(!1),{openImageModal:_}=os(),S=p=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(p),i=p=>new Date(p).toLocaleDateString("es-GT",{day:"numeric",month:"short",year:"numeric"});return e.jsxs(B,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border border-gray-200",style:{backgroundColor:"white"},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-gray-100",children:j?e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xe,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sin imagen"})]})}):e.jsx(Me,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>d(!0),expandable:!0,onExpand:_})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(se,{variant:s.is_public?"default":"secondary",className:"text-xs font-medium",style:{backgroundColor:s.is_public?"#22c55e":"#6b7280",color:"white",border:"none"},children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"w-3 h-3 mr-1"}),"Público"]}):e.jsxs(e.Fragment,{children:[e.jsx(Zs,{className:"w-3 h-3 mr-1"}),"Privado"]})})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(se,{variant:"destructive",className:"text-xs font-medium",style:{backgroundColor:"#ef4444",color:"white",border:"none"},children:"Sin stock"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(se,{variant:"outline",className:"text-xs font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.95)",color:"#374151",border:"1px solid #d1d5db"},children:s.category})})]}),e.jsx(W,{className:"p-3 md:p-4",style:{backgroundColor:"white"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1 text-sm md:text-base",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-sm md:text-lg text-green-600",children:S(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"w-3 h-3 md:w-4 md:h-4 text-gray-500 flex-shrink-0"}),e.jsxs("span",{className:"text-xs md:text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Creado el ",i(s.created_at)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>f(s),className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#d1d5db",color:"#374151"},children:[e.jsx(Xe,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(xs,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"flex-1",style:{minHeight:"36px",fontSize:"12px",fontWeight:"600",borderColor:"#fecaca",color:"#dc2626",backgroundColor:"white"},children:[e.jsx(ws,{className:"w-3 h-3 mr-1"}),"Eliminar"]})}),e.jsxs(hs,{children:[e.jsxs(fs,{children:[e.jsx(bs,{children:"¿Eliminar producto?"}),e.jsxs(js,{children:['Esta acción no se puede deshacer. El producto "',s.name,'" se eliminará permanentemente de tu tienda.']})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(ys,{onClick:()=>u(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})})]})}function Na({dailyProduct:s,onEdit:f,onDelete:u}){const[j,d]=c.useState(!1),[_,S]=c.useState(""),[i,p]=c.useState(!1),{openImageModal:L}=os();c.useEffect(()=>{const n=()=>{const E=Us(s.expires_at);S(E.formattedTime),p(E.isExpired)};n();const b=setInterval(n,1e3);return()=>clearInterval(b)},[s.expires_at]);const I=n=>new Intl.NumberFormat("es-GT",{style:"currency",currency:"GTQ",minimumFractionDigits:2}).format(n),F=n=>Vs(n);return e.jsxs(B,{className:"group hover:shadow-lg transition-all duration-200 overflow-hidden border-orange-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden",children:j?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-red-100 flex items-center justify-center",children:e.jsx(re,{className:"w-12 h-12 text-orange-400"})}):e.jsx(Me,{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",onError:()=>d(!0),expandable:!0,onExpand:L})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(se,{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs",children:[e.jsx(Fs,{className:"w-3 h-3 mr-1"}),"Oferta del Día"]})}),s.stock_quantity===0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(se,{variant:"destructive",className:"text-xs",children:"Agotado"})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(se,{variant:i?"destructive":"secondary",className:`text-xs ${i?"bg-red-500 text-white":"bg-white/90 backdrop-blur-sm text-orange-700"}`,children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),_]})})]}),e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-1",title:s.name,children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:I(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_s,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.stock_quantity," disponible"]})]})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-orange-700",children:["Creado a las ",F(s.created_at)]}),e.jsxs("span",{className:"text-orange-700 font-medium",children:["Expira: ",F(s.expires_at)]})]})}),!i&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-orange-600 font-medium",children:["⏰ Se elimina automáticamente en ",_]})}),i&&e.jsx("div",{className:"text-center bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-xs text-red-700 font-medium",children:"❌ Este producto ha expirado y será eliminado pronto"})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>f(s),className:"flex-1 border-orange-300 text-orange-600 hover:bg-orange-50",disabled:i,children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(xs,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ws,{className:"w-4 h-4 mr-1"}),"Eliminar"]})}),e.jsxs(hs,{children:[e.jsxs(fs,{children:[e.jsx(bs,{children:"¿Eliminar producto del día?"}),e.jsxs(js,{children:['Esta acción no se puede deshacer. El producto "',s.name,'" se eliminará permanentemente de tu tienda y su imagen del servidor.',!i&&e.jsxs("span",{className:"block mt-2 text-orange-600 font-medium",children:["Nota: Este producto se eliminará automáticamente en ",_," de todas formas."]})]})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(ys,{onClick:()=>u(s.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar Ahora"})]})]})]})]})]})})]})}const $e={north:15.2,south:15,east:-89.3,west:-89.5};function ya(){var s,f;try{return(f=(s=import.meta)==null?void 0:s.env)==null?void 0:f.VITE_GOOGLE_MAPS_API_KEY}catch{return}}function wa(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")?"Safari":s.includes("edge")?"Edge":"tu navegador"}function _a(){const[s,f]=c.useState(!1),[u,j]=c.useState(null),[d,_]=c.useState(null),S=c.useCallback(()=>{j(null)},[]),i=c.useCallback((n,b)=>n>=$e.south&&n<=$e.north&&b>=$e.west&&b<=$e.east,[]),p=c.useCallback(async()=>{try{if("permissions"in navigator&&"query"in navigator.permissions){const n=await navigator.permissions.query({name:"geolocation"});return _(n.state),n.state}return _("prompt"),"prompt"}catch(n){return console.warn("Could not check geolocation permissions:",n),_("prompt"),"prompt"}},[]),L=c.useCallback(async()=>{try{const n=await new Promise(b=>{navigator.geolocation.getCurrentPosition(()=>b(!0),E=>{console.log("Permission request result:",E.code,E.message),b(E.code!==E.PERMISSION_DENIED)},{timeout:1e3,maximumAge:0})});return n&&await p(),n}catch(n){return console.error("Error requesting permissions:",n),!1}},[p]),I=c.useCallback(async(n,b)=>{try{j(null);const E=ya();if(E&&typeof fetch<"u")try{const C=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${n},${b}&key=${E}&language=es&region=GT`);if(C.ok){const v=await C.json();if(v.status==="OK"&&v.results&&v.results.length>0){const P=v.results[0],R=P.address_components||[];let Z="",U="",ee="",a="";return R.forEach(o=>{const l=o.types||[];l.includes("locality")||l.includes("administrative_area_level_2")?Z=o.long_name||"":l.includes("administrative_area_level_1")?U=o.long_name||"":l.includes("country")?ee=o.long_name||"":l.includes("postal_code")&&(a=o.long_name||"")}),{latitude:n,longitude:b,address:P.formatted_address||`Ubicación GPS: ${n.toFixed(6)}, ${b.toFixed(6)}`,formatted_address:P.formatted_address||`Coordenadas: ${n.toFixed(6)}, ${b.toFixed(6)}`,city:Z||"Gualán",state:U||"Zacapa",country:ee||"Guatemala",postal_code:a,place_id:P.place_id}}}}catch(C){console.warn("Google Maps API request failed, using fallback:",C)}return{latitude:n,longitude:b,address:`Gualán, Zacapa, Guatemala (${n.toFixed(6)}, ${b.toFixed(6)})`,formatted_address:`Ubicación GPS verificada en Gualán: ${n.toFixed(6)}, ${b.toFixed(6)}`,city:"Gualán",state:"Zacapa",country:"Guatemala"}}catch(E){return console.error("Error in reverse geocoding:",E),{latitude:n,longitude:b,address:`Gualán, Zacapa, Guatemala (${n.toFixed(6)}, ${b.toFixed(6)})`,formatted_address:`Ubicación GPS: ${n.toFixed(6)}, ${b.toFixed(6)}`,city:"Gualán",state:"Zacapa",country:"Guatemala"}}},[]),F=c.useCallback(async()=>new Promise((n,b)=>{if(f(!0),j(null),!(navigator!=null&&navigator.geolocation)){const v=`❌ Geolocalización no disponible

Tu navegador no soporta geolocalización GPS. 

✅ Soluciones:
• Usa un navegador moderno (Chrome, Firefox, Safari, Edge)
• Verifica que estés usando HTTPS (no HTTP)
• Intenta desde un dispositivo móvil
• Actualiza tu navegador a la versión más reciente`;console.error("Geolocation not supported"),j(v),f(!1),b(new Error(v));return}const E={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5},C=wa();navigator.geolocation.getCurrentPosition(async v=>{try{const{latitude:P,longitude:R}=v.coords,Z=v.coords.accuracy;if(console.log(`📍 GPS Location obtained: ${P.toFixed(6)}, ${R.toFixed(6)} (accuracy: ${Z}m)`),!i(P,R)){const ee=`🗺️ Ubicación fuera del área de servicio

📍 Coordenadas detectadas: ${P.toFixed(4)}, ${R.toFixed(4)}
🏢 Área de servicio: Gualán, Zacapa

⚠️ Posibles causas:
• Tu negocio no está en Gualán, Zacapa
• El GPS no es preciso (intenta ir al aire libre)
• Estás usando VPN que cambia tu ubicación

✅ Si tu negocio SÍ está en Gualán:
• Ve al exterior para mejor señal GPS
• Desactiva VPN si usas una
• Espera unos segundos y vuelve a intentar
• La ubicación se guardará aunque esté fuera del área estimada`;console.warn(`Location validation failed: lat=${P}, lng=${R}, accuracy=${Z}m`),j(ee),f(!1),b(new Error(ee));return}const U=await I(P,R);console.log("✅ Location successfully processed:",U),f(!1),n(U)}catch(P){console.error("Error processing location:",P);const R=P instanceof Error?P.message:"Error al procesar la ubicación detectada";j(R),f(!1),b(P)}},v=>{console.error("Geolocation error details:",{code:v.code,message:v.message,PERMISSION_DENIED:v.PERMISSION_DENIED,POSITION_UNAVAILABLE:v.POSITION_UNAVAILABLE,TIMEOUT:v.TIMEOUT});let P="Error al detectar la ubicación";switch(v.code){case v.PERMISSION_DENIED:P=`🚫 Permiso de ubicación denegado

📱 SOLUCIÓN RÁPIDA para ${C}:

🔒 **Método 1 - Ícono de ubicación:**
1. Busca el ícono 🔒 o 🌐 en la barra de direcciones
2. Haz clic en él
3. Cambia "Ubicación" de "Bloqueado" a "Permitir"
4. Recarga la página

⚙️ **Método 2 - Configuración del navegador:**
• Chrome: Configuración → Privacidad → Configuración del sitio → Ubicación
• Firefox: Preferencias → Privacidad → Permisos → Ubicación  
• Safari: Preferencias → Sitios web → Ubicación
• Edge: Configuración → Permisos del sitio → Ubicación

📍 **¿Por qué necesitamos tu ubicación?**
Los repartidores necesitan las coordenadas GPS exactas de tu negocio para hacer entregas correctas.

🔄 Después de cambiar los permisos, recarga esta página y vuelve a intentar.`;break;case v.POSITION_UNAVAILABLE:P=`📡 Señal GPS no disponible

🛰️ **Posibles causas:**
• Estás en un lugar cerrado (edificio, sótano)
• Señal GPS débil en tu área
• Interferencia de otros dispositivos
• GPS desactivado en el dispositivo

✅ **Soluciones:**
• Ve cerca de una ventana o al aire libre
• Verifica que el GPS esté activado en tu dispositivo
• Espera 1-2 minutos para que mejore la señal
• Intenta desde otro lugar o dispositivo
• Asegúrate de tener conexión a internet estable

📱 En móviles: Configuración → Ubicación → Activar GPS de alta precisión`;break;case v.TIMEOUT:P=`⏰ Tiempo de espera agotado (15 segundos)

🔄 **La detección GPS tardó demasiado:**

📶 **Soluciones rápidas:**
• Ve a un lugar con mejor señal (ventana o exterior)
• Verifica tu conexión a internet
• Reinicia el GPS en tu dispositivo si es móvil
• Cierra otras apps que usen ubicación

🚀 **Inténtalo de nuevo:**
La detección puede ser más rápida en el segundo intento.

💡 **Tip:** En dispositivos móviles, el GPS suele ser más rápido y preciso que en computadoras.`;break;default:P=`❌ Error GPS desconocido

🔧 **Información técnica:**
• Código de error: ${v.code}
• Mensaje: ${v.message}

🛠️ **Soluciones generales:**
• Recarga la página e intenta de nuevo
• Verifica los permisos de ubicación
• Intenta desde otro navegador o dispositivo
• Asegúrate de usar HTTPS (no HTTP)

📧 Si el problema persiste, contacta soporte técnico con esta información.`}console.error("Geolocation error processed:",P),j(P),f(!1),b(new Error(P))},E)}),[i,I]);return c.useEffect(()=>{p()},[p]),{getCurrentLocation:F,reverseGeocode:I,validateLocation:i,checkPermissions:p,requestPermissions:L,loading:s,error:u,permissionState:d,clearError:S}}const Sa={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWRkenlsb3RxZGNrdWJsZmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTU4NjEsImV4cCI6MjA3MTM3MTg2MX0.ktxZ0H7mI9NVdxu48sPd90kqPerSP-vkysQlIM1JpG8",VITE_SUPABASE_URL:"https://deaddzylotqdckublfed.supabase.co"},ks=[{key:"monday",label:"Lunes",short:"Lun"},{key:"tuesday",label:"Martes",short:"Mar"},{key:"wednesday",label:"Miércoles",short:"Mié"},{key:"thursday",label:"Jueves",short:"Jue"},{key:"friday",label:"Viernes",short:"Vie"},{key:"saturday",label:"Sábado",short:"Sáb"},{key:"sunday",label:"Domingo",short:"Dom"}],ka={monday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"18:00"},saturday:{isOpen:!0,openTime:"09:00",closeTime:"17:00"},sunday:{isOpen:!1,openTime:"09:00",closeTime:"15:00"}};function Ca(){try{return!!(import.meta&&Sa&&!1)}catch{return!1}}function Ea(s){const[f,u]=c.useState(()=>{if(s)try{return JSON.parse(s)}catch{console.log("Using default weekly hours")}return ka});return{weeklyHours:f,setWeeklyHours:u,updateWeeklyHours:(S,i,p)=>{u(L=>({...L,[S]:{...L[S],[i]:p}}))},generateWeeklyHoursText:()=>{const S=ks.filter(i=>f[i.key].isOpen);return S.length===0?"Cerrado toda la semana":S.map(i=>{const p=f[i.key];return`${i.short}: ${p.openTime}-${p.closeTime}`}).join(", ")},getHoursAsJSON:()=>JSON.stringify(f)}}function Pa({weeklyHours:s,updateWeeklyHours:f,generateWeeklyHoursText:u}){const[j,d]=c.useState(!1),_=()=>{d(!1)},S=()=>{d(!1)};return e.jsxs(B,{className:"seller-profile",children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ks,{className:"w-5 h-5 text-purple-500"}),"Horarios de Atención"]}),!j&&e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>d(!0),className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Editar Horarios"]})]})}),e.jsx(W,{className:"space-y-4",children:j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Configurar Horarios"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:S,className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Cancelar"]}),e.jsxs(k,{size:"sm",onClick:_,className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Guardar"]})]})]}),e.jsx("div",{className:"space-y-3",children:ks.map(i=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 min-w-[80px]",children:i.label}),e.jsx(ls,{checked:s[i.key].isOpen,onCheckedChange:p=>f(i.key,"isOpen",p)}),e.jsx("span",{className:`text-sm font-medium ${s[i.key].isOpen?"text-green-600":"text-red-600"}`,children:s[i.key].isOpen?"Abierto":"Cerrado"})]})}),s[i.key].isOpen&&e.jsxs("div",{className:"flex items-center gap-4 ml-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-sm whitespace-nowrap",children:"Apertura:"}),e.jsx(H,{type:"time",value:s[i.key].openTime,onChange:p=>f(i.key,"openTime",p.target.value),className:"w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-sm whitespace-nowrap",children:"Cierre:"}),e.jsx(H,{type:"time",value:s[i.key].closeTime,onChange:p=>f(i.key,"closeTime",p.target.value),className:"w-32"})]})]})]},i.key))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Vista previa:"}),e.jsx("p",{className:"text-sm text-blue-800",children:u()})]})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-center",children:"Vista previa de horarios:"}),e.jsx("div",{className:"text-sm text-blue-800 leading-relaxed",children:u()})]})})]})}function Ta(s,f){if(s&&f){const u=`https://www.google.com/maps/@${s},${f},18z`;window.open(u,"_blank")}}function Ia(s){return s.business_name.trim()?null:"El nombre del negocio es requerido"}const We=({active:s,onClick:f,children:u,icon:j})=>e.jsxs("button",{onClick:f,className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 ${s?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:u})]});function ts(){const{user:s}=fe(),{getCurrentLocation:f,loading:u,error:j,permissionState:d,clearError:_}=_a(),[S,i]=c.useState(null),[p,L]=c.useState(!0),[I,F]=c.useState(!1),[n,b]=c.useState(""),[E,C]=c.useState(""),[v,P]=c.useState(!1),[R,Z]=c.useState(!1),[U,ee]=c.useState(!1),[a,o]=c.useState(!1),[l,m]=c.useState(""),[r,x]=c.useState(!1),[y,A]=c.useState(!1),[O,K]=c.useState(!1),[ae,ge]=c.useState("info"),ye=c.useRef(null),Te=c.useRef(null),{weeklyHours:ze,setWeeklyHours:Re,updateWeeklyHours:Fe,generateWeeklyHoursText:Ue,getHoursAsJSON:Ie}=Ea(S==null?void 0:S.business_hours),[N,X]=c.useState({business_name:"",business_description:"",business_logo:"",cover_image_url:"",business_category:"",phone:"",email:"",address:"",latitude:0,longitude:0,delivery_time:30,delivery_radius:5,minimum_order:50,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:{facebook:"",instagram:"",whatsapp:"",website:""}});c.useEffect(()=>{s?be():(i(null),K(!1),L(!1)),x(Ca())},[s]),c.useEffect(()=>{if(!s||!p)return;const h=setTimeout(()=>{L(!1),K(!0)},8e3);return()=>clearTimeout(h)},[s,p]),c.useEffect(()=>{j&&(A(!0),b(""))},[j]);const be=async()=>{var h;try{L(!0);const{data:t,error:T}=await w.from("sellers").select("*").eq("id",s==null?void 0:s.id).single();if(T){const $=T.code,V=((h=T.message)==null?void 0:h.toString().toLowerCase())||"";if($==="PGRST116"||$==="PGRST403"||$==="42501"||$==="PGRST114"||V.includes("permission")||V.includes("rls")||V.includes("forbidden")||V.includes("not authorized"))K(!0);else throw T}if(t){if(i(t),X({business_name:t.business_name||"",business_description:t.business_description||"",business_logo:t.business_logo||"",cover_image_url:t.cover_image_url||"",business_category:t.business_category||"",phone:t.phone||"",email:t.email||"",address:t.address||"",latitude:t.latitude||0,longitude:t.longitude||0,delivery_time:t.delivery_time||30,delivery_radius:t.delivery_radius||5,minimum_order:t.minimum_order||50,is_active:t.is_active!==!1,is_open_now:t.is_open_now||!1,is_accepting_orders:t.is_accepting_orders!==!1,location_verified:t.location_verified||!1,social_media:t.social_media||{facebook:"",instagram:"",whatsapp:"",website:""}}),t.business_hours)try{Re(JSON.parse(t.business_hours))}catch{console.log("Using default weekly hours")}const $=t.latitude&&t.longitude&&Math.abs(t.latitude)>.001&&Math.abs(t.longitude)>.001;o($),$&&m(`${t.latitude.toFixed(6)}, ${t.longitude.toFixed(6)}`)}}catch(t){console.error("Error loading profile:",t),b("Error al cargar el perfil del negocio")}finally{L(!1)}},Ve=async()=>{var h,t,T,$,V;if(s)try{F(!0),b("");const G={business_name:((h=N.business_name)==null?void 0:h.trim())||"Mi Negocio",business_description:((t=N.business_description)==null?void 0:t.trim())||"",business_logo:"",cover_image_url:"",business_category:N.business_category||"",phone:((T=N.phone)==null?void 0:T.trim())||"",email:(($=N.email)==null?void 0:$.trim())||"",address:((V=N.address)==null?void 0:V.trim())||"",latitude:N.latitude||0,longitude:N.longitude||0,business_hours:Ie(),delivery_time:N.delivery_time||30,delivery_radius:N.delivery_radius||5,minimum_order:N.minimum_order||0,is_active:!0,is_open_now:!1,is_accepting_orders:!0,location_verified:!1,social_media:N.social_media,is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:J}=await w.from("sellers").upsert({id:s.id,...G});if(J)throw J;C("✅ Perfil de vendedor creado. Completa la información y guarda los cambios."),K(!1),P(!0),await be(),setTimeout(()=>C(""),4e3)}catch(G){console.error("Error creating minimal seller profile:",G),b("No se pudo crear el perfil de vendedor. Intenta de nuevo.")}finally{F(!1)}},Ge=async()=>{var h,t,T,$,V,G;try{F(!0),b("");const J=Ia(N);if(J){b(J);return}console.log("💾 Guardando perfil con datos:",{business_name:N.business_name,address:N.address,latitude:N.latitude,longitude:N.longitude,business_logo:((h=N.business_logo)==null?void 0:h.substring(0,50))+"...",cover_image_url:((t=N.cover_image_url)==null?void 0:t.substring(0,50))+"..."});const oe={business_name:N.business_name.trim(),business_description:((T=N.business_description)==null?void 0:T.trim())||null,business_category:N.business_category||null,phone:(($=N.phone)==null?void 0:$.trim())||null,email:((V=N.email)==null?void 0:V.trim())||null,address:((G=N.address)==null?void 0:G.trim())||null,latitude:N.latitude||null,longitude:N.longitude||null,business_hours:Ie(),delivery_time:N.delivery_time||30,delivery_radius:N.delivery_radius||5,minimum_order:N.minimum_order||0,is_active:N.is_active,is_open_now:N.is_open_now,location_verified:N.location_verified||!1,social_media:N.social_media||{},business_logo:N.business_logo||null,cover_image_url:N.cover_image_url||null,updated_at:new Date().toISOString()},{error:te}=await w.from("sellers").upsert({id:s==null?void 0:s.id,...oe});if(te)throw console.error("💥 Error al guardar:",te),te;console.log("✅ Perfil guardado exitosamente"),C("✅ Perfil guardado exitosamente"),P(!1),await be(),setTimeout(()=>C(""),4e3)}catch(J){console.error("💥 Error saving profile:",J),b(`Error al guardar el perfil: ${J.message||"Error desconocido"}`)}finally{F(!1)}},Ce=(h,t,T,$=.8)=>new Promise(V=>{const G=document.createElement("canvas"),J=G.getContext("2d"),oe=new Image;oe.onload=()=>{let{width:te,height:he}=oe;te>he?te>t&&(he=he*t/te,te=t):he>T&&(te=te*T/he,he=T),G.width=te,G.height=he,J.drawImage(oe,0,0,te,he),G.toBlob(Ye=>{Ye&&V(Ye)},"image/jpeg",$)},oe.src=URL.createObjectURL(h)}),Ae=async h=>{var T;const t=(T=h.target.files)==null?void 0:T[0];if(!(!t||!s))try{if(Z(!0),b(""),console.log("� SUBIENDO LOGO:",t.name),!t.type.startsWith("image/")){b("Solo imágenes permitidas");return}const $=await Ce(t,400,400,.9),V=`${s.id}/logo-${Date.now()}.jpg`;console.log("📤 Subiendo a business-logos...");const{error:G}=await w.storage.from("business-logos").upload(V,$,{upsert:!0});if(G){console.error("❌ Error upload:",G),b(`Error subiendo: ${G.message}`);return}const{data:J}=w.storage.from("business-logos").getPublicUrl(V);console.log("🔗 URL generada:",J.publicUrl);const{error:oe}=await w.from("sellers").upsert({id:s.id,business_logo:J.publicUrl,business_name:N.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(oe){console.error("❌ Error BD:",oe),b(`Error guardando: ${oe.message}`);return}console.log("✅ LOGO GUARDADO EXITOSAMENTE"),X(te=>({...te,business_logo:J.publicUrl})),C("✅ Logo guardado correctamente"),setTimeout(()=>C(""),3e3)}catch($){console.error("💥 ERROR COMPLETO:",$),b(`Error: ${$.message}`)}finally{Z(!1)}},De=async h=>{var T;const t=(T=h.target.files)==null?void 0:T[0];if(!(!t||!s))try{if(Z(!0),b(""),console.log("� SUBIENDO PORTADA:",t.name),!t.type.startsWith("image/")){b("Solo imágenes permitidas");return}const $=await Ce(t,1200,400,.9),V=`${s.id}/cover-${Date.now()}.jpg`;console.log("📤 Subiendo a business-covers...");const{error:G}=await w.storage.from("business-covers").upload(V,$,{upsert:!0});if(G){console.error("❌ Error upload:",G),b(`Error subiendo: ${G.message}`);return}const{data:J}=w.storage.from("business-covers").getPublicUrl(V);console.log("🔗 URL generada:",J.publicUrl);const{error:oe}=await w.from("sellers").upsert({id:s.id,cover_image_url:J.publicUrl,business_name:N.business_name||"Mi Negocio",updated_at:new Date().toISOString()},{onConflict:"id"});if(oe){console.error("❌ Error BD:",oe),b(`Error guardando: ${oe.message}`);return}console.log("✅ PORTADA GUARDADA EXITOSAMENTE"),X(te=>({...te,cover_image_url:J.publicUrl})),C("✅ Portada guardada correctamente"),setTimeout(()=>C(""),3e3)}catch($){console.error("💥 ERROR COMPLETO:",$),b(`Error: ${$.message}`)}finally{Z(!1)}},g=async()=>{try{b(""),A(!1),_();const h=await f();X(t=>({...t,latitude:h.latitude,longitude:h.longitude})),o(!0),m(`${h.latitude.toFixed(6)}, ${h.longitude.toFixed(6)}`),C(`🎯 ¡Ubicación GPS verificada exitosamente!
      
️ Ciudad: ${h.city}, ${h.state}
📊 Coordenadas: ${h.latitude.toFixed(6)}, ${h.longitude.toFixed(6)}
      
✅ Los repartidores podrán encontrar tu negocio fácilmente.
📝 Ahora escribe la dirección de tu negocio en el campo correspondiente.

🔔 No olvides guardar el perfil para mantener estos cambios.`)}catch(h){console.error("Error detecting location:",h),A(!0)}},M=()=>{A(!1),_(),g()},D=()=>{A(!1),_()},Q=async()=>{const h=!N.is_open_now;try{const{error:t}=await w.from("sellers").update({is_open_now:h,updated_at:new Date().toISOString()}).eq("id",s==null?void 0:s.id);if(t)throw t;X(T=>({...T,is_open_now:h})),C(h?"🟢 ¡Negocio ABIERTO! Ahora apareces en el listado de compradores":"🔴 Negocio CERRADO. No aparecerás en el listado hasta que abras"),setTimeout(()=>C(""),4e3)}catch(t){console.error("Error updating business status:",t),b("Error al actualizar el estado del negocio")}};return p?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"w-10 h-10 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Cargando tu perfil de negocio..."})]})}):!p&&O?e.jsx("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:e.jsxs(B,{className:"text-center shadow-lg border-none",children:[e.jsxs(ie,{children:[e.jsx(Y,{children:"¡Bienvenido, Vendedor!"}),e.jsx("p",{className:"text-gray-600",children:"Parece que aún no has configurado tu perfil. ¡Es el primer paso para empezar a vender!"})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Crearemos un perfil básico para ti. Podrás editar y completar toda la información más adelante."}),e.jsxs(k,{onClick:Ve,disabled:I,size:"lg",className:"w-full sm:w-auto",children:[I?e.jsx(le,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Crear Mi Perfil Ahora"]})]})]})}):e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil de Negocio"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestiona la información que ven tus clientes."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>P(!v),children:v?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"})," Editar"]})}),v&&e.jsxs(k,{onClick:Ge,disabled:I,children:[I?e.jsx(le,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})]})]})}),n&&e.jsxs(me,{variant:"destructive",className:"mb-6 flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{className:"whitespace-pre-line",children:n})]}),E&&e.jsxs(me,{className:"mb-6 border-green-200 bg-green-50 text-green-800 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-green-800 whitespace-pre-line",children:E})]}),!r&&e.jsxs(me,{className:"mb-6 border-blue-200 bg-blue-50",children:[e.jsx(cs,{className:"h-4 w-4 text-blue-600"}),e.jsxs(ue,{className:"text-blue-800",children:[e.jsx("strong",{children:"Sistema GPS:"})," Funcionando con detección básica. Para direcciones más detalladas, puedes configurar Google Maps API (opcional).",e.jsx("br",{}),e.jsx("small",{children:"Ver: /GOOGLE_MAPS_SETUP_OPCIONAL.md"})]})]}),e.jsxs(B,{className:"w-full overflow-hidden shadow-lg border-none",children:[e.jsxs("div",{className:"relative h-40 sm:h-56 bg-gradient-to-r from-blue-500 to-purple-600",children:[N.cover_image_url?e.jsx(Me,{src:N.cover_image_url,alt:"Portada del negocio",className:"w-full h-full object-cover",width:800,height:200}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-2 opacity-70"}),e.jsx("p",{className:"text-sm opacity-90",children:"Imagen de portada"}),v&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:"Cualquier imagen se optimizará automáticamente"})]})}),v&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var h;return(h=Te.current)==null?void 0:h.click()},children:[e.jsxs(k,{variant:"secondary",disabled:R,children:[R?e.jsx(le,{className:"w-4 h-4 animate-spin"}):e.jsx(ve,{className:"w-4 h-4 mr-2"}),N.cover_image_url?"Cambiar Portada":"Agregar Portada"]}),e.jsx("input",{ref:Te,type:"file",accept:"image/*",className:"hidden",onChange:De})]})]}),e.jsx("div",{className:"relative px-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-16 sm:-mt-12",children:[e.jsxs("div",{className:"relative h-32 w-32 rounded-full border-4 border-white bg-gradient-to-br from-green-400 to-blue-500 shadow-md flex items-center justify-center",children:[N.business_logo?e.jsx(Me,{src:N.business_logo,alt:"Logo del negocio",className:"w-full h-full object-cover rounded-full"}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-1"}),v&&e.jsx("p",{className:"text-xs opacity-80",children:"Logo - Auto-optimizado"})]}),v&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var h;return(h=ye.current)==null?void 0:h.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white/90 rounded-full flex items-center justify-center",children:R?e.jsx(le,{className:"w-5 h-5 animate-spin text-slate-800"}):e.jsx(ve,{className:"w-5 h-5 text-slate-800"})}),e.jsx("input",{ref:ye,type:"file",accept:"image/*",className:"hidden",onChange:Ae})]})]}),e.jsxs("div",{className:"mt-4 sm:ml-6 text-center sm:text-left",children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:N.business_name}),(S==null?void 0:S.is_verified)&&e.jsx(Bs,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-gray-500",children:N.business_category})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-auto",children:e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium ${N.is_open_now?"bg-green-500 text-white":"bg-gray-400 text-white"}`,children:[e.jsx("span",{children:N.is_open_now?"Abierto":"Cerrado"}),e.jsx(ls,{checked:N.is_open_now,onCheckedChange:Q,className:"h-3 w-5 scale-75"})]})})]})}),e.jsx("div",{className:"px-6 mt-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 -mb-px overflow-x-auto",children:[e.jsx(We,{active:ae==="info",onClick:()=>ge("info"),icon:es,children:"Información"}),e.jsx(We,{active:ae==="location",onClick:()=>ge("location"),icon:ce,children:"Ubicación"}),e.jsx(We,{active:ae==="delivery",onClick:()=>ge("delivery"),icon:Pe,children:"Delivery"})]})}),e.jsxs(W,{className:"p-6",children:[ae==="info"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"w-5 h-5 text-green-500"})," Información Básica"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"business_name",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ne,{className:"w-4 h-4 text-green-500"}),"Nombre del Negocio"]}),e.jsx(H,{id:"business_name",value:N.business_name,onChange:h=>X(t=>({...t,business_name:h.target.value})),disabled:!v,placeholder:"Mi Negocio",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs(z,{htmlFor:"business_description",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(es,{className:"w-4 h-4 text-purple-500"}),"Descripción (opcional)"]}),e.jsx(Ze,{id:"business_description",value:N.business_description,onChange:h=>X(t=>({...t,business_description:h.target.value})),disabled:!v,rows:3,placeholder:"Cuéntales a tus clientes sobre tu negocio...",className:"border-gray-200 focus:border-purple-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs(Y,{className:"flex items-center gap-2 mb-4",children:[e.jsx(Le,{className:"w-5 h-5 text-blue-500"})," Contacto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Le,{className:"w-4 h-4 text-green-500"}),"Teléfono"]}),e.jsx(H,{id:"phone",value:N.phone,onChange:h=>X(t=>({...t,phone:h.target.value})),disabled:!v,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ys,{className:"w-4 h-4 text-blue-500"}),"Email (opcional)"]}),e.jsx(H,{id:"email",type:"email",value:N.email,onChange:h=>X(t=>({...t,email:h.target.value})),disabled:!v,placeholder:"contacto@negocio.com",className:"border-gray-200 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsxs(Y,{className:"flex items-center gap-2 mb-4",children:[e.jsx(ss,{className:"w-5 h-5 text-purple-500"})," Redes Sociales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"whatsapp",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Xs,{className:"w-4 h-4 text-green-500"})," WhatsApp"]}),e.jsx(H,{id:"whatsapp",value:N.social_media.whatsapp,onChange:h=>X(t=>({...t,social_media:{...t.social_media,whatsapp:h.target.value}})),disabled:!v,placeholder:"+502 1234-5678",className:"border-gray-200 focus:border-green-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"facebook",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ma,{className:"w-4 h-4 text-blue-600"})," Facebook"]}),e.jsx(H,{id:"facebook",value:N.social_media.facebook,onChange:h=>X(t=>({...t,social_media:{...t.social_media,facebook:h.target.value}})),disabled:!v,placeholder:"@mi_negocio",className:"border-gray-200 focus:border-blue-500"})]})]}),v&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"+ Más redes sociales (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"instagram",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(pa,{className:"w-4 h-4 text-pink-500"})," Instagram"]}),e.jsx(H,{id:"instagram",value:N.social_media.instagram,onChange:h=>X(t=>({...t,social_media:{...t.social_media,instagram:h.target.value}})),placeholder:"@mi_negocio",className:"border-gray-200 focus:border-pink-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"website",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-500"})," Sitio Web"]}),e.jsx(H,{id:"website",value:N.social_media.website,onChange:h=>X(t=>({...t,social_media:{...t.social_media,website:h.target.value}})),placeholder:"www.mi-negocio.com",className:"border-gray-200 focus:border-gray-500"})]})]})]})]})]}),ae==="location"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Ubicación del Negocio"}),a&&e.jsx(ne,{className:"w-5 h-5 text-green-500"})]}),y&&j&&e.jsxs(me,{variant:"destructive",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsxs(ue,{className:"flex flex-col gap-3",children:[e.jsx("span",{children:j}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:M,className:"bg-white hover:bg-gray-50",children:[e.jsx(Ws,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),e.jsxs(k,{size:"sm",variant:"ghost",onClick:D,className:"text-red-800 hover:bg-red-50",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Cerrar"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(z,{htmlFor:"address",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500"}),"Dirección"]}),e.jsx(H,{id:"address",value:N.address,onChange:h=>X(t=>({...t,address:h.target.value})),disabled:!v,placeholder:"Dirección de tu negocio",className:"border-gray-200 focus:border-red-500"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"GPS Automático"})]}),a&&e.jsx(ne,{className:"w-5 h-5 text-green-500"})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-green-700 bg-green-100 p-3 rounded-md",children:["✅ ",e.jsx("strong",{children:"Ubicación verificada"}),e.jsx("br",{}),"📍 ",l]}),v&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:g,disabled:u,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[u?e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),e.jsxs(k,{onClick:()=>Ta(N.latitude,N.longitude),variant:"outline",size:"sm",disabled:!N.latitude||!N.longitude,children:[e.jsx(ea,{className:"w-4 h-4 mr-2"}),"Ver Mapa"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Detecta tu ubicación para que los repartidores te encuentren fácilmente"}),v&&e.jsxs(k,{onClick:g,disabled:u,className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:[u?e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4 mr-2"}),u?"Detectando...":"Detectar Mi Ubicación"]}),d==="denied"&&e.jsxs(me,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(ke,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(ue,{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"GPS bloqueado."})," Haz clic en 🔒 en la barra del navegador para permitir ubicación."]})]})]})]})]})]}),e.jsx("div",{children:e.jsx(Pa,{weeklyHours:ze,updateWeeklyHours:Fe,generateWeeklyHoursText:Ue})})]}),ae==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-orange-500"})," Configuración de Delivery"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"w-5 h-5 text-orange-500"}),e.jsx(z,{htmlFor:"delivery_time",className:"text-sm font-medium",children:"Tiempo de Preparación"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_time",type:"number",value:N.delivery_time,onChange:h=>X(t=>({...t,delivery_time:parseInt(h.target.value)||0})),disabled:!v,min:"5",max:"120",className:"border-gray-200 focus:border-orange-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-500"}),e.jsx(z,{htmlFor:"delivery_radius",className:"text-sm font-medium",children:"Radio de Entrega"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"delivery_radius",type:"number",value:N.delivery_radius,onChange:h=>X(t=>({...t,delivery_radius:parseInt(h.target.value)||0})),disabled:!v,min:"1",max:"20",className:"border-gray-200 focus:border-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"km"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-500"}),e.jsx(z,{htmlFor:"minimum_order",className:"text-sm font-medium",children:"Pedido Mínimo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Q"}),e.jsx(H,{id:"minimum_order",type:"number",value:N.minimum_order,onChange:h=>X(t=>({...t,minimum_order:parseInt(h.target.value)||0})),disabled:!v,min:"0",className:"border-gray-200 focus:border-green-500"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500 bg-gray-50 p-3 rounded-lg",children:"💡 Estos valores ayudan a los clientes a saber qué esperar de tu servicio"})]})]})]})]})})}async function Aa(s){try{const{data:{user:f}}=await w.auth.getUser();if(!f)throw new Error("Usuario no autenticado");console.log(`🚀 Intentando aceptar orden ${s}...`);const{data:u,error:j}=await w.rpc("seller_accept_order",{p_order_id:s,p_seller_id:f.id});return j?(console.error("❌ Error:",j),{success:!1,error:j.message}):(console.log("✅ Resultado:",u),{success:!0,data:u})}catch(f){return console.error("💥 Error:",f),{success:!1,error:f instanceof Error?f.message:"Error desconocido"}}}const Da={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-purple-100 text-purple-800",assigned:"bg-indigo-100 text-indigo-800",picked_up:"bg-green-100 text-green-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},is={pending:"Pendiente",accepted:"Aceptado",confirmed:"Confirmado",preparing:"Preparando",ready:"Listo",assigned:"Asignado",picked_up:"Recogido",in_transit:"En camino",delivered:"Entregado",completed:"Completado",cancelled:"Cancelado",rejected:"Rechazado"};function ns(){const{user:s}=fe(),[f,u]=c.useState([]),[j,d]=c.useState(!0),[_,S]=c.useState(!1),[i,p]=c.useState(new Set),[L,I]=c.useState("pending");c.useEffect(()=>{s!=null&&s.id&&(n(),F())},[s==null?void 0:s.id]);const F=()=>{if(!(s!=null&&s.id))return;const a=w.channel("seller-orders-management").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},()=>{n()}).subscribe();return()=>{a.unsubscribe()}},n=async()=>{u([]);try{const{data:a,error:o}=await w.from("orders").select(`
          *,
          order_items (
            id,
            product_name,
            quantity,
            unit_price,
            product_image,
            notes
          ),
          users!orders_buyer_id_fkey (
            name,
            phone
          ),
          drivers:users!orders_driver_id_fkey (
            name
          )
        `).eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(o)throw o;console.log("📊 Órdenes cargadas:",(a==null?void 0:a.length)||0),console.log("📋 Datos de órdenes:",a);const l=(a==null?void 0:a.map(m=>{var r,x,y;return console.log(`🔍 Orden ${m.order_number}:`,{id:m.id,status:m.status,delivery_type:m.delivery_type,buyer_id:m.buyer_id}),{...m,buyer_id:m.buyer_id,buyer_name:((r=m.users)==null?void 0:r.name)||"Cliente",buyer_phone:(x=m.users)==null?void 0:x.phone,driver_name:(y=m.drivers)==null?void 0:y.name,items:m.order_items||[]}}))||[];u(l)}catch(a){console.error("Error loading orders:",a),q.error("Error al cargar las órdenes")}finally{d(!1),S(!1)}},b=()=>{S(!0),n()},E=async a=>{console.log(`🧪 Probando aceptar orden directa: ${a}`);const o=await Aa(a);console.log("📊 Resultado:",o),o.success?(q.success("Orden aceptada exitosamente!"),n()):q.error(`Error: ${o.error}`)},C=async a=>{if(!i.has(a)){p(o=>new Set([...o,a]));try{console.log(`🎯 Marcando orden como lista: ${a}`);let o,l;try{console.log("🔄 Intento 1: seller_mark_ready_improved");const m=await w.rpc("seller_mark_ready_improved",{p_order_id:a,p_seller_id:s==null?void 0:s.id});o=m.data,l=m.error,!l&&o&&console.log("✅ Éxito con función mejorada")}catch{console.log("⚠️ Función mejorada falló, probando segura...");try{console.log("🔄 Intento 2: seller_mark_ready_safe");const r=await w.rpc("seller_mark_ready_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});o=r.data,l=r.error,!l&&o&&console.log("✅ Éxito con función segura")}catch{console.log("⚠️ Función segura falló, probando básica...");try{console.log("🔄 Intento 3: seller_mark_ready_basic");const x=await w.rpc("seller_mark_ready_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});o=x.data,l=x.error,!l&&o&&console.log("✅ Éxito con función básica")}catch(x){throw console.error("💥 Todos los métodos fallaron:",x),new Error("No se pudo marcar la orden como lista")}}}if(l){console.error("❌ Error RPC:",l),q.error(`Error: ${l.message}`);return}if(console.log("✅ Resultado final:",o),o&&o.length>0){const m=o[0];m.success?(q.success(m.message),n()):q.error(m.message)}else q.success("Orden marcada como lista"),n()}catch(o){console.error("💥 Error en handleMarcarListo:",o),q.error("Error al marcar orden como lista")}finally{p(o=>{const l=new Set(o);return l.delete(a),l})}}},v=async a=>{if(!i.has(a)){p(o=>new Set([...o,a]));try{console.log(`📦 Completando orden pickup/dine-in: ${a}`);let o,l;try{console.log("🔄 Intento 1: seller_mark_completed_pickup");const m=await w.rpc("seller_mark_completed_pickup",{p_order_id:a,p_seller_id:s==null?void 0:s.id});o=m.data,l=m.error,!l&&o&&console.log("✅ Éxito con función completa")}catch{console.log("⚠️ Función completa falló, probando segura...");try{console.log("🔄 Intento 2: seller_mark_completed_pickup_safe");const r=await w.rpc("seller_mark_completed_pickup_safe",{p_order_id:a,p_seller_id:s==null?void 0:s.id});o=r.data,l=r.error,!l&&o&&console.log("✅ Éxito con función segura")}catch{console.log("⚠️ Función segura falló, probando básica...");try{console.log("🔄 Intento 3: seller_mark_completed_pickup_basic");const x=await w.rpc("seller_mark_completed_pickup_basic",{p_order_id:a,p_seller_id:s==null?void 0:s.id});o=x.data,l=x.error,!l&&o&&console.log("✅ Éxito con función básica")}catch(x){throw console.error("💥 Todos los métodos fallaron:",x),new Error("No se pudo completar la orden pickup/dine-in")}}}if(l){console.error("❌ Error RPC:",l),q.error(`Error: ${l.message}`);return}if(console.log("✅ Resultado final:",o),o&&o.length>0){const m=o[0];m.success?(q.success(m.message),n()):q.error(m.message)}else q.success("Orden completada exitosamente"),n()}catch(o){console.error("💥 Error en handleCompletarPickup:",o),q.error("Error al completar la orden")}finally{p(o=>{const l=new Set(o);return l.delete(a),l})}}},P=async(a,o)=>{var r,x;if(i.has(a))return;const m={confirmed:"accepted",preparing:"ready",ready:"ready",delivered:"delivered",cancelled:"cancelled"}[o];p(y=>new Set([...y,a]));try{let y;if(m==="accepted"&&(y=await w.rpc("seller_accept_order",{p_order_id:a,p_seller_id:s==null?void 0:s.id})),y&&(y.error||y.data&&y.data[0]&&!y.data[0].success)){const O=((r=y.error)==null?void 0:r.message)||((x=y.data[0])==null?void 0:x.message)||"Error al actualizar el estado";console.error("RPC error:",O),q.error(O),p(K=>{const ae=new Set(K);return ae.delete(a),ae});return}const A=f.find(O=>O.id===a);if(A&&m==="accepted"){await w.from("notifications").insert({user_id:A.buyer_id,order_id:A.id,message:`Tu orden #${A.order_number} ha sido aceptada.`,type:"order_accepted"}),console.log("🔄 Orden aceptada, actualizando stock...");const{data:O,error:K}=await w.from("order_items").select("product_id, daily_product_id, quantity, product_name, product_type").eq("order_id",a);if(K)console.error("❌ Error obteniendo items de la orden:",K),q.error("Orden aceptada pero error al actualizar stock");else if(O&&O.length>0){console.log("📦 Items encontrados:",O.length),O.forEach((ge,ye)=>{console.log(`   ${ye+1}. ${ge.product_name} - Cantidad: ${ge.quantity} - Tipo: ${ge.product_type}`)}),console.log("🚀 Llamando updateProductStock...");const ae=await Hs(O,a);console.log("📊 Resultado del stock manager:",ae),ae.success?(console.log("✅ Stock actualizado exitosamente:",ae.updatedProducts),q.success("Orden aceptada y stock actualizado")):(console.error("❌ Error actualizando stock:",ae.message),q.error(`Orden aceptada pero ${ae.message}`))}else console.log("⚠️ No se encontraron items en la orden"),q.success("Orden aceptada (sin items para actualizar stock)")}q.success(`Orden actualizada a ${is[m]||m}.`),n(),p(O=>{const K=new Set(O);return K.delete(a),K})}catch(y){console.error("Error updating order status:",y),q.error("Error al actualizar el estado de la orden")}finally{p(y=>{const A=new Set(y);return A.delete(a),A})}},R=async(a,o)=>{if(!i.has(a)){p(l=>new Set([...l,a]));try{const{error:l}=await w.from("orders").update({status:"rejected",rejection_reason:o,updated_at:new Date().toISOString()}).eq("id",a);if(l)throw l;const m=f.find(r=>r.id===a);m&&await w.from("notifications").insert({user_id:m.buyer_id,order_id:m.id,message:`Tu orden #${m.order_number} fue rechazada.`,type:"order_rejected"}),q.success("Orden rechazada"),n()}catch(l){console.error("Error rejecting order:",l),q.error("Error al rechazar la orden")}finally{p(l=>{const m=new Set(l);return m.delete(a),m})}}},Z=a=>{try{return new Date(a).toLocaleString("es-GT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha inválida"}},U=a=>a==="active"?f.filter(o=>["accepted","ready","assigned","picked_up","in_transit"].includes(o.status)):a==="completed"?f.filter(o=>["delivered","completed"].includes(o.status)):a==="cancelled"?f.filter(o=>["cancelled","rejected"].includes(o.status)):f.filter(o=>o.status===a),ee=a=>{const o=i.has(a.id);return console.log(`🎨 Renderizando orden ${a.order_number}:`,{id:a.id,status:a.status,delivery_type:a.delivery_type,buyer_id:a.buyer_id,isProcessing:o,orderObject:a}),console.log(`❓ Status actual: "${a.status}" (tipo: ${typeof a.status})`),console.log(`❓ Delivery type actual: "${a.delivery_type}" (tipo: ${typeof a.delivery_type})`),console.log(`❓ ¿Status === 'pending'? ${a.status==="pending"}`),console.log(`❓ ¿Delivery type === 'delivery'? ${a.delivery_type==="delivery"}`),console.log(`❓ ¿Status incluye pending? ${String(a.status).includes("pending")}`),console.log(`❓ ¿Delivery incluye delivery? ${String(a.delivery_type).includes("delivery")}`),e.jsxs(B,{className:"border-l-4 border-l-orange-500",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"text-lg",children:["Orden #",a.order_number]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Z(a.created_at)})]}),e.jsx(se,{className:Da[a.status],children:is[a.status]})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.buyer_name}),a.buyer_phone&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-4 h-4 text-gray-500 ml-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.buyer_phone})]})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"?"bg-blue-50 border-blue-300":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"bg-green-50 border-green-300":"bg-blue-50 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?e.jsx(Pe,{className:"w-8 h-8 text-blue-600"}):String(a.delivery_type||"").trim().toLowerCase()==="pickup"?e.jsx(xe,{className:"w-8 h-8 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-xl font-bold ${String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"text-blue-800":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"text-green-800":"text-orange-800"}`,children:String(a.delivery_type||"").trim().toLowerCase()==="delivery"||!a.delivery_type?"SERVICIO A DOMICILIO":String(a.delivery_type||"").trim().toLowerCase()==="pickup"?"RECOGER EN TIENDA":"COMER EN EL LUGAR"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Método de entrega: ",a.delivery_type||"No especificado"]})]})]})}),a.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:a.delivery_address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Productos:"}),a.items.map((l,m)=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[e.jsxs("span",{children:[l.quantity,"x ",l.product_name]}),e.jsxs("span",{className:"font-medium",children:["Q",(l.quantity*l.unit_price).toFixed(2)]})]},m))]}),a.notes&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fa,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Notas:"}),e.jsx("p",{className:"text-sm text-blue-700",children:a.notes})]})]})}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["Q",a.total.toFixed(2)]})]}),a.delivery_fee>0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Incluye Q",a.delivery_fee.toFixed(2)," de entrega"]})]}),a.driver_name&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Repartidor: ",a.driver_name]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[String(a.status).trim().toLowerCase()==="pending"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:()=>E(a.id),disabled:i.has(a.id),className:"flex-1 bg-green-600 hover:bg-green-700",children:[i.has(a.id)?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Aceptar Orden"]}),e.jsxs(k,{onClick:()=>R(a.id,"No disponible"),disabled:i.has(a.id),variant:"destructive",size:"lg",className:"px-6 bg-red-600 hover:bg-red-700 text-white border-red-600",style:{backgroundColor:"#dc2626",borderColor:"#dc2626"},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})}),a.status==="accepted"&&e.jsxs(k,{onClick:()=>C(a.id),disabled:i.has(a.id),className:"w-full bg-purple-600 hover:bg-purple-700",children:[i.has(a.id)?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Marcar Orden Lista"]}),a.status==="ready"&&e.jsxs("div",{className:"space-y-3",children:[(a.delivery_type==="delivery"||!a.delivery_type)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Orden lista para recoger"}),e.jsx("p",{className:"text-sm text-blue-600",children:"El repartidor recogerá y entregará esta orden"})]})]})}),(a.delivery_type==="pickup"||a.delivery_type==="dine-in")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${a.delivery_type==="pickup"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.delivery_type==="pickup"?e.jsx(xe,{className:"w-6 h-6 text-green-600"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M17 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M6 12h.01"}),e.jsx("path",{d:"M18 12h.01"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.delivery_type==="pickup"?"text-green-800":"text-orange-800"}`,children:a.delivery_type==="pickup"?"Cliente debe recoger en tienda":"Cliente consume en el lugar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Marcar como entregado cuando el cliente complete la orden"})]})]})}),e.jsxs(k,{onClick:()=>v(a.id),disabled:i.has(a.id),className:"w-full bg-green-600 hover:bg-green-700",children:[i.has(a.id)?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),a.delivery_type==="pickup"?"Marcar como Recogido":"Marcar como Servido"]})]})]}),a.status==="delivered"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:()=>P(a.id,"confirmed"),disabled:o,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[o?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Re-procesar"]}),e.jsxs(k,{onClick:()=>R(a.id,"Orden rechazada"),disabled:o,variant:"destructive",size:"lg",className:"px-6",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Rechazar"]})]})]})]})]},a.id)};return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{className:"border-orange-200 shadow-lg",children:e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-500"}),"Gestión de Órdenes"]}),e.jsxs(k,{variant:"outline",onClick:b,disabled:_,size:"sm",children:[_?e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(we,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})})}),e.jsxs(He,{value:L,onValueChange:I,children:[e.jsxs(Je,{className:"grid w-full grid-cols-4",children:[e.jsxs(je,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Pendientes",U("pending").length>0&&e.jsx(se,{variant:"destructive",className:"ml-1 px-1.5 py-0.5 text-xs",children:U("pending").length})]}),e.jsxs(je,{value:"active",className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Activas",U("active").length>0&&e.jsx(se,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:U("active").length})]}),e.jsxs(je,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Completadas"]}),e.jsxs(je,{value:"cancelled",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Canceladas"]})]}),e.jsx(de,{value:"pending",className:"space-y-4",children:U("pending").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(Se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay órdenes pendientes"})]})}):U("pending").map(ee)}),e.jsx(de,{value:"active",className:"space-y-4",children:U("active").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay órdenes activas"})]})}):U("active").map(ee)}),e.jsx(de,{value:"completed",className:"space-y-4",children:U("completed").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay órdenes completadas"})]})}):U("completed").map(ee)}),e.jsx(de,{value:"cancelled",className:"space-y-4",children:U("cancelled").length===0?e.jsx(B,{children:e.jsxs(W,{className:"text-center py-8",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay órdenes canceladas"})]})}):U("cancelled").map(ee)})]})]})}function $a({userRole:s,onVerificationComplete:f}){const{user:u}=fe(),[j,d]=c.useState({latitude:null,longitude:null,address:""}),[_,S]=c.useState({latitude:null,longitude:null,address:""}),[i,p]=c.useState({phone:"",profileImage:"",coverImage:"",vehicleType:"",licenseNumber:""}),[L,I]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1}),[F,n]=c.useState(!1),[b,E]=c.useState(!1);c.useEffect(()=>{u&&C()},[u]);const C=async()=>{if(u)try{const{data:r,error:x}=await w.from("users").select("*").eq("id",u.id).single();if(x)throw x;if(r&&(d({latitude:r.latitude,longitude:r.longitude,address:r.address||""}),p({phone:r.phone||"",profileImage:r.profile_image_url||"",coverImage:r.cover_image_url||"",vehicleType:r.vehicle_type||"",licenseNumber:r.license_number||""}),I(y=>({...y,locationVerified:r.location_verified||!1,profileCompleted:r.profile_completed||!1}))),s==="vendedor"){const{data:y,error:A}=await w.from("sellers").select("*").eq("user_id",u.id).single();y&&(S({latitude:y.business_latitude,longitude:y.business_longitude,address:y.business_address||""}),p(O=>({...O,coverImage:y.cover_image_url||""})),I(O=>({...O,businessLocationVerified:y.business_location_verified||!1,canPublish:y.can_publish_products||!1})))}}catch(r){console.error("Error loading user data:",r),q.error("Error al cargar datos del usuario")}},v=async()=>{if(!navigator.geolocation){q.error("Tu navegador no soporta geolocalización");return}E(!0),navigator.geolocation.getCurrentPosition(async r=>{const{latitude:x,longitude:y}=r.coords;try{const A=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${y},${x}.json?access_token=`);if(A.ok){const O=await A.json();O.features&&O.features.length>0&&d(K=>({...K,latitude:x,longitude:y}))}else d(O=>({...O,latitude:x,longitude:y}));q.success("Ubicación obtenida correctamente")}catch(A){console.error("Error getting address:",A),d(O=>({...O,latitude:x,longitude:y})),q.success("Ubicación obtenida (sin dirección)")}finally{E(!1)}},r=>{console.error("Geolocation error:",r),E(!1),q.error("No se pudo obtener tu ubicación. Verifica los permisos del navegador.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},P=async()=>{if(!u||!j.latitude||!j.longitude){q.error("Primero obtén tu ubicación");return}n(!0);try{const{error:r}=await w.rpc("update_user_location",{user_id:u.id,lat:j.latitude,lng:j.longitude,user_address:j.address});if(r)throw r;I(x=>({...x,locationVerified:!0})),q.success("Ubicación personal verificada"),await U()}catch(r){console.error("Error saving location:",r),q.error("Error al guardar ubicación")}finally{n(!1)}},R=async()=>{if(!u||!_.latitude||!_.longitude){q.error("Primero obtén la ubicación del negocio");return}n(!0);try{const{error:r}=await w.rpc("update_business_location",{seller_user_id:u.id,lat:_.latitude,lng:_.longitude,business_addr:_.address});if(r)throw r;I(x=>({...x,businessLocationVerified:!0})),q.success("Ubicación del negocio verificada"),await U()}catch(r){console.error("Error saving business location:",r),q.error("Error al guardar ubicación del negocio")}finally{n(!1)}},Z=async()=>{if(u){n(!0);try{const r={phone:i.phone,profile_image_url:i.profileImage,updated_at:new Date().toISOString()};s==="repartidor"&&(r.vehicle_type=i.vehicleType,r.license_number=i.licenseNumber);const{error:x}=await w.from("users").update(r).eq("id",u.id);if(x)throw x;if(s==="vendedor"&&i.coverImage){const{error:y}=await w.from("sellers").update({cover_image_url:i.coverImage}).eq("user_id",u.id);if(y)throw y}q.success("Perfil actualizado"),await U()}catch(r){console.error("Error updating profile:",r),q.error("Error al actualizar perfil")}finally{n(!1)}}},U=async()=>{if(u)try{let r=!1;if(s==="vendedor"){const{data:x,error:y}=await w.rpc("check_seller_can_publish",{seller_user_id:u.id});y||(r=x)}else if(s==="comprador"){const{data:x,error:y}=await w.rpc("check_buyer_can_purchase",{buyer_user_id:u.id});y||(r=x)}else if(s==="repartidor"){const{data:x,error:y}=await w.rpc("check_driver_can_work",{driver_user_id:u.id});y||(r=x)}I(x=>({...x,canPublish:s==="vendedor"?r:x.canPublish,canPurchase:s==="comprador"?r:x.canPurchase,canWork:s==="repartidor"?r:x.canWork})),r&&f&&f()}catch(r){console.error("Error checking verification status:",r)}},ee=()=>{const r=[{name:"Teléfono",completed:!!i.phone,icon:Le},{name:"Ubicación verificada",completed:L.locationVerified,icon:ce}];return s==="vendedor"?[...r,{name:"Foto de perfil",completed:!!i.profileImage,icon:ve},{name:"Foto de portada",completed:!!i.coverImage,icon:ve},{name:"Ubicación del negocio",completed:L.businessLocationVerified,icon:ce}]:s==="repartidor"?[...r,{name:"Tipo de vehículo",completed:!!i.vehicleType&&i.vehicleType!=="No especificado",icon:Oe},{name:"Número de licencia",completed:!!i.licenseNumber&&i.licenseNumber!=="No especificado",icon:ve}]:r},a=()=>s==="vendedor"&&L.canPublish?{message:"¡Puedes publicar productos!",type:"success"}:s==="comprador"&&L.canPurchase?{message:"¡Puedes realizar compras!",type:"success"}:s==="repartidor"&&L.canWork?{message:"¡Puedes tomar órdenes!",type:"success"}:{message:"Completa todos los requisitos",type:"warning"},o=ee(),l=o.filter(r=>r.completed).length,m=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center space-x-2",children:[m.type==="success"?e.jsx(ne,{className:"w-5 h-5 text-green-500"}):e.jsx(ke,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{children:"Estado de Verificación"})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${m.type==="success"?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:[e.jsx("p",{className:`font-medium ${m.type==="success"?"text-green-800":"text-orange-800"}`,children:m.message}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[l," de ",o.length," requisitos completados"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:o.map(r=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded border",children:[e.jsx(r.icon,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:r.name}),r.completed?e.jsx(ne,{className:"w-4 h-4 text-green-500 ml-auto"}):e.jsx(_e,{className:"w-4 h-4 text-red-500 ml-auto"})]},r.name))})]})})]}),e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{children:"Ubicación Personal"}),L.locationVerified&&e.jsx(se,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Dirección"}),e.jsx(H,{value:j.address,onChange:r=>d(x=>({...x,address:r.target.value})),placeholder:"Tu dirección",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(k,{onClick:v,disabled:b,className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50",variant:"outline",style:{borderColor:"#2563eb",color:"#2563eb",backgroundColor:"white",fontWeight:"600"},children:b?"Obteniendo...":"Obtener Ubicación Actual"})})]}),j.latitude&&j.longitude&&e.jsx("div",{className:"p-3 bg-gray-50 rounded border",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas: ",j.latitude,", ",j.longitude]})}),e.jsx(k,{onClick:P,disabled:F||!j.latitude||!j.longitude,className:"w-full",children:F?"Guardando...":"Verificar Ubicación Personal"})]})]}),s==="vendedor"&&e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Ubicación del Negocio"}),L.businessLocationVerified&&e.jsx(se,{variant:"default",className:"bg-green-500",children:"Verificada"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Dirección del Negocio"}),e.jsx(H,{value:_.address,onChange:r=>S(x=>({...x,address:r.target.value})),placeholder:"Dirección de tu negocio",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(k,{onClick:()=>{v(),j.latitude&&j.longitude&&S(r=>({...r,latitude:j.latitude,longitude:j.longitude}))},disabled:b,className:"w-full",variant:"outline",children:"Usar Ubicación Actual"})})]}),e.jsx(k,{onClick:R,disabled:F||!_.latitude||!_.longitude,className:"w-full",children:F?"Guardando...":"Verificar Ubicación del Negocio"})]})]}),e.jsxs(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{children:"Información del Perfil"})]})}),e.jsxs(W,{className:"space-y-4",style:{backgroundColor:"rgba(255,255,255,0.95)",padding:"20px",borderRadius:"8px"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Teléfono"}),e.jsx(H,{value:i.phone,onChange:r=>p(x=>({...x,phone:r.target.value})),placeholder:"+502 1234-5678",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Perfil"}),e.jsx(H,{value:i.profileImage,onChange:r=>p(x=>({...x,profileImage:r.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="vendedor"&&e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"URL de Foto de Portada"}),e.jsx(H,{value:i.coverImage,onChange:r=>p(x=>({...x,coverImage:r.target.value})),placeholder:"https://...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),s==="repartidor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Tipo de Vehículo"}),e.jsx(H,{value:i.vehicleType,onChange:r=>p(x=>({...x,vehicleType:r.target.value})),placeholder:"Motocicleta, Automóvil, Bicicleta...",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]}),e.jsxs("div",{children:[e.jsx(z,{style:{color:"#000000",fontWeight:"600",backgroundColor:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:"4px"},children:"Número de Licencia"}),e.jsx(H,{value:i.licenseNumber,onChange:r=>p(x=>({...x,licenseNumber:r.target.value})),placeholder:"M-123456",style:{backgroundColor:"#ffffff !important",color:"#000000 !important",border:"1px solid #d1d5db !important"},className:"bg-white text-black border-gray-300"})]})]})]}),e.jsx(k,{onClick:Z,disabled:F,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold",style:{backgroundColor:"#2563eb",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"600"},children:F?"Actualizando...":"Actualizar Perfil"})]})]})]})}function Cs(s){const{user:f}=fe(),[u,j]=c.useState({locationVerified:!1,businessLocationVerified:!1,profileCompleted:!1,canPublish:!1,canPurchase:!1,canWork:!1,requirements:{phone:!1,profileImage:!1,coverImage:!1,location:!1,businessLocation:!1,vehicleType:!1,licenseNumber:!1,adminApproval:!1}}),[d,_]=c.useState(!0);c.useEffect(()=>{f&&S()},[f,s]);const S=async()=>{if(f)try{_(!0);const{data:n,error:b}=await w.from("users").select("*").eq("id",f.id).single();if(b)throw b;let E=null;if(s==="vendedor"){const{data:P,error:R}=await w.from("sellers").select("*").eq("user_id",f.id).single();R||(E=P)}const C={phone:!!(n.phone&&n.phone.trim()!==""),profileImage:!!(n.profile_image_url&&n.profile_image_url.trim()!==""),coverImage:s==="vendedor"?!!(E!=null&&E.cover_image_url&&E.cover_image_url.trim()!==""):!0,location:!!(n.location_verified&&n.latitude&&n.longitude&&n.address),businessLocation:s==="vendedor"?!!(E!=null&&E.business_location_verified&&E.business_latitude&&E.business_longitude&&E.business_address):!0,vehicleType:s==="repartidor"?!!(n.vehicle_type&&n.vehicle_type!=="No especificado"):!0,licenseNumber:s==="repartidor"?!!(n.license_number&&n.license_number!=="No especificado"):!0,adminApproval:s==="repartidor"?!!(n.is_verified&&n.is_active):!0};let v=!1;if(s==="vendedor"){const{data:P,error:R}=await w.rpc("check_seller_can_publish",{seller_user_id:f.id});R||(v=P)}else if(s==="comprador"){const{data:P,error:R}=await w.rpc("check_buyer_can_purchase",{buyer_user_id:f.id});R||(v=P)}else if(s==="repartidor"){const{data:P,error:R}=await w.rpc("check_driver_can_work",{driver_user_id:f.id});R||(v=P)}j({locationVerified:n.location_verified||!1,businessLocationVerified:(E==null?void 0:E.business_location_verified)||!1,profileCompleted:n.profile_completed||!1,canPublish:s==="vendedor"?v:!1,canPurchase:s==="comprador"?v:!1,canWork:s==="repartidor"?v:!1,requirements:C})}catch(n){console.error("Error checking verification status:",n)}finally{_(!1)}};return{status:u,loading:d,refreshStatus:()=>{S()},getCompletionPercentage:()=>{const n=Object.values(u.requirements).length,b=Object.values(u.requirements).filter(Boolean).length;return Math.round(b/n*100)},getMissingRequirements:()=>{const n=[];return u.requirements.phone||n.push("Teléfono"),u.requirements.profileImage||n.push("Foto de perfil"),u.requirements.location||n.push("Ubicación verificada"),s==="vendedor"&&(u.requirements.coverImage||n.push("Foto de portada"),u.requirements.businessLocation||n.push("Ubicación del negocio")),s==="repartidor"&&(u.requirements.vehicleType||n.push("Tipo de vehículo"),u.requirements.licenseNumber||n.push("Número de licencia"),u.requirements.adminApproval||n.push("Aprobación del administrador")),n},canPerformMainAction:()=>{switch(s){case"vendedor":return u.canPublish;case"comprador":return u.canPurchase;case"repartidor":return u.canWork;default:return!1}},getMainActionText:()=>{switch(s){case"vendedor":return u.canPublish?"Puedes publicar productos":"No puedes publicar productos aún";case"comprador":return u.canPurchase?"Puedes realizar compras":"No puedes comprar aún";case"repartidor":return u.canWork?"Puedes tomar órdenes":"No puedes trabajar aún";default:return""}}}}function Oa({userRole:s,onOpenVerification:f,showIfComplete:u=!1}){const{loading:j,canPerformMainAction:d,getMissingRequirements:_,getCompletionPercentage:S}=Cs(s);if(j)return null;const i=d(),p=_(),L=S();if(s==="vendedor"||i&&!u)return null;const I=()=>{switch(s){case"vendedor":return Ke;case"comprador":return ce;case"repartidor":return Pe;default:return ke}},F=()=>{if(i)switch(s){case"vendedor":return"¡Perfil completo! Puedes publicar productos";case"comprador":return"¡Perfil completo! Puedes realizar compras";case"repartidor":return"¡Perfil completo! Puedes tomar órdenes";default:return"¡Perfil completo!"}switch(s){case"vendedor":return"Completa tu perfil para publicar productos";case"comprador":return"Completa tu perfil para realizar compras";case"repartidor":return"Completa tu perfil para trabajar como repartidor";default:return"Completa tu perfil"}},n=()=>i?"Tu perfil está completamente verificado y puedes usar todas las funciones de TRATO.":p.length===0?"Casi listo, solo faltan algunos detalles por verificar.":p.length===1?`Te falta 1 requisito: ${p[0]}.`:`Te faltan ${p.length} requisitos: ${p.slice(0,2).join(", ")}${p.length>2?" y más...":""}.`,b=I();return e.jsx(me,{className:`verification-alert mb-6 ${i?"border-green-200 bg-green-50":"border-orange-200 bg-orange-50"}`,children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0 w-full",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(b,{className:`w-6 h-6 flex-shrink-0 mt-1 ${i?"text-green-600":"text-orange-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-lg leading-tight ${i?"text-green-800":"text-orange-800"}`,children:F()}),e.jsx(ue,{className:`alert-description mt-1 text-sm ${i?"text-green-700":"text-orange-700"}`,children:n()}),!i&&e.jsxs("div",{className:"verification-progress mt-3 space-y-2",children:[e.jsxs("div",{className:"verification-progress-label flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-orange-800",children:"Progreso del perfil"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[L,"%"]})]}),e.jsx("div",{className:"verification-progress-bar w-full bg-orange-200 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${L}%`}})})]})]})]}),e.jsx("div",{className:"flex justify-center md:justify-end mt-4 md:mt-0 md:ml-4",children:e.jsx(k,{onClick:f,className:`verification-button px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 ${i?"bg-green-500 hover:bg-green-600 hover:shadow-green-200":"bg-orange-500 hover:bg-orange-600 hover:shadow-orange-200"}`,style:{minWidth:"160px",borderRadius:"8px",fontSize:"14px",fontWeight:"600"},children:i?"Ver Estado":"Completar Perfil"})})]})})}function Ma({onDismiss:s}){const{user:f}=fe(),{permission:u,requestPermission:j,supported:d}=Ps(),[_,S]=c.useState(!1),[i,p]=c.useState(!1);c.useEffect(()=>{const b=d&&u!=="granted"&&u!=="denied"&&((f==null?void 0:f.role)==="vendedor"||(f==null?void 0:f.role)==="repartidor");p(b)},[d,u,f==null?void 0:f.role]);const L=async()=>{S(!0);try{await j()&&(p(!1),s==null||s())}catch(b){console.error("Error al solicitar permisos:",b)}finally{S(!1)}},I=()=>{p(!1),s==null||s()};if(!i)return null;const n=(()=>{switch(f==null?void 0:f.role){case"vendedor":return{title:"Notificaciones de Nuevas Órdenes",description:"Recibe alertas inmediatas cuando lleguen nuevos pedidos, incluso con la pantalla apagada.",benefits:["📱 Notificaciones incluso con pantalla apagada","🔔 Alertas sonoras para nuevos pedidos","⚡ Respuesta más rápida a clientes"]};case"repartidor":return{title:"Notificaciones de Entregas",description:"Mantente informado sobre nuevas entregas disponibles y asignaciones.",benefits:["🚛 Alertas de nuevas entregas","📍 Notificaciones de asignaciones","💰 No pierdas oportunidades de entrega"]};default:return{title:"Notificaciones Push",description:"Recibe notificaciones importantes de la aplicación.",benefits:["🔔 Alertas importantes","📱 Notificaciones push","⚡ Información en tiempo real"]}}})();return e.jsxs(B,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-yellow-50 shadow-lg",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(ia,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg text-orange-900",children:n.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:n.description})]})]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:I,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:e.jsx(Ee,{className:"w-4 h-4"})})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:n.benefits.map((b,E)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-800",children:[e.jsx(ne,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),b]},E))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{variant:u==="granted"?"default":u==="denied"?"destructive":"secondary",className:"flex items-center gap-1",children:u==="granted"?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-3 h-3"}),"Activadas"]}):u==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-3 h-3"}),"Denegadas"]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3 h-3"}),"Pendientes"]})}),!d&&e.jsx(se,{variant:"outline",className:"text-gray-600",children:"No soportadas en este navegador"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(k,{onClick:L,disabled:_||!d||u==="granted",className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",children:_?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2 animate-spin"}),"Solicitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Activar Notificaciones"]})}),e.jsx(k,{variant:"outline",onClick:I,className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:"Ahora no"})]}),u==="denied"&&e.jsxs(me,{className:"border-red-200 bg-red-50",children:[e.jsx(ke,{className:"w-4 h-4 text-red-600"}),e.jsx(ue,{className:"text-red-800 text-sm",children:"Las notificaciones fueron denegadas. Para activarlas, ve a configuración del navegador → Notificaciones → Permitir para este sitio."})]})]})]})}function La({onPermissionChange:s,userRole:f="buyer",className:u=""}){const[j,d]=c.useState("default"),[_,S]=c.useState(!1);c.useEffect(()=>{"Notification"in window&&d(Notification.permission)},[]);const i=async()=>{if(!("Notification"in window)){alert("Tu navegador no soporta notificaciones");return}if(j!=="granted"){S(!0);try{const p=await Notification.requestPermission();d(p),p==="granted"?(s==null||s(!0),new Notification("¡TRATO Notificaciones Activas!",{body:"Las notificaciones están funcionando correctamente",icon:"/favicon.ico"})):s==null||s(!1)}catch(p){console.error("Error requesting notification permission:",p)}finally{S(!1)}}};return j==="granted"?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-green-700 ${u}`,children:[e.jsx(ne,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Notificaciones activas"})]}):e.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 ${u}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Configurar Notificaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:j==="denied"?"Notificaciones bloqueadas":"Activa las notificaciones para recibir alertas"})]})]}),j!=="denied"&&e.jsx("button",{onClick:i,disabled:_,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:_?"Activando...":"Activar"})]}),j==="denied"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("p",{className:"text-sm text-red-700",children:'Las notificaciones están bloqueadas. Para activarlas, haz clic en el ícono del candado en la barra de direcciones y selecciona "Permitir".'})})]})}function pr(){const{user:s,signOut:f}=fe(),{canPerformMainAction:u,refreshStatus:j}=Cs("vendedor"),[d,_]=c.useState("dashboard"),[S,i]=c.useState("list"),[p,L]=c.useState([]),[I,F]=c.useState([]),[n,b]=c.useState(!0),[E,C]=c.useState(""),[v,P]=c.useState(0),[R,Z]=c.useState(""),[U,ee]=c.useState([]),[a,o]=c.useState(null),[l,m]=c.useState(null),[r,x]=c.useState(!1),[y,A]=c.useState({totalProducts:0,dailyProducts:0,totalViews:0,totalSales:0,revenue:0,avgRating:0});c.useEffect(()=>{s&&(O(),K(),ae(),be(),N(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(g=>{console.log(`🔔 Permisos de notificación: ${g}`),g==="granted"?console.log("✅ Notificaciones habilitadas para nuevos pedidos"):console.warn("⚠️ Notificaciones bloqueadas - solo sonido y alertas visuales")}))},[s]),c.useEffect(()=>{const g=setInterval(()=>{(d==="dashboard"||d==="products")&&K()},6e4);return()=>clearInterval(g)},[d]);const O=async()=>{try{const{data:g,error:M}=await w.from("products").select("*").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(M)throw M;L(g||[])}catch(g){console.error("Error loading products:",g),C("Error al cargar productos")}},K=async()=>{try{const{data:g,error:M}=await w.from("daily_products").select("*").eq("seller_id",s==null?void 0:s.id).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(M)throw M;F(g||[])}catch(g){console.error("Error loading daily products:",g),C("Error al cargar productos del día")}finally{b(!1)}},ae=async()=>{try{const g=p.length,M=I.length;let D=0,Q=0,h=0;try{const{data:t,error:T}=await w.from("orders").select("id").limit(1);if(T)console.log("Orders table not available yet, using default stats");else{const{data:$,error:V}=await w.from("orders").select("id, total, status, created_at").eq("seller_id",s==null?void 0:s.id);!V&&$&&(D=$.length,Q=$.filter(G=>G.status==="delivered").reduce((G,J)=>G+(J.total||0),0),console.log(`Loaded ${D} orders, revenue: Q${Q}`));try{const{data:G,error:J}=await w.from("seller_ratings_view").select("average_rating, total_reviews").eq("seller_id",s==null?void 0:s.id).single();!J&&G?(h=G.average_rating||0,console.log(`🌟 Seller rating: ${h} from ${G.total_reviews} reviews`)):console.log("No ratings found for seller, showing 0.0")}catch{console.log("Rating system not available, using 0.0")}}}catch{console.log("Orders system not configured yet, using default stats")}A({totalProducts:g,dailyProducts:M,totalViews:Math.floor(Math.random()*1e3)+500,totalSales:D,revenue:Q,avgRating:h})}catch(g){console.error("Error loading stats:",g),A({totalProducts:p.length,dailyProducts:I.length,totalViews:0,totalSales:0,revenue:0,avgRating:0})}},ge=()=>{O(),be(),i("list")},ye=()=>{K(),be(),i("list")},Te=g=>{o(g),i("edit-product")},ze=g=>{m(g),i("edit-daily")},Re=()=>{O(),o(null),i("list")},Fe=()=>{K(),m(null),i("list")},Ue=async g=>{try{const{error:M}=await w.from("products").delete().eq("id",g);if(M)throw M;O()}catch(M){console.error("Error deleting product:",M),C("Error al eliminar producto")}},Ie=async g=>{try{const{error:M}=await w.from("daily_products").delete().eq("id",g);if(M)throw M;K()}catch(M){console.error("Error deleting daily product:",M),C("Error al eliminar producto del día")}},N=c.useCallback(async()=>{if(s!=null&&s.id)try{const g=w.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${s.id}`},M=>{console.log("🔔 Nueva orden recibida:",M),P(t=>t+1);const D=M.new,Q=new CustomEvent("criticalNotification",{detail:{type:"new_order",message:`🎯 NUEVA ORDEN: Q${D.total||"0.00"} - ${D.notes||"Sin notas"}`,urgency:"high",sound:!0,persist:!0,metadata:{order_id:D.id,total:D.total,buyer_name:D.buyer_name,created_at:D.created_at}}});window.dispatchEvent(Q),Notification.permission==="granted"&&new Notification("¡Nueva orden en TRATO!",{body:`Tienes un nuevo pedido por Q${D.total||"0.00"}`,icon:"/favicon.ico",tag:"new-order",requireInteraction:!0}),(async()=>{try{await w.from("critical_alerts").insert({alert_type:"new_order",order_id:D.id,user_id:s==null?void 0:s.id,message:`Nueva orden recibida: Q${D.total||"0.00"}`,urgency_level:"high",metadata:{total:D.total,buyer_name:D.buyer_name,notification_sent:!0}})}catch(t){console.error("Error logging critical alert:",t)}})(),Z(new Date().toISOString())}).subscribe();if(Notification.permission==="default"){const M=await Notification.requestPermission();console.log("Notification permission:",M)}return()=>{g.unsubscribe()}}catch(g){console.error("Error setting up order notifications:",g)}},[s==null?void 0:s.id]),X=c.useCallback(async()=>{if(s!=null&&s.id)try{const{data:g,error:M}=await w.from("orders").select("id").limit(1);if(!M){const D=new Date().toISOString(),Q=`seller_last_notification_${s.id}`,h=localStorage.getItem(Q);if(h){const{data:t,error:T}=await w.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).gt("created_at",h).order("created_at",{ascending:!1});!T&&t&&t.length>0&&(P($=>$+t.length),localStorage.setItem(Q,D),console.log(`📦 Found ${t.length} new orders since ${h}`))}else{const{data:t,error:T}=await w.from("orders").select("id, total, created_at, status").eq("seller_id",s.id).eq("status","pending").order("created_at",{ascending:!1});!T&&t&&t.length>0&&(P(t.length),console.log(`📦 Found ${t.length} pending orders (first check)`)),localStorage.setItem(Q,D)}}}catch(g){console.log("📦 Orders table not available for notifications:",g)}},[s==null?void 0:s.id]);c.useEffect(()=>{if(!(s!=null&&s.id))return;X();const g=setInterval(()=>{X()},3e4);return()=>clearInterval(g)},[s==null?void 0:s.id]);const be=async()=>{try{const g=[];if(p.length>0){const D=p[0];g.push({id:`product-${D.id}`,type:"product",message:`Producto agregado: "${D.name}"`,timestamp:D.created_at,color:"green"})}if(I.length>0){const D=I[0];g.push({id:`daily-${D.id}`,type:"daily_product",message:`Venta del día creada: "${D.name}"`,timestamp:D.created_at,color:"orange"})}try{const{data:D,error:Q}=await w.from("orders").select("id").limit(1);if(!Q){const{data:h,error:t}=await w.from("orders").select("id, status, created_at, total").eq("seller_id",s==null?void 0:s.id).order("created_at",{ascending:!1}).limit(3);!t&&h&&h.length>0&&h.forEach(T=>{let $="",V="blue";switch(T.status){case"pending":$=`Nueva orden recibida (Q${T.total})`,V="yellow";break;case"confirmed":$=`Orden confirmada (Q${T.total})`,V="blue";break;case"preparing":$=`Orden en preparación (Q${T.total})`,V="orange";break;case"ready":$=`Orden lista (Q${T.total})`,V="purple";break;case"delivered":$=`Orden entregada (Q${T.total})`,V="green";break;case"cancelled":$=`Orden cancelada (Q${T.total})`,V="red";break;default:$=`Orden ${T.status} (Q${T.total})`,V="blue"}g.push({id:`order-${T.id}`,type:"order",message:$,timestamp:T.created_at,color:V})})}}catch{console.log("Orders table not available for activity")}const M=g.sort((D,Q)=>new Date(Q.timestamp).getTime()-new Date(D.timestamp).getTime()).slice(0,5);ee(M)}catch(g){console.error("Error loading recent activity:",g)}},Ve=g=>{const M=new Date().getTime(),D=new Date(g).getTime(),Q=M-D,h=Math.floor(Q/(1e3*60)),t=Math.floor(Q/(1e3*60*60)),T=Math.floor(Q/(1e3*60*60*24));return h<60?h<=1?"Hace un momento":`Hace ${h} minutos`:t<24?t===1?"Hace 1 hora":`Hace ${t} horas`:T===1?"Ayer":`Hace ${T} días`},Ge=()=>{const g=new Date,M=new Date;M.setHours(23,59,59,999);const D=M.getTime()-g.getTime(),Q=Math.floor(D/(1e3*60*60)),h=Math.floor(D%(1e3*60*60)/(1e3*60));return`${Q}h ${h}m`},Ce=[{id:"dashboard",label:"Inicio",icon:Js,description:"Resumen y estadísticas"},{id:"products",label:"Productos",icon:aa,description:"Gestiona tu menú"},{id:"orders",label:"Pedidos",icon:ca,description:"Órdenes y analytics",hasNotification:v>0,notificationCount:v},{id:"profile",label:"Perfil",icon:Ke,description:"Configuración del negocio"}],Ae=()=>e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(B,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dashboard-welcome",style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",color:"white",padding:"24px",borderRadius:"16px",marginBottom:"16px"},children:e.jsx(ie,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-2 md:p-3 rounded-xl",children:e.jsx(Ne,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{className:"text-lg md:text-2xl text-white leading-tight",style:{color:"white",fontSize:"20px"},children:"¡Bienvenido, Interlano Fernando Interiano! 👋"}),e.jsx("p",{className:"text-sm md:text-base text-white mt-1",style:{color:"white",fontSize:"16px"},children:"Gestiona tu negocio y conecta con más clientes en Gualán"})]})]})})}),e.jsxs("div",{className:"dashboard-stats",style:{display:"grid",gridTemplateColumns:window.innerWidth<=768?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:"12px",marginBottom:"16px"},children:[e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Productos"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:y.totalProducts})]}),e.jsx(xe,{className:"w-6 h-6 md:w-8 md:h-8 text-blue-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas del Día"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:y.dailyProducts})]}),e.jsx(re,{className:"w-6 h-6 md:w-8 md:h-8 text-orange-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:y.totalSales})]}),e.jsx(Os,{className:"w-6 h-6 md:w-8 md:h-8 text-green-500"})]})})}),e.jsx(B,{className:"stat-card",style:{background:"white",padding:"16px",borderRadius:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",textAlign:"center",border:"1px solid #e5e7eb"},children:e.jsx(W,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",style:{fontSize:"12px",color:"#6b7280",textTransform:"uppercase"},children:"Calificación"}),e.jsx("p",{className:"stat-number",style:{fontSize:"24px",fontWeight:"bold",color:"#f97316",marginBottom:"8px"},children:y.avgRating.toFixed(1)})]}),e.jsx(ra,{className:"w-6 h-6 md:w-8 md:h-8 text-yellow-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-green-500"}),"Ingresos del Mes"]})}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:["Q",y.revenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"+12% comparado al mes pasado"})]})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(oa,{className:"w-5 h-5 text-blue-500"}),"Vistas del Perfil"]})}),e.jsxs(W,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:y.totalViews.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vistas esta semana"})]})]})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsx(Y,{children:"Acciones Rápidas"})}),e.jsx(W,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(k,{onClick:()=>{if(!u()){x(!0);return}_("products"),i("add-product")},className:"h-20 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Nuevo Producto"})]})}),e.jsx(k,{onClick:()=>{if(!u()){x(!0);return}_("products"),i("add-daily")},variant:"outline",className:"h-20 border-orange-500 text-orange-600 hover:bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Venta del Día"})]})}),e.jsx(k,{onClick:()=>_("profile"),variant:"outline",className:"h-20 border-blue-500 text-blue-600 hover:bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ne,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Editar Perfil"})]})})]})})]}),e.jsxs(B,{children:[e.jsx(ie,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Actividad Reciente"]})}),e.jsx(W,{children:e.jsx("div",{className:"space-y-3",children:U.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay actividad reciente"})]}):U.map(g=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-${g.color}-50 rounded-lg`,children:[e.jsx("div",{className:`w-2 h-2 bg-${g.color}-500 rounded-full`}),e.jsx("p",{className:"text-sm flex-1",children:g.message}),e.jsx("span",{className:"text-xs text-gray-500",children:Ve(g.timestamp)})]},g.id))})})]})]}),De=()=>S==="add-product"?e.jsx(as,{onSuccess:ge,onCancel:()=>i("list")}):S==="add-daily"?e.jsx(rs,{onSuccess:ye,onCancel:()=>i("list")}):S==="edit-product"&&a?e.jsx(as,{product:a,onSuccess:Re,onCancel:()=>{o(null),i("list")}}):S==="edit-daily"&&l?e.jsx(rs,{dailyProduct:l,onSuccess:Fe,onCancel:()=>{m(null),i("list")}}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 leading-tight",children:"Gestión de Productos"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Administra tu menú y ofertas especiales"})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[e.jsxs(k,{onClick:()=>i("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),e.jsxs(k,{onClick:()=>i("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Venta del Día"]})]})]}),e.jsxs(He,{defaultValue:"products",className:"space-y-6",children:[e.jsxs(Je,{className:"grid w-full grid-cols-2 h-auto p-1 bg-gray-100 rounded-lg",children:[e.jsxs(je,{value:"products",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(xe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos Normales"}),e.jsx("span",{className:"sm:hidden",children:"Normales"}),e.jsxs("span",{className:"ml-1",children:["(",p.length,")"]})]}),e.jsxs(je,{value:"daily",className:"flex items-center justify-center gap-2 py-3 px-2 text-sm font-medium transition-all",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(re,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Productos del Día"}),e.jsx("span",{className:"sm:hidden",children:"Del Día"}),e.jsxs("span",{className:"ml-1",children:["(",I.length,")"]})]})]}),e.jsx(de,{value:"products",className:"space-y-4",children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-gray-400"})}):p.length===0?e.jsx(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(W,{className:"p-8 md:p-12 text-center",children:[e.jsx(xe,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos aún"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Comienza agregando tu primer producto para empezar a vender"}),e.jsxs(k,{onClick:()=>i("add-product"),className:"bg-gradient-to-r from-green-500 to-green-600 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600"},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Agregar Primer Producto"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:p.map(g=>e.jsx(va,{product:g,onEdit:Te,onDelete:Ue},g.id))})}),e.jsxs(de,{value:"daily",className:"space-y-4",children:[I.length>0&&e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-orange-800 text-sm sm:text-base",children:"Tiempo restante:"})]}),e.jsx("span",{className:"font-bold text-orange-800 text-sm sm:text-base",children:Ge()})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Los productos del día se eliminan automáticamente a las 23:59:59"})]}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-gray-400"})}):I.length===0?e.jsx(B,{style:{backgroundColor:"white",border:"1px solid #e5e7eb"},children:e.jsxs(W,{className:"p-8 md:p-12 text-center",children:[e.jsx(re,{className:"w-12 h-12 md:w-16 md:h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tienes productos del día"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"Crea ofertas especiales que duran solo hasta medianoche"}),e.jsxs(k,{onClick:()=>i("add-daily"),variant:"outline",className:"border-orange-500 text-orange-600 hover:bg-orange-50 w-full md:w-auto",style:{minHeight:"44px",fontSize:"14px",fontWeight:"600",borderWidth:"2px"},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Crear Venta del Día"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:I.map(g=>e.jsx(Na,{dailyProduct:g,onEdit:ze,onDelete:Ie},g.id))})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-green-50",children:[e.jsx("div",{className:"container mx-auto px-4 pt-4",children:e.jsx(La,{onPermissionChange:g=>{console.log("🔔 Permisos de notificación cambiados:",g)}})}),e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 mb-2",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-2 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"TRATO Vendedor"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Panel de control empresarial"})]})]}),e.jsxs(k,{variant:"outline",onClick:f,className:"flex items-center gap-1 text-xs md:text-sm px-2 md:px-4 py-2 min-h-[44px]",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar Sesión"}),e.jsx("span",{className:"sm:hidden",children:"Salir"})]})]})})}),e.jsxs("div",{className:"main-content container mx-auto px-4 py-4 md:py-6",style:{paddingBottom:window.innerWidth<=768?"80px":"24px"},children:[E&&e.jsxs(me,{variant:"destructive",className:"mb-4 md:mb-6",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-sm md:text-base",children:E})]}),e.jsx(Oa,{userRole:"vendedor",onOpenVerification:()=>x(!0)}),e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx(Ma,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"mobile-bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,background:"white",borderTop:"2px solid #e5e7eb",padding:"12px",zIndex:50,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsx("div",{className:"grid grid-cols-4 gap-1",children:Ce.map(g=>{const M=g.icon,D=d===g.id;return e.jsxs("button",{onClick:()=>{_(g.id),g.id==="orders"&&P(0)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px",borderRadius:"8px",minHeight:"60px",fontSize:"10px",fontWeight:"500",backgroundColor:D?"#fef3c7":"transparent",color:D?"#f97316":"#6b7280",border:"none",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"w-5 h-5"}),g.hasNotification&&g.notificationCount&&g.notificationCount>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#ef4444",color:"white",fontSize:"10px",borderRadius:"50%",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",animation:"pulse 2s infinite"},children:g.notificationCount>9?"9+":g.notificationCount})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"500",lineHeight:"1.2"},children:g.label})]},g.id)})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(He,{value:d,onValueChange:g=>_(g),className:"space-y-6",children:[e.jsx(Je,{className:"grid w-full grid-cols-4 lg:w-2/3 mx-auto bg-white border border-gray-200",children:Ce.map(g=>{const M=g.icon;return e.jsxs(je,{value:g.id,className:"flex flex-col items-center gap-1 p-4 data-[state=active]:bg-green-100 data-[state=active]:text-green-700 relative",onClick:()=>{g.id==="orders"&&P(0)},children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"w-5 h-5"}),g.hasNotification&&g.notificationCount&&g.notificationCount>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:g.notificationCount>9?"9+":g.notificationCount})]}),e.jsx("span",{className:"text-xs font-medium",children:g.label})]},g.id)})}),e.jsx(de,{value:"dashboard",className:"space-y-6",children:Ae()}),e.jsx(de,{value:"products",className:"space-y-6",children:De()}),e.jsx(de,{value:"orders",className:"space-y-6",children:e.jsx(ns,{})}),e.jsx(de,{value:"profile",className:"space-y-6",children:e.jsx(ts,{})})]})}),e.jsxs("div",{className:"block md:hidden mt-4",children:[d==="dashboard"&&Ae(),d==="products"&&De(),d==="orders"&&e.jsx(ns,{}),d==="profile"&&e.jsx(ts,{})]})]}),e.jsx(Ts,{open:r,onOpenChange:x,children:e.jsxs(Is,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(As,{children:e.jsxs(Ds,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Verificación de Perfil y Ubicación"})]})}),e.jsx($a,{userRole:"vendedor",onVerificationComplete:()=>{x(!1),j()}})]})}),e.jsx(Qs,{}),e.jsx($s,{onNewOrder:()=>{d==="orders"&&window.location.reload()}})]})}export{pr as SellerDashboard};
