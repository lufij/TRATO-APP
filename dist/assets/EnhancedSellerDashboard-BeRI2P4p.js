import{u as w,r as u,s as f,j as a}from"./index-BTyKdRD7.js";import{SellerDashboard as b}from"./SellerDashboard-B1uZhpk3.js";import{u as v,N as x,F as A}from"./FloatingNotifications-Bvy8cVfj.js";import"./alert-CQSZsoEo.js";import"./NotificationSystem-ULUvmE0W.js";import"./volume-2-BMej0IbQ.js";import"./triangle-alert-O3EMxmTl.js";import"./shopping-cart-CODLgsuV.js";import"./input-DvWigz_3.js";import"./textarea-BEO_-vo8.js";import"./label-tt752GDS.js";import"./select-C-Ta4wpw.js";import"./arrow-left-DfIy-RmF.js";import"./upload-BIjAhDXk.js";import"./save-COMb1XqD.js";import"./clock-DJp80oyB.js";import"./TimeoutAlerts-BOBbpnxP.js";import"./truck-DXBDyUMR.js";import"./users-Dpqtw5u0.js";import"./alert-dialog-CJdMw9__.js";import"./eye-off-CCnCCJay.js";import"./trash-2-us24VGaD.js";import"./CriticalNotifications-CNjDfvsN.js";import"./store-BFWsu0R8.js";import"./info-BZooRFu9.js";import"./map-pin-CKjuLaG2.js";import"./mail-3E9qE1O3.js";import"./globe-DoXt7wXi.js";import"./circle-x-C_CfgVQs.js";import"./external-link-DzPkE37O.js";import"./user-CrJaDjzD.js";import"./log-out-DqCQ09YX.js";import"./shopping-bag-CcHcjL33.js";import"./star-YN4C-HPc.js";function ie(){const{user:n}=w(),{notifications:g,addNotification:c,removeNotification:T}=v(),s=u.useCallback(async()=>{try{const e=new(window.AudioContext||window.webkitAudioContext);e.state==="suspended"&&await e.resume();const o=e.createOscillator(),t=e.createOscillator(),i=e.createGain();o.connect(i),t.connect(i),i.connect(e.destination),o.frequency.setValueAtTime(800,e.currentTime),o.frequency.exponentialRampToValueAtTime(600,e.currentTime+.3),o.type="sine",t.frequency.setValueAtTime(1200,e.currentTime),t.frequency.exponentialRampToValueAtTime(900,e.currentTime+.3),t.type="triangle",i.gain.setValueAtTime(0,e.currentTime),i.gain.linearRampToValueAtTime(.4,e.currentTime+.1),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+1.2),o.start(e.currentTime),o.stop(e.currentTime+1.2),t.start(e.currentTime+.1),t.stop(e.currentTime+1),console.log("ðŸ”Š Sonido de pedido reproducido")}catch(e){console.log("âš ï¸ Error con sonido:",e)}},[]);return u.useEffect(()=>{if(!(n!=null&&n.id))return;console.log("ðŸ”” Activando notificaciones para vendedor:",n.email);const e=f.channel("seller-orders").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`seller_id=eq.${n.id}`},o=>{console.log("ðŸŽ¯ Nuevo pedido recibido:",o.new);const t=o.new,i=parseFloat(t.total||"0").toFixed(2);if(c({title:"ðŸ›’ Nuevo Pedido",message:`Orden por Q${i}${t.notes?` - ${t.notes}`:""}`,orderData:t,duration:8e3}),s(),Notification.permission==="granted"){const r=new Notification("ðŸ›’ Nuevo Pedido TRATO",{body:`Orden por Q${i}${t.notes?` - ${t.notes.substring(0,50)}`:""}`,icon:"/favicon.ico",tag:`trato-order-${t.id}`,requireInteraction:!0});setTimeout(()=>{r.close()},1e4),r.onclick=()=>{window.focus(),r.close()}}navigator.vibrate&&navigator.vibrate([200,100,200,100,400])}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`seller_id=eq.${n.id}`},o=>{var r,l,d,m;const t=(r=o.old)==null?void 0:r.status,i=(l=o.new)==null?void 0:l.status;if(t!==i&&(i==="cancelled"||i==="delivered")){const p=((m=(d=o.new)==null?void 0:d.id)==null?void 0:m.toString().slice(-4))||"N/A",N=i==="cancelled"?`Orden #${p} cancelada`:`Orden #${p} marcada como entregada`;c({title:i==="cancelled"?"âŒ Orden Cancelada":"âœ… Orden Entregada",message:N,orderData:o.new,duration:5e3})}}).subscribe(o=>{console.log("ðŸ“¡ Estado de notificaciones:",o),o==="SUBSCRIBED"?console.log("âœ… Escuchando nuevos pedidos"):(o==="CHANNEL_ERROR"||o==="TIMED_OUT")&&console.error("âŒ Error en notificaciones:",o)});return()=>{console.log("ðŸ”„ Desconectando notificaciones"),f.removeChannel(e)}},[n==null?void 0:n.id,c,s]),a.jsxs(a.Fragment,{children:[a.jsx(x,{}),a.jsx(A,{notifications:g,onRemove:T}),a.jsx(b,{})]})}export{ie as EnhancedSellerDashboard};
